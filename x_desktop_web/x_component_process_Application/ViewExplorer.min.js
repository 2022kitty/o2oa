MWF.require("MWF.widget.Mask",null,false);MWF.xDesktop.requireApp("process.Application","WorkExplorer",null,false);MWF.xApplication.process.Application.ViewExplorer=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer,Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i);this.setTooltip();this.path="/x_component_process_Application/$WorkExplorer/";this.cssPath="/x_component_process_Application/$WorkExplorer/"+this.options.style+"/css.wcss";this._loadCss();this.actions=e;this.node=$(t);this.items=[]},load:function(){if(!this.actions){MWF.xDesktop.requireApp("process.Application","Actions.RestActions",function(){this.actions=new MWF.xApplication.process.Application.Actions.RestActions;this.loadToolbar();this.loadFilterNode();this.loadContentNode();this.setNodeScroll()}.bind(this))}else{this.loadToolbar();this.loadFilterNode();this.loadContentNode();this.setNodeScroll()}this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.node)},createWorkListHead:function(){},setContentSize:function(){var t=this.toolbarNode.getSize();var e=this.node.getSize();var i=this.elementContentNode.getStyle("padding-top").toFloat();var s=this.elementContentNode.getStyle("padding-bottom").toFloat();var n=this.filterNode.getSize();var o=e.y-t.y-i-s-n.y;this.elementContentNode.setStyle("height",""+o+"px");this.pageCount=(o/40).toInt()+5},createSearchElementNode:function(){return false},loadFilterNode:function(){this.filterNode=new Element("div",{styles:this.css.filterNode}).inject(this.node);this.filterNode.setStyle("padding","0px 10px");this.loadViewList()},loadViewList:function(){this.actions.listView(this.app.options.id,function(t){if(t.data.length){t.data.each(function(t){this.loadViewListNode(t)}.bind(this));if(this.mask){this.mask.hide();this.mask=null}if(this.currentView){this.currentView.click()}else{this.items[0].click()}}else{this.filterNode.destroy();var e=new Element("div",{styles:this.css.noElementNode,text:this.app.lp.noView}).inject(this.elementContentListNode);if(this.mask){this.mask.hide();this.mask=null}}}.bind(this))},loadViewListNode:function(t){var e=new Element("div",{styles:this.css.filterViewNode}).inject(this.filterNode);e.set("text",t.name);e.store("view",t);this.items.push(e);if(this.app.status.viewName){if(t.name==this.app.status.viewName)this.currentView=e}var i=this;e.addEvent("click",function(){i.loadViewData(this)});e.makeLnk({par:this._getLnkPar(t)})},_getLnkPar:function(t){return{icon:this.path+this.options.style+"/viewIcon/lnk.png",title:t.name,par:'process.Application#{"navi": 2, "id": "'+this.app.options.id+'", "viewName": "'+t.name+'", "hideMenu": true}'}},loadViewData:function(t){if(!this.mask){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.node)}this.items.each(function(t){t.setStyles(this.css.filterViewNode)}.bind(this));t.setStyles(this.css.filterViewNode_current);var e=t.retrieve("view");this.actions.loadView(function(t){this.showViewData(t.data);if(this.mask){this.mask.hide();this.mask=null}}.bind(this),null,e.id,this.app.options.id)},showViewData:function(t){this.elementContentListNode.empty();this.viewTable=null;this.loadViewDataTitle(t.selectEntryList);this.loadViewDataLine(t)},loadViewDataTitle:function(t){this.viewTable=new Element("table",{styles:this.css.viewTableNode,width:"100%",border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.elementContentListNode);this.viewHeadTr=new Element("tr").inject(this.viewTable);t.each(function(t){var e=new Element("th",{styles:this.css.viewHeadTh,text:t.displayName}).inject(this.viewHeadTr)}.bind(this))},loadViewDataLine:function(t){if(t.groupEntry&&t.groupEntry.column){if(t.groupGrid.length){t.groupGrid.each(function(e,i){var s=new Element("tr",{styles:this.css.viewContentTrNode}).inject(this.viewTable);var n=t.selectEntryList.length;var o=new Element("td",{styles:this.css.viewContentGroupTdNode,colSpan:n}).inject(s);var a=new Element("div",{styles:this.css.viewContentTdGroupNode}).inject(o);var l=new Element("div",{styles:this.css.viewContentTdGroupIconNode}).inject(a);var d=new Element("div",{styles:this.css.viewContentTdGroupTextNode}).inject(a);d.set("text",e.group);var r=[];e.list.each(function(e){var i=new Element("tr",{styles:this.css.viewContentTrNode}).inject(this.viewTable);i.setStyle("display","none");var s=new Element("td",{styles:this.css.viewContentTdNode}).inject(i);Object.each(e.data,function(e,s){if(s!=t.groupEntry.column){var n=new Element("td",{styles:this.css.viewContentTdNode}).inject(i);n.set("text",e)}}.bind(this));r.push(i)}.bind(this));a.store("subtrs",r);var c=this;a.addEvent("click",function(){var t=this.retrieve("subtrs");var e=a.getFirst("div");if(t[0]){if(t[0].getStyle("display")=="none"){t.each(function(t){t.setStyle("display","table-row")});e.setStyle("background","url("+"/x_component_process_ViewDesigner/$View/default/icon/down.png) center center no-repeat")}else{t.each(function(t){t.setStyle("display","none")});e.setStyle("background","url("+"/x_component_process_ViewDesigner/$View/default/icon/right.png) center center no-repeat")}}c.setContentHeight()})}.bind(this))}}else{if(t.grid.length){t.grid.each(function(t,e){var i=new Element("tr",{styles:this.css.viewContentTrNode}).inject(this.viewTable);Object.each(t.data,function(t,e){var s=new Element("td",{styles:this.css.viewContentTdNode}).inject(i);s.set("text",t)}.bind(this))}.bind(this))}}}});