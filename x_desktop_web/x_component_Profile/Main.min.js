MWF.xApplication.Profile.options.multitask=false;MWF.xApplication.Profile.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"Profile",icon:"icon.png",width:"800",height:"600",isResize:false,isMax:false,title:MWF.xApplication.Profile.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Profile.LP},loadApplication:function(t){this.loadTitle();this.loadContent()},loadTitle:function(){this.loadTitleBar();this.loadTitleUserNode();this.loadTitleTextNode()},loadTitleBar:function(){this.titleBar=new Element("div",{styles:this.css.titleBar}).inject(this.content)},loadTitleUserNode:function(){this.titleUserNode=new Element("div",{styles:this.css.titleUserNode}).inject(this.titleBar);this.titleUserIconNode=new Element("div",{styles:this.css.titleUserIconNode}).inject(this.titleUserNode);this.titleUserTextNode=new Element("div",{styles:this.css.titleUserTextNode,text:this.desktop.session.user.name}).inject(this.titleUserNode)},loadTitleTextNode:function(){this.taskTitleTextNode=new Element("div",{styles:this.css.titleTextNode,text:this.lp.title}).inject(this.titleBar)},loadContent:function(){this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.content);MWF.require("MWF.widget.Tab",function(){this.tab=new MWF.widget.Tab(this.contentNode,{style:"profile"});this.tab.load();this.loadInforConfigNode();this.loadLayoutConfigNode();this.loadIdeaConfigNode();this.loadPasswordConfigNode();this.inforConfigPage=this.tab.addTab(this.inforConfigNode,this.lp.inforConfig);this.layoutConfigPage=this.tab.addTab(this.layoutConfigNode,this.lp.layoutConfig);this.ideaConfigPage=this.tab.addTab(this.ideaConfigNode,this.lp.ideaConfig);this.passwordConfigPage=this.tab.addTab(this.passwordConfigNode,this.lp.passwordConfig);if(this.options.tab){this[this.options.tab].showIm()}else{this.inforConfigPage.showIm()}}.bind(this))},loadInforConfigNode:function(){this.inforConfigNode=new Element("div",{styles:this.css.configNode}).inject(this.content);this.inforConfigAreaNode=new Element("div",{styles:this.css.inforConfigAreaNode}).inject(this.inforConfigNode);this.getAction(function(){this.action.getPerson(function(t){this.personData=t.data;var e=t.data.icon;if(!e){if(t.data.genderType=="f"){e="/x_component_Profile/$Main/"+this.options.style+"/female.png"}else{e="/x_component_Profile/$Main/"+this.options.style+"/man.png"}}else{e="data:image/png;base64,"+e}var i=this;var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforIconTitleNode,text:this.lp.icon}).inject(s);var o=new Element("div",{styles:this.css.inforIconContentNode}).inject(s);this.contentImgNode=new Element("img",{styles:this.css.inforIconContentImgNode,src:e}).inject(o);var a=new Element("div",{styles:this.css.inforChangeIconNode,text:this.lp.changeIcon,events:{click:function(){this.changeIcon()}.bind(this)}}).inject(s);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.name}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode,text:t.data.name}).inject(s);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.display}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode,text:t.data.employee}).inject(s);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.display}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode}).inject(s);this.displayInputNode=new Element("input",{styles:this.css.inforContentInputNode,value:t.data.display,events:{blur:function(){this.setStyles(i.css.inforContentInputNode)},focus:function(){this.setStyles(i.css.inforContentInputNode_focus)}}}).inject(o);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.mail}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode}).inject(s);this.mailInputNode=new Element("input",{styles:this.css.inforContentInputNode,value:t.data.mail,events:{blur:function(){this.setStyles(i.css.inforContentInputNode)},focus:function(){this.setStyles(i.css.inforContentInputNode_focus)}}}).inject(o);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.mobile}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode}).inject(s);this.mobileInputNode=new Element("input",{styles:this.css.inforContentInputNode,value:t.data.mobile,events:{blur:function(){this.setStyles(i.css.inforContentInputNode)},focus:function(){this.setStyles(i.css.inforContentInputNode_focus)}}}).inject(o);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.weixin}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode}).inject(s);this.weixinInputNode=new Element("input",{styles:this.css.inforContentInputNode,value:t.data.weixin,events:{blur:function(){this.setStyles(i.css.inforContentInputNode)},focus:function(){this.setStyles(i.css.inforContentInputNode_focus)}}}).inject(o);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.QQ}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode}).inject(s);this.qqInputNode=new Element("input",{styles:this.css.inforContentInputNode,value:t.data.qq,events:{blur:function(){this.setStyles(i.css.inforContentInputNode)},focus:function(){this.setStyles(i.css.inforContentInputNode_focus)}}}).inject(o);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);var n=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.signature}).inject(s);var o=new Element("div",{styles:this.css.inforContentNode}).inject(s);this.signatureInputNode=new Element("input",{styles:this.css.inforContentInputNode,value:t.data.signature,events:{blur:function(){this.setStyles(i.css.inforContentInputNode)},focus:function(){this.setStyles(i.css.inforContentInputNode_focus)}}}).inject(o);var s=new Element("div",{styles:this.css.inforLineNode}).inject(this.inforConfigAreaNode);this.saveAction=new Element("div",{styles:this.css.saveAction,text:this.lp.saveInfor}).inject(s);this.saveAction.addEvent("click",function(){this.savePersonInfor()}.bind(this))}.bind(this),null,this.desktop.session.user.name)}.bind(this))},changeIcon:function(){if(!this.uploadFileAreaNode){this.uploadFileAreaNode=new Element("div");var t='<input name="file" type="file"/>';this.uploadFileAreaNode.set("html",t);this.fileUploadNode=this.uploadFileAreaNode.getFirst();this.fileUploadNode.addEvent("change",function(){var t=e.files;if(t.length){for(var i=0;i<t.length;i++){var s=t.item(i);var n=new FormData;n.append("file",s);this.action.changeIcon(function(){this.action.getPerson(function(t){if(t.data){this.personData=t.data;if(this.personData.icon){this.contentImgNode.set("src","data:image/png;base64,"+this.personData.icon)}}}.bind(this))}.bind(this),null,n,s)}}}.bind(this))}var e=this.uploadFileAreaNode.getFirst();e.click()},savePersonInfor:function(){this.personData.display=this.displayInputNode.get("value");this.personData.mail=this.mailInputNode.get("value");this.personData.mobile=this.mobileInputNode.get("value");this.personData.weixin=this.weixinInputNode.get("value");this.personData.qq=this.qqInputNode.get("value");this.personData.signature=this.signatureInputNode.get("value");this.action.updatePerson(this.personData,function(){this.notice(this.lp.saveInforOk,"success")}.bind(this))},loadLayoutConfigNode:function(){this.layoutConfigNode=new Element("div",{styles:this.css.configNode}).inject(this.content);this.clearDataAction=new Element("div",{styles:this.css.clearDataAction,text:this.lp.clear}).inject(this.layoutConfigNode);this.clearDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){MWF.UD.putData("layout",{},function(){this.notice(this.lp.clearok,"success");this.desktop.notRecordStatus=true}.bind(this))}.bind(this))}.bind(this));if(MWF.AC.isAdministrator()){this.defaultDataAction=new Element("div",{styles:this.css.setDefaultDataAction,text:this.lp.setDefault}).inject(this.layoutConfigNode);this.defaultDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var t=this.lp.setDefaultOk;this.close();var e=layout.desktop.getLayoutStatusData();MWF.UD.putPublicData("defaultLayout",e,function(){MWF.xDesktop.notice("success",{x:"right",y:"top"},t,layout.desktop.desktopNode)}.bind(this))}.bind(this))}.bind(this))}},loadIdeaConfigNode:function(){this.ideaConfigNode=new Element("div",{styles:this.css.configNode}).inject(this.content);this.ideasArea=new Element("textarea",{styles:this.css.ideasArea}).inject(this.ideaConfigNode);this.ideasSaveAction=new Element("div",{styles:this.css.ideasSaveAction,text:this.lp.saveIdea}).inject(this.ideaConfigNode);if(MWF.AC.isAdministrator()){this.ideasSaveDefaultAction=new Element("div",{styles:this.css.ideasSaveAction,text:this.lp.saveIdeaDefault}).inject(this.ideaConfigNode);this.ideasSaveDefaultAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var t={};t.ideas=this.ideasArea.get("value").split("\n");MWF.UD.putPublicData("idea",t,function(){this.notice(this.lp.ideaSaveOk,"success")}.bind(this))}.bind(this))}.bind(this))}MWF.require("MWF.widget.UUID",function(){MWF.UD.getDataJson("idea",function(t){if(t){if(t.ideas)this.ideasArea.set("value",t.ideas.join("\n"))}}.bind(this))}.bind(this));this.ideasSaveAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var t={};t.ideas=this.ideasArea.get("value").split("\n");MWF.UD.putData("idea",t,function(){this.notice(this.lp.ideaSaveOk,"success")}.bind(this))}.bind(this))}.bind(this))},loadPasswordConfigNode:function(){this.passwordConfigNode=new Element("div",{styles:this.css.configNode});this.passwordConfigAreaNode=new Element("div",{styles:this.css.inforConfigAreaNode}).inject(this.passwordConfigNode);var t=this;var e=new Element("div",{styles:this.css.inforLineNode}).inject(this.passwordConfigAreaNode);var i=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.oldPassword}).inject(e);var s=new Element("div",{styles:this.css.inforContentNode}).inject(e);this.oldPasswordInputNode=new Element("input",{type:"password",styles:this.css.inforContentInputNode,events:{blur:function(){this.setStyles(t.css.inforContentInputNode)},focus:function(){this.setStyles(t.css.inforContentInputNode_focus)}}}).inject(s);var e=new Element("div",{styles:this.css.inforLineNode}).inject(this.passwordConfigAreaNode);var i=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.password}).inject(e);var s=new Element("div",{styles:this.css.inforContentNode}).inject(e);this.passwordInputNode=new Element("input",{type:"password",styles:this.css.inforContentInputNode,events:{blur:function(){this.setStyles(t.css.inforContentInputNode)},focus:function(){this.setStyles(t.css.inforContentInputNode_focus)}}}).inject(s);var e=new Element("div",{styles:this.css.inforLineNode}).inject(this.passwordConfigAreaNode);var i=new Element("div",{styles:this.css.inforTitleNode,text:this.lp.morePassword}).inject(e);var s=new Element("div",{styles:this.css.inforContentNode}).inject(e);this.morePasswordInputNode=new Element("input",{type:"password",styles:this.css.inforContentInputNode,events:{blur:function(){this.setStyles(t.css.inforContentInputNode)},focus:function(){this.setStyles(t.css.inforContentInputNode_focus)}}}).inject(s);var e=new Element("div",{styles:this.css.inforLineNode}).inject(this.passwordConfigAreaNode);this.saveAction=new Element("div",{styles:this.css.saveAction,text:this.lp.passwordConfig}).inject(e);this.saveAction.addEvent("click",function(){this.changePassword()}.bind(this))},changePassword:function(){var t=this.oldPasswordInputNode.get("value");var e=this.passwordInputNode.get("value");var i=this.morePasswordInputNode.get("value");if(e!=i){this.notice(this.lp.passwordNotMatch,"error");this.passwordInputNode.setStyles(this.css.inforContentInputNode_error);this.morePasswordInputNode.setStyles(this.css.inforContentInputNode_error)}else{this.action.changePassword(t,e,i,function(){this.oldPasswordInputNode.set("value","");this.passwordInputNode.set("value","");this.morePasswordInputNode.set("value","");this.notice(this.lp.changePasswordOk,"success")}.bind(this));if(layout.config.mail){var s="http://"+layout.config.mail+"//names.nsf?changepassword&password="+encodeURIComponent(t)+"&passwordnew="+encodeURIComponent(e)+"&passwordconfirm="+encodeURIComponent(e);var n=new Element("iframe",{styles:{display:"none"}}).inject(this.desktop.desktopNode);n.set("src",s);window.setTimeout(function(){n.destroy()}.bind(this),2e3)}}},getAction:function(t){if(!this.acrion){MWF.xDesktop.requireApp("Profile","Actions.RestActions",function(){this.action=new MWF.xApplication.Profile.Actions.RestActions;if(t)t()}.bind(this))}else{if(t)t()}}});