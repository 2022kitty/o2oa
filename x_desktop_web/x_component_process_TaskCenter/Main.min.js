MWF.require("MWF.widget.Mask",null,false);MWF.xApplication.process.TaskCenter.options.multitask=false;MWF.xApplication.process.TaskCenter.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"process.TaskCenter",icon:"icon.png",width:"1280",height:"700",title:MWF.xApplication.process.TaskCenter.LP.title,filterMap:{applicationList:"applicationList",processList:"processList",creatorCompanyList:"creatorCompanyList",creatorDepartmentList:"creatorDepartmentList",activityNameList:"activityNameList",completedTimeMonthList:"completedTimeMonthList",key:"key"}},onQueryLoad:function(){this.lp=MWF.xApplication.process.TaskCenter.LP},loadApplication:function(t){this.appIcons={};this.tabs=[];this.tabShadows=[];this.loadTitle();this.loadTab();this.loadContent();this.currentTab="";this.openTab()},openTab:function(){var t="task";if(this.status)t=this.status.navi;switch(t){case"task":this.showTask();break;case"done":this.showDone();break;case"read":this.showRead();break;case"readed":this.showReaded();break;case"review":this.showReview();break;default:this.showTask();break}},loadTitle:function(){this.loadTitleBar();this.loadTitleUserNode();this.loadStartProcessActionNode();this.loadTitleTextNode();this.loadSearchNode()},loadTitleBar:function(){this.taskTitleBar=new Element("div",{styles:this.css.taskTitleBar}).inject(this.content)},loadTitleUserNode:function(){this.taskTitleUserNode=new Element("div",{styles:this.css.taskTitleUserNode}).inject(this.taskTitleBar);this.taskTitleUserIconNode=new Element("div",{styles:this.css.taskTitleUserIconNode}).inject(this.taskTitleUserNode);this.taskTitleUserTextNode=new Element("div",{styles:this.css.taskTitleUserTextNode,text:this.desktop.session.user.name}).inject(this.taskTitleUserNode)},loadStartProcessActionNode:function(){this.startProcessAction=new Element("div",{styles:this.css.startProcessAction}).inject(this.taskTitleBar);this.startProcessAction.addEvents({click:function(t){this.showStartProcessArea()}.bind(this)})},showStartProcessArea:function(){if(!this.startProcessAreaNode){this.createStartProcessArea()}this.startProcessAreaNode.fade("0.9")},closeStartProcessArea:function(){if(this.startProcessAreaNode)this.startProcessAreaNode.fade("out")},createStartProcessArea:function(){this.createStartProcessAreaNode();this.createStartProcessCloseNode();this.createStartProcessScrollNode();this.listApplications();this.setResizeStartProcessAreaHeight();this.addEvent("resize",this.setResizeStartProcessAreaHeight.bind(this))},createStartProcessAreaNode:function(){this.startProcessAreaNode=new Element("div",{styles:this.css.startProcessAreaNode}).inject(this.content);this.startProcessAreaNode.addEvent("click",function(t){this.closeStartProcessArea()}.bind(this))},createStartProcessCloseNode:function(){this.startProcessTopNode=new Element("div",{styles:this.css.startProcessTopNode}).inject(this.startProcessAreaNode);this.startProcessCloseNode=new Element("div",{styles:this.css.startProcessCloseNode}).inject(this.startProcessTopNode);this.startProcessCloseNode.addEvent("click",function(t){this.closeStartProcessArea()}.bind(this))},createStartProcessScrollNode:function(){this.startProcessScrollNode=new Element("div",{styles:this.css.startProcessScrollNode}).inject(this.startProcessAreaNode);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.startProcessScrollNode,{style:"xApp_taskcenter",where:"after",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));this.startProcessContentNode=new Element("div",{styles:this.css.startProcessContentNode}).inject(this.startProcessScrollNode)},listApplications:function(){this.getAction(function(){this.action.listApplication(function(t){t.data.each(function(t){new MWF.xApplication.process.TaskCenter.Application(t,this,this.startProcessContentNode)}.bind(this))}.bind(this))}.bind(this))},getAction:function(t){if(!this.action){MWF.xDesktop.requireApp("process.TaskCenter","Actions.RestActions",function(){this.action=new MWF.xApplication.process.TaskCenter.Actions.RestActions;if(t)t()}.bind(this))}else{if(t)t()}},setResizeStartProcessAreaHeight:function(){var t=this.content.getSize();if(this.startProcessAreaNode){var e=this.startProcessCloseNode.getSize();var i=t.y-e.y-80;var s=t.x-110;var o=t.y-60;var n=t.x-90;this.startProcessScrollNode.setStyle("height",""+i+"px");this.startProcessScrollNode.setStyle("width",""+s+"px");this.startProcessAreaNode.setStyle("height",""+o+"px");this.startProcessAreaNode.setStyle("width",""+n+"px")}},loadTitleTextNode:function(){this.taskTitleTextNode=new Element("div",{styles:this.css.taskTitleTextNode,text:this.lp.title}).inject(this.taskTitleBar)},loadSearchNode:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.taskTitleBar);this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode);this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode);this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode);this.searchBarInputNode=new Element("input",{type:"text",value:this.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);var t=this;this.searchBarActionNode.addEvent("click",function(){this.searchTask()}.bind(this));this.searchBarInputNode.addEvents({focus:function(){if(this.value==t.lp.searchKey)this.set("value","")},blur:function(){if(!this.value)this.set("value",t.lp.searchKey)},keydown:function(t){if(t.code==13){this.searchTask();t.preventDefault()}}.bind(this),selectstart:function(t){t.preventDefault()}})},loadTab:function(){this.tabAreaNode=new Element("div",{styles:this.css.tabAreaNode}).inject(this.content);this.createTabLeft();this.createTabItem(this.lp.task,"task.png","task",function(){this.showTask()}.bind(this));this.createTabItem(this.lp.done,"done.png","taskCompleted",function(){this.showDone()}.bind(this));this.createTabItem(this.lp.read,"read.png","read",function(){this.showRead()}.bind(this));this.createTabItem(this.lp.readed,"readed.png","readCompleted",function(){this.showReaded()}.bind(this));this.createTabItem(this.lp.review,"review.png","review",function(){this.showReview()}.bind(this));this.createTabRight();this.createShadowNode();this.getWorkCounts()},getWorkCounts:function(){this.getAction(function(){this.action.getCount(function(t){this.counts=t.data;this["taskCountNode"].set("text","[ "+(this.counts.task>100?"99":this.counts.task)+" ]");this["taskCompletedCountNode"].set("text","[ "+(this.counts.taskCompleted>100?"99":this.counts.taskCompleted)+" ]");this["readCountNode"].set("text","[ "+(this.counts.read>100?"99":this.counts.read)+" ]");this["readCompletedCountNode"].set("text","[ "+(this.counts.readCompleted>100?"99":this.counts.readCompleted)+" ]");this["reviewCountNode"].set("text","[ "+(this.counts.review>100?"99":this.counts.review)+" ]")}.bind(this),null,this.desktop.session.user.name)}.bind(this))},createTaskList:function(){if(!this.contentNode)this.loadContent();this.taskList=new MWF.xApplication.process.TaskCenter.TaskList(this.contentListAreaNode,this)},refreshAll:function(){this.getWorkCounts();if(this.taskList)if(this.currentTab=="task")this.taskList.refresh()},showTask:function(){if(this.currentTab!="task"){this.showTab(0);this.currentTab="task";if(!this.taskList){this.createTaskList();this.taskList.show()}else{this.taskList.show();if(this.taskList)this.taskList.refresh()}}else{if(this.taskList)this.taskList.refresh()}this.searchBarAreaNode.setStyle("display","none")},createTaskCompletedList:function(t){if(!this.contentNode)this.loadContent();this.taskCompletedList=new MWF.xApplication.process.TaskCenter.TaskCompletedList(this.contentListAreaNode,this,t)},showDone:function(){if(this.currentTab!="done"){this.showTab(1);this.currentTab="done";if(!this.taskCompletedList){this.createTaskCompletedList(this.status?this.status.filter:null);this.taskCompletedList.show()}else{this.taskCompletedList.show();if(this.taskCompletedList)this.taskCompletedList.refresh()}}else{if(this.taskCompletedList)this.taskCompletedList.refresh()}this.searchBarAreaNode.setStyle("display","block");this.searchBarInputNode.set("value",this.lp.searchKey)},createReadList:function(t){if(!this.contentNode)this.loadContent();this.readList=new MWF.xApplication.process.TaskCenter.ReadList(this.contentListAreaNode,this,t)},showRead:function(){if(this.currentTab!="read"){this.showTab(2);this.currentTab="read";if(!this.readList){this.createReadList(this.status?this.status.filter:null);this.readList.show()}else{this.readList.show();if(this.readList)this.readList.refresh()}}else{if(this.readList)this.readList.refresh()}this.searchBarAreaNode.setStyle("display","block");this.searchBarInputNode.set("value",this.lp.searchKey)},createReadedList:function(t){if(!this.contentNode)this.loadContent();this.readedList=new MWF.xApplication.process.TaskCenter.ReadedList(this.contentListAreaNode,this,t)},showReaded:function(){if(this.currentTab!="readed"){this.showTab(3);this.currentTab="readed";if(!this.readedList){this.createReadedList(this.status?this.status.filter:null);this.readedList.show()}else{this.readedList.show();if(this.readedList)this.readedList.refresh()}}else{if(this.readedList)this.readedList.refresh()}this.searchBarAreaNode.setStyle("display","block");this.searchBarInputNode.set("value",this.lp.searchKey)},createReviewList:function(t){if(!this.contentNode)this.loadContent();this.reviewList=new MWF.xApplication.process.TaskCenter.ReviewList(this.contentListAreaNode,this,t)},showReview:function(){if(this.currentTab!="review"){this.showTab(4);this.currentTab="review";if(!this.reviewList){this.createReviewList(this.status?this.status.filter:null);this.reviewList.show()}else{this.reviewList.show();if(this.reviewList)this.reviewList.refresh()}}else{if(this.reviewList)this.reviewList.refresh()}this.searchBarAreaNode.setStyle("display","block")},showTab:function(t){this.tabs.each(function(e,i){if(i==t){e.setStyles(this.css.tabItemNode_current)}else{e.setStyles(this.css.tabItemNode)}}.bind(this));this.tabShadows.each(function(e,i){if(i==t){e.setStyles(this.css.tabShadowItemNode_current)}else{e.setStyles(this.css.tabShadowItemNode)}}.bind(this))},createTabLeft:function(){var t=new Element("div",{styles:this.css.tabItemLeftNode}).inject(this.tabAreaNode)},createTabRight:function(){var t=new Element("div",{styles:this.css.tabItemRightNode}).inject(this.tabAreaNode);var e=new Element("div",{styles:this.css.tabItemRightBoxNode}).inject(t)},createTabItem:function(t,e,i,s){var o=new Element("div",{styles:this.css.tabItemNode}).inject(this.tabAreaNode);var n=new Element("div",{styles:this.css.tabItemAreaNode}).inject(o);var a=new Element("div",{styles:this.css.tabItemContentNode}).inject(n);var l=new Element("div",{styles:this.css.tabItemIconNode}).inject(a);l.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/tab/"+e+")");var r=new Element("div",{styles:this.css.tabItemTextNode,text:t}).inject(a);this[i+"CountNode"]=new Element("div",{styles:this.css.tabItemCountNode}).inject(a);o.addEvent("click",function(){s()}.bind(this));this.tabs.push(o)},createShadowNode:function(){this.tabShadowNode=new Element("div",{styles:this.css.tabShadowNode}).inject(this.content);this.createShadowLeftRightNode();this.createShadowItemNode();this.createShadowLeftRightNode()},createShadowLeftRightNode:function(){new Element("div",{styles:this.css.tabShadowLeftRightNode}).inject(this.tabShadowNode)},createShadowItemNode:function(){for(var t=0;t<5;t++){this.tabShadows.push(new Element("div",{styles:this.css.tabShadowItemNode}).inject(this.tabShadowNode))}},loadContent:function(){this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.content);this.contentListAreaNode=new Element("div",{styles:this.css.contentListAreaNode}).inject(this.contentNode);this.setContentNodeHeight();this.addEvent("resize",this.setContentNodeHeight.bind(this))},setContentNodeHeight:function(){var t=this.content.getSize();var e=this.taskTitleBar.getSize();var i=this.tabAreaNode.getSize();var s=this.tabShadowNode.getSize();var o=t.y-e.y-i.y-s.y-1;this.contentNode.setStyle("height",""+o+"px");var n=10;if(this.taskList)n=n+t.x;if(this.taskCompletedList)n=n+t.x;if(this.readList)n=n+t.x;if(this.readCompletedList)n=n+t.x;this.contentListAreaNode.setStyle("width",""+n+"px")},recordStatus:function(){var t=this.currentTab||"task";var e=null;if(t=="done"){e=this.taskCompletedList.filterData}if(t=="read"){e=this.readList.filterData}if(t=="readed"){e=this.readedList.filterData}if(t=="review"){e=this.reviewList.filterData}return{navi:this.currentTab||"task",filter:e}},searchTask:function(){var t=this.searchBarInputNode.get("value");if(t&&t!=this.lp.searchKey){var e=this.currentTab||"task";switch(e){case"done":if(!this.taskCompletedList.filterData)this.taskCompletedList.filterData={};this.taskCompletedList.filterData.key=t;this.taskCompletedList.refilter();break;case"read":if(!this.readList.filterData)this.readList.filterData={};this.readList.filterData.key=t;this.readList.refilter();break;case"readed":if(!this.readedList.filterData)this.readedList.filterData={};this.readedList.filterData.key=t;this.readedList.refilter();break;case"review":if(!this.reviewList.filterData)this.reviewList.filterData={};this.reviewList.filterData.key=t;this.reviewList.refilter();break}}}});MWF.xApplication.process.TaskCenter.Application=new Class({initialize:function(t,e,i){this.bgColors=["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"];this.data=t;this.app=e;this.container=i;this.css=this.app.css;this.load()},load:function(){this.node=new Element("div",{styles:this.css.applicationNode}).inject(this.container);this.topNode=new Element("div",{styles:this.css.applicationTopNode}).inject(this.node);this.iconNode=new Element("div",{styles:this.css.applicationIconNode}).inject(this.topNode);if(this.data.icon){this.iconNode.setStyle("background-image","url(data:image/png;base64,"+this.data.icon+")")}else{this.iconNode.setStyle("background-image","url("+"/x_component_process_ApplicationExplorer/$Main/default/icon/application.png)")}this.textNode=new Element("div",{styles:this.css.applicationTextNode}).inject(this.topNode);this.textNode.set("text",this.data.name);this.childNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.node);this.loadChild()},loadChild:function(){this.app.action.listProcess(function(t){if(t.data.length){t.data.each(function(t){new MWF.xApplication.process.TaskCenter.Process(t,this,this.childNode)}.bind(this))}else{this.node.setStyle("display","none")}}.bind(this),null,this.data.id)}});MWF.xApplication.process.TaskCenter.Process=new Class({initialize:function(t,e,i){this.data=t;this.application=e;this.app=this.application.app;this.container=i;this.css=this.app.css;this.load()},load:function(){this.node=new Element("div.processItem",{styles:this.css.startProcessNode}).inject(this.container);this.iconNode=new Element("div",{styles:this.css.processIconNode}).inject(this.node);this.textNode=new Element("div",{styles:this.css.processTextNode}).inject(this.node);this.textNode.set({text:this.data.name,title:this.data.name+"-"+this.data.description});var t=this;this.node.addEvents({mouseover:function(t){this.node.setStyles(this.css.startProcessNode_over)}.bind(this),mouseout:function(t){this.node.setStyles(this.css.startProcessNode_out)}.bind(this),click:function(t){this.startProcess(t)}.bind(this)})},startProcess:function(t){this.app.closeStartProcessArea();MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){var t=new MWF.xApplication.process.TaskCenter.ProcessStarter(this.data,this.app,{onStarted:function(t,e,i){this.afterStartProcess(t,e,i)}.bind(this)});t.load()}.bind(this))},afterStartProcess:function(t,e,i){var s=[];var o=[];t.each(function(t){if(t.currentTaskIndex!=-1)o.push(t.taskList[t.currentTaskIndex].work);s.push(this.getStartWorkInforObj(t))}.bind(this));if(o.length==1){var n={workId:o[0]};this.app.desktop.openApplication(null,"process.Work",n);this.createStartWorkResault(s,e,i,false)}else{this.createStartWorkResault(s,e,i,true)}},getStartWorkInforObj:function(t){var e=[];var i="";t.taskList.each(function(s,o){e.push(s.person+"("+s.department+")");if(t.currentTaskIndex==o)i=s.id}.bind(this));return{activity:t.fromActivityName,users:e,currentTask:i}},createStartWorkResault:function(t,e,i,s){var o="";t.each(function(t){o+="<div><b>"+this.app.lp.nextActivity+'<font style="color: #ea621f">'+t.activity+"</font>, "+this.app.lp.nextUser+'<font style="color: #ea621f">'+t.users.join(", ")+"</font></b>";if(t.currentTask&&s){o+='&nbsp;&nbsp;&nbsp;&nbsp;<span value="'+t.currentTask+'">'+this.app.lp.deal+"</span></div>"}else{o+="</div>"}}.bind(this));var n={subject:this.app.lp.processStarted,content:"<div>"+this.app.lp.processStartedMessage+"“["+i+"]"+e+"”</div>"+o};var a=layout.desktop.message.addTooltip(n);var l=layout.desktop.message.addMessage(n);this.setStartWorkResaultAction(a);this.setStartWorkResaultAction(l)},setStartWorkResaultAction:function(t){var e=t.node.getElements("span");e.setStyles(this.app.css.dealStartedWorkAction);var i=this;e.addEvent("click",function(t){var e={taskId:this.get("value")};i.app.desktop.openApplication(t,"process.Work",e);nbyc})}});MWF.xApplication.process.TaskCenter.List=new Class({initialize:function(t,e,i){this.container=$(t);this.app=e;this.css=this.app.css;this.currentPageData=[];this.nextPageData=[];this.prevPageData=[];this.initData();this.filterData=null;if(i)this.filterData=i;this.load()},initData:function(){this.count=0;this.isCountShow=false;this.currentPage=1;this.pageCount=20;this.pages=0;this.items=[];this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0;this.filterApplication="";this.currentFilterNode=null;this.filterListNode=null},load:function(){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.app.content);this.contentNode=new Element("div",{styles:this.css.listContentNode}).inject(this.container);this.createActionBarNode();this.createListAreaNode();this.resetListAreaHeight();this.app.addEvent("resize",this.resetListAreaHeight.bind(this));this.setAppContentSize()},refresh:function(){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.app.content);this.initData();this.filterData=null;this.applicationFilterAreaNode.empty();this.createAppFilterNodes();this.listAreaNode.empty();this.resetListAreaHeight();this.app.getWorkCounts()},refilter:function(){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.app.content);this.initData();this.applicationFilterAreaNode.empty();this.createAppFilterNodes();this.listAreaNode.empty();this.resetListAreaHeight()},listItemNext:function(t){debugger;if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(t){debugger;this.count=t.count;if(!this.isCountShow){this.currentFilterNode.getFirst("span").set("text","("+this.count+")");this.isCountShow=true}if(t.count<=this.items.length){this.isItemsLoaded=true}t.data.each(function(t){this.items.push(this._createItem(t))}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.listItemNext()}this.mask.hide()}.bind(this),t)}else{this.loadItemQueue++}}},createActionBarNode:function(){this.actionBarNode=new Element("div",{styles:this.css.actionBarNode}).inject(this.contentNode);this.isFilterOpen=false;this.filterActionNode=new Element("div",{styles:this.css.filterActionNode,text:this.app.lp.filter}).inject(this.actionBarNode);this.filterActionNode.addEvents({click:function(t){this.showOrHideFilter();t.stopPropagation()}.bind(this)});this.applicationFilterAreaNode=new Element("div",{styles:this.css.applicationFilterAreaNode}).inject(this.actionBarNode);this.createAppFilterNodes()},showOrHideFilter:function(){if(!this.isFilterOpen){if(!this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.showFilter()}else{if(this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.hideFilter()}},showFilter:function(){this.filterActionNode.setStyles(this.css.filterActionNode_check);if(!this.filterAreaNode)this.createFilterAreaNode();this.filterAreaTipNode.setStyle("display","block");this.filterAreaNode.setStyle("display","block");this.resizeFilterAreaNode();var t={width:"460px",height:"500px"};this.isFilterOpen=true;this.filterAreaMorph.start(t).chain(function(){this.createFilterAreaTitle();this.createFilterAreaContent();this.hideFilterFun=this.hideFilter.bind(this);$(document.body).addEvent("click",this.hideFilterFun)}.bind(this))},hideFilter:function(){if(this.filterAreaNode){var t={width:"460px",height:"0px"};this.filterAreaNode.empty();this.isFilterOpen=false;this.filterAreaMorph.start(t).chain(function(){this.filterAreaNode.eliminate("input");this.filterAreaNode.setStyle("display","none");this.filterAreaTipNode.setStyle("display","none");this.filterActionNode.setStyles(this.css.filterActionNode)}.bind(this));$(document.body).removeEvent("click",this.hideFilterFun)}},createFilterAreaContent:function(){var t=new Element("div",{styles:this.css.applicationFilterAreaContentScrollNode}).inject(this.filterAreaNode);var e=new Element("div",{styles:{overflow:"hidden"}}).inject(t);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(t,{style:"xApp_filter",where:"after",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));var i=this;this.app.getAction(function(){this._getFilterCount(function(t){var s=t.data;Object.each(s,function(t,s){var o=new Element("div",{styles:this.css.applicationFilterCategoryNode}).inject(e);o.set("text",this.app.lp[s]);var n=new Element("div",{styles:this.css.applicationFilterItemAreaNode}).inject(e);t.each(function(t){var e=new Element("div",{styles:this.css.applicationFilterItemNode}).inject(n);e.set("text",t.name);e.store("value",t.value);e.store("textname",t.name);e.store("key",s);e.addEvent("click",function(){if(this.hasClass("applicationFilterItemNode_over")){i.unSelectedFilterItem(this)}else{i.selectedFilterItem(this)}});if(this.filterData){if(this.filterData[s]){if(t.value==this.filterData[s].value){this.selectedFilterItem(e)}}}}.bind(this))}.bind(this))}.bind(this))}.bind(this))},_getFilterCount:function(t){this.app.action.listTaskCompletedFilterCount(function(e){if(t)t(e)})},unSelectedFilterItem:function(t){if(t.hasClass("applicationFilterItemNode_over")){var e=t.retrieve("value");var i=t.retrieve("textname");var s=t.retrieve("key");t.setStyles(this.css.applicationFilterItemNode);t.removeClass("applicationFilterItemNode_over");t.addClass("applicationFilterItemNode");if(!this.filterData)this.filterData={};this.filterData[s]=null;delete this.filterData[s];t.getParent().eliminate("current")}},selectedFilterItem:function(t){if(!t.hasClass("applicationFilterItemNode_over")){var e=t.getParent().retrieve("current");if(e)this.unSelectedFilterItem(e);var i=t.retrieve("value");var s=t.retrieve("key");var o=t.retrieve("textname");t.setStyles(this.css.applicationFilterItemNode_over);t.removeClass("applicationFilterItemNode");t.addClass("applicationFilterItemNode_over");if(!this.filterData)this.filterData={};this.filterData[s]={value:i,name:o};t.getParent().store("current",t)}},createFilterAreaTitle:function(){var t=new Element("div",{styles:this.app.css.filterAreaTitleNode}).inject(this.filterAreaNode);var e=new Element("div",{styles:this.app.css.filterAreaTitleActionOkNode,text:this.app.lp.ok}).inject(t);var i=new Element("div",{styles:this.app.css.filterAreaTitleActionClearNode,text:this.app.lp.clear}).inject(t);i.addEvent("click",function(){this.filterAreaNode.getElements(".filterItem").each(function(t){this.unSelectedFilterItem(t)}.bind(this));var t=this.filterAreaNode.retrieve("input");t.set("value","");this.filterData=null;this.hideFilter();this.refilter()}.bind(this));e.addEvent("click",function(){var t=this.filterAreaNode.retrieve("input");if(!this.filterData)this.filterData={};var e=t.get("value");if(e&&e!=this.app.lp.searchKey){this.filterData.key=e}else{this.filterData.key="";delete this.filterData.key}this.hideFilter();this.refilter()}.bind(this));var s=new Element("div",{styles:this.app.css.filterAreaTitleSearchNode}).inject(t);var o=new Element("div",{styles:this.app.css.filterAreaTitleSearchIconNode}).inject(s);var n=new Element("div",{styles:this.app.css.filterAreaTitleSearchInputAreaNode}).inject(s);var a=new Element("input",{styles:this.app.css.filterAreaTitleSearchInputNode,value:this.app.lp.searchKey}).inject(n);if(this.filterData){if(this.filterData.key)a.set("value",this.filterData.key)}this.filterAreaNode.store("input",a);var l=this.app.lp.searchKey;a.addEvents({blur:function(){if(!this.get("value"))this.set("value",l)},focus:function(){if(this.get("value")==l)this.set("value","")}})},createFilterAreaNode:function(){this.filterAreaNode=new Element("div",{styles:this.app.css.filterAreaNode}).inject(this.container);this.filterAreaNode.addEvent("click",function(t){t.stopPropagation()});this.filterAreaTipNode=new Element("div",{styles:this.app.css.filterAreaTipNode}).inject(this.container);this.filterAreaNode.setStyles({width:"460px",height:"0px"});this.filterAreaNode.position({relativeTo:this.actionBarNode,position:"bottomRight",edge:"upperRight",offset:{x:0,y:-2}});this.filterAreaTipNode.position({relativeTo:this.filterAreaNode,position:"topRight",edge:"bottomRight",offset:{x:-26,y:1}});this.app.addEvent("resize",function(){this.resizeFilterAreaNode()}.bind(this));this.filterAreaMorph=new Fx.Morph(this.filterAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeInOut})},resizeFilterAreaNode:function(){if(this.filterAreaNode){this.filterAreaNode.position({relativeTo:this.actionBarNode,position:"bottomRight",edge:"upperRight",offset:{x:0,y:-2}});if(this.filterAreaTipNode){this.filterAreaTipNode.position({relativeTo:this.filterAreaNode,position:"topRight",edge:"bottomRight",offset:{x:-26,y:1}})}}},createAppFilterNodes:function(){var t={name:this.app.lp.all,application:"",count:0};this.allAppFilterNode=this.createAppFilterNode(t,"appFilterNode_current");this.currentFilterNode=this.allAppFilterNode;this._getApplicationCount(function(t){t.data.each(function(t){this.createAppFilterNode(t)}.bind(this))}.bind(this))},createAppFilterNode:function(t,e){e=e||"appFilterNode";var i=new Element("div",{styles:this.app.css[e]}).inject(this.applicationFilterAreaNode);var s=t.count?t.name+"<span>("+t.count+")</span>":t.name+"<span></span>";i.set({html:s,id:t.value});var o=this;i.addEvent("click",function(t){o.filterByApplication(this)});return i},filterByApplication:function(t){var e=t.get("id");if(!e){this.refresh()}else{if(this.currentFilterNode)this.currentFilterNode.setStyles(this.app.css.appFilterNode);this.initData();this.filterApplication=e;this.listAreaNode.empty();this.resetListAreaHeight();this.currentFilterNode=t;this.currentFilterNode.setStyles(this.app.css.appFilterNode_current)}},createListAreaNode:function(){this.listScrollAreaNode=new Element("div",{styles:this.css.listScrollAreaNode}).inject(this.contentNode);this.listAreaNode=new Element("div",{styles:this.css.listAreaNode}).inject(this.listScrollAreaNode);var t=this;MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.listScrollAreaNode,{style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(e){var i=t.listScrollAreaNode.getScrollSize();var s=t.listScrollAreaNode.getSize();var o=i.y-s.y;if(e+200>o){if(!t.isElementLoaded)t.listItemNext()}}})}.bind(this))},setAppContentSize:function(){var t=this.app.contentNode.getSize();var e=this.container.getSize().x+t.x;this.container.setStyle("width",""+e+"px")},resetListAreaHeight:function(){var t=this.app.contentNode.getSize();this.contentNode.setStyle("width",""+t.x+"px");var e=this.contentNode.getSize();var i=this.actionBarNode.getSize();var s=e.y-i.y;this.listScrollAreaNode.setStyle("height",""+s+"px");if(this.listAreaNode){var o=(e.x/402).toInt();var n=402*o;var a=(e.x-n)/2;this.listAreaNode.setStyles({width:""+n+"px","margin-left":""+a+"px"});if(this.actionBarNode)this.actionBarNode.setStyles({width:""+n+"px","margin-left":""+a+"px"});var l=(s/102).toInt()+1;this.pageCount=o*l;if(this.items.length<this.pageCount){this.listItemNext(this.pageCount-this.items.length)}}},show:function(){debugger;if(this.app.currentList)this.app.currentList.hide();this.app.currentList=this;this.contentNode.setStyle("display","block")},hide:function(){this.contentNode.setStyle("display","none")},_getCurrentPageData:function(t,e){this.app.getAction(function(){if(this.filterApplication){var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskNextByApp(function(e){if(t)t(e)},null,i,e||this.pageCount,this.filterApplication)}else{var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskNext(function(e){if(t)t(e)},null,i,e||this.pageCount)}}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listTaskApplication(function(e){if(t)t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.TaskList.Item(t,this)}});MWF.xApplication.process.TaskCenter.TaskList=new Class({Extends:MWF.xApplication.process.TaskCenter.List,createAppFilterNodes:function(){var t={name:this.app.lp.all,application:"",count:0};this.allAppFilterNode=this.createAppFilterNode(t,"appFilterNode_current");this.currentFilterNode=this.allAppFilterNode;this.filterListNode=new Element("div",{styles:this.css.filterListNode}).inject(this.applicationFilterAreaNode)},createFilterItemNode:function(t,e){var i=this;var s=new Element("div",{styles:this.css.filterListItemNode}).inject(this.filterListNode);var o=new Element("div",{styles:this.css.filterListItemActionNode}).inject(s);var n=new Element("div",{styles:this.css.filterListItemTextNode}).inject(s);n.set("text",this.app.lp[t]+": "+e.name);o.store("key",t);s.addEvents({mouseover:function(){this.setStyles(i.css.filterListItemNode_over);this.getLast().setStyles(i.css.filterListItemTextNode_over);this.getFirst().setStyles(i.css.filterListItemActionNode_over)},mouseout:function(){this.setStyles(i.css.filterListItemNode);this.getLast().setStyles(i.css.filterListItemTextNode);this.getFirst().setStyles(i.css.filterListItemActionNode)}});o.addEvent("click",function(){var t=this.retrieve("key");if(i.filterData[t])i.filterData[t]=null;delete i.filterData[t];this.destroy();i.refilter()})},_getCurrentPageData:function(t,e){this.app.getAction(function(){if(this.filterData){this.filterListNode.empty();var i={};Object.each(this.filterData,function(t,e){if(e!="key"){if(t){if(!i[this.app.options.filterMap[e]])i[this.app.options.filterMap[e]]=[];i[this.app.options.filterMap[e]].push(t.value);this.createFilterItemNode(e,t)}}else{i.key=t}}.bind(this));if(this.filterData.key){this.createFilterItemNode("key",{name:this.filterData.key})}var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskFilter(function(e){if(t)t(e)},null,s,e||this.pageCount,i)}else{var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskNext(function(e){if(t)t(e)},null,s,e||this.pageCount)}}.bind(this))}});MWF.xApplication.process.TaskCenter.TaskCompletedList=new Class({Extends:MWF.xApplication.process.TaskCenter.List,createAppFilterNodes:function(){var t={name:this.app.lp.all,application:"",count:0};this.allAppFilterNode=this.createAppFilterNode(t,"appFilterNode_current");this.currentFilterNode=this.allAppFilterNode;this.filterListNode=new Element("div",{styles:this.css.filterListNode}).inject(this.applicationFilterAreaNode)},createFilterItemNode:function(t,e){var i=this;var s=new Element("div",{styles:this.css.filterListItemNode}).inject(this.filterListNode);var o=new Element("div",{
styles:this.css.filterListItemActionNode}).inject(s);var n=new Element("div",{styles:this.css.filterListItemTextNode}).inject(s);n.set("text",this.app.lp[t]+": "+e.name);o.store("key",t);s.addEvents({mouseover:function(){this.setStyles(i.css.filterListItemNode_over);this.getLast().setStyles(i.css.filterListItemTextNode_over);this.getFirst().setStyles(i.css.filterListItemActionNode_over)},mouseout:function(){this.setStyles(i.css.filterListItemNode);this.getLast().setStyles(i.css.filterListItemTextNode);this.getFirst().setStyles(i.css.filterListItemActionNode)}});o.addEvent("click",function(){var t=this.retrieve("key");if(i.filterData[t])i.filterData[t]=null;delete i.filterData[t];this.destroy();i.refilter()})},_getCurrentPageData:function(t,e){this.app.getAction(function(){if(this.filterData){this.filterListNode.empty();var i={};Object.each(this.filterData,function(t,e){if(e!="key"){if(t){if(!i[this.app.options.filterMap[e]])i[this.app.options.filterMap[e]]=[];i[this.app.options.filterMap[e]].push(t.value);this.createFilterItemNode(e,t)}}else{i.key=t}}.bind(this));if(this.filterData.key){this.createFilterItemNode("key",{name:this.filterData.key})}var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskCompletedFilter(function(e){if(t)t(e)},null,s,e||this.pageCount,i)}else{var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskCompletedNext(function(e){if(t)t(e)},null,s,e||this.pageCount)}}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listTaskCompletedApplication(function(e){if(t)t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.TaskCompletedList.Item(t,this)}});MWF.xApplication.process.TaskCenter.ReadList=new Class({Extends:MWF.xApplication.process.TaskCenter.TaskCompletedList,_getCurrentPageData:function(t,e){this.app.getAction(function(){if(this.filterData){this.filterListNode.empty();var i={};Object.each(this.filterData,function(t,e){if(e!="key"){if(t){if(!i[this.app.options.filterMap[e]])i[this.app.options.filterMap[e]]=[];i[this.app.options.filterMap[e]].push(t.value);this.createFilterItemNode(e,t)}}else{i.key=t}}.bind(this));if(this.filterData.key){this.createFilterItemNode("key",{name:this.filterData.key})}var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listReadFilter(function(e){if(t)t(e)},null,s,e||this.pageCount,i)}else{var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listReadNext(function(e){if(t)t(e)},null,s,e||this.pageCount)}}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listReadApplication(function(e){if(t)t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.ReadList.Item(t,this)},_getFilterCount:function(t){this.app.action.listReadFilterCount(function(e){if(t)t(e)})}});MWF.xApplication.process.TaskCenter.ReadedList=new Class({Extends:MWF.xApplication.process.TaskCenter.TaskCompletedList,_getCurrentPageData:function(t,e){this.app.getAction(function(){if(this.filterData){this.filterListNode.empty();var i={};Object.each(this.filterData,function(t,e){if(e!="key"){if(t){if(!i[this.app.options.filterMap[e]])i[this.app.options.filterMap[e]]=[];i[this.app.options.filterMap[e]].push(t.value);this.createFilterItemNode(e,t)}}else{i.key=t}}.bind(this));if(this.filterData.key){this.createFilterItemNode("key",{name:this.filterData.key})}var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listReadedFilter(function(e){if(t)t(e)},null,s,e||this.pageCount,i)}else{var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listReadedNext(function(e){if(t)t(e)},null,s,e||this.pageCount)}}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listReadedApplication(function(e){if(t)t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.ReadedList.Item(t,this)},_getFilterCount:function(t){this.app.action.listReadedFilterCount(function(e){if(t)t(e)})}});MWF.xApplication.process.TaskCenter.ReviewList=new Class({Extends:MWF.xApplication.process.TaskCenter.TaskCompletedList,_getCurrentPageData:function(t,e){this.app.getAction(function(){if(this.filterData){this.filterListNode.empty();var i={};Object.each(this.filterData,function(t,e){if(e!="key"){if(t){if(!i[this.app.options.filterMap[e]])i[this.app.options.filterMap[e]]=[];i[this.app.options.filterMap[e]].push(t.value);this.createFilterItemNode(e,t)}}else{i.key=t}}.bind(this));if(this.filterData.key){this.createFilterItemNode("key",{name:this.filterData.key})}var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listReviewFilter(function(e){if(t)t(e)},null,s,e||this.pageCount,i)}else{var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listReviewNext(function(e){if(t)t(e)},null,s,e||this.pageCount)}}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listReviewApplication(function(e){if(t)t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.ReviewList.Item(t,this)},_getFilterCount:function(t){this.app.action.listReviewFilterCount(function(e){if(t)t(e)})}});MWF.xApplication.process.TaskCenter.List.Item=new Class({initialize:function(t,e){this.data=t;this.list=e;this.container=this.list.listAreaNode;this.load()},load:function(){this.node=new Element("div",{styles:this.list.css.itemNode}).inject(this.container);this.applicationIconAreaNode=new Element("div",{styles:this.list.css.itemApplicationIconAreaNode,title:this.data.applicationName}).inject(this.node);this.applicationIconNode=new Element("div",{styles:this.list.css.itemApplicationIconNode}).inject(this.applicationIconAreaNode);this.timeIconNode=new Element("div",{styles:this.list.css.itemTimeIconNode}).inject(this.node);this.contentNode=new Element("div",{styles:this.list.css.itemContentNode}).inject(this.node);this.titleNode=new Element("div",{styles:this.list.css.itemTitleNode}).inject(this.contentNode);this.inforNode=new Element("div",{styles:this.list.css.itemInforNode}).inject(this.contentNode);this.newIconNode=new Element("div",{styles:this.list.css.itemNewIconNode}).inject(this.applicationIconAreaNode);this.setContent();this.setNewIcon();this.setEvent();this.setTimeIcon();this.node.fade("in")},setTimeIcon:function(){this.timeIconNode.empty();if(this.data.expireTime){var t=Date.parse(this.data.expireTime);var e=Date.parse(this.data.createTime);var i=new Date;var s=e.diff(i,"second");var o=i.diff(t,"second");var n=e.diff(t,"second");var a=this.timeIconNode.getSize();var l=s/n;var r=a.y*(l>1?1:l);if(r<5)r=5;var d=a.y-r;this.expireIconNode=new Element("div",{styles:{height:""+r+"px","margin-top":""+d+"px"}}).inject(this.timeIconNode);var h="#00FF00";var c=this.list.app.lp.expire1;c=c.replace(/{time}/g,this.data.expireTime);if(l<.6){}else if(l<.8){h="yellow"}else if(l<1){c=this.list.app.lp.expire2;c=c.replace(/{time}/g,this.data.expireTime);h="orange"}else if(l<2){h="red";c=this.list.app.lp.expire3;c=c.replace(/{time}/g,this.data.expireTime)}else{h="red";c=this.list.app.lp.expire3;c=c.replace(/{time}/g,this.data.expireTime)}this.expireIconNode.setStyle("background",h);this.expireIconNode.set("title",c)}},setEvent:function(){this.node.addEvents({mouseover:function(){this.showAction()}.bind(this),mouseout:function(){this.hideAction()}.bind(this)});if(this.editNode){this.editNode.addEvent("click",function(t){this.editTask()}.bind(this))}if(this.closeNode){this.closeNode.addEvent("click",function(t){this.closeEditTask()}.bind(this))}if(this.titleTextNode){this.titleTextNode.addEvent("click",function(t){this.openTask(t)}.bind(this))}},showAction:function(){},hideAction:function(){},openTask:function(t){var e={workId:this.data.work};this.list.app.desktop.openApplication(t,"process.Work",e)},closeEditTask:function(t){this.closeNode.setStyle("display","none");this.flowInforLeftNode.destroy();this.flowInforRightNode.destroy();this.flowInforContentNode.destroy();this.flowInforScrollNode.destroy();this.flowInforNode.destroy();this.processNode.destroy();this.flowInforScrollFx=null;this.flowInforLeftNode=null;this.flowInforRightNode=null;this.flowInforScrollNode=null;this.flowInforContentNode=null;delete this.flowInforScrollFx;delete this.flowInforLeftNode;delete this.flowInforRightNode;delete this.flowInforScrollNode;delete this.flowInforContentNode;delete this.flowInforNode;delete this.processNode;var e=this.nodeClone.getPosition(this.nodeClone.getOffsetParent());this.list.css.itemNode_edit_from.top=""+e.y+"px";this.list.css.itemNode_edit_from.left=""+e.x+"px";var i=new Fx.Morph(this.node,{duration:200,transition:Fx.Transitions.Expo.easeIn,onComplete:function(){this.nodeClone.destroy();this.list.app.content.unmask();this.node.setStyles(this.list.css.itemNode);this.node.setStyle("opacity",1);this.list.app.removeEvent("resize",this.resizeEditNodeFun);this.editNode.setStyle("display","block");if(t)t()}.bind(this)});i.start(this.list.css.itemNode_edit_from)},editTask:function(){this.list.app.content.mask({destroyOnHide:true,id:"mask_"+this.data.id,style:this.list.css.maskNode});this._getJobByTask(function(t){this.nodeClone=this.node.clone(false);this.nodeClone.inject(this.node,"after");this.node.setStyles(this.list.css.itemNode_edit_from);this.node.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"});this.showEditNode(t)}.bind(this))},setEditTaskNodes:function(t){this.flowInforNode=new Element("div",{styles:this.list.css.flowInforNode}).inject(this.node);this.processNode=new Element("div",{styles:this.list.css.processNode}).inject(this.node);this.setFlowInfor(t);this.setProcessor()},setFlowChart:function(t){var e=0;t.workLogList.each(function(i){if(!i.taskCompletedList)i.taskCompletedList=[];if(!i.taskList)i.taskList=[];if(i.taskCompletedList.length||i.taskList.length){this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,i.fromActivityToken==t.task.activityToken);e++}}.bind(this));return e},setFlowInfor:function(t){this.flowInforLeftNode=new Element("div",{styles:this.list.css.flowInforLeftNode}).inject(this.flowInforNode);this.flowInforRightNode=new Element("div",{styles:this.list.css.flowInforRightNode}).inject(this.flowInforNode);this.flowInforScrollNode=new Element("div",{styles:this.list.css.flowInforScrollNode}).inject(this.flowInforNode);this.flowInforContentNode=new Element("div",{styles:this.list.css.flowInforContentNode}).inject(this.flowInforScrollNode);var e=this.setFlowChart(t);var i=e*40+(e-1)*16;this.flowInforContentNode.setStyle("width",""+i+"px");this.setFlowInforScroll()},toFlowInforLeft:function(){var t=this.flowInforScrollNode.getSize();var e=this.flowInforScrollNode.getScrollSize();var i=this.flowInforScrollNode.getScroll();if(i.x>0){var s=i.x-t.x;if(s<0)s=0;if(s>0){}else{this.flowInforLeftNode.setStyle("background-image","")}if(s+t.x<e.x){this.flowInforRightNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/processor/right.png)")}else{}this.flowInforScrollFx.start(s)}},toFlowInforRight:function(){var t=this.flowInforScrollNode.getSize();var e=this.flowInforScrollNode.getScrollSize();var i=this.flowInforScrollNode.getScroll();if(i.x+t.x<e.x){var s=i.x+t.x;if(s>e.x)s=e.x;if(s>0){this.flowInforLeftNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/processor/left.png)")}else{}if(s+t.x<e.x){}else{this.flowInforRightNode.setStyle("background-image","")}this.flowInforScrollFx.start(s)}},setFlowInforScroll:function(){var t=this.flowInforScrollNode.getSize();var e=this.flowInforScrollNode.getScrollSize();var i=this.flowInforScrollNode.getScroll();if(e.x>t.x){if(!this.flowInforScrollFx)this.flowInforScrollFx=new Fx.Scroll(this.flowInforScrollNode,{wheelStops:false});this.flowInforScrollFx.toRight();this.flowInforLeftNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/processor/left.png)");this.flowInforLeftNode.addEvent("click",function(){this.toFlowInforLeft()}.bind(this));this.flowInforRightNode.addEvent("click",function(){this.toFlowInforRight()}.bind(this))}},createFlowInforWorklogNode:function(t,e,i,s,o){if(s!=0)var n=new Element("div",{styles:this.list.css.logLineNode}).inject(this.flowInforContentNode);var a=new Element("div",{styles:this.list.css.logActivityNode}).inject(this.flowInforContentNode);var l=new Element("div",{styles:this.list.css.logActivityIconNode}).inject(a);var r=new Element("div",{styles:this.list.css.logActivityTextNode,text:t}).inject(a);var d="user";var h="";if(e.length+i.length>1)d="users";if(o)h="_red";var c=new Element("div",{styles:this.list.css.logInforNode});e.each(function(t){var e=new Element("div",{styles:this.list.css.logRouteNode}).inject(c);e.set("text",t.person+": ");var i=new Element("div",{styles:this.list.css.logOpinionNode}).inject(c);if(!t.opinion)t.opinion="";i.set("text","["+t.routeName+"] "+t.opinion);var s=new Element("div",{styles:this.list.css.logTimeNode}).inject(c);s.set("text",t.completedTime);if(this.list.app.desktop.session.user.name==t.person)if(!h)h="_yellow"}.bind(this));i.each(function(t){var e=new Element("div",{styles:this.list.css.taskTextNode}).inject(c);e.set("text",t.person+" "+this.list.app.lp.processing)}.bind(this));var p="url("+"/x_component_process_TaskCenter/$Main/default/processor/"+d+h+".png)";l.setStyle("background-image",p);if(i.length){var f=new Element("div",{styles:this.list.css.logTaskCountNode}).inject(a);var u=i.length>99?"99+":i.length;f.set("text",u)}new mBox.Tooltip({content:c,setStyles:{content:{padding:10,lineHeight:20}},attach:a,transition:"flyin",offset:{x:this.list.app.contentNode.getScroll().x,y:this.list.listScrollAreaNode.getScroll().y}})},setProcessor:function(){var t=this;MWF.xDesktop.requireApp("process.Work","Processor",function(){new MWF.xApplication.process.Work.Processor(this.processNode,this.data,{style:"task",onCancel:function(){t.closeEditTask();delete this},onSubmit:function(e,i){t.submitTask(e,i,this);delete this}})}.bind(this))},addMessage:function(t){var e="";if(t.length){t.each(function(t){var i=[];t.taskList.each(function(t){i.push(t.person+"("+t.department+")")}.bind(this));e+="<div><b>"+this.list.app.lp.nextActivity+'<font style="color: #ea621f">'+t.fromActivityName+"</font>, "+this.list.app.lp.nextUser+'<font style="color: #ea621f">'+i.join(", ")+"</font></b></div>"}.bind(this))}else{e+=this.list.app.lp.workCompleted}var i={subject:this.list.app.lp.taskProcessed,content:"<div>"+this.list.app.lp.taskProcessedMessage+"“"+this.data.title+"”</div>"+e};layout.desktop.message.addTooltip(i);layout.desktop.message.addMessage(i)},submitTask:function(t,e,i){if(!e)e=t;this.data.routeName=t;this.data.opinion=e;this.list.app.action.processTask(function(t){i.destroy();this.closeEditTask(function(){this.node.destroy();this.list.refresh();this.addMessage(t.data);delete this}.bind(this))}.bind(this),null,this.data.id,this.data)},resizeEditNode:function(){var t=this.getEditNodePosition();var e=this.list.app.content.getSize();var i=this.list.app.window.node.getElement("#mask_"+this.data.id);if(i)i.setStyles({width:""+e.x+"px",height:""+e.y+"px"});this.node.setStyles({top:""+t.y+"px",left:""+t.x+"px"})},getEditNodePosition:function(){var t=this.list.app.content.getSize();var e=t.y/2-160;var i=t.x/2-300;if(e<0)e=0;return{x:i,y:e}},showEditNode:function(t,e){var i=this.getEditNodePosition();this.list.css.itemNode_edit.top=""+i.y+"px";this.list.css.itemNode_edit.left=""+i.x+"px";this.editNode.setStyle("display","none");var s=new Fx.Morph(this.node,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this);this.list.app.addEvent("resize",this.resizeEditNodeFun);this.setEditTaskNodes(t);this.closeNode.setStyle("display","block");if(e)e()}.bind(this)});s.start(this.list.css.itemNode_edit)},_getJobByTask:function(t){this.list.app.action.getSimpleJobByTask(function(e){if(t)t(e.data)}.bind(this),null,this.data.id)},setContent:function(){this.titleActionNode=new Element("div",{styles:this.list.css.titleActionNode}).inject(this.titleNode);this.titleTextNode=new Element("div",{styles:this.list.css.titleTextNode,title:this.data.title}).inject(this.titleNode);this.titleTextNode.set("html",'<font style="color: #333;">['+this.data.processName+"]</font>"+this.data.title);var t=new Element("div",{styles:this.list.css.itemInforTimeNode,text:this.data.startTime}).inject(this.inforNode);var e=new Element("div",{styles:this.list.css.itemInforActivityNode,text:this.data.activityName,title:this.data.activityName}).inject(this.inforNode);this.loadActions();this.loadApplicationIcon()},loadActions:function(){if(this.data.allowRapid){this.editNode=new Element("div",{styles:this.list.css.titleActionEditNode}).inject(this.titleActionNode);this.closeNode=new Element("div",{styles:this.list.css.titleActionCloseNode}).inject(this.titleActionNode)}},loadApplicationIcon:function(){this.getApplicationIcon(function(t){if(t){this.applicationIconNode.setStyle("background-image","url(data:image/png;base64,"+t+")")}else{this.applicationIconNode.setStyle("background-image","url("+"/x_component_process_ApplicationExplorer/$Main/default/icon/application.png)")}}.bind(this))},getApplicationIcon:function(t){var e=this.list.app.appIcons[this.data.application];if(!e){this.list.app.action.getApplicationIcon(function(e){if(e.data){this.list.app.appIcons[this.data.application]=e.data.icon;if(t)t(e.data.icon)}else{this.invalidItem=true;if(t)t("iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEgElEQVR4Xu1aPXMTSRB9vUaGQqs6iCgi4Bfgq7I2lqWrSwgQMQHyPzAJIeguvOT4BxbBxYjgkquTrFiiCvkXYCKKCFMSFEjs9tWsrEKWvTtfuyvXrTbd6ZnuN69fz842IecP5Tx+rAFYMyDnCKxTYBUE4MrWta9UuLu49hWeHlJveJy1P6kzQAT7eWPzPgN1MFeI6FpckMx8DKIeAe2iP3mVNiipADALuvAIQAOgLbtd5SGAVtGfvkgDjMQB+Fz1ngXgPdlO64IimOGAnhe7/d90bePGJwbAuOY9AqMJwu0kHTwzF+MIhKbb6b9IYh1rAATdxxub+yRyPMOHgbbrT3Zt08IKgHGlvIUN7NvnuSlyPISPXbc3EDph9BgDMPplu4KAXiad67pRhFXD4Qelf1/3dG3FeCMARPDEzoHJgmnZMAU7JiBoAyBozw4OVr3zy0AKJlCAHd100ALgpL4frC7nZfzhYdGf7ugIoxYAo5r3Mmu1l4V8hglAu9TpP1C1UwZgXC03QLSvOvFKxzHvut1BS8UHDQC8t6kfclQ8VhnDOHK7/TsqQ5UAGFW9JhGeqUy4PIZu3AR/eG9iChtbcPDY7b5+LltYCkB40nMKb01U/9Kv93D5yVN8++N3fP/nb5kvp97b2IqJRFVwg+kdmSBKARhXt/dAzp9a3gOYBzC30wHBxvaUnwoskANQK7/RLXvLAeiAYGN7dpN46HYGP8dtXiwAJ5cZH3V2X+Tt1b/akSZxTIgKfj7Zl4d1bT0p+pPrcWkQC4Bp6ZMFch4IJjZKGyMpibEAjGpem4D7SgstDdIJSGesri8MvCp1+pGf6vEAVMsfTdR/7qRKYGKsqBRRj454njeHqAal7uB61PzxKVDzWBfx5fEyEOLmtw1+Prfb6UfGGfnCRACjgjEBIanghU9GACT9za8DQpLBh4eimLuCSAYkDYBwRAWEpINfA3BRGKCy+zonRh1xNkqB3IugQHic5zIoABjVyscE+kmHbotjZbQXgpf6QQj8qdQZRP6QXR+F43Y39x9DJkL4v/ocDoWw6g1BONXNIdMEm0sNG9szfjEO3W4/tj9BfiOU9yux2e/vwpFJNbC52LSxDY+/4E+uP71tfSkalsM8X4vP82pc9URnxi1Z/l+I94x3brev1Kki1YAfAOT819jsZGh+R5gVM2R3gMt+KDMgFBbR/uZs9nTLYlbBg3FYDCYVmfAt+qMFQHguEA0SG+iZVIU0gRCqTz4qqTZIzANI47bIFpzMWmQWQQBTe9VMEDsP4rpJf5CIRTsFFncqbJNzqLUyTWAcIuCGLu2tNGCZqieNki3TP0im1Bdq7/qTho7gnbeWFQNOsUG00IBEq2y6hyXGO4Cbqi0wMoATA+DHgWl7j4maSWtDqPIsApd3fciCTjQFzltsdl641ACchrU+iDxH0CoG31u2dE81BaJQn4FRqDNRXRylZMwIVR3UI+Z2MZi20wg6dQaoUDDsNV54TMuYylpxYxLXAFuHsrZfA5A14hdtvTUDLtqOZO1P7hnwH8CljF98DV13AAAAAElFTkSuQmCC")}}.bind(this),function(){this.invalidItem=true;if(t)t("iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEgElEQVR4Xu1aPXMTSRB9vUaGQqs6iCgi4Bfgq7I2lqWrSwgQMQHyPzAJIeguvOT4BxbBxYjgkquTrFiiCvkXYCKKCFMSFEjs9tWsrEKWvTtfuyvXrTbd6ZnuN69fz842IecP5Tx+rAFYMyDnCKxTYBUE4MrWta9UuLu49hWeHlJveJy1P6kzQAT7eWPzPgN1MFeI6FpckMx8DKIeAe2iP3mVNiipADALuvAIQAOgLbtd5SGAVtGfvkgDjMQB+Fz1ngXgPdlO64IimOGAnhe7/d90bePGJwbAuOY9AqMJwu0kHTwzF+MIhKbb6b9IYh1rAATdxxub+yRyPMOHgbbrT3Zt08IKgHGlvIUN7NvnuSlyPISPXbc3EDph9BgDMPplu4KAXiad67pRhFXD4Qelf1/3dG3FeCMARPDEzoHJgmnZMAU7JiBoAyBozw4OVr3zy0AKJlCAHd100ALgpL4frC7nZfzhYdGf7ugIoxYAo5r3Mmu1l4V8hglAu9TpP1C1UwZgXC03QLSvOvFKxzHvut1BS8UHDQC8t6kfclQ8VhnDOHK7/TsqQ5UAGFW9JhGeqUy4PIZu3AR/eG9iChtbcPDY7b5+LltYCkB40nMKb01U/9Kv93D5yVN8++N3fP/nb5kvp97b2IqJRFVwg+kdmSBKARhXt/dAzp9a3gOYBzC30wHBxvaUnwoskANQK7/RLXvLAeiAYGN7dpN46HYGP8dtXiwAJ5cZH3V2X+Tt1b/akSZxTIgKfj7Zl4d1bT0p+pPrcWkQC4Bp6ZMFch4IJjZKGyMpibEAjGpem4D7SgstDdIJSGesri8MvCp1+pGf6vEAVMsfTdR/7qRKYGKsqBRRj454njeHqAal7uB61PzxKVDzWBfx5fEyEOLmtw1+Prfb6UfGGfnCRACjgjEBIanghU9GACT9za8DQpLBh4eimLuCSAYkDYBwRAWEpINfA3BRGKCy+zonRh1xNkqB3IugQHic5zIoABjVyscE+kmHbotjZbQXgpf6QQj8qdQZRP6QXR+F43Y39x9DJkL4v/ocDoWw6g1BONXNIdMEm0sNG9szfjEO3W4/tj9BfiOU9yux2e/vwpFJNbC52LSxDY+/4E+uP71tfSkalsM8X4vP82pc9URnxi1Z/l+I94x3brev1Kki1YAfAOT819jsZGh+R5gVM2R3gMt+KDMgFBbR/uZs9nTLYlbBg3FYDCYVmfAt+qMFQHguEA0SG+iZVIU0gRCqTz4qqTZIzANI47bIFpzMWmQWQQBTe9VMEDsP4rpJf5CIRTsFFncqbJNzqLUyTWAcIuCGLu2tNGCZqieNki3TP0im1Bdq7/qTho7gnbeWFQNOsUG00IBEq2y6hyXGO4Cbqi0wMoATA+DHgWl7j4maSWtDqPIsApd3fciCTjQFzltsdl641ACchrU+iDxH0CoG31u2dE81BaJQn4FRqDNRXRylZMwIVR3UI+Z2MZi20wg6dQaoUDDsNV54TMuYylpxYxLXAFuHsrZfA5A14hdtvTUDLtqOZO1P7hnwH8CljF98DV13AAAAAElFTkSuQmCC")}.bind(this),this.data.application)}else{if(t)t(e)}},setNewIcon:function(){var t=(new Date).parse(this.data.startTime);var e=new Date;if(e.getTime()-t.getTime()<864e5){this.newIconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/new.png)")}},setTimeIconNode:function(){var t=["#FF0000","#00d400","#f6ff0c"];var e=(Math.random()*3).toInt();var i=t[e];this.timeIconNode.setStyle("background-color",i)}});MWF.xApplication.process.TaskCenter.TaskList.Item=new Class({Extends:MWF.xApplication.process.TaskCenter.List.Item});MWF.xApplication.process.TaskCenter.TaskCompletedList.Item=new Class({Extends:MWF.xApplication.process.TaskCenter.List.Item,loadActions:function(){this.showTaskCompletedNode=new Element("div",{styles:this.list.css.titleActionShowNode}).inject(this.titleActionNode);this.closeTaskCompletedNode=new Element("div",{styles:this.list.css.titleActionCloseNode}).inject(this.titleActionNode)},setEvent:function(){this.node.addEvents({mouseover:function(){this.showAction()}.bind(this),mouseout:function(){this.hideAction()}.bind(this)});if(this.showTaskCompletedNode){this.showTaskCompletedNode.addEvent("click",function(t){this.showTaskCompleted()}.bind(this))}if(this.closeTaskCompletedNode){this.closeTaskCompletedNode.addEvent("click",function(t){this.closeTaskCompleted()}.bind(this))}if(this.titleTextNode){this.titleTextNode.addEvent("click",function(t){this.showTaskCompleted(t)}.bind(this))}},setFlowChart:function(t){var e=0;debugger;t.workLogTokenList={};t.workLogList.each(function(i){t.workLogTokenList[i.fromActivityToken]=i;if(!i.taskCompletedList)i.taskCompletedList=[];if(!i.taskList)i.taskList=[];if(i.taskCompletedList.length||i.taskList.length){this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,i.fromActivityToken==t.taskCompleted.activityToken);e++}}.bind(this));return e},showAction:function(){if(this.showTaskCompletedNode)this.showTaskCompletedNode.fade("in")},hideAction:function(){if(this.showTaskCompletedNode)this.showTaskCompletedNode.fade("out")},_getJobByTaskComplete:function(){this.list.app.action.getSimpleJobByTaskCompleted(function(t){if(callback)callback(t.data)}.bind(this),null,this.data.id)},showTaskCompleted:function(){if(!this.nodeClone){this.list.app.content.mask({destroyOnHide:true,id:"mask_"+this.data.id,style:this.list.css.maskNode});this._getSimpleJobByTaskComplete(function(t){this.nodeClone=this.node.clone(false);this.nodeClone.inject(this.node,"after");this.node.setStyles(this.list.css.itemNode_edit_from);this.node.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"});this.showEditTaskCompletedNode(t)}.bind(this))}},_getSimpleJobByTaskComplete:function(t){this.list.app.action.getSimpleJobByTaskCompleted(function(e){if(t)t(e.data)}.bind(this),null,this.data.id)},showEditTaskCompletedNode:function(t,e){var i=this.getEditNodePosition();this.list.css.itemNode_edit.top=""+i.y+"px";this.list.css.itemNode_edit.left=""+i.x+"px";this.showTaskCompletedNode.setStyle("display","none");var s=new Fx.Morph(this.node,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this);this.list.app.addEvent("resize",this.resizeEditNodeFun);this.setEditTaskCompleledNodes(t);this.closeTaskCompletedNode.setStyle("display","block");if(e)e()}.bind(this)});s.start(this.list.css.itemNode_edit)},setEditTaskCompleledNodes:function(t){this.flowInforNode=new Element("div",{styles:this.list.css.flowInforNode}).inject(this.node);this.workInforNode=new Element("div",{styles:this.list.css.workInforNode}).inject(this.node);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.workInforNode,{style:"xApp_Task_infor",where:"before",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));this.setFlowInfor(t);this.setWorkInfor(t)},setWorkInfor:function(t){var e=this.list.app.lp;var i=new Element("div",{styles:this.list.css.taskCompletedWorkInforTitleNode,text:e.currentFileStatus}).inject(this.workInforNode);t.workList.each(function(i){var s=t.workLogTokenList[i.activityToken];if(s){var o=[];s.taskList.each(function(t){o.push(t.person+"("+t.department+")")}.bind(this));var n='<table border="0" width="96%" align="center"><tr>'+'<td style="white-space: normal;word-break: break-all;word-wrap:break-word;">'+""+e.fileat+'<font style="color: #00F"> '+s.fromTime+" </font>"+e.flowto+'<font style="color: #00F"> ['+s.fromActivityName+"] </font>"+'<br/><font style="font-weight:bold">'+e.list_owner+": </font>"+o.join(", ")+"</td>"+'<td style="width:60px; text-align:right"><div id="'+i.id+'">打开</div></td>'+"</tr></table>";var a=new Element("div",{styles:this.list.css.taskCompletedWorkInforNode,html:n}).inject(this.workInforNode);var l=a.getElement("table");l;var r=a.getElement("div");if(r){r.setStyles(this.list.css.taskCompletedOpenNode);var d=this;r.addEvent("click",function(t){var e=this.get("id");d.openWorkByTaskCompleted(t,e)})}}}.bind(this));t.workCompletedList.each(function(t){var i='<table border="0" width="90%" align="center"><tr>'+"<td>“"+t.title+"”"+e.fileat+""+t.completedTime+""+e.completed+"</td>"+'<td><div id="'+t.id+'">打开</div></td>'+"</tr></table>";var s=new Element("div",{styles:this.list.css.taskCompletedWorkInforNode,html:i}).inject(this.workInforNode);var o=s.getElement("div");if(o){o.setStyles(this.list.css.taskCompletedOpenNode);var n=this;o.addEvent("click",function(t){var e=this.get("id");n.openWorkCompleteedByTaskCompleted(t,e)})}}.bind(this))},openWorkByTaskCompleted:function(t,e){var i={workId:e,readonly:true};this.list.app.desktop.openApplication(t,"process.Work",i)},openWorkCompleteedByTaskCompleted:function(t,e){var i={workCompletedId:e,readonly:true};this.list.app.desktop.openApplication(t,"process.Work",i)},closeTaskCompleted:function(t){this.closeTaskCompletedNode.setStyle("display","none");this.flowInforLeftNode.destroy();this.flowInforRightNode.destroy();this.flowInforContentNode.destroy();this.flowInforScrollNode.destroy();this.flowInforNode.destroy();this.workInforNode.destroy();this.flowInforScrollFx=null;this.flowInforLeftNode=null;this.flowInforRightNode=null;this.flowInforScrollNode=null;this.flowInforContentNode=null;this.flowInforNode=null;this.workInforNode=null;delete this.flowInforScrollFx;delete this.flowInforLeftNode;delete this.flowInforRightNode;delete this.flowInforScrollNode;delete this.flowInforContentNode;delete this.flowInforNode;delete this.workInforNode;var e=this.nodeClone.getPosition(this.nodeClone.getOffsetParent());this.list.css.itemNode_edit_from.top=""+e.y+"px";this.list.css.itemNode_edit_from.left=""+e.x+"px";var i=new Fx.Morph(this.node,{duration:200,transition:Fx.Transitions.Expo.easeIn,onComplete:function(){this.nodeClone.destroy();this.nodeClone=null;this.list.app.content.unmask();this.node.setStyles(this.list.css.itemNode);this.node.setStyle("opacity",1);this.list.app.removeEvent("resize",this.resizeEditNodeFun);this.showTaskCompletedNode.setStyle("display","block");if(t)t()}.bind(this)});i.start(this.list.css.itemNode_edit_from)}});MWF.xApplication.process.TaskCenter.ReadList.Item=new Class({Extends:MWF.xApplication.process.TaskCenter.TaskCompletedList.Item,setFlowChart:function(t){var e=0;t.workLogTokenList={};t.workLogList.each(function(i){t.workLogTokenList[i.fromActivityToken]=i;if(!i.taskCompletedList)i.taskCompletedList=[];if(!i.taskList)i.taskList=[];if(i.taskCompletedList.length||i.taskList.length){this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,i.fromActivityToken==t.read.activityToken);e++}}.bind(this));return e},_getSimpleJobByTaskComplete:function(t){this.list.app.action.getSimpleJobByRead(function(e){if(t)t(e.data)}.bind(this),null,this.data.id)},loadActions:function(){this.showTaskCompletedNode=new Element("div",{styles:this.list.css.titleActionReadedNode,title:"设置为已阅"}).inject(this.titleActionNode);this.closeTaskCompletedNode=new Element("div",{styles:this.list.css.titleActionCloseNode}).inject(this.titleActionNode)},setEvent:function(){this.node.addEvents({mouseover:function(){this.showAction()}.bind(this),mouseout:function(){this.hideAction()}.bind(this)});if(this.showTaskCompletedNode){this.showTaskCompletedNode.addEvent("click",function(t){this.setReadedClose(t)}.bind(this))}if(this.closeTaskCompletedNode){this.closeTaskCompletedNode.addEvent("click",function(t){this.closeTaskCompleted()}.bind(this))}if(this.titleTextNode){this.titleTextNode.addEvent("click",function(t){this.showTaskCompleted(t)}.bind(this))}},setEditTaskCompleledNodes:function(t){this.flowInforNode=new Element("div",{styles:this.list.css.flowInforNode}).inject(this.node);this.workInforNode=new Element("div",{styles:this.list.css.workInforNode}).inject(this.node);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.workInforNode,{style:"xApp_Task_infor",where:"before",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));this.setFlowInfor(t);this.setWorkInfor(t);this.setReadedButton()},setReadedButton:function(){this.setReadedAction=Element("div",{styles:this.list.css.setReadedAction,text:"设置为已阅"}).inject(this.node);this.setReadedAction.addEvent("click",function(t){this.setReaded(t)}.bind(this))},setReadedClose:function(t){var e=this;var i="您确定要将“"+this.data.title+"”标记为已阅吗？";this.list.app.confirm("infor",t,"标记已阅确认",i,350,130,function(){debugger;e.list.app.action.setReaded(function(){this.node.destroy();this.list.refresh()}.bind(e),null,e.data.id,e.data);this.close()},function(){this.close()},null,this.list.app.content)},setReaded:function(t){var e=this;var i="您确定要将“"+this.data.title+"”标记为已阅吗？";this.list.app.confirm("infor",t,"标记已阅确认",i,350,130,function(){debugger;e.list.app.action.setReaded(function(){this.closeTaskCompleted(function(){this.node.destroy();this.list.refresh()}.bind(this))}.bind(e),null,e.data.id,e.data);this.close()},function(){this.close()},null,this.list.app.content)},closeTaskCompleted:function(t){this.closeTaskCompletedNode.setStyle("display","none");this.flowInforLeftNode.destroy();this.flowInforRightNode.destroy();this.flowInforContentNode.destroy();this.flowInforScrollNode.destroy();this.flowInforNode.destroy();this.workInforNode.destroy();this.setReadedAction.destroy();this.flowInforScrollFx=null;this.flowInforLeftNode=null;this.flowInforRightNode=null;this.flowInforScrollNode=null;this.flowInforContentNode=null;this.flowInforNode=null;this.workInforNode=null;this.setReadedAction=null;delete this.flowInforScrollFx;delete this.flowInforLeftNode;delete this.flowInforRightNode;delete this.flowInforScrollNode;delete this.flowInforContentNode;delete this.flowInforNode;delete this.workInforNode;delete this.setReadedAction;var e=this.nodeClone.getPosition(this.nodeClone.getOffsetParent());this.list.css.itemNode_edit_from.top=""+e.y+"px";this.list.css.itemNode_edit_from.left=""+e.x+"px";var i=new Fx.Morph(this.node,{duration:200,transition:Fx.Transitions.Expo.easeIn,
onComplete:function(){this.nodeClone.destroy();this.nodeClone=null;this.list.app.content.unmask();this.node.setStyles(this.list.css.itemNode);this.node.setStyle("opacity",1);this.list.app.removeEvent("resize",this.resizeEditNodeFun);this.showTaskCompletedNode.setStyle("display","block");if(t)t()}.bind(this)});i.start(this.list.css.itemNode_edit_from)}});MWF.xApplication.process.TaskCenter.ReadedList.Item=new Class({Extends:MWF.xApplication.process.TaskCenter.TaskCompletedList.Item,setFlowChart:function(t){var e=0;t.workLogTokenList={};t.workLogList.each(function(i){t.workLogTokenList[i.fromActivityToken]=i;if(!i.taskCompletedList)i.taskCompletedList=[];if(!i.taskList)i.taskList=[];if(i.taskCompletedList.length||i.taskList.length){this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,false);e++}}.bind(this));return e},_getSimpleJobByTaskComplete:function(t){this.list.app.action.getSimpleJobByReaded(function(e){if(t)t(e.data)}.bind(this),null,this.data.id)}});MWF.xApplication.process.TaskCenter.ReviewList.Item=new Class({Extends:MWF.xApplication.process.TaskCenter.TaskCompletedList.Item,setFlowChart:function(t){var e=0;t.workLogTokenList={};t.workLogList.each(function(i){t.workLogTokenList[i.fromActivityToken]=i;if(!i.taskCompletedList)i.taskCompletedList=[];if(!i.taskList)i.taskList=[];if(i.taskCompletedList.length||i.taskList.length){this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,false);e++}}.bind(this));return e},_getSimpleJobByTaskComplete:function(t){this.list.app.action.getSimpleJobByReview(function(e){if(t)t(e.data)}.bind(this),null,this.data.id)},setContent:function(){this.titleActionNode=new Element("div",{styles:this.list.css.titleActionNode}).inject(this.titleNode);this.titleTextNode=new Element("div",{styles:this.list.css.titleTextNode,title:this.data.title}).inject(this.titleNode);this.titleTextNode.set("html",'<font style="color: #333;">['+this.data.processName+"]</font>"+this.data.title);var t=new Element("div",{styles:this.list.css.itemInforTimeNode,text:this.data.startTime}).inject(this.inforNode);var e=new Element("div",{styles:this.list.css.itemInforActivityNode,text:this.data.applicationName,title:this.data.applicationName}).inject(this.inforNode);this.loadActions();this.loadApplicationIcon()}});