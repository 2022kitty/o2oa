MWF.xApplication.process.TaskCenter.options.multitask=false;MWF.xApplication.process.TaskCenter.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"process.TaskCenter",icon:"icon.png",width:"900",height:"700",title:MWF.xApplication.process.TaskCenter.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.process.TaskCenter.LP},loadApplication:function(t){this.tabs=[];this.tabShadows=[];this.loadTitle();this.loadTab();this.loadContent()},loadTitle:function(){this.loadTitleBar();this.loadTitleUserNode();this.loadStartProcessActionNode();this.loadTitleTextNode();this.loadSearchNode()},loadTitleBar:function(){this.taskTitleBar=new Element("div",{styles:this.css.taskTitleBar}).inject(this.content)},loadTitleUserNode:function(){this.taskTitleUserNode=new Element("div",{styles:this.css.taskTitleUserNode}).inject(this.taskTitleBar);this.taskTitleUserIconNode=new Element("div",{styles:this.css.taskTitleUserIconNode}).inject(this.taskTitleUserNode);this.taskTitleUserTextNode=new Element("div",{styles:this.css.taskTitleUserTextNode,text:this.desktop.session.user.name}).inject(this.taskTitleUserNode)},loadStartProcessActionNode:function(){this.startProcessAction=new Element("div",{styles:this.css.startProcessAction}).inject(this.taskTitleBar);this.startProcessAction.addEvents({click:function(t){this.showStartProcessArea()}.bind(this)})},showStartProcessArea:function(){if(!this.startProcessAreaNode){this.createStartProcessArea()}this.startProcessTween.start("left","-400px","0px")},closeStartProcessArea:function(){if(this.startProcessAreaNode)this.startProcessTween.start("left","0px","-400px")},createStartProcessArea:function(){this.createStartProcessAreaNode();this.createStartProcessCloseNode();this.createStartProcessScrollNode();this.listApplications();this.setResizeStartProcessAreaHeight();this.addEvent("resize",this.setResizeStartProcessAreaHeight.bind(this));this.startProcessTween=new Fx.Tween(this.startProcessAreaNode,{duration:"200",transition:Fx.Transitions.Quad.easeOut})},createStartProcessAreaNode:function(){this.startProcessAreaNode=new Element("div",{styles:this.css.startProcessAreaNode}).inject(this.content)},createStartProcessCloseNode:function(){this.startProcessTopNode=new Element("div",{styles:this.css.startProcessTopNode}).inject(this.startProcessAreaNode);this.startProcessCloseNode=new Element("div",{styles:this.css.startProcessCloseNode}).inject(this.startProcessTopNode);this.startProcessCloseNode.addEvent("click",function(t){this.closeStartProcessArea()}.bind(this))},createStartProcessScrollNode:function(){this.startProcessScrollNode=new Element("div",{styles:this.css.startProcessScrollNode}).inject(this.startProcessAreaNode);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.startProcessScrollNode,{style:"xApp_taskcenter",where:"after",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));this.startProcessContentNode=new Element("div",{styles:this.css.startProcessContentNode}).inject(this.startProcessScrollNode)},listApplications:function(){this.getAction(function(){this.action.listApplication(function(t){t.data.each(function(t){new MWF.xApplication.process.TaskCenter.Application(t,this,this.startProcessContentNode)}.bind(this))}.bind(this))}.bind(this))},getAction:function(t){if(!this.action){MWF.require("MWF.xApplication.process.TaskCenter.Actions.RestActions",function(){this.action=new MWF.xApplication.process.TaskCenter.Actions.RestActions;if(t)t()}.bind(this))}else{if(t)t()}},setResizeStartProcessAreaHeight:function(){var t=this.content.getSize();if(this.startProcessAreaNode){var e=this.startProcessCloseNode.getSize();this.startProcessAreaNode.setStyle("height",""+t.y+"px");var s=t.y-e.y-20;this.startProcessScrollNode.setStyle("height",""+s+"px")}},loadTitleTextNode:function(){this.taskTitleTextNode=new Element("div",{styles:this.css.taskTitleTextNode,text:this.lp.title}).inject(this.taskTitleBar)},loadSearchNode:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.taskTitleBar);this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode);this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode);this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode);this.searchBarInputNode=new Element("input",{type:"text",value:this.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);var t=this;this.searchBarActionNode.addEvent("click",function(){this.searchTask()}.bind(this));this.searchBarInputNode.addEvents({focus:function(){if(this.value==t.lp.searchKey)this.set("value","")},blur:function(){if(!this.value)this.set("value",t.lp.searchKey)},keydown:function(t){if(t.code==13){this.searchTask();t.preventDefault()}}.bind(this),selectstart:function(t){t.preventDefault()}})},loadTab:function(){this.tabAreaNode=new Element("div",{styles:this.css.tabAreaNode}).inject(this.content);this.createTabLeft();this.createTabItem(this.lp.task,"task.png",function(){this.showTask()}.bind(this));this.createTabItem(this.lp.done,"done.png",function(){this.showDone()}.bind(this));this.createTabItem(this.lp.draft,"draft.png",function(){this.showDraft()}.bind(this));this.createTabItem(this.lp.myfile,"myfile.png",function(){this.showMyfile()}.bind(this));this.createTabRight();this.createShadowNode()},createTaskList:function(){if(!this.contentNode)this.loadContent();this.taskList=new MWF.xApplication.process.TaskCenter.TaskList(this.contentNode,this)},showTask:function(){if(this.currentTab!="task"){this.showTab(0);if(!this.taskList){this.createTaskList()}this.taskList.show();this.currentTab="task"}},createTaskCompletedList:function(){if(!this.contentNode)this.loadContent();this.taskCompletedList=new MWF.xApplication.process.TaskCenter.TaskCompletedList(this.contentNode,this)},showDone:function(){if(this.currentTab!="done"){this.showTab(1);if(!this.taskCompletedList){this.createTaskCompletedList()}this.taskCompletedList.show();this.currentTab="done"}},showDraft:function(){this.showTab(2)},showMyfile:function(){this.showTab(3)},showTab:function(t){this.tabs.each(function(e,s){if(s==t){e.setStyles(this.css.tabItemNode_current)}else{e.setStyles(this.css.tabItemNode)}}.bind(this));this.tabShadows.each(function(e,s){if(s==t){e.setStyles(this.css.tabShadowItemNode_current)}else{e.setStyles(this.css.tabShadowItemNode)}}.bind(this))},createTabLeft:function(){var t=new Element("div",{styles:this.css.tabItemLeftNode}).inject(this.tabAreaNode)},createTabRight:function(){var t=new Element("div",{styles:this.css.tabItemRightNode}).inject(this.tabAreaNode);var e=new Element("div",{styles:this.css.tabItemRightBoxNode}).inject(t)},createTabItem:function(t,e,s){var i=new Element("div",{styles:this.css.tabItemNode}).inject(this.tabAreaNode);var n=new Element("div",{styles:this.css.tabItemAreaNode}).inject(i);var o=new Element("div",{styles:this.css.tabItemContentNode}).inject(n);var a=new Element("div",{styles:this.css.tabItemIconNode}).inject(o);a.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/tab/"+e+")");var c=new Element("div",{styles:this.css.tabItemTextNode,text:t}).inject(o);i.addEvent("click",function(){s()}.bind(this));this.tabs.push(i)},createShadowNode:function(){this.tabShadowNode=new Element("div",{styles:this.css.tabShadowNode}).inject(this.content);this.createShadowLeftRightNode();this.createShadowItemNode();this.createShadowLeftRightNode()},createShadowLeftRightNode:function(){new Element("div",{styles:this.css.tabShadowLeftRightNode}).inject(this.tabShadowNode)},createShadowItemNode:function(){for(var t=0;t<4;t++){this.tabShadows.push(new Element("div",{styles:this.css.tabShadowItemNode}).inject(this.tabShadowNode))}},loadContent:function(){this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.content);this.setContentNodeHeight();this.addEvent("resize",this.setContentNodeHeight.bind(this))},setContentNodeHeight:function(){var t=this.content.getSize();var e=this.taskTitleBar.getSize();var s=this.tabAreaNode.getSize();var i=this.tabShadowNode.getSize();var n=t.y-e.y-s.y-i.y-1;this.contentNode.setStyle("height",""+n+"px")},searchTask:function(){}});MWF.xApplication.process.TaskCenter.Application=new Class({initialize:function(t,e,s){this.bgColors=["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"];this.data=t;this.app=e;this.container=s;this.css=this.app.css;this.load()},load:function(){this.node=new Element("div",{styles:this.css.applicationNode}).inject(this.container);this.topNode=new Element("div",{styles:this.css.applicationTopNode}).inject(this.node);this.iconNode=new Element("div",{styles:this.css.applicationIconNode}).inject(this.topNode);if(this.data.icon){this.iconNode.setStyle("background-image","url(data:image/png;base64,"+this.data.icon+")")}else{this.iconNode.setStyle("background-image","url("+"/x_component_process_ApplicationExplorer/$Main/default/icon/application.png)")}this.textNode=new Element("div",{styles:this.css.applicationTextNode}).inject(this.topNode);this.textNode.set("text",this.data.name);this.childNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.node);this.loadChild()},loadChild:function(){this.app.action.listProcess(function(t){if(t.data.length){t.data.each(function(t){new MWF.xApplication.process.TaskCenter.Process(t,this,this.childNode)}.bind(this))}else{this.node.setStyle("display","none")}}.bind(this),null,this.data.id)}});MWF.xApplication.process.TaskCenter.Process=new Class({initialize:function(t,e,s){this.data=t;this.application=e;this.app=this.application.app;this.container=s;this.css=this.app.css;this.load()},load:function(){this.node=new Element("div",{styles:this.css.processNode}).inject(this.container);this.iconNode=new Element("div",{styles:this.css.processIconNode}).inject(this.node);this.textNode=new Element("div",{styles:this.css.processTextNode}).inject(this.node);this.textNode.set({text:this.data.name,title:this.data.name+"-"+this.data.description});var t=this;this.node.addEvents({mouseover:function(t){this.node.setStyles(this.css.processNode_over)}.bind(this),mouseout:function(t){this.node.setStyles(this.css.processNode_out)}.bind(this),click:function(t){this.startProcess(t)}.bind(this)})},startProcess:function(t){this.app.closeStartProcessArea();MWF.require("MWF.xApplication.process.TaskCenter.ProcessStarter",function(){var e=new MWF.xApplication.process.TaskCenter.ProcessStarter(this.data,this.app,{onStarted:function(e){var s=this;var i={workId:e};this.app.desktop.openApplication(t,"process.Work",i)}.bind(this)});e.load()}.bind(this))}});MWF.xApplication.process.TaskCenter.List=new Class({initialize:function(t,e){this.container=$(t);this.app=e;this.css=this.app.css;this.currentPageData=[];this.nextPageData=[];this.prevPageData=[];this.count=0;this.currentPage=1;this.pageCount=20;this.pages=0;this.load()},load:function(){this.contentNode=new Element("div",{styles:this.css.listContentNode}).inject(this.container);this.topPageAreaNode=new Element("div",{styles:this.css.listPageAreaNode}).inject(this.contentNode);this.createListAreaNode();this.bottomPageAreaNode=new Element("div",{styles:this.css.listPageAreaNode}).inject(this.contentNode);this.resetListAreaHeight();this.app.addEvent("resize",this.resetListAreaHeight.bind(this));this.listCurrentPage()},listCurrentPage:function(){this._getCurrentPageData(function(t){this.count=t.count;this.reloadPages();t.data.each(function(t){new MWF.xApplication.process.TaskCenter.List.Item(t,this)}.bind(this))}.bind(this))},reloadPages:function(){var t=this.count/this.pageCount;this.pages=t.toInt();if(this.pages<t)this.pages=this.pages+1;this.reloadItemPages(this.topPageAreaNode);this.reloadItemPages(this.bottomPageAreaNode)},reloadItemPages:function(t){var e=this;for(var s=this.pages;s>=1;s--){var i=new Element("div",{styles:this.css.listPageNode,text:s}).inject(t);i.addEvents({mouseover:function(){this.setStyle("background-color","#ffad64")},mouseout:function(){this.setStyle("background-color","#fff")},click:function(){e.gotoPage(this.get("text"))}})}},gotoPage:function(t){},createPageNode:function(){this.leftAreaPageNode=new Element("div",{styles:this.css.leftAreaPageNode}).inject(this.contentNode);this.rightAreaPageNode=new Element("div",{styles:this.css.rightAreaPageNode}).inject(this.contentNode);this.leftPageNode=new Element("div",{styles:this.css.leftPageNode}).inject(this.leftAreaPageNode);this.rightPageNode=new Element("div",{styles:this.css.rightPageNode}).inject(this.rightAreaPageNode);this.leftPageIconNode=new Element("div",{styles:this.css.leftPageIconNode}).inject(this.leftPageNode);this.rightPagIconeNode=new Element("div",{styles:this.css.rightPagIconeNode}).inject(this.rightPageNode);this.leftAreaPageNode.addEvents({mouseover:function(){this.leftPageNode.fade("in");this.rightPageNode.fade("in")}.bind(this),mouseout:function(){this.leftPageNode.fade("out");this.rightPageNode.fade("out")}.bind(this)});this.rightAreaPageNode.addEvents({mouseover:function(){this.leftPageNode.fade("in");this.rightPageNode.fade("in")}.bind(this),mouseout:function(){this.leftPageNode.fade("out");this.rightPageNode.fade("out")}.bind(this)});this.leftPageNode.addEvent("click",function(){}.bind(this))},createListAreaNode:function(){},createListAreaNode:function(){this.createPageNode();this.listScrollAreaNode=new Element("div",{styles:this.css.listScrollAreaNode}).inject(this.contentNode);this.listAreaNode=new Element("div",{styles:this.css.listAreaNode}).inject(this.listScrollAreaNode);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.listScrollAreaNode,{style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this))},resetListAreaHeight:function(){var t=this.contentNode.getSize();var e=this.topPageAreaNode.getSize();var s=t.y-e.y*2;this.listScrollAreaNode.setStyle("height",""+s+"px");this.leftAreaPageNode.setStyle("height",""+s+"px");this.rightAreaPageNode.setStyle("height",""+s+"px");this.pageCount=((s-30)/30).toInt()},show:function(){new Fx.Scroll(this.container).toElementEdge(this.contentNode)},_getCurrentPageData:function(t){this.app.getAction(function(){var e=this.currentPageData.length?this.currentPageData[this.currentPageData.length-1].id:"(0)";this.app.action.listTaskNext(function(e){if(t)t(e)},null,e,this.pageCount)}.bind(this))}});MWF.xApplication.process.TaskCenter.TaskList=new Class({Extends:MWF.xApplication.process.TaskCenter.List});MWF.xApplication.process.TaskCenter.TaskCompletedList=new Class({Extends:MWF.xApplication.process.TaskCenter.List,_getCurrentPageData:function(t){this.app.getAction(function(){var e=this.currentPageData.length?this.currentPageData[this.currentPageData.length-1].id:"(0)";this.app.action.listTaskCompletedNext(function(e){if(t)t(e)},null,e,this.pageCount)}.bind(this))}});MWF.xApplication.process.TaskCenter.List.Item=new Class({initialize:function(t,e){this.data=t;this.list=e;this.container=this.list.listAreaNode;this.load()},load:function(){this.node=new Element("div",{styles:this.list.css.itemNode}).inject(this.container);this.applicationIconNode=new Element("div",{styles:this.list.css.itemApplicationIconNode}).inject(this.node);this.timeIconNode=new Element("div",{styles:this.list.css.itemTimeIconNode}).inject(this.node);this.contentNode=new Element("div",{styles:this.list.css.itemContentNode}).inject(this.node);this.titleNode=new Element("div",{styles:this.list.css.itemTitleNode}).inject(this.contentNode);this.inforNode=new Element("div",{styles:this.list.css.itemInforNode}).inject(this.contentNode);this.setContent()},setContent:function(){this.titleNode.set("text",this.data.title);var t=new Element("div",{styles:this.list.css.itemInforProcessNode,text:this.data.processName}).inject(this.inforNode);var e=new Element("div",{styles:this.list.css.itemInforTimeNode,text:this.data.updateTime}).inject(this.inforNode);var s=new Element("div",{styles:this.list.css.itemInforActivityNode,text:this.data.activityName}).inject(this.inforNode)}});