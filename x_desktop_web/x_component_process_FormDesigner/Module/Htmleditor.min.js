MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.$Element",null,false);MWF.xApplication.process.FormDesigner.Module.Htmleditor=MWF.FCHtmleditor=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"/x_component_process_FormDesigner/Module/Htmleditor/htmleditor.html"},initialize:function(e,t){this.setOptions(t);this.path="/x_component_process_FormDesigner/Module/Htmleditor/";this.cssPath="/x_component_process_FormDesigner/Module/Htmleditor/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="element";this.moduleName="htmleditor";this.form=e;this.container=null;this.containerNode=null},_createMoveNode:function(){this.moveNode=new Element("div",{MWFType:"itmleditor",id:this.json.id,styles:this.css.moduleNodeMove,events:{selectstart:function(){return false}}}).inject(this.form.container)},_createNode:function(){this.node=this.moveNode.clone(true,true);this.node.setStyles(this.css.moduleNode);this.node.set("id",this.json.id);this.node.addEvent("selectstart",function(e){e.preventDefault()})},_setEditStyle_custom:function(e){if(e=="editorProperties"){if(this.editor){Object.each(this.json.editorProperties,function(e,t){if(e=="true")this.json.editorProperties[t]=true;if(e=="false")this.json.editorProperties[t]=false}.bind(this));this.distroyCkeditor();var t=Object.clone(this.json.editorProperties);if(this.json.config){if(this.json.config.code){var i=MWF.Macro.exec(this.json.config.code,this);Object.each(i,function(e,i){t[i]=e})}}this.loadCkeditor(t)}}debugger;if(e=="templateCode"){if(this.editor)this.editor.setData(this.json.templateCode)}},_initModule:function(){this.node.empty();var e=Object.clone(this.json.editorProperties);if(this.json.config){if(this.json.config.code){var t=MWF.Macro.exec(this.json.config.code,this);Object.each(t,function(t,i){e[i]=t})}}this.loadCkeditor(e);this._setNodeProperty();this._createIconAction();this._setNodeEvent()},loadCkeditor:function(e){COMMON.AjaxModule.load("ckeditor",function(){var t=new Element("div").inject(this.node);if(this.json.templateCode)t.set("html",this.json.templateCode);var i=this.node.getSize().y;var o=e||{};if(this.form.options.mode=="Mobile"){o.toolbar=[{name:"paragraph",items:["Bold","Italic","-","TextColor","BGColor","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","Undo","Redo"]},{name:"basicstyles",items:["Styles","FontSize"]}]}this.editor=CKEDITOR.replace(t,o);this.editor.on("dataReady",function(){this.editor.setReadOnly(true)},this)}.bind(this))},distroyCkeditor:function(){if(this.editor)this.editor.destroy();this.editor=null}});