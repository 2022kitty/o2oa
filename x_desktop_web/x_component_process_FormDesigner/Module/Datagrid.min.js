MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.$Container",null,false);MWF.xDesktop.requireApp("process.FormDesigner","Module.$Component",null,false);MWF.xDesktop.requireApp("process.FormDesigner","Module.Datagrid$Data",null,false);MWF.xDesktop.requireApp("process.FormDesigner","Module.Datagrid$Title",null,false);MWF.xDesktop.requireApp("process.FormDesigner","Module.Table$Td",null,false);MWF.xApplication.process.FormDesigner.Module.Datagrid=MWF.FCDatagrid=new Class({Extends:MWF.FC$Component,Implements:[Options,Events],options:{style:"default",propertyPath:"/x_component_process_FormDesigner/Module/Datagrid/datagrid.html"},initialize:function(t,e){this.setOptions(e);this.path="/x_component_process_FormDesigner/Module/Datagrid/";this.cssPath="/x_component_process_FormDesigner/Module/Datagrid/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="component";this.moduleName="datagrid";this.form=t;this.container=null;this.containerNode=null;this.containers=[];this.elements=[];this.selectedMultiTds=[]},clearTemplateStyles:function(t){if(t){if(t.styles)this.removeStyles(t.styles,"styles");if(t.tableStyles)this.removeStyles(t.tableStyles,"tableStyles");if(t.titleStyles)this.removeStyles(t.titleStyles,"titleStyles");if(t.contentStyles)this.removeStyles(t.contentStyles,"contentStyles");if(t.actionStyles)this.removeStyles(t.actionStyles,"actionStyles");if(t.editStyles)this.removeStyles(t.editStyles,"editStyles");if(t.amountStyles)this.removeStyles(t.amountStyles,"amountStyles");if(t.properties)this.removeStyles(t.properties,"properties")}},setTemplateStyles:function(t){if(t.styles)this.copyStyles(t.styles,"styles");if(t.tableStyles)this.copyStyles(t.tableStyles,"tableStyles");if(t.titleStyles)this.copyStyles(t.titleStyles,"titleStyles");if(t.contentStyles)this.copyStyles(t.contentStyles,"contentStyles");if(t.actionStyles)this.copyStyles(t.actionStyles,"actionStyles");if(t.editStyles)this.copyStyles(t.editStyles,"editStyles");if(t.amountStyles)this.copyStyles(t.amountStyles,"amountStyles");if(t.properties)this.copyStyles(t.properties,"properties")},_createMoveNode:function(){var t='<table border="0" cellpadding="0" cellspacing="2" width="100%" align="center">';t+="<tr><th></th><th></th><th></th></tr>";t+="<tr><td></td><td></td><td></td></tr>";t+="</table>";this.moveNode=new Element("div",{html:t}).inject(this.form.container);this.moveNode.setStyles(this.css.moduleNodeMove);this._setTableStyle()},_setTableStyle:function(){var t=this.moveNode.getElements("td");t.setStyles({border:"1px dashed #999",height:"20px"});var t=this.moveNode.getElements("th");t.setStyles({background:"#C3CEEA",border:"1px dashed #999",height:"20px"})},_getContainers:function(){var t=this.node.getElements("td");this.form.getTemplateData("Datagrid$Data",function(e){t.each(function(t){var s=this.form.getDomjson(t);var i=null;if(!s){var o=Object.clone(e);i=new MWF.FCDatagrid$Data(this.form);i.load(o,t,this)}else{i=new MWF.FCDatagrid$Data(this.form);i.load(s,t,this)}this.containers.push(i)}.bind(this))}.bind(this))},_getElements:function(){var t=this.node.getElements("th");this.form.getTemplateData("Datagrid$Title",function(e){t.each(function(t){var s=this.form.getDomjson(t);var i=null;if(!s){var o=Object.clone(e);i=new MWF.FCDatagrid$Title(this.form);i.load(o,t,this)}else{i=new MWF.FCDatagrid$Title(this.form);i.load(s,t,this)}this.elements.push(i)}.bind(this))}.bind(this))},_createNode:function(t){var e=this;var s=this.path+"datagridCreate.html";MWF.require("MWF.widget.Dialog",function(){var i=$(document.body).getSize();var o=i.x/2-180;var l=i.y/2-130;var n=new MWF.DL({title:"Create Datagrid",style:"property",top:l,left:o-40,fromTop:i.y/2-65,fromLeft:i.x/2,width:360,height:260,url:s,buttonList:[{text:MWF.APPFD.LP.button.ok,action:function(){e._createTableNode();t();this.close()}}]});n.show()}.bind(this))},_createTableNode:function(){var t=$("MWFNewTableColumn").get("value");var e=$("MWFNewTableWidth").get("value");var s=$("MWFNewTableWidthUnit");var i=s.options[s.selectedIndex].value;var o=$("MWFNewTableBorder").get("value");var l=$("MWFNewTableCellpadding").get("value");var n=$("MWFNewTableCellspacing").get("value");var r="";if(i=="percent"){r=e+"%"}else{r=e+"px"}this.json.properties.width=r;this.json.properties.border=o;this.json.properties.cellpadding=l;this.json.properties.cellspacing=n;var a='<table border="'+o+'" cellpadding="'+l+'" cellspacing="'+n+'" width="'+r+'" align="center">';a+="<tr>";for(var d=0;d<t.toInt();d++){a+="<th></th>"}a+="</tr>";a+="<tr>";for(var d=0;d<t.toInt();d++){a+="<td></td>"}a+="</tr></table>";this.node=new Element("div",{id:this.json.id,MWFType:"datagrid",html:a,styles:this.css.moduleNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.node);this.table=this.node.getElement("table")},_dragComplete:function(){if(!this.node){this._createNode(function(){this._dragMoveComplete()}.bind(this))}else{this._dragMoveComplete()}},_dragMoveComplete:function(){this._resetTreeNode();this.node.inject(this.copyNode,"before");this._initModule();var t=this.node.retrieve("thisDisplay");if(t){this.node.setStyle("display",t)}if(this.copyNode)this.copyNode.destroy();if(this.moveNode)this.moveNode.destroy();this.moveNode=null;this.copyNode=null;this.nextModule=null;this.form.moveModule=null;this.form.json.moduleList[this.json.id]=this.json;this.selected()},_initModule:function(){this.setStyleTemplate();this.table=this.node.getElement("table");this._getElements();this._getContainers();this.setPropertiesOrStyles("styles");this.setPropertiesOrStyles("tableStyles");this.setPropertiesOrStyles("properties");this._setNodeProperty();this._createIconAction();this._setNodeEvent()},setPropertiesOrStyles:function(t){if(t=="styles"){var e=this.node.getStyle("border");this.node.clearStyles();this.node.setStyles(this.css.moduleNode);this.node.setStyle("border",e);Object.each(this.json.styles,function(t,e){var s=/^border\w*/gi;if(!e.test(s)){this.node.setStyle(e,t)}}.bind(this))}if(t=="tableStyles"){this.table.clearStyles();Object.each(this.json.tableStyles,function(t,e){var s=/^border\w*/gi;if(!e.test(s)){this.table.setStyle(e,t)}}.bind(this))}if(t=="properties"){this.node.getFirst().setProperties(this.json.properties)}},_setEditStyle_custom:function(t,e,s){if(t=="id"){if(t!=s){var i=new RegExp("^"+s,"i");this.containers.each(function(t){var e=t.json.id;var s=e.replace(i,this.json.id);t.json.id=s;delete this.form.json.moduleList[e];this.form.json.moduleList[s]=t.json;t._setEditStyle("id")}.bind(this))}}if(t=="titleStyles"){var o=this.table.getElements("th");o.each(function(t){this.setCustomNodeStyles(t,this.json.titleStyles)}.bind(this))}if(t=="contentStyles"){var l=this.table.getElements("td");l.each(function(t){this.setCustomNodeStyles(t,this.json.contentStyles)}.bind(this))}},setDatagridStyles:function(){if(this.json.titleStyles){var t=this.table.getElements("th");t.each(function(t){this.setCustomNodeStyles(t,this.json.titleStyles)}.bind(this))}if(this.json.contentStyles){var e=this.table.getElements("td");e.each(function(t){this.setCustomNodeStyles(t,this.json.contentStyles)}.bind(this))}},setAllStyles:function(){this.setPropertiesOrStyles("styles");this.setPropertiesOrStyles("tableStyles");this.setPropertiesOrStyles("properties");this.setDatagridStyles();this.reloadMaplist()},getContainerNodes:function(){return this.node.getElements("td")},copyComponentJsonData:function(t,e){var s=t.getElements("td");var i=t.getElements("th");s.each(function(t,s){var i=Object.clone(this.containers[s].json);i.id=this.containers[s]._getNewId(e);this.form.json.moduleList[i.id]=i;t.set("id",i.id)}.bind(this));i.each(function(t,s){var i=Object.clone(this.elements[s].json);i.id=this.elements[s]._getNewId(e);this.form.json.moduleList[i.id]=i;t.set("id",i.id)}.bind(this))}});