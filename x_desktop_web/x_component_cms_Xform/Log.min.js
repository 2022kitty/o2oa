MWF.xDesktop.requireApp("cms.Xform","$Module",null,false);MWF.xApplication.cms.Xform.Log=MWF.CMSLog=new Class({Extends:MWF.CMS$Module,_loadUserInterface:function(){this.node.empty();this.node.setStyle("-webkit-user-select","text");if(this.form.businessData){if(this.form.businessData.workLogList){this.workLog=this.form.businessData.workLogList;this.loadWorkLog()}}},loadWorkLog:function(){if(this.json.mode=="table"){this.loadWorkLogTable()}else if(this.json.mode=="text"){this.loadWorkLogText()}else{this.loadWorkLogDefault()}},loadWorkLogTable:function(){this.workLog.each(function(e,t){this.loadWorkLogLine_table(e,t)}.bind(this))},loadWorkLogLine_table:function(e,t){if(e.taskCompletedList.length||this.json.isTask!="false"&&e.taskList.length){var s=new Element("div",{styles:this.form.css.logActivityNode}).inject(this.node);var i=new Element("div",{styles:this.form.css.logActivityTitleNode}).inject(s);var o=new Element("div",{styles:this.form.css.logActivityChildNode}).inject(s);var l=new Element("div",{styles:this.form.css.logActivityIconNode}).inject(i);var n=new Element("div",{styles:this.form.css.logActivityFromNode}).inject(i);var r=new Element("div",{styles:this.form.css.logActivityArrowNode}).inject(i);var a=new Element("div",{styles:this.form.css.logActivityArrivedNode}).inject(i);var c=new Element("div",{styles:this.form.css.logActivityTimeNode}).inject(i);if(e.connected){l.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/ok14.png)")}else{l.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/rightRed.png)")}n.set("html","<b>"+e.fromActivityName+"</b>");if(e.arrivedActivityName){r.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/right.png)");a.set("html","<b>"+e.arrivedActivityName+"</b>");c.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime+"<br/><b>"+MWF.xApplication.cms.Xform.LP.end+": </b>"+e.arrivedTime)}else{c.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime)}if(t%2==0){s.setStyles(this.form.css.logActivityNode_even);i.setStyles(this.form.css.logActivityTitleNode_even)}var m=new Element("table",{styles:this.form.css.logTableTask,border:"0",cellSpacing:"0",cellpadding:"3px",width:"100%"}).inject(o);var d=m.insertRow(0).setStyles(this.form.css.logTableTaskTitleLine);var f=d.insertCell(0).setStyles(this.form.css.logTableTaskTitle);f.set("text",MWF.xApplication.cms.Xform.LP.person);f=d.insertCell(1).setStyles(this.form.css.logTableTaskTitle);f.set("text",MWF.xApplication.cms.Xform.LP.department);f=d.insertCell(2).setStyles(this.form.css.logTableTaskTitle);f.set("text",MWF.xApplication.cms.Xform.LP.startTime);f=d.insertCell(3).setStyles(this.form.css.logTableTaskTitle);f.set("text",MWF.xApplication.cms.Xform.LP.completedTime);f=d.insertCell(4).setStyles(this.form.css.logTableTaskTitle);f.set("text",MWF.xApplication.cms.Xform.LP.route);f=d.insertCell(5).setStyles(this.form.css.logTableTaskTitle);f.set("text",MWF.xApplication.cms.Xform.LP.opinion);e.taskCompletedList.each(function(t){this.loadTaskLine_table(t,m,e,false)}.bind(this));if(this.json.isTask!="false"){e.taskList.each(function(t){this.loadTaskLine_table(t,m,e,true)}.bind(this))}}},loadTaskLine_table:function(e,t,s,i){var o="logTableTaskLine";if(i)o="logTableTaskLine_task";var l=t.insertRow(t.rows.length);var n=l.insertCell(0).setStyles(this.form.css[o]);n.set("text",e.person||"");n=l.insertCell(1).setStyles(this.form.css[o]);n.set("text",e.department||"");n=l.insertCell(2).setStyles(this.form.css[o]);n.set("text",e.startTime||"");n=l.insertCell(3).setStyles(this.form.css[o]);n.set("text",e.completedTime||"");n=l.insertCell(4).setStyles(this.form.css[o]);n.set("text",e.routeName||"");n=l.insertCell(5).setStyles(this.form.css[o]);n.set("text",e.opinion||"")},loadWorkLogText:function(){this.lineClass="logTaskNode";this.workLog.each(function(e,t){this.loadWorkLogLine_text(e,t)}.bind(this))},loadWorkLogLine_text:function(e,t){e.taskCompletedList.each(function(t){this.loadTaskLine_text(t,this.node,e,false)}.bind(this));if(this.json.isTask!="false"){e.taskList.each(function(t){this.loadTaskLine_text(t,this.node,e,true)}.bind(this))}},loadTaskLine_text:function(e,t,s,i){this.loadTaskLine_default(e,t,s,i,"0px",true)},loadWorkLogDefault:function(){this.workLog.each(function(e,t){this.loadWorkLogLine_default(e,t)}.bind(this))},loadWorkLogLine_default:function(e,t){if(e.taskCompletedList.length||this.json.isTask!="false"&&e.taskList.length){var s=new Element("div",{styles:this.form.css.logActivityNode}).inject(this.node);var i=new Element("div",{styles:this.form.css.logActivityTitleNode}).inject(s);var o=new Element("div",{styles:this.form.css.logActivityChildNode}).inject(s);var l=new Element("div",{styles:this.form.css.logActivityIconNode}).inject(i);var n=new Element("div",{styles:this.form.css.logActivityFromNode}).inject(i);var r=new Element("div",{styles:this.form.css.logActivityArrowNode}).inject(i);var a=new Element("div",{styles:this.form.css.logActivityArrivedNode}).inject(i);var c=new Element("div",{styles:this.form.css.logActivityTimeNode}).inject(i);if(e.connected){l.setStyle("background-image","url(/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/ok14.png)")}else{l.setStyle("background-image","url(/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/rightRed.png)")}n.set("html","<b>"+e.fromActivityName+"</b>");if(e.arrivedActivityName){r.setStyle("background-image","url(/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/right.png)");a.set("html","<b>"+e.arrivedActivityName+"</b>");c.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime+"<br/><b>"+MWF.xApplication.cms.Xform.LP.end+": </b>"+e.arrivedTime)}else{c.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime)}if(t%2==0){s.setStyles(this.form.css.logActivityNode_even);i.setStyles(this.form.css.logActivityTitleNode_even)}e.taskCompletedList.each(function(t){this.loadTaskLine_default(t,o,e,false)}.bind(this));if(this.json.isTask!="false"){e.taskList.each(function(t){this.loadTaskLine_default(t,o,e,true)}.bind(this))}}},loadTaskLine_default:function(e,t,s,i,o,l,n){var r="logTaskNode";if(n)r="logTaskTextNode";var a=new Element("div",{styles:this.form.css[r]}).inject(t);var c=new Element("div",{styles:this.form.css.logTaskIconNode}).inject(a);var m=new Element("div",{styles:this.form.css.logTaskTextNode}).inject(a);if(l){a.setStyles(this.form.css[this.lineClass]);if(this.lineClass=="logTaskNode"){this.lineClass="logTaskNode_even"}else{this.lineClass="logTaskNode"}}if(o)c.setStyle("margin-left",o);var d=c.getStyle("margin-left").toInt();d=d+28;m.setStyle("margin-left",""+d+"px");if(!i){var f=this.json.textStyle;f=f.replace(/\{person\}/g,e.person);f=f.replace(/\{department\}/g,e.department);f=f.replace(/\{route\}/g,e.routeName);f=f.replace(/\{time\}/g,e.completedTime);f=f.replace(/\{opinion\}/g,e.opinion);f=f.replace(/\{company\}/g,e.company);f=f.replace(/\{startTime\}/g,e.startTime);f=f.replace(/\{activity\}/g,s.fromActivityName);f=f.replace(/\{arrivedActivity\}/g,e.arrivedActivityName);m.set("html",f)}else{var f=e.person+"("+e.department+")"+MWF.xApplication.cms.Xform.LP.processing+", "+MWF.xApplication.cms.Xform.LP.comeTime+": "+e.startTime;m.set("html",f);c.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/rightRed.png)")}}});