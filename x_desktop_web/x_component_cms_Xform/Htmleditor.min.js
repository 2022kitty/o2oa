MWF.xDesktop.requireApp("process.Xform","Htmleditor",null,false);MWF.xApplication.cms.Xform.Htmleditor=MWF.CMSHtmleditor=new Class({Extends:MWF.APPHtmleditor,_loadUserInterface:function(){this.node.empty();if(this.readonly){this.node.set("html",this._getBusinessData());this.node.setStyles({"-webkit-user-select":"text","-moz-user-select":"text"});if(layout.mobile){this.node.getElements("img").each(function(e){e.setStyle("height","auto")}.bind(this))}}else{var e=Object.clone(this.json.editorProperties);if(this.json.config){if(this.json.config.code){var t=MWF.CMSMacro.exec(this.json.config.code,this);Object.each(t,function(t,i){e[i]=t})}}this.loadCkeditor(e)}},loadCkeditor:function(e){_self=this;COMMON.AjaxModule.loadDom("ckeditor",function(){var t=new Element("div").inject(this.node);var i=this._getBusinessData();if(i){t.set("html",i)}else if(this.json.templateCode){t.set("html",this.json.templateCode)}var o=this.node.getSize().y;var s=e||{};if(this.form.json.mode=="Mobile"){if(!s.toolbar&&!s.toolbarGroups){s.toolbar=[{name:"paragraph",items:["Bold","Italic","-","TextColor","BGColor","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","Undo","Redo"]},{name:"basicstyles",items:["Styles","FontSize"]}]}}s.filebrowserFilesImage=function(e,t){_self.selectCloudFilesImage(e,t)};s.localImageMaxWidth=800;s.reference=this.form.businessData.document.id;s.referenceType="cmsDocument";this.editor=CKEDITOR.replace(t,s);this._loadEvents();this.editor.on("change",function(){this._setBusinessData(this.getData())}.bind(this))}.bind(this))},validationConfigItem:function(e,t){var i=t.status=="all"?true:e=="publish";if(i){var o=this.getData();var s=t.valueType=="value"?o:o.length;switch(t.operateor){case"isnull":if(!s){this.notValidationMode(t.prompt);return false}break;case"notnull":if(s){this.notValidationMode(t.prompt);return false}break;case"gt":if(s>t.value){this.notValidationMode(t.prompt);return false}break;case"lt":if(s<t.value){this.notValidationMode(t.prompt);return false}break;case"equal":if(s==t.value){this.notValidationMode(t.prompt);return false}break;case"neq":if(s!=t.value){this.notValidationMode(t.prompt);return false}break;case"contain":if(s.indexOf(t.value)!=-1){this.notValidationMode(t.prompt);return false}break;case"notcontain":if(s.indexOf(t.value)==-1){this.notValidationMode(t.prompt);return false}break}}return true}});