MWF.xDesktop.requireApp("cms.Xform","$Input",null,false);MWF.xApplication.cms.Xform.Checkbox=MWF.CMSCheckbox=new Class({Implements:[Events],Extends:MWF.CMS$Input,_loadNode:function(){if(this.readonly){this._loadNodeRead()}else{this._loadNodeEdit()}},_loadNodeRead:function(){this.node.empty();var e=this.getOptions();var t=this.getValue();if(t){var i=[];e.each(function(e){var s=e.split("|");var n=s[0];var o=s[1]||text;if(t.indexOf(o)!=-1){i.push(n)}});this.node.set("text",i.join(", "))}},_loadNodeEdit:function(){var e=new Element("div");e.set(this.json.properties);e.inject(this.node,"after");this.node.destroy();this.node=e;this.node.set({id:this.json.id,MWFType:this.json.type,styles:{display:"inline"}});this.setOptions()},getOptions:function(){if(this.json.itemType=="values"){return this.json.itemValues}else{return this.form.CMSMacro.exec(this.json.itemScript.code,this)}return[]},setOptions:function(){var e=this.getOptions();e.each(function(e){var t=e.split("|");var i=t[0];var s=t[1]||i;var n=new Element("input",{type:"checkbox",name:this.json.id,value:s,showText:i,styles:this.json.buttonStyles}).inject(this.node);n.appendText(i,"after");n.addEvent("click",function(){this.validationMode();if(this.validation())this._setBusinessData(this.getInputData("change"))}.bind(this))}.bind(this))},_setValue:function(e){this._setBusinessData(e);var t=this.node.getElements("input");for(var i=0;i<t.length;i++){var s=t[i];if(e.indexOf(s.value)!=-1){s.checked=true}else{s.checked=false}}},getTextData:function(){var e=this.node.getElements("input");var t=[];var i=[];if(e.length){e.each(function(e){if(e.checked){var s=e.get("value");var n=e.get("showText");t.push(s||"");i.push(n||s||"")}})}if(!t.length)t=[""];if(!i.length)i=[""];return{value:t,text:i}},getInputData:function(){var e=this.node.getElements("input");var t=[];if(e.length){e.each(function(e){if(e.checked){var i=e.get("value");if(i)t.push(i||"")}})}return t.length?t:null},resetData:function(){this.setData(this.getValue())},setData:function(e){this._setBusinessData(e);var t=this.node.getElements("input");if(t.length){t.each(function(t){if(typeOf(e)=="array"){if(e.indexOf(t.get("value"))!=-1){t.set("checked",true)}else{t.set("checked",false)}}else{if(e==t.get("value")){t.set("checked",true)}else{t.set("checked",false)}}})}},notValidationMode:function(e){if(!this.isNotValidationMode){this.isNotValidationMode=true;this.node.store("background",this.node.getStyles("background"));this.node.setStyle("background","#ffdcdc");this.errNode=this.createErrorNode(e);if(this.iconNode){this.errNode.inject(this.iconNode,"after")}else{this.errNode.inject(this.node,"after")}}},validationMode:function(){if(this.isNotValidationMode){this.isNotValidationMode=false;this.node.setStyles(this.node.retrieve("background"));if(this.errNode){this.errNode.destroy();this.errNode=null}}}});