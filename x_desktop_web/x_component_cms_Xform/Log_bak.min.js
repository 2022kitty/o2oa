MWF.xDesktop.requireApp("cms.Xform","$Module",null,false);MWF.xApplication.cms.Xform.Log_bak=MWF.CMSLog=new Class({Extends:MWF.CMS$Module,_loadUserInterface:function(){this.node.empty();this.node.setStyle("-webkit-user-select","text");if(this.form.businessData){if(this.form.businessData.workLogList){this.workLog=this.form.businessData.workLogList;this.loadWorkLog()}}},loadWorkLog:function(){if(this.json.mode=="table"){this.loadWorkLogTable()}else if(this.json.mode=="text"){this.loadWorkLogText()}else{this.loadWorkLogDefault()}},loadWorkLogTable:function(){this.table=new Element("table",{styles:this.form.css.logTable,border:"0",cellSpacing:"0",cellpadding:"3px",width:"100%"}).inject(this.node);this.workLog.each(function(e,t){this.loadWorkLogLine_table(e,t)}.bind(this))},loadWorkLogLine_table:function(e,t){var s=this.table.insertRow(this.table.rows?this.table.rows.length:0).setStyles(this.form.css.logTableTr);var i=s.insertCell(0).setStyles(this.form.css.logTableIconTd);var o=s.insertCell(1).setStyles(this.form.css.logTableActivityTd);var l=s.insertCell(2).setStyles(this.form.css.logTableTaskTd);if(e.connected){i.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/ok14.png)")}else{i.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/rightRed.png)")}var n=new Element("div",{styles:this.form.css.logTableActivityNode}).inject(o);var a=new Element("div",{styles:this.form.css.logTableActivityTimeNode}).inject(o);if(e.arrivedActivityName){var r="<b>"+e.fromActivityName+"</b> -> <b>"+e.arrivedActivityName+"</b>";n.set("html",r);a.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime+"<br/><b>"+MWF.xApplication.cms.Xform.LP.end+": </b>"+e.arrivedTime)}else{var r="<b>"+e.fromActivityName+"</b>";n.set("html",r);a.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime)}if(e.taskCompletedList.length||this.json.isTask!="false"&&e.taskList.length){var m=new Element("table",{styles:this.form.css.logTableTask,border:"0",cellSpacing:"0",cellpadding:"3px",width:"100%"}).inject(l);var s=m.insertRow(0).setStyles(this.form.css.logTableTaskTitleLine);var c=s.insertCell(0).setStyles(this.form.css.logTableTaskTitle);c.set("text",MWF.xApplication.cms.Xform.LP.person);c=s.insertCell(1).setStyles(this.form.css.logTableTaskTitle);c.set("text",MWF.xApplication.cms.Xform.LP.department);c=s.insertCell(2).setStyles(this.form.css.logTableTaskTitle);c.set("text",MWF.xApplication.cms.Xform.LP.startTime);c=s.insertCell(3).setStyles(this.form.css.logTableTaskTitle);c.set("text",MWF.xApplication.cms.Xform.LP.completedTime);c=s.insertCell(4).setStyles(this.form.css.logTableTaskTitle);c.set("text",MWF.xApplication.cms.Xform.LP.route);c=s.insertCell(5).setStyles(this.form.css.logTableTaskTitle);c.set("text",MWF.xApplication.cms.Xform.LP.opinion);e.taskCompletedList.each(function(t){this.loadTaskLine_table(t,m,e,false)}.bind(this));if(this.json.isTask!="false"){e.taskList.each(function(t){this.loadTaskLine_table(t,m,e,true)}.bind(this))}}},loadTaskLine_table:function(e,t,s,i){var o="logTableTaskLine";if(i)o="logTableTaskLine_task";var l=t.insertRow(t.rows.length);var n=l.insertCell(0).setStyles(this.form.css[o]);n.set("text",e.person||"");n=l.insertCell(1).setStyles(this.form.css[o]);n.set("text",e.department||"");n=l.insertCell(2).setStyles(this.form.css[o]);n.set("text",e.startTime||"");n=l.insertCell(3).setStyles(this.form.css[o]);n.set("text",e.completedTime||"");n=l.insertCell(4).setStyles(this.form.css[o]);n.set("text",e.routeName||"");n=l.insertCell(5).setStyles(this.form.css[o]);n.set("text",e.opinion||"")},loadWorkLogText:function(){this.lineClass="logTaskNode";this.workLog.each(function(e,t){this.loadWorkLogLine_text(e,t)}.bind(this))},loadWorkLogLine_text:function(e,t){e.taskCompletedList.each(function(t){this.loadTaskLine_text(t,this.node,e,false)}.bind(this));if(this.json.isTask!="false"){e.taskList.each(function(t){this.loadTaskLine_text(t,this.node,e,true)}.bind(this))}},loadTaskLine_text:function(e,t,s,i){this.loadTaskLine_default(e,t,s,i,"0px",true)},loadWorkLogDefault:function(){this.workLog.each(function(e,t){this.loadWorkLogLine_default(e,t)}.bind(this))},loadWorkLogLine_default:function(e,t){var s=new Element("div",{styles:this.form.css.logActivityNode}).inject(this.node);var i=new Element("div",{styles:this.form.css.logActivityTitleNode}).inject(s);var o=new Element("div",{styles:this.form.css.logActivityChildNode}).inject(s);var l=new Element("div",{styles:this.form.css.logActivityIconNode}).inject(i);var n=new Element("div",{styles:this.form.css.logActivityFromNode}).inject(i);var a=new Element("div",{styles:this.form.css.logActivityArrowNode}).inject(i);var r=new Element("div",{styles:this.form.css.logActivityArrivedNode}).inject(i);var m=new Element("div",{styles:this.form.css.logActivityTimeNode}).inject(i);if(e.connected){l.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/ok14.png)")}else{l.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/rightRed.png)")}n.set("html","<b>"+e.fromActivityName+"</b>");if(e.arrivedActivityName){a.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/right.png)");r.set("html","<b>"+e.arrivedActivityName+"</b>");m.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime+"<br/><b>"+MWF.xApplication.cms.Xform.LP.end+": </b>"+e.arrivedTime)}else{m.set("html","<b>"+MWF.xApplication.cms.Xform.LP.begin+": </b>"+e.fromTime)}if(t%2==0){s.setStyles(this.form.css.logActivityNode_even);i.setStyles(this.form.css.logActivityTitleNode_even)}e.taskCompletedList.each(function(t){this.loadTaskLine_default(t,o,e,false)}.bind(this));if(this.json.isTask!="false"){e.taskList.each(function(t){this.loadTaskLine_default(t,o,e,true)}.bind(this))}},loadTaskLine_default:function(e,t,s,i,o,l){var n=new Element("div",{styles:this.form.css.logTaskNode}).inject(t);var a=new Element("div",{styles:this.form.css.logTaskIconNode}).inject(n);var r=new Element("div",{styles:this.form.css.logTaskTextNode}).inject(n);if(l){n.setStyles(this.form.css[this.lineClass]);if(this.lineClass=="logTaskNode"){this.lineClass="logTaskNode_even"}else{this.lineClass="logTaskNode"}}if(o)a.setStyle("margin-left",o);var m=a.getStyle("margin-left").toInt();m=m+28;r.setStyle("margin-left",""+m+"px");if(!i){var c=this.json.textStyle;c=c.replace(/\{person\}/g,e.person);c=c.replace(/\{department\}/g,e.department);c=c.replace(/\{route\}/g,e.routeName);c=c.replace(/\{time\}/g,e.completedTime);c=c.replace(/\{opinion\}/g,e.opinion);c=c.replace(/\{company\}/g,e.company);c=c.replace(/\{startTime\}/g,e.startTime);c=c.replace(/\{activity\}/g,s.fromActivityName);c=c.replace(/\{arrivedActivity\}/g,e.arrivedActivityName);r.set("html",c)}else{var c=e.person+"("+e.department+")"+MWF.xApplication.cms.Xform.LP.processing+", "+MWF.xApplication.cms.Xform.LP.comeTime+": "+e.startTime;r.set("html",c);a.setStyle("background-image","url("+"/x_component_cms_Xform/$Form/"+this.form.options.style+"/icon/rightRed.png)")}}});