define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(e,n,o){function t(){return typeof cvox!="undefined"&&cvox&&cvox.Api}function r(e){if(t())he(e);else{Se++;if(Se>=ke)return;window.setTimeout(r,500,e)}}var c={};c.SpeechProperty,c.Cursor,c.Token,c.Annotation;var i={rate:.8,pitch:.4,volume:.9},a={rate:1,pitch:.5,volume:.9},u={rate:.8,pitch:.8,volume:.9},s={rate:.8,pitch:.3,volume:.9},p={rate:.8,pitch:.7,volume:.9},l={rate:.8,pitch:.8,volume:.9},d={punctuationEcho:"none",relativePitch:-.6},f="ALERT_NONMODAL",v="ALERT_MODAL",m="INVALID_KEYPRESS",g="insertMode",A="start",h=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],S={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"},k="CONTROL + SHIFT ";c.editor=null;var E=null,x={},y=!1,w=!1,T=!1,C=null,b={},O={},_=function(e){return k+String.fromCharCode(e)},L=function(){var e=c.editor.keyBinding.getKeyboardHandler();return e.$id==="ace/keyboard/vim"},N=function(e){return c.editor.getSession().getTokenAt(e.row,e.column+1)},K=function(e){return c.editor.getSession().getLine(e.row)},P=function(e){x[e.row]&&cvox.Api.playEarcon(f),y?(cvox.Api.stop(),U(e),W(N(e)),$(e.row,1)):$(e.row,0)},I=function(e){var n=K(e),o=n.substr(e.column-1);e.column===0&&(o=" "+n);var t=/^\W(\w+)/,r=t.exec(o);return r!==null},M={constant:{prop:i},entity:{prop:u},keyword:{prop:s},storage:{prop:p},variable:{prop:l},meta:{prop:a,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},D={prop:D},G=function(e,n){var o=e;for(var t=0;t<n.length;t++){var r=n[t],c=new RegExp(r.substr,"g");o=o.replace(c,r.newSubstr)}return o},R=function(e,n,o){var t={};t.value="",t.type=e[n].type;for(var r=n;r<o;r++)t.value+=e[r].value;return t},B=function(e){if(e.length<=1)return e;var n=[],o=0;for(var t=1;t<e.length;t++){var r=e[o],c=e[t];X(r)!==X(c)&&(n.push(R(e,o,t)),o=t)}return n.push(R(e,o,e.length)),n},F=function(e){var n=c.editor.getSession().getLine(e),o=/^\s*$/;return o.exec(n)!==null},$=function(e,n){var o=c.editor.getSession().getTokens(e);if(o.length===0||F(e)){cvox.Api.playEarcon("EDITABLE_TEXT");return}o=B(o);var t=o[0];o=o.filter(function(e){return e!==t}),H(t,n),o.forEach(W)},q=function(e){H(e,0)},W=function(e){H(e,1)},X=function(e){if(!e||!e.type)return;var n=e.type.split(".");if(n.length===0)return;var o=n[0],t=M[o];return t?t:D},H=function(e,n){var o=X(e),t=G(e.value,h);o.replace&&(t=G(t,o.replace)),cvox.Api.speak(t,n,o.prop)},U=function(e){var n=K(e);cvox.Api.speak(n[e.column],1)},V=function(e,n){var o=K(n),t=o.substring(e.column,n.column);t=t.replace(/ /g," space "),cvox.Api.speak(t)},J=function(e,n){if(Math.abs(e.column-n.column)!==1){var o=K(n).length;if(n.column===0||n.column===o){$(n.row,0);return}if(I(n)){cvox.Api.stop(),W(N(n));return}}U(n)},Y=function(e,n){c.editor.selection.isEmpty()?w?V(e,n):J(e,n):(V(e,n),cvox.Api.speak("selected",1))},j=function(e){if(T){T=!1;return}var n=c.editor.selection.getCursor();n.row!==E.row?P(n):Y(E,n),E=n},z=function(e){c.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},Q=function(e){switch(data.action){case"remove":cvox.Api.speak(data.text,0,d),T=!0;break;case"insert":cvox.Api.speak(data.text,0),T=!0}},Z=function(e){var n=e.row,o=e.column;return!x[n]||!x[n][o]},ee=function(e){x={};for(var n=0;n<e.length;n++){var o=e[n],t=o.row,r=o.column;x[t]||(x[t]={}),x[t][r]=o}},ne=function(e){var n=c.editor.getSession().getAnnotations(),o=n.filter(Z);o.length>0&&cvox.Api.playEarcon(f),ee(n)},oe=function(e){var n=e.type+" "+e.text+" on "+re(e.row,e.column);n=n.replace(";","semicolon"),cvox.Api.speak(n,1)},te=function(e){var n=x[e];for(var o in n)oe(n[o])},re=function(e,n){return"row "+(e+1)+" column "+(n+1)},ce=function(){cvox.Api.speak(re(E.row,E.column))},ie=function(){for(var e in x)te(e)},ae=function(){if(!L())return;switch(c.editor.keyBinding.$data.state){case g:cvox.Api.speak("Insert mode");break;case A:cvox.Api.speak("Command mode")}},ue=function(){y=!y,y?cvox.Api.speak("Speak location on row change enabled."):cvox.Api.speak("Speak location on row change disabled.")},se=function(){w=!w,w?cvox.Api.speak("Speak displacement on column changes."):cvox.Api.speak("Speak current character or word on column changes.")},pe=function(e){if(e.ctrlKey&&e.shiftKey){var n=b[e.keyCode];n&&n.func()}},le=function(e,n){if(!L())return;var o=n.keyBinding.$data.state;if(o===C)return;switch(o){case g:cvox.Api.playEarcon(v),cvox.Api.setKeyEcho(!0);break;case A:cvox.Api.playEarcon(v),cvox.Api.setKeyEcho(!1)}C=o},de=function(e){var n=e.detail.customCommand,o=O[n];o&&(o.func(),c.editor.focus())},fe=function(){var e=ge.map(function(e){return{desc:e.desc+_(e.keyCode),cmd:e.cmd}}),n=document.querySelector("body");n.setAttribute("contextMenuActions",JSON.stringify(e)),n.addEventListener("ATCustomEvent",de,!0)},ve=function(e){e.match?$(E.row,0):cvox.Api.playEarcon(m)},me=function(){c.editor.focus()},ge=[{keyCode:49,func:function(){te(E.row)},cmd:S.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:ie,cmd:S.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:ae,cmd:S.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:ue,cmd:S.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:ce,cmd:S.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:se,cmd:S.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:me,cmd:S.FOCUS_TEXT,desc:"Focus text"}],Ae=function(){c.editor=editor,editor.getSession().selection.on("changeCursor",j),editor.getSession().selection.on("changeSelection",z),editor.getSession().on("change",Q),editor.getSession().on("changeAnnotation",ne),editor.on("changeStatus",le),editor.on("findSearchBox",ve),editor.container.addEventListener("keydown",pe),E=editor.selection.getCursor()},he=function(e){Ae(),ge.forEach(function(e){b[e.keyCode]=e,O[e.cmd]=e}),e.on("focus",Ae),L()&&cvox.Api.setKeyEcho(!1),fe()},Se=0,ke=15,Ee=e("../editor").Editor;e("../config").defineOptions(Ee.prototype,"editor",{enableChromevoxEnhancements:{set:function(e){e&&r(this)},value:!0}})});(function(){window.require(["ace/ext/chromevox"],function(){})})();