define("tinymce/pasteplugin/Clipboard",["tinymce/Env","tinymce/util/VK","tinymce/pasteplugin/Utils"],function(e,t,n){return function(i){var r=this,a,o,s=0;var f="%MCEPASTEBIN%",l;function c(e){var t,n=i.dom;t=i.fire("BeforePastePreProcess",{content:e});t=i.fire("PastePreProcess",t);e=t.content;if(!t.isDefaultPrevented()){if(i.hasEventListeners("PastePostProcess")&&!t.isDefaultPrevented()){var r=n.add(i.getBody(),"div",{style:"display:none"},e);t=i.fire("PastePostProcess",{node:r});n.remove(r);e=t.node.innerHTML}if(!t.isDefaultPrevented()){i.insertContent(e)}}}function d(e){e=i.dom.encode(e).replace(/\r\n/g,"\n");var t=i.dom.getParent(i.selection.getStart(),i.dom.isBlock);var r=i.settings.forced_root_block;var a;if(r){a=i.dom.createHTML(r,i.settings.forced_root_block_attrs);a=a.substr(0,a.length-3)+">"}if(t&&/^(PRE|DIV)$/.test(t.nodeName)||!r){e=n.filter(e,[[/\n/g,"<br>"]])}else{e=n.filter(e,[[/\n\n/g,"</p>"+a],[/^(.*<\/p>)(<p>)$/,a+"$1"],[/\n/g,"<br />"]]);if(e.indexOf("<p>")!=-1){e=a+e}}c(e)}function u(){var t=i.dom,n=i.getBody();var r=i.dom.getViewPort(i.getWin()),s=r.y,l=20;var c;o=i.selection.getRng();if(i.inline){c=i.selection.getScrollContainer();if(c){s=c.scrollTop}}if(o.getClientRects){var d=o.getClientRects();if(d.length){l=s+(d[0].top-t.getPos(n).y)}else{l=s;var u=o.startContainer;if(u){if(u.nodeType==3&&u.parentNode!=n){u=u.parentNode}if(u.nodeType==1){l=t.getPos(u,c||n).y}}}}a=t.add(i.getBody(),"div",{id:"mcepastebin",contentEditable:true,"data-mce-bogus":"1",style:"position: absolute; top: "+l+"px;"+"width: 10px; height: 10px; overflow: hidden; opacity: 0"},f);if(e.ie||e.gecko){t.setStyle(a,"left",t.getStyle(n,"direction",true)=="rtl"?65535:-65535)}t.bind(a,"beforedeactivate focusin focusout",function(e){e.stopPropagation()});a.focus();i.selection.select(a,true)}function g(){if(a){var e;while(e=i.dom.get("mcepastebin")){i.dom.remove(e);i.dom.unbind(e)}if(o){i.selection.setRng(o)}}l=false;a=o=null}function p(){var e=f,t,n;t=i.dom.select("div[id=mcepastebin]");n=t.length;while(n--){var r=t[n].innerHTML;if(e==f){e=""}if(r.length>e.length){e=r}}return e}function m(e){var t={};if(e&&e.types){var n=e.getData("Text");if(n&&n.length>0){t["text/plain"]=n}for(var i=0;i<e.types.length;i++){var r=e.types[i];t[r]=e.getData(r)}}return t}function v(e){return m(e.clipboardData||i.getDoc().dataTransfer)}function P(e,t){function n(e){if(r[a].type=="image/png"){var t=new FileReader;t.onload=function(){c('<img src="'+t.result+'">')};t.readAsDataURL(e.getAsFile());return true}}if(!i.settings.paste_data_images||"text/html"in t||"text/plain"in t){return}if(e.clipboardData){var r=e.clipboardData.items;if(r){for(var a=0;a<r.length;a++){if(n(r[a])){return true}}}}}function h(e){var t=i.getDoc(),n;if(t.caretPositionFromPoint){var r=t.caretPositionFromPoint(e.clientX,e.clientY);n=t.createRange();n.setStart(r.offsetNode,r.offset);n.collapse(true)}else if(t.caretRangeFromPoint){n=t.caretRangeFromPoint(e.clientX,e.clientY)}return n}function y(e,t){return t in e&&e[t].length>0}function b(){i.on("keydown",function(n){if(n.isDefaultPrevented()){return}if(t.metaKeyPressed(n)&&n.keyCode==86||n.shiftKey&&n.keyCode==45){l=n.shiftKey&&n.keyCode==86;n.stopImmediatePropagation();s=(new Date).getTime();if(e.ie&&l){n.preventDefault();i.fire("paste",{ieFake:true});return}g();u()}});i.on("paste",function(t){var o=v(t);var m=(new Date).getTime()-s<1e3;var h=r.pasteFormat=="text"||l;if(t.isDefaultPrevented()){g();return}if(P(t,o)){g();return}if(!m){t.preventDefault()}if(e.ie&&(!m||t.ieFake)){u();i.dom.bind(a,"paste",function(e){e.stopPropagation()});i.getDoc().execCommand("Paste",false,null);o["text/html"]=p()}setTimeout(function(){var e=p();if(a&&a.firstChild&&a.firstChild.id==="mcepastebin"){h=true}g();if(!h&&m&&e&&e!=f){o["text/html"]=e}if(e==f||!m){e=o["text/html"]||o["text/plain"]||f;if(e==f){if(!m){i.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.")}return}}if(!y(o,"text/html")&&y(o,"text/plain")){h=true}if(h){d(o["text/plain"]||n.innerText(e))}else{c(e)}},0)});i.on("dragstart",function(e){if(e.dataTransfer.types){try{e.dataTransfer.setData("mce-internal",i.selection.getContent())}catch(e){}}});i.on("drop",function(e){var t=h(e);if(t&&!e.isDefaultPrevented()){var n=m(e.dataTransfer);var r=n["mce-internal"]||n["text/html"]||n["text/plain"];if(r){e.preventDefault();i.undoManager.transact(function(){if(n["mce-internal"]){i.execCommand("Delete")}i.selection.setRng(t);if(!n["text/html"]){d(r)}else{c(r)}})}}})}r.pasteHtml=c;r.pasteText=d;i.on("preInit",function(){b();i.parser.addNodeFilter("img",function(t){if(!i.settings.paste_data_images){var n=t.length;while(n--){var r=t[n].attributes.map.src;if(r&&r.indexOf("data:image")===0){if(!t[n].attr("data-mce-object")&&r!==e.transparentSrc){t[n].remove()}}}}})});i.on("PreProcess",function(){i.dom.remove(i.dom.get("mcepastebin"))})}});