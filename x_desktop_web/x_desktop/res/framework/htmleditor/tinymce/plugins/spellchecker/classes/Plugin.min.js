define("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(e,t,n,c,r,l,o,a){t.add("spellchecker",function(t,i){var s,u=this,f,h,p,g=t.settings;function d(){if(!u.textMatcher){u.textMatcher=new e(t.getBody(),t)}return u.textMatcher}function m(e,t){var c=[];n.each(t,function(e){c.push({selectable:true,text:e.name,data:e.value})});return c}var k=g.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,"+"German=de,Italian=it,Polish=pl,Portuguese=pt_BR,"+"Spanish=es,Swedish=sv";s=m("Language",n.map(k.split(","),function(e){var t=e.split("=");return{name:t[0],value:t[1]}}));function v(e){for(var t in e){return false}return true}function x(e,l){var o=[],a=f[e];n.each(a,function(e){o.push({text:e,onclick:function(){t.insertContent(t.dom.encode(e));t.dom.remove(l);S()}})});o.push.apply(o,[{text:"-"},{text:"Ignore",onclick:function(){_(e,l)}},{text:"Ignore all",onclick:function(){_(e,l,true)}},{text:"Finish",onclick:M}]);p=new c({items:o,context:"contextmenu",onautohide:function(e){if(e.target.className.indexOf("spellchecker")!=-1){e.preventDefault()}},onhide:function(){p.remove();p=null}});p.renderTo(document.body);var i=r.DOM.getPos(t.getContentAreaContainer());var s=t.dom.getPos(l[0]);var u=t.dom.getRoot();if(u.nodeName=="BODY"){s.x-=u.ownerDocument.documentElement.scrollLeft||u.scrollLeft;s.y-=u.ownerDocument.documentElement.scrollTop||u.scrollTop}else{s.x-=u.scrollLeft;s.y-=u.scrollTop}i.x+=s.x;i.y+=s.y;p.moveTo(i.x,i.y+l[0].offsetHeight)}function w(){return t.getParam("spellchecker_wordchar_pattern")||new RegExp("[^"+'\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`'+"§©«®±¶·¸»"+"¼½¾¿×÷¤”“„"+"]+","g")}function y(){if(h){M();return}else{M()}h=true;function e(e){t.setProgressState(false);if(v(e)){t.windowManager.alert("No misspellings found");h=false;return}f=e;d().find(w()).filter(function(t){return!!e[t.text]}).wrap(function(e){return t.dom.create("span",{class:"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":e.text})});t.fire("SpellcheckStart")}function n(e){t.windowManager.alert(e);t.setProgressState(false);M()}function c(e,t,c){l.send({url:new o(i).toAbsolute(g.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:"text="+encodeURIComponent(t)+"&lang="+g.spellchecker_language,success:function(e){e=a.parse(e);if(!e){n("Sever response wasn't proper JSON.")}else if(e.error){n(e.error)}else{c(e.words)}},error:function(e,t){n("Spellchecker request error: "+t.status)}})}t.setProgressState(true);var r=g.spellchecker_callback||c;r.call(u,"spellcheck",d().text,e,n);t.focus()}function S(){if(!t.dom.select("span.mce-spellchecker-word").length){M()}}function _(e,c,r){t.selection.collapse();if(r){n.each(t.dom.select("span.mce-spellchecker-word"),function(n){if(n.getAttribute("data-mce-word")==e){t.dom.remove(n,true)}})}else{t.dom.remove(c,true)}S()}function M(){d().reset();u.textMatcher=null;if(h){h=false;t.fire("SpellcheckEnd")}}function P(e){var t=e.getAttribute("data-mce-index");if(typeof t=="number"){return""+t}return t}function b(e){var c,r=[];c=n.toArray(t.getBody().getElementsByTagName("span"));if(c.length){for(var l=0;l<c.length;l++){var o=P(c[l]);if(o===null||!o.length){continue}if(o===e.toString()){r.push(c[l])}}}return r}t.on("click",function(e){var n=e.target;if(n.className=="mce-spellchecker-word"){e.preventDefault();var c=b(P(n));if(c.length>0){var r=t.dom.createRng();r.setStartBefore(c[0]);r.setEndAfter(c[c.length-1]);t.selection.setRng(r);x(n.getAttribute("data-mce-word"),c)}}});t.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:y,selectable:true,onPostRender:function(){var e=this;t.on("SpellcheckStart SpellcheckEnd",function(){e.active(h)})}});function R(e){var t=g.spellchecker_language;e.control.items().each(function(e){e.active(e.settings.data===t)})}var D={tooltip:"Spellcheck",onclick:y,onPostRender:function(){var e=this;t.on("SpellcheckStart SpellcheckEnd",function(){e.active(h)})}};if(s.length>1){D.type="splitbutton";D.menu=s;D.onshow=R;D.onselect=function(e){g.spellchecker_language=e.control.settings.data}}t.addButton("spellchecker",D);t.addCommand("mceSpellCheck",y);t.on("remove",function(){if(p){p.remove();p=null}});t.on("change",S);this.getTextMatcher=d;this.getWordCharPattern=w;this.getLanguage=function(){return g.spellchecker_language};g.spellchecker_language=g.spellchecker_language||g.language||"en"})});