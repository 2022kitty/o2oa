define("tinymce/tableplugin/Quirks",["tinymce/util/VK","tinymce/Env","tinymce/util/Tools"],function(e,t,n){var r=n.each;function o(e,t){return parseInt(e.getAttribute(t)||1,10)}return function(n){function i(){function t(t){var i=t.keyCode;function a(e,r){var o=e?"previousSibling":"nextSibling";var i=n.dom.getParent(r,"tr");var a=i[o];if(a){b(n,r,a,e);t.preventDefault();return true}else{var l=n.dom.getParent(i,"table");var s=i.parentNode;var c=s.nodeName.toLowerCase();if(c==="tbody"||c===(e?"tfoot":"thead")){var g=d(e,l,s,"tbody");if(g!==null){return u(e,g,r)}}return f(e,i,o,l)}}function d(e,t,r,o){var i=n.dom.select(">"+o,t);var a=i.indexOf(r);if(e&&a===0||!e&&a===i.length-1){return l(e,t)}else if(a===-1){var d=r.tagName.toLowerCase()==="thead"?0:i.length-1;return i[d]}else{return i[a+(e?-1:1)]}}function l(e,t){var r=e?"thead":"tfoot";var o=n.dom.select(">"+r,t);return o.length!==0?o[0]:null}function u(e,r,o){var i=s(r,e);if(i){b(n,o,i,e)}t.preventDefault();return true}function f(e,r,o,i){var d=i[o];if(d){c(d);return true}else{var l=n.dom.getParent(i,"td,th");if(l){return a(e,l,t)}else{var u=s(r,!e);c(u);t.preventDefault();return false}}}function s(e,t){var r=e&&e[t?"lastChild":"firstChild"];return r&&r.nodeName==="BR"?n.dom.getParent(r,"td,th"):r}function c(e){n.selection.setCursorLocation(e,0)}function g(){return i==e.UP||i==e.DOWN}function v(e){var t=e.selection.getNode();var n=e.dom.getParent(t,"tr");return n!==null}function m(e){var t=0;var n=e;while(n.previousSibling){n=n.previousSibling;t=t+o(n,"colspan")}return t}function h(e,t){var n=0,i=0;r(e.children,function(e,r){n=n+o(e,"colspan");i=r;if(n>t){return false}});return i}function b(e,t,r,o){var i=m(n.dom.getParent(t,"td,th"));var a=h(r,i);var d=r.childNodes[a];var l=s(d,o);c(l||d)}function C(e){var t=n.selection.getNode();var r=n.dom.getParent(t,"td,th");var o=n.dom.getParent(e,"td,th");return r&&r!==o&&p(r,o)}function p(e,t){return n.dom.getParent(e,"TABLE")===n.dom.getParent(t,"TABLE")}if(g()&&v(n)){var y=n.selection.getNode();setTimeout(function(){if(C(y)){a(!t.shiftKey&&i===e.UP,y,t)}},0)}}n.on("KeyDown",function(e){t(e)})}function a(){function e(e,t){var n=t.ownerDocument,r=n.createRange(),o;r.setStartBefore(t);r.setEnd(e.endContainer,e.endOffset);o=n.createElement("body");o.appendChild(r.cloneContents());return o.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length===0}n.on("KeyDown",function(t){var r,o,i=n.dom;if(t.keyCode==37||t.keyCode==38){r=n.selection.getRng();o=i.getParent(r.startContainer,"table");if(o&&n.getBody().firstChild==o){if(e(r,o)){r=i.createRng();r.setStartBefore(o);r.setEndBefore(o);n.selection.setRng(r);t.preventDefault()}}}})}function d(){n.on("KeyDown SetContent VisualAid",function(){var e;for(e=n.getBody().lastChild;e;e=e.previousSibling){if(e.nodeType==3){if(e.nodeValue.length>0){break}}else if(e.nodeType==1&&!e.getAttribute("data-mce-bogus")){break}}if(e&&e.nodeName=="TABLE"){if(n.settings.forced_root_block){n.dom.add(n.getBody(),n.settings.forced_root_block,n.settings.forced_root_block_attrs,t.ie&&t.ie<11?"&nbsp;":'<br data-mce-bogus="1" />')}else{n.dom.add(n.getBody(),"br",{"data-mce-bogus":"1"})}}});n.on("PreProcess",function(e){var t=e.node.lastChild;if(t&&(t.nodeName=="BR"||t.childNodes.length==1&&(t.firstChild.nodeName=="BR"||t.firstChild.nodeValue=="Â "))&&t.previousSibling&&t.previousSibling.nodeName=="TABLE"){n.dom.remove(t)}})}function l(){function e(e,t,n,r){var o=3,i=e.dom.getParent(t.startContainer,"TABLE");var a,d,l;if(i){a=i.parentNode}d=t.startContainer.nodeType==o&&t.startOffset===0&&t.endOffset===0&&r&&(n.nodeName=="TR"||n==a);l=(n.nodeName=="TD"||n.nodeName=="TH")&&!r;return d||l}function t(){var t=n.selection.getRng();var r=n.selection.getNode();var o=n.dom.getParent(t.startContainer,"TD,TH");if(!e(n,t,r,o)){return}if(!o){o=r}var i=o.lastChild;while(i.lastChild){i=i.lastChild}t.setEnd(i,i.nodeValue.length);n.selection.setRng(t)}n.on("KeyDown",function(){t()});n.on("MouseDown",function(e){if(e.button!=2){t()}})}function u(){n.on("keydown",function(t){if((t.keyCode==e.DELETE||t.keyCode==e.BACKSPACE)&&!t.isDefaultPrevented()){var r=n.dom.getParent(n.selection.getStart(),"table");if(r){var o=n.dom.select("td,th",r),i=o.length;while(i--){if(!n.dom.hasClass(o[i],"mce-item-selected")){return}}t.preventDefault();n.execCommand("mceTableDelete")}}})}u();if(t.webkit){i();l()}if(t.gecko){a();d()}if(t.ie>10){a();d()}}});