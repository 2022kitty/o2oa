define("tinymce/tableplugin/TableGrid",["tinymce/util/Tools","tinymce/Env"],function(e,n){var t=e.each;function r(e,n){return parseInt(e.getAttribute(n)||1,10)}return function(i,f){var o,l,a,c,s=i.selection,u=s.dom;function p(){var e=0;o=[];t(["thead","tbody","tfoot"],function(n){var i=u.select("> "+n+" tr",f);t(i,function(i,f){f+=e;t(u.select("> td, > th",i),function(e,t){var i,l,a,c;if(o[f]){while(o[f][t]){t++}}a=r(e,"rowspan");c=r(e,"colspan");for(l=f;l<f+a;l++){if(!o[l]){o[l]=[]}for(i=t;i<t+c;i++){o[l][i]={part:n,real:l==f&&i==t,elm:e,rowspan:a,colspan:c}}}})});e+=i.length})}function m(e,n){e=e.cloneNode(n);e.removeAttribute("id");return e}function d(e,n){var t;t=o[n];if(t){return t[e]}}function v(e,n,t){if(e){t=parseInt(t,10);if(t===1){e.removeAttribute(n,1)}else{e.setAttribute(n,t,1)}}}function h(e){return e&&(u.hasClass(e.elm,"mce-item-selected")||e==c)}function g(){var e=[];t(f.rows,function(n){t(n.cells,function(t){if(u.hasClass(t,"mce-item-selected")||c&&t==c.elm){e.push(n);return false}})});return e}function w(){var e=u.createRng();e.setStartAfter(f);e.setEndAfter(f);s.setRng(e);u.remove(f)}function S(r){var f,o={};if(i.settings.table_clone_elements!==false){o=e.makeMap((i.settings.table_clone_elements||"strong em b i span font h1 h2 h3 h4 h5 h6 p div").toUpperCase(),/[ ,]/)}e.walk(r,function(e){var i;if(e.nodeType==3){t(u.getParents(e.parentNode,null,r).reverse(),function(e){if(!o[e.nodeName]){return}e=m(e,false);if(!f){f=i=e}else if(i){i.appendChild(e)}i=e});if(i){i.innerHTML=n.ie?"&nbsp;":'<br data-mce-bogus="1" />'}return false}},"childNodes");r=m(r,false);v(r,"rowSpan",1);v(r,"colSpan",1);if(f){r.appendChild(f)}else{if(!n.ie){r.innerHTML='<br data-mce-bogus="1" />'}}return r}function y(){var e=u.createRng(),n;t(u.select("tr",f),function(e){if(e.cells.length===0){u.remove(e)}});if(u.select("tr",f).length===0){e.setStartBefore(f);e.setEndBefore(f);s.setRng(e);u.remove(f);return}t(u.select("thead,tbody,tfoot",f),function(e){if(e.rows.length===0){u.remove(e)}});p();if(l){n=o[Math.min(o.length-1,l.y)];if(n){s.select(n[Math.min(n.length-1,l.x)].elm,true);s.collapse(true)}}}function b(e,n,t,r){var i,f,l,a,c;i=o[n][e].elm.parentNode;for(l=1;l<=t;l++){i=u.getNext(i,"tr");if(i){for(f=e;f>=0;f--){c=o[n+l][f].elm;if(c.parentNode==i){for(a=1;a<=r;a++){u.insertAfter(S(c),c)}break}}if(f==-1){for(a=1;a<=r;a++){i.insertBefore(S(i.cells[0]),i.cells[0])}}}}}function x(){t(o,function(e,n){t(e,function(e,t){var i,f,o;if(h(e)){e=e.elm;i=r(e,"colspan");f=r(e,"rowspan");if(i>1||f>1){v(e,"rowSpan",1);v(e,"colSpan",1);for(o=0;o<i-1;o++){u.insertAfter(S(e),e)}b(t,n,f-1,i)}}})})}function C(n,r,i){var f,c,s,m,g,w,S,b,C,N,A;if(n){f=P(n);c=f.x;s=f.y;m=c+(r-1);g=s+(i-1)}else{l=a=null;t(o,function(e,n){t(e,function(e,t){if(h(e)){if(!l){l={x:t,y:n}}a={x:t,y:n}}})});if(l){c=l.x;s=l.y;m=a.x;g=a.y}}b=d(c,s);C=d(m,g);if(b&&C&&b.part==C.part){x();p();b=d(c,s).elm;v(b,"colSpan",m-c+1);v(b,"rowSpan",g-s+1);for(S=s;S<=g;S++){for(w=c;w<=m;w++){if(!o[S]||!o[S][w]){continue}n=o[S][w].elm;if(n!=b){N=e.grep(n.childNodes);t(N,function(e){b.appendChild(e)});if(N.length){N=e.grep(b.childNodes);A=0;t(N,function(e){if(e.nodeName=="BR"&&u.getAttrib(e,"data-mce-bogus")&&A++<N.length-1){b.removeChild(e)}})}u.remove(n)}}}y()}}function N(e){var n,i,f,l,a,c,s,p,d;t(o,function(r,i){t(r,function(t){if(h(t)){t=t.elm;a=t.parentNode;c=m(a,false);n=i;if(e){return false}}});if(e){return!n}});if(n===undefined){return}for(l=0;l<o[0].length;l++){if(!o[n][l]){continue}i=o[n][l].elm;if(i!=f){if(!e){d=r(i,"rowspan");if(d>1){v(i,"rowSpan",d+1);continue}}else{if(n>0&&o[n-1][l]){p=o[n-1][l].elm;d=r(p,"rowSpan");if(d>1){v(p,"rowSpan",d+1);continue}}}s=S(i);v(s,"colSpan",i.colSpan);c.appendChild(s);f=i}}if(c.hasChildNodes()){if(!e){u.insertAfter(c,a)}else{a.parentNode.insertBefore(c,a)}}}function A(e){var n,i;t(o,function(r){t(r,function(t,r){if(h(t)){n=r;if(e){return false}}});if(e){return!n}});t(o,function(t,f){var o,l,a;if(!t[n]){return}o=t[n].elm;if(o!=i){a=r(o,"colspan");l=r(o,"rowspan");if(a==1){if(!e){u.insertAfter(S(o),o);b(n,f,l-1,a)}else{o.parentNode.insertBefore(S(o),o);b(n,f,l-1,a)}}else{v(o,"colSpan",o.colSpan+1)}i=o}})}function R(){var n=[];t(o,function(i){t(i,function(i,f){if(h(i)&&e.inArray(n,f)===-1){t(o,function(e){var n=e[f].elm,t;t=r(n,"colSpan");if(t>1){v(n,"colSpan",t-1)}else{u.remove(n)}});n.push(f)}})});y()}function M(){var e;function n(e){var n,i,f;n=u.getNext(e,"tr");t(e.cells,function(e){var n=r(e,"rowSpan");if(n>1){v(e,"rowSpan",n-1);i=P(e);b(i.x,i.y,1,1)}});i=P(e.cells[0]);t(o[i.y],function(e){var n;e=e.elm;if(e!=f){n=r(e,"rowSpan");if(n<=1){u.remove(e)}else{v(e,"rowSpan",n-1)}f=e}})}e=g();t(e.reverse(),function(e){n(e)});y()}function B(){var e=g();u.remove(e);y();return e}function T(){var e=g();t(e,function(n,t){e[t]=m(n,true)});return e}function E(e,n){var r=g(),i=r[n?0:r.length-1],f=i.cells.length;if(!e){return}t(o,function(e){var n;f=0;t(e,function(e){if(e.real){f+=e.colspan}if(e.elm.parentNode==i){n=1}});if(n){return false}});if(!n){e.reverse()}t(e,function(e){var t,r=e.cells.length,o;for(t=0;t<r;t++){o=e.cells[t];v(o,"colSpan",1);v(o,"rowSpan",1)}for(t=r;t<f;t++){e.appendChild(S(e.cells[r-1]))}for(t=f;t<r;t++){u.remove(e.cells[t])}if(n){i.parentNode.insertBefore(e,i)}else{u.insertAfter(e,i)}});u.removeClass(u.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected")}function P(e){var n;t(o,function(r,i){t(r,function(t,r){if(t.elm==e){n={x:r,y:i};return false}});return!n});return n}function _(e){l=P(e)}function k(){var e,n;e=n=0;t(o,function(r,i){t(r,function(t,r){var f,l;if(h(t)){t=o[i][r];if(r>e){e=r}if(i>n){n=i}if(t.real){f=t.colspan-1;l=t.rowspan-1;if(f){if(r+f>e){e=r+f}}if(l){if(i+l>n){n=i+l}}}}})});return{x:e,y:n}}function H(e){var n,t,r,i,f,c,s,p,m,d;a=P(e);if(l&&a){n=Math.min(l.x,a.x);t=Math.min(l.y,a.y);r=Math.max(l.x,a.x);i=Math.max(l.y,a.y);f=r;c=i;for(d=t;d<=c;d++){e=o[d][n];if(!e.real){if(n-(e.colspan-1)<n){n-=e.colspan-1}}}for(m=n;m<=f;m++){e=o[t][m];if(!e.real){if(t-(e.rowspan-1)<t){t-=e.rowspan-1}}}for(d=t;d<=i;d++){for(m=n;m<=r;m++){e=o[d][m];if(e.real){s=e.colspan-1;p=e.rowspan-1;if(s){if(m+s>f){f=m+s}}if(p){if(d+p>c){c=d+p}}}}}u.removeClass(u.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected");for(d=t;d<=c;d++){for(m=n;m<=f;m++){if(o[d][m]){u.addClass(o[d][m].elm,"mce-item-selected")}}}}}f=f||u.getParent(s.getStart(),"table");p();c=u.getParent(s.getStart(),"th,td");if(c){l=P(c);a=k();c=d(l.x,l.y)}e.extend(this,{deleteTable:w,split:x,merge:C,insertRow:N,insertCol:A,deleteCols:R,deleteRows:M,cutRows:B,copyRows:T,pasteRows:E,getPos:P,setStartCell:_,setEndCell:H})}});