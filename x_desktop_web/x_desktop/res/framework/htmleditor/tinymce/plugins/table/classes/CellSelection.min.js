define("tinymce/tableplugin/CellSelection",["tinymce/tableplugin/TableGrid","tinymce/dom/TreeWalker","tinymce/util/Tools"],function(e,t,n){return function(l){var o=l.dom,i,r,s,a=true;function c(){l.getBody().style.webkitUserSelect="";if(a){l.dom.removeClass(l.dom.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected");a=false}}function d(t){var n,c,d=t.target;if(r&&(i||d!=r)&&(d.nodeName=="TD"||d.nodeName=="TH")){c=o.getParent(d,"table");if(c==s){if(!i){i=new e(l,c);i.setStartCell(r);l.getBody().style.webkitUserSelect="none"}i.setEndCell(d);a=true}n=l.selection.getSel();try{if(n.removeAllRanges){n.removeAllRanges()}else{n.empty()}}catch(e){}t.preventDefault()}}l.on("MouseDown",function(e){if(e.button!=2){c();r=o.getParent(e.target,"td,th");s=o.getParent(r,"table")}});l.on("mouseover",d);l.on("remove",function(){o.unbind(l.getDoc(),"mouseover",d)});l.on("MouseUp",function(){var e,a=l.selection,c,d,m,f,u;function g(l,o){var i=new t(l,l);do{if(l.nodeType==3&&n.trim(l.nodeValue).length!==0){if(o){e.setStart(l,0)}else{e.setEnd(l,l.nodeValue.length)}return}if(l.nodeName=="BR"){if(o){e.setStartBefore(l)}else{e.setEndBefore(l)}return}}while(l=o?i.next():i.prev())}if(r){if(i){l.getBody().style.webkitUserSelect=""}c=o.select("td.mce-item-selected,th.mce-item-selected");if(c.length>0){e=o.createRng();m=c[0];u=c[c.length-1];e.setStartBefore(m);e.setEndAfter(m);g(m,1);d=new t(m,o.getParent(c[0],"table"));do{if(m.nodeName=="TD"||m.nodeName=="TH"){if(!o.hasClass(m,"mce-item-selected")){break}f=m}}while(m=d.next());g(f);a.setRng(e)}l.nodeChanged();r=i=s=null}});l.on("KeyUp Drop",function(){c();r=i=s=null});return{clear:c}}});