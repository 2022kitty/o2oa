define("tinymce/util/Quirks",["tinymce/util/VK","tinymce/dom/RangeUtils","tinymce/html/Node","tinymce/html/Entities","tinymce/Env","tinymce/util/Tools"],function(e,t,n,o,i,r){return function(a){var c=r.each;var d=e.BACKSPACE,f=e.DELETE,u=a.dom,s=a.selection,l=a.settings,m=a.parser,g=a.serializer;var v=i.gecko,p=i.ie,h=i.webkit;function y(e,t){try{a.getDoc().execCommand(e,false,t)}catch(e){}}function b(){var e=a.getDoc().documentMode;return e?e:6}function C(e){return e.isDefaultPrevented()}function D(){var t=a.getDoc(),n="data:text/mce-internal,";var o=window.MutationObserver,i,c;if(!o){i=true;o=function(){var e=[],t;function n(t){var n=t.relatedNode||t.target;e.push({target:n,addedNodes:[n]})}function o(t){var n=t.relatedNode||t.target;e.push({target:n,attributeName:t.attrName})}this.observe=function(e){t=e;t.addEventListener("DOMSubtreeModified",n,false);t.addEventListener("DOMNodeInsertedIntoDocument",n,false);t.addEventListener("DOMNodeInserted",n,false);t.addEventListener("DOMAttrModified",o,false)};this.disconnect=function(){t.removeEventListener("DOMNodeInserted",n);t.removeEventListener("DOMAttrModified",o);t.removeEventListener("DOMSubtreeModified",n,false)};this.takeRecords=function(){return e}}}function l(e){var t=new o(function(){});r.each(a.getBody().getElementsByTagName("*"),function(e){if(e.tagName=="SPAN"){e.setAttribute("mce-data-marked",1)}if(!e.hasAttribute("data-mce-style")&&e.hasAttribute("style")){a.dom.setAttrib(e,"style",e.getAttribute("style"))}});t.observe(a.getDoc(),{childList:true,attributes:true,subtree:true,attributeFilter:["style"]});a.getDoc().execCommand(e?"ForwardDelete":"Delete",false,null);var n=a.selection.getRng();var i=n.startContainer.parentNode;r.each(t.takeRecords(),function(e){if(e.attributeName=="style"){var t=e.target.getAttribute("data-mce-style");if(t){e.target.setAttribute("style",t)}else{e.target.removeAttribute("style")}}r.each(e.addedNodes,function(e){if(e.nodeName=="SPAN"&&!e.getAttribute("mce-data-marked")){var t,o;if(e==i){t=n.startOffset;o=e.firstChild}u.remove(e,true);if(o){n.setStart(o,t);n.setEnd(o,t);a.selection.setRng(n)}}})});t.disconnect();r.each(a.dom.select("span[mce-data-marked]"),function(e){e.removeAttribute("mce-data-marked")})}a.on("keydown",function(t){var n=t.keyCode==f,o=e.metaKeyPressed(t);if(!C(t)&&(n||t.keyCode==d)){var i=a.selection.getRng(),r=i.startContainer,c=i.startOffset;if(!o&&i.collapsed&&r.nodeType==3){if(n?c<r.data.length:c>0){return}}t.preventDefault();if(o){a.selection.getSel().modify("extend",n?"forward":"backward","word")}l(n)}});a.on("keypress",function(t){if(!C(t)&&!s.isCollapsed()&&t.charCode&&!e.metaKeyPressed(t)){t.preventDefault();l(true);a.selection.setContent(String.fromCharCode(t.charCode))}});a.addCommand("Delete",function(){l()});a.addCommand("ForwardDelete",function(){l(true)});if(i){return}a.on("dragstart",function(e){var t;if(a.selection.isCollapsed()&&e.target.tagName=="IMG"){s.select(e.target)}c=s.getRng();t=a.selection.getContent();if(t.length>0){e.dataTransfer.setData("URL","data:text/mce-internal,"+escape(t))}});a.on("drop",function(e){if(!C(e)){var o=e.dataTransfer.getData("URL");if(!o||o.indexOf(n)==-1||!t.caretRangeFromPoint){return}o=unescape(o.substr(n.length));if(t.caretRangeFromPoint){e.preventDefault();window.setTimeout(function(){var n=t.caretRangeFromPoint(e.x,e.y);if(c){s.setRng(c);c=null}l();s.setRng(n);a.insertContent(o)},0)}}});a.on("cut",function(e){if(!C(e)&&e.clipboardData){e.preventDefault();e.clipboardData.clearData();e.clipboardData.setData("text/html",a.selection.getContent());e.clipboardData.setData("text/plain",a.selection.getContent({format:"text"}));l(true)}})}function k(){function e(e){var t=u.create("body");var n=e.cloneContents();t.appendChild(n);return s.serializer.serialize(t,{format:"html"})}function n(n){if(!n.setStart){if(n.item){return false}var o=n.duplicate();o.moveToElementText(a.getBody());return t.compareRanges(n,o)}var i=e(n);var r=u.createRng();r.selectNode(a.getBody());var c=e(r);return i===c}a.on("keydown",function(e){var t=e.keyCode,o,i;if(!C(e)&&(t==f||t==d)){o=a.selection.isCollapsed();i=a.getBody();if(o&&!u.isEmpty(i)){return}if(!o&&!n(a.selection.getRng())){return}e.preventDefault();a.setContent("");if(i.firstChild&&u.isBlock(i.firstChild)){a.selection.setCursorLocation(i.firstChild,0)}else{a.selection.setCursorLocation(i,0)}a.nodeChanged()}})}function N(){a.on("keydown",function(t){if(!C(t)&&t.keyCode==65&&e.metaKeyPressed(t)){t.preventDefault();a.execCommand("SelectAll")}})}function w(){if(!a.settings.content_editable){u.bind(a.getDoc(),"focusin",function(){s.setRng(s.getRng())});u.bind(a.getDoc(),"mousedown",function(e){if(e.target==a.getDoc().documentElement){a.getBody().focus();s.setRng(s.getRng())}})}}function R(){a.on("keydown",function(e){if(!C(e)&&e.keyCode===d){if(s.isCollapsed()&&s.getRng(true).startOffset===0){var t=s.getNode();var n=t.previousSibling;if(t.nodeName=="HR"){u.remove(t);e.preventDefault();return}if(n&&n.nodeName&&n.nodeName.toLowerCase()==="hr"){u.remove(n);e.preventDefault()}}}})}function S(){if(!window.Range.prototype.getClientRects){a.on("mousedown",function(e){if(!C(e)&&e.target.nodeName==="HTML"){var t=a.getBody();t.blur();setTimeout(function(){t.focus()},0)}})}}function E(){a.on("click",function(e){e=e.target;if(/^(IMG|HR)$/.test(e.nodeName)){s.getSel().setBaseAndExtent(e,0,e,1)}if(e.nodeName=="A"&&u.hasClass(e,"mce-item-anchor")){s.select(e)}a.nodeChanged()})}function A(){function e(){var e=u.getAttribs(s.getStart().cloneNode(false));return function(){var t=s.getStart();if(t!==a.getBody()){u.setAttrib(t,"style",null);c(e,function(e){t.setAttributeNode(e.cloneNode(true))})}}}function t(){return!s.isCollapsed()&&u.getParent(s.getStart(),u.isBlock)!=u.getParent(s.getEnd(),u.isBlock)}a.on("keypress",function(n){var o;if(!C(n)&&(n.keyCode==8||n.keyCode==46)&&t()){o=e();a.getDoc().execCommand("delete",false,null);o();n.preventDefault();return false}});u.bind(a.getDoc(),"cut",function(n){var o;if(!C(n)&&t()){o=e();setTimeout(function(){o()},0)}})}function x(){var e,n;a.on("selectionchange",function(){if(n){clearTimeout(n);n=0}n=window.setTimeout(function(){if(a.removed){return}var n=s.getRng();if(!e||!t.compareRanges(n,e)){a.nodeChanged();e=n}},50)})}function B(){document.body.setAttribute("role","application")}function T(){a.on("keydown",function(e){if(!C(e)&&e.keyCode===d){if(s.isCollapsed()&&s.getRng(true).startOffset===0){var t=s.getNode().previousSibling;if(t&&t.nodeName&&t.nodeName.toLowerCase()==="table"){e.preventDefault();return false}}}})}function P(){if(b()>7){return}y("RespectVisibilityInDesign",true);a.contentStyles.push(".mceHideBrInPre pre br {display: none}");u.addClass(a.getBody(),"mceHideBrInPre");m.addNodeFilter("pre",function(e){var t=e.length,o,i,r,a;while(t--){o=e[t].getAll("br");i=o.length;while(i--){r=o[i];a=r.prev;if(a&&a.type===3&&a.value.charAt(a.value-1)!="\n"){a.value+="\n"}else{r.parent.insert(new n("#text",3),r,true).value="\n"}}}});g.addNodeFilter("pre",function(e){var t=e.length,n,o,i,r;while(t--){n=e[t].getAll("br");o=n.length;while(o--){i=n[o];r=i.prev;if(r&&r.type==3){r.value=r.value.replace(/\r?\n$/,"")}}}})}function M(){u.bind(a.getBody(),"mouseup",function(){var e,t=s.getNode();if(t.nodeName=="IMG"){if(e=u.getStyle(t,"width")){u.setAttrib(t,"width",e.replace(/[^0-9%]+/g,""));u.setStyle(t,"width","")}if(e=u.getStyle(t,"height")){u.setAttrib(t,"height",e.replace(/[^0-9%]+/g,""));u.setStyle(t,"height","")}}})}function L(){a.on("keydown",function(t){var n,o,i,r,c;if(C(t)||t.keyCode!=e.BACKSPACE){return}n=s.getRng();o=n.startContainer;i=n.startOffset;r=u.getRoot();c=o;if(!n.collapsed||i!==0){return}while(c&&c.parentNode&&c.parentNode.firstChild==c&&c.parentNode!=r){c=c.parentNode}if(c.tagName==="BLOCKQUOTE"){a.formatter.toggle("blockquote",null,c);n=u.createRng();n.setStart(o,0);n.setEnd(o,0);s.setRng(n)}})}function O(){function e(){a._refreshContentEditable();y("StyleWithCSS",false);y("enableInlineTableEditing",false);if(!l.object_resizing){y("enableObjectResizing",false)}}if(!l.readonly){a.on("BeforeExecCommand MouseDown",e)}}function I(){function e(){c(u.select("a"),function(e){var t=e.parentNode,n=u.getRoot();if(t.lastChild===e){while(t&&!u.isBlock(t)){if(t.parentNode.lastChild!==t||t===n){return}t=t.parentNode}u.add(t,"br",{"data-mce-bogus":1})}})}a.on("SetContent ExecCommand",function(t){if(t.type=="setcontent"||t.command==="mceInsertLink"){e()}})}function F(){if(l.forced_root_block){a.on("init",function(){y("DefaultParagraphSeparator",l.forced_root_block)})}}function z(){a.on("Undo Redo SetContent",function(e){if(!e.initial){a.execCommand("mceRepaint")}})}function H(){a.on("keydown",function(e){var t;if(!C(e)&&e.keyCode==d){t=a.getDoc().selection.createRange();if(t&&t.item){e.preventDefault();a.undoManager.beforeChange();u.remove(t.item(0));a.undoManager.add()}}})}function K(){var e;if(b()>=10){e="";c("p div h1 h2 h3 h4 h5 h6".split(" "),function(t,n){e+=(n>0?",":"")+t+":empty"});a.contentStyles.push(e+"{padding-right: 1px !important}")}}function _(){if(b()<9){m.addNodeFilter("noscript",function(e){var t=e.length,n,o;while(t--){n=e[t];o=n.firstChild;if(o){n.attr("data-mce-innertext",o.value)}}});g.addNodeFilter("noscript",function(e){var t=e.length,i,r,a;while(t--){i=e[t];r=e[t].firstChild;if(r){r.value=o.decode(r.value)}else{a=i.attributes.map["data-mce-innertext"];if(a){i.attr("data-mce-innertext",null);r=new n("#text",3);r.value=a;r.raw=true;i.append(r)}}}})}}function U(){var e=u.doc,t=e.body,n,o,i;function r(e,n){var o=t.createTextRange();try{o.moveToPoint(e,n)}catch(e){o=null}return o}function a(e){var t;if(e.button){t=r(e.x,e.y);if(t){if(t.compareEndPoints("StartToStart",o)>0){t.setEndPoint("StartToStart",o)}else{t.setEndPoint("EndToEnd",o)}t.select()}}else{c()}}function c(){var t=e.selection.createRange();if(o&&!t.item&&t.compareEndPoints("StartToEnd",t)===0){o.select()}u.unbind(e,"mouseup",c);u.unbind(e,"mousemove",a);o=n=0}e.documentElement.unselectable=true;u.bind(e,"mousedown contextmenu",function(t){if(t.target.nodeName==="HTML"){if(n){c()}i=e.documentElement;if(i.scrollHeight>i.clientHeight){return}n=1;o=r(t.x,t.y);if(o){u.bind(e,"mouseup",c);u.bind(e,"mousemove",a);u.getRoot().focus();o.select()}}})}function G(){a.on("keyup focusin mouseup",function(t){if(t.keyCode!=65||!e.metaKeyPressed(t)){s.normalize()}},true)}function j(){a.contentStyles.push("img:-moz-broken {"+"-moz-force-broken-image-icon:1;"+"min-width:24px;"+"min-height:24px"+"}")}function Q(){if(!a.inline){a.on("keydown",function(){if(document.activeElement==document.body){a.getWin().focus()}})}}function V(){if(!a.inline){a.contentStyles.push("body {min-height: 150px}");a.on("click",function(e){if(e.target.nodeName=="HTML"){a.getBody().focus();a.selection.normalize();a.nodeChanged()}})}}function W(){if(i.mac){a.on("keydown",function(t){if(e.metaKeyPressed(t)&&(t.keyCode==37||t.keyCode==39)){t.preventDefault();a.selection.getSel().modify("move",t.keyCode==37?"backward":"forward","word")}})}}function $(){y("AutoUrlDetect",false)}function q(){if(!a.inline){a.on("focus blur beforegetcontent",function(){var e=a.dom.create("br");a.getBody().appendChild(e);e.parentNode.removeChild(e)},true)}}function J(){a.on("click",function(e){var t=e.target;do{if(t.tagName==="A"){e.preventDefault();return}}while(t=t.parentNode)});a.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")}function X(){a.on("init",function(){a.dom.bind(a.getBody(),"submit",function(e){e.preventDefault()})})}T();L();k();G();if(h){D();w();E();F();X();if(i.iOS){x();Q();V();J()}else{N()}}if(p&&i.ie<11){R();B();P();M();H();K();_();U()}if(i.ie>=11){V();q()}if(i.ie){N();$()}if(v){R();S();A();O();I();z();j();W()}}});