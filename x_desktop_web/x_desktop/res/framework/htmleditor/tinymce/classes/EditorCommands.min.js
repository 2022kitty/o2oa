define("tinymce/EditorCommands",["tinymce/html/Serializer","tinymce/Env","tinymce/util/Tools"],function(e,t,n){var r=n.each,i=n.extend;var o=n.map,a=n.inArray,s=n.explode;var l=t.gecko,c=t.ie;var f=true,u=false;return function(n){var d=n.dom,m=n.selection,g={state:{},exec:{},value:{}},p=n.settings,C=n.formatter,v;function y(e,t,n){var r;e=e.toLowerCase();if(r=g.exec[e]){r(e,t,n);return f}return u}function h(e){var t;e=e.toLowerCase();if(t=g.state[e]){return t(e)}return-1}function k(e){var t;e=e.toLowerCase();if(t=g.value[e]){return t(e)}return u}function S(e,t){t=t||"exec";r(e,function(e,n){r(n.toLowerCase().split(","),function(n){g[t][n]=e})})}i(this,{execCommand:y,queryCommandState:h,queryCommandValue:k,addCommands:S});function L(e,t,r){if(t===undefined){t=u}if(r===undefined){r=null}return n.getDoc().execCommand(e,t,r)}function B(e){return C.match(e)}function N(e,t){C.toggle(e,t?{value:t}:undefined);n.nodeChanged()}function R(e){v=m.getBookmark(e)}function b(){m.moveToBookmark(v)}S({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){n.undoManager.add()},"Cut,Copy,Paste":function(e){var r=n.getDoc(),i;try{L(e)}catch(e){i=f}if(i||!r.queryCommandSupported(e)){var o=n.translate("Your browser doesn't support direct access to the clipboard. "+"Please use the Ctrl+X/C/V keyboard shortcuts instead.");if(t.mac){o=o.replace(/Ctrl\+/g,"âŒ˜+")}n.windowManager.alert(o)}},unlink:function(){if(m.isCollapsed()){var e=m.getNode();if(e.tagName=="A"){n.dom.remove(e,true)}return}C.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(e){var t=e.substring(7);if(t=="full"){t="justify"}r("left,center,right,justify".split(","),function(e){if(t!=e){C.remove("align"+e)}});N("align"+t);y("mceRepaint")},"InsertUnorderedList,InsertOrderedList":function(e){var t,n;L(e);t=d.getParent(m.getNode(),"ol,ul");if(t){n=t.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName)){R();d.split(n,t);b()}}},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){N(e)},"ForeColor,HiliteColor,FontName":function(e,t,n){N(e,n)},FontSize:function(e,t,n){var r,i;if(n>=1&&n<=7){i=s(p.font_size_style_values);r=s(p.font_size_classes);if(r){n=r[n-1]||n}else{n=i[n-1]||n}}N(e,n)},RemoveFormat:function(e){C.remove(e)},mceBlockQuote:function(){N("blockquote")},FormatBlock:function(e,t,n){return N(n||"p")},mceCleanup:function(){var e=m.getBookmark();n.setContent(n.getContent({cleanup:f}),{cleanup:f});m.moveToBookmark(e)},mceRemoveNode:function(e,t,r){var i=r||m.getNode();if(i!=n.getBody()){R();n.dom.remove(i,f);b()}},mceSelectNodeDepth:function(e,t,r){var i=0;d.getParent(m.getNode(),function(e){if(e.nodeType==1&&i++==r){m.select(e);return u}},n.getBody())},mceSelectNode:function(e,t,n){m.select(n)},mceInsertContent:function(t,r,i){var o,a,s,l,f,u;var g,p,C,v,y;function h(e){var t,n,r;t=m.getRng(true);n=t.startContainer;r=t.startOffset;function i(e){return n[e]&&n[e].nodeType==3}if(n.nodeType==3){if(r>0){e=e.replace(/^&nbsp;/," ")}else if(!i("previousSibling")){e=e.replace(/^ /,"&nbsp;")}if(r<n.length){e=e.replace(/&nbsp;(<br>|)$/," ")}else if(!i("nextSibling")){e=e.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;")}}return e}if(/^ | $/.test(i)){i=h(i)}o=n.parser;a=new e({},n.schema);y='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#200B;</span>';u={content:i,format:"html",selection:true};n.fire("BeforeSetContent",u);i=u.content;if(i.indexOf("{$caret}")==-1){i+="{$caret}"}i=i.replace(/\{\$caret\}/,y);p=m.getRng();var k=p.startContainer||(p.parentElement?p.parentElement():null);var S=n.getBody();if(k===S&&m.isCollapsed()){if(d.isBlock(S.firstChild)&&d.isEmpty(S.firstChild)){p=d.createRng();p.setStart(S.firstChild,0);p.setEnd(S.firstChild,0);m.setRng(p)}}if(!m.isCollapsed()){n.getDoc().execCommand("Delete",false,null)}s=m.getNode();var L={context:s.nodeName.toLowerCase()};f=o.parse(i,L);C=f.lastChild;if(C.attr("id")=="mce_marker"){g=C;for(C=C.prev;C;C=C.walk(true)){if(C.type==3||!d.isBlock(C.name)){C.parent.insert(g,C,C.name==="br");break}}}if(!L.invalid){i=a.serialize(f);C=s.firstChild;v=s.lastChild;if(!C||C===v&&C.nodeName==="BR"){d.setHTML(s,i)}else{m.setContent(i)}}else{m.setContent(y);s=m.getNode();l=n.getBody();if(s.nodeType==9){s=C=l}else{C=s}while(C!==l){s=C;C=C.parentNode}i=s==l?l.innerHTML:d.getOuterHTML(s);i=a.serialize(o.parse(i.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return a.serialize(f)})));if(s==l){d.setHTML(l,i)}else{d.setOuterHTML(s,i)}}g=d.get("mce_marker");m.scrollIntoView(g);p=d.createRng();C=g.previousSibling;if(C&&C.nodeType==3){p.setStart(C,C.nodeValue.length);if(!c){v=g.nextSibling;if(v&&v.nodeType==3){C.appendData(v.data);v.parentNode.removeChild(v)}}}else{p.setStartBefore(g);p.setEndBefore(g)}d.remove(g);m.setRng(p);n.fire("SetContent",u);n.addVisual()},mceInsertRawHTML:function(e,t,r){m.setContent("tiny_mce_marker");n.setContent(n.getContent().replace(/tiny_mce_marker/g,function(){return r}))},mceToggleFormat:function(e,t,n){N(n)},mceSetContent:function(e,t,r){n.setContent(r)},"Indent,Outdent":function(e){var t,i,o;t=p.indentation;i=/[a-z%]+$/i.exec(t);t=parseInt(t,10);if(!h("InsertUnorderedList")&&!h("InsertOrderedList")){if(!p.forced_root_block&&!d.getParent(m.getNode(),d.isBlock)){C.apply("div")}r(m.getSelectedBlocks(),function(r){if(r.nodeName!="LI"){var a=n.getParam("indent_use_margin",false)?"margin":"padding";a+=d.getStyle(r,"direction",true)=="rtl"?"Right":"Left";if(e=="outdent"){o=Math.max(0,parseInt(r.style[a]||0,10)-t);d.setStyle(r,a,o?o+i:"")}else{o=parseInt(r.style[a]||0,10)+t+i;d.setStyle(r,a,o)}}})}else{L(e)}},mceRepaint:function(){if(l){try{R(f);if(m.getSel()){m.getSel().selectAllChildren(n.getBody())}m.collapse(f);b()}catch(e){}}},InsertHorizontalRule:function(){n.execCommand("mceInsertContent",false,"<hr />")},mceToggleVisualAid:function(){n.hasVisual=!n.hasVisual;n.addVisual()},mceReplaceContent:function(e,t,r){n.execCommand("mceInsertContent",false,r.replace(/\{\$selection\}/g,m.getContent({format:"text"})))},mceInsertLink:function(e,t,n){var r;if(typeof n=="string"){n={href:n}}r=d.getParent(m.getNode(),"a");n.href=n.href.replace(" ","%20");if(!r||!n.href){C.remove("link")}if(n.href){C.apply("link",n,r)}},selectAll:function(){var e=d.getRoot(),t;if(m.getRng().setStart){t=d.createRng();t.setStart(e,0);t.setEnd(e,e.childNodes.length);m.setRng(t)}else{t=m.getRng();if(!t.item){t.moveToElementText(e);t.select()}}},delete:function(){L("Delete");var e=n.getBody();if(d.isEmpty(e)){n.setContent("");if(e.firstChild&&d.isBlock(e.firstChild)){n.selection.setCursorLocation(e.firstChild,0)}else{n.selection.setCursorLocation(e,0)}}},mceNewDocument:function(){n.setContent("")}});S({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(e){var t="align"+e.substring(7);var n=m.isCollapsed()?[d.getParent(m.getNode(),d.isBlock)]:m.getSelectedBlocks();var r=o(n,function(e){return!!C.matchNode(e,t)});return a(r,f)!==-1},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){return B(e)},mceBlockQuote:function(){return B("blockquote")},Outdent:function(){var e;if(p.inline_styles){if((e=d.getParent(m.getStart(),d.isBlock))&&parseInt(e.style.paddingLeft,10)>0){return f}if((e=d.getParent(m.getEnd(),d.isBlock))&&parseInt(e.style.paddingLeft,10)>0){return f}}return h("InsertUnorderedList")||h("InsertOrderedList")||!p.inline_styles&&!!d.getParent(m.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(e){var t=d.getParent(m.getNode(),"ul,ol");return t&&(e==="insertunorderedlist"&&t.tagName==="UL"||e==="insertorderedlist"&&t.tagName==="OL")}},"state");S({"FontSize,FontName":function(e){var t=0,n;if(n=d.getParent(m.getNode(),"span")){if(e=="fontsize"){t=n.style.fontSize}else{t=n.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()}}return t}},"value");S({Undo:function(){n.undoManager.undo()},Redo:function(){n.undoManager.redo()}})}});