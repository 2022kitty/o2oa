define("tinymce/dom/Serializer",["tinymce/dom/DOMUtils","tinymce/html/DomParser","tinymce/html/Entities","tinymce/html/Serializer","tinymce/html/Node","tinymce/html/Schema","tinymce/Env","tinymce/util/Tools"],function(e,t,n,i,r,a,l,s){var c=s.each,o=s.trim;var d=e.DOM;return function(e,r){var s,u,m;if(r){s=r.dom;u=r.schema}s=s||d;u=u||new a(e);e.entity_encoding=e.entity_encoding||"named";e.remove_trailing_brs="remove_trailing_brs"in e?e.remove_trailing_brs:true;m=new t(e,u);m.addAttributeFilter("data-mce-tabindex",function(e,t){var n=e.length,i;while(n--){i=e[n];i.attr("tabindex",i.attributes.map["data-mce-tabindex"]);i.attr(t,null)}});m.addAttributeFilter("src,href,style",function(t,n){var i=t.length,r,a,l="data-mce-"+n;var c=e.url_converter,o=e.url_converter_scope,d;while(i--){r=t[i];a=r.attributes.map[l];if(a!==d){r.attr(n,a.length>0?a:null);r.attr(l,null)}else{a=r.attributes.map[n];if(n==="style"){a=s.serializeStyle(s.parseStyle(a),r.name)}else if(c){a=c.call(o,a,n,r.name)}r.attr(n,a.length>0?a:null)}}});m.addAttributeFilter("class",function(e){var t=e.length,n,i;while(t--){n=e[t];i=n.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,"");n.attr("class",i.length>0?i:null)}});m.addAttributeFilter("data-mce-type",function(e,t,n){var i=e.length,r;while(i--){r=e[i];if(r.attributes.map["data-mce-type"]==="bookmark"&&!n.cleanup){r.remove()}}});m.addAttributeFilter("data-mce-expando",function(e,t){var n=e.length;while(n--){e[n].attr(t,null)}});m.addNodeFilter("noscript",function(e){var t=e.length,i;while(t--){i=e[t].firstChild;if(i){i.value=n.decode(i.value)}}});m.addNodeFilter("script,style",function(e,t){var n=e.length,i,r;function a(e){return e.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}while(n--){i=e[n];r=i.firstChild?i.firstChild.value:"";if(t==="script"){var l=(i.attr("type")||"text/javascript").replace(/^mce\-/,"");i.attr("type",l==="text/javascript"?null:l);if(r.length>0){i.firstChild.value="// <![CDATA[\n"+a(r)+"\n// ]]>"}}else{if(r.length>0){i.firstChild.value="<!--\n"+a(r)+"\n-->"}}}});m.addNodeFilter("#comment",function(e){var t=e.length,n;while(t--){n=e[t];if(n.value.indexOf("[CDATA[")===0){n.name="#cdata";n.type=4;n.value=n.value.replace(/^\[CDATA\[|\]\]$/g,"")}else if(n.value.indexOf("mce:protected ")===0){n.name="#text";n.type=3;n.raw=true;n.value=unescape(n.value).substr(14)}}});m.addNodeFilter("xml:namespace,input",function(e,t){var n=e.length,i;while(n--){i=e[n];if(i.type===7){i.remove()}else if(i.type===1){if(t==="input"&&!("type"in i.attributes.map)){i.attr("type","text")}}}});if(e.fix_list_elements){m.addNodeFilter("ul,ol",function(e){var t=e.length,n,i;while(t--){n=e[t];i=n.parent;if(i.name==="ul"||i.name==="ol"){if(n.prev&&n.prev.name==="li"){n.prev.append(n)}}}})}m.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected",function(e,t){var n=e.length;while(n--){e[n].attr(t,null)}});return{schema:u,addNodeFilter:m.addNodeFilter,addAttributeFilter:m.addAttributeFilter,serialize:function(t,n){var r=this,a,d,f,p,h;if(l.ie&&s.select("script,style,select,map").length>0){h=t.innerHTML;t=t.cloneNode(false);s.setHTML(t,h)}else{t=t.cloneNode(true)}a=t.ownerDocument.implementation;if(a.createHTMLDocument){d=a.createHTMLDocument("");c(t.nodeName=="BODY"?t.childNodes:[t],function(e){d.body.appendChild(d.importNode(e,true))});if(t.nodeName!="BODY"){t=d.body.firstChild}else{t=d.body}f=s.doc;s.doc=d}n=n||{};n.format=n.format||"html";if(n.selection){n.forced_root_block=""}if(!n.no_events){n.node=t;r.onPreProcess(n)}p=new i(e,u);n.content=p.serialize(m.parse(o(n.getInner?t.innerHTML:s.getOuterHTML(t)),n));if(!n.cleanup){n.content=n.content.replace(/\uFEFF/g,"")}if(!n.no_events){r.onPostProcess(n)}if(f){s.doc=f}n.node=null;return n.content},addRules:function(e){u.addValidElements(e)},setRules:function(e){u.setValidElements(e)},onPreProcess:function(e){if(r){r.fire("PreProcess",e)}},onPostProcess:function(e){if(r){r.fire("PostProcess",e)}}}}});