define("tinymce/dom/RangeUtils",["tinymce/util/Tools","tinymce/dom/TreeWalker"],function(e,n){var t=e.each;function i(e){this.walk=function(n,i){var r=n.startContainer,o=n.startOffset,d=n.endContainer,a=n.endOffset,f,l,s,u,h,c,p;p=e.select("td.mce-item-selected,th.mce-item-selected");if(p.length>0){t(p,function(e){i([e])});return}function g(e){var n;n=e[0];if(n.nodeType===3&&n===r&&o>=n.nodeValue.length){e.splice(0,1)}n=e[e.length-1];if(a===0&&e.length>0&&n===d&&n.nodeType===3){e.splice(e.length-1,1)}return e}function N(e,n,t){var i=[];for(;e&&e!=t;e=e[n]){i.push(e)}return i}function m(e,n){do{if(e.parentNode==n){return e}e=e.parentNode}while(e)}function v(e,n,t){var r=t?"nextSibling":"previousSibling";for(u=e,h=u.parentNode;u&&u!=n;u=h){h=u.parentNode;c=N(u==e?u:u[r],r);if(c.length){if(!t){c.reverse()}i(g(c))}}}if(r.nodeType==1&&r.hasChildNodes()){r=r.childNodes[o]}if(d.nodeType==1&&d.hasChildNodes()){d=d.childNodes[Math.min(a-1,d.childNodes.length-1)]}if(r==d){return i(g([r]))}f=e.findCommonAncestor(r,d);for(u=r;u;u=u.parentNode){if(u===d){return v(r,f,true)}if(u===f){break}}for(u=d;u;u=u.parentNode){if(u===r){return v(d,f)}if(u===f){break}}l=m(r,f)||r;s=m(d,f)||d;v(r,l,true);c=N(l==r?l:l.nextSibling,"nextSibling",s==d?s.nextSibling:s);if(c.length){i(g(c))}v(d,s)};this.split=function(e){var n=e.startContainer,t=e.startOffset,i=e.endContainer,r=e.endOffset;function o(e,n){return e.splitText(n)}if(n==i&&n.nodeType==3){if(t>0&&t<n.nodeValue.length){i=o(n,t);n=i.previousSibling;if(r>t){r=r-t;n=i=o(i,r).previousSibling;r=i.nodeValue.length;t=0}else{r=0}}}else{if(n.nodeType==3&&t>0&&t<n.nodeValue.length){n=o(n,t);t=0}if(i.nodeType==3&&r>0&&r<i.nodeValue.length){i=o(i,r).previousSibling;r=i.nodeValue.length}}return{startContainer:n,startOffset:t,endContainer:i,endOffset:r}};this.normalize=function(t){var i,r;function o(o){var d,a,f,l=e.getRoot(),s,u;var h,c;function p(t,i){var r=new n(t,e.getParent(t.parentNode,e.isBlock)||l);while(t=r[i?"prev":"next"]()){if(t.nodeName==="BR"){return true}}}function g(e,n){return e.previousSibling&&e.previousSibling.nodeName==n}function N(t,o){var f,h,p;o=o||d;p=e.getParent(o.parentNode,e.isBlock)||l;if(t&&o.nodeName=="BR"&&c&&e.isEmpty(p)){d=o.parentNode;a=e.nodeIndex(o);i=true;return}f=new n(o,p);while(s=f[t?"prev":"next"]()){if(e.getContentEditableParent(s)==="false"){return}if(s.nodeType===3&&s.nodeValue.length>0){d=s;a=t?s.nodeValue.length:0;i=true;return}if(e.isBlock(s)||u[s.nodeName.toLowerCase()]){return}h=s}if(r&&h){d=h;i=true;a=0}}d=t[(o?"start":"end")+"Container"];a=t[(o?"start":"end")+"Offset"];c=d.nodeType==1&&a===d.childNodes.length;u=e.schema.getNonEmptyElements();h=o;if(d.nodeType==1&&a>d.childNodes.length-1){h=false}if(d.nodeType===9){d=e.getRoot();a=0}if(d===l){if(h){s=d.childNodes[a>0?a-1:0];if(s){if(u[s.nodeName]||s.nodeName=="TABLE"){return}}}if(d.hasChildNodes()){a=Math.min(!h&&a>0?a-1:a,d.childNodes.length-1);d=d.childNodes[a];a=0;if(d.hasChildNodes()&&!/TABLE/.test(d.nodeName)){s=d;f=new n(d,l);do{if(s.nodeType===3&&s.nodeValue.length>0){a=h?0:s.nodeValue.length;d=s;i=true;break}if(u[s.nodeName.toLowerCase()]){a=e.nodeIndex(s);d=s.parentNode;if(s.nodeName=="IMG"&&!h){a++}i=true;break}}while(s=h?f.next():f.prev())}}}if(r){if(d.nodeType===3&&a===0){N(true)}if(d.nodeType===1){s=d.childNodes[a];if(!s){s=d.childNodes[a-1]}if(s&&s.nodeName==="BR"&&!g(s,"A")&&!p(s)&&!p(s,true)){N(true,s)}}}if(h&&!r&&d.nodeType===3&&a===d.nodeValue.length){N(false)}if(i){t["set"+(o?"Start":"End")](d,a)}}r=t.collapsed;o(true);if(!r){o()}if(i&&r){t.collapse(true)}return i}}i.compareRanges=function(e,n){if(e&&n){if(e.item||e.duplicate){if(e.item&&n.item&&e.item(0)===n.item(0)){return true}if(e.isEqual&&n.isEqual&&n.isEqual(e)){return true}}else{return e.startContainer==n.startContainer&&e.startOffset==n.startOffset}}return false};return i});