define("tinymce/dom/TridentSelection",[],function(){function e(e){var t=this,n=e.dom,r=false;function i(t,n){var r,i=0,o,a,s,l,d,f,c=-1,u;r=t.duplicate();r.collapse(n);u=r.parentElement();if(u.ownerDocument!==e.dom.doc){return}while(u.contentEditable==="false"){u=u.parentNode}if(!u.hasChildNodes()){return{node:u,inside:1}}s=u.children;o=s.length-1;while(i<=o){f=Math.floor((i+o)/2);l=s[f];r.moveToElementText(l);c=r.compareEndPoints(n?"StartToStart":"EndToEnd",t);if(c>0){o=f-1}else if(c<0){i=f+1}else{return{node:l}}}if(c<0){if(!l){r.moveToElementText(u);r.collapse(true);l=u;a=true}else{r.collapse(false)}d=0;while(r.compareEndPoints(n?"StartToStart":"StartToEnd",t)!==0){if(r.move("character",1)===0||u!=r.parentElement()){break}d++}}else{r.collapse(true);d=0;while(r.compareEndPoints(n?"StartToStart":"StartToEnd",t)!==0){if(r.move("character",-1)===0||u!=r.parentElement()){break}d++}}return{node:l,position:c,offset:d,inside:a}}function o(){var r=e.getRng(),o=n.createRng(),a,s,l,d,f;a=r.item?r.item(0):r.parentElement();if(a.ownerDocument!=n.doc){return o}s=e.isCollapsed();if(r.item){o.setStart(a.parentNode,n.nodeIndex(a));o.setEnd(o.startContainer,o.startOffset+1);return o}function c(e){var t=i(r,e),n,a,s=0,l,d,f;n=t.node;a=t.offset;if(t.inside&&!n.hasChildNodes()){o[e?"setStart":"setEnd"](n,0);return}if(a===d){o[e?"setStartBefore":"setEndAfter"](n);return}if(t.position<0){l=t.inside?n.firstChild:n.nextSibling;if(!l){o[e?"setStartAfter":"setEndAfter"](n);return}if(!a){if(l.nodeType==3){o[e?"setStart":"setEnd"](l,0)}else{o[e?"setStartBefore":"setEndBefore"](l)}return}while(l){f=l.nodeValue;s+=f.length;if(s>=a){n=l;s-=a;s=f.length-s;break}l=l.nextSibling}}else{l=n.previousSibling;if(!l){return o[e?"setStartBefore":"setEndBefore"](n)}if(!a){if(n.nodeType==3){o[e?"setStart":"setEnd"](l,n.nodeValue.length)}else{o[e?"setStartAfter":"setEndAfter"](l)}return}while(l){s+=l.nodeValue.length;if(s>=a){n=l;s-=a;break}l=l.previousSibling}}o[e?"setStart":"setEnd"](n,s)}try{c(true);if(!s){c()}}catch(n){if(n.number==-2147024809){f=t.getBookmark(2);l=r.duplicate();l.collapse(true);a=l.parentElement();if(!s){l=r.duplicate();l.collapse(false);d=l.parentElement();d.innerHTML=d.innerHTML}a.innerHTML=a.innerHTML;t.moveToBookmark(f);r=e.getRng();c(true);if(!s){c()}}else{throw n}}return o}this.getBookmark=function(t){var r=e.getRng(),o={};function a(e){var t,r,i,o,a=[];t=e.parentNode;r=n.getRoot().parentNode;while(t!=r&&t.nodeType!==9){i=t.children;o=i.length;while(o--){if(e===i[o]){a.push(o);break}}e=t;t=t.parentNode}return a}function s(e){var t;t=i(r,e);if(t){return{position:t.position,offset:t.offset,indexes:a(t.node),inside:t.inside}}}if(t===2){if(!r.item){o.start=s(true);if(!e.isCollapsed()){o.end=s()}}else{o.start={ctrl:true,indexes:a(r.item(0))}}}return o};this.moveToBookmark=function(e){var t,r=n.doc.body;function i(e){var t,r,i,o;t=n.getRoot();for(r=e.length-1;r>=0;r--){o=t.children;i=e[r];if(i<=o.length-1){t=o[i]}}return t}function o(n){var o=e[n?"start":"end"],a,s,l,d;if(o){a=o.position>0;s=r.createTextRange();s.moveToElementText(i(o.indexes));d=o.offset;if(d!==l){s.collapse(o.inside||a);s.moveStart("character",a?-d:d)}else{s.collapse(n)}t.setEndPoint(n?"StartToStart":"EndToStart",s);if(n){t.collapse(true)}}}if(e.start){if(e.start.ctrl){t=r.createControlRange();t.addElement(i(e.start.indexes));t.select()}else{t=r.createTextRange();o(true);o();t.select()}}};this.addRange=function(t){var i,o,a,s,l,d,f,c=e.dom.doc,u=c.body,m,p;function h(e){var t,o,f,m,p;f=n.create("a");t=e?a:l;o=e?s:d;m=i.duplicate();if(t==c||t==c.documentElement){t=u;o=0}if(t.nodeType==3){t.parentNode.insertBefore(f,t);m.moveToElementText(f);m.moveStart("character",o);n.remove(f);i.setEndPoint(e?"StartToStart":"EndToEnd",m)}else{p=t.childNodes;if(p.length){if(o>=p.length){n.insertAfter(f,p[p.length-1])}else{t.insertBefore(f,p[o])}m.moveToElementText(f)}else if(t.canHaveHTML){t.innerHTML="<span>&#xFEFF;</span>";f=t.firstChild;m.moveToElementText(f);m.collapse(r)}i.setEndPoint(e?"StartToStart":"EndToEnd",m);n.remove(f)}}a=t.startContainer;s=t.startOffset;l=t.endContainer;d=t.endOffset;i=u.createTextRange();if(a==l&&a.nodeType==1){if(s==d&&!a.hasChildNodes()){if(a.canHaveHTML){f=a.previousSibling;if(f&&!f.hasChildNodes()&&n.isBlock(f)){f.innerHTML="&#xFEFF;"}else{f=null}a.innerHTML="<span>&#xFEFF;</span><span>&#xFEFF;</span>";i.moveToElementText(a.lastChild);i.select();n.doc.selection.clear();a.innerHTML="";if(f){f.innerHTML=""}return}else{s=n.nodeIndex(a);a=a.parentNode}}if(s==d-1){try{p=a.childNodes[s];o=u.createControlRange();o.addElement(p);o.select();m=e.getRng();if(m.item&&p===m.item(0)){return}}catch(e){}}}h(true);h();i.select()};this.getRangeAt=o}return e});