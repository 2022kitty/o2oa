define("tinymce/dom/ControlSelection",["tinymce/util/VK","tinymce/util/Tools","tinymce/Env"],function(e,t,n){return function(i,o){var a=o.dom,r=t.each;var c,d,s,l,f;var u,m,g,h,b,v,p,y;var z,R,w=o.getDoc(),E=document,B=n.ie&&n.ie<11;s={n:[.5,0,0,-1],e:[1,.5,1,0],s:[.5,1,0,1],w:[0,.5,-1,0],nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var S=".mce-content-body";o.contentStyles.push(S+" div.mce-resizehandle {"+"position: absolute;"+"border: 1px solid black;"+"background: #FFF;"+"width: 5px;"+"height: 5px;"+"z-index: 10000"+"}"+S+" .mce-resizehandle:hover {"+"background: #000"+"}"+S+" img[data-mce-selected], hr[data-mce-selected] {"+"outline: 1px solid black;"+"resize: none"+"}"+S+" .mce-clonedresizable {"+"position: absolute;"+(n.gecko?"":"outline: 1px dashed black;")+"opacity: .5;"+"filter: alpha(opacity=50);"+"z-index: 10000"+"}");function N(e){var t=o.settings.object_resizing;if(t===false||n.iOS){return false}if(typeof t!="string"){t="table,img,div"}if(e.getAttribute("data-mce-resize")==="false"){return false}return o.dom.is(e,t)}function A(t){var n,i;n=t.screenX-u;i=t.screenY-m;z=n*l[2]+b;R=i*l[3]+v;z=z<5?5:z;R=R<5?5:R;if(e.modifierPressed(t)||c.nodeName=="IMG"&&l[2]*l[3]!==0){z=Math.round(R/p);R=Math.round(z*p)}a.setStyles(d,{width:z,height:R});if(l[2]<0&&d.clientWidth<=z){a.setStyle(d,"left",g+(b-z))}if(l[3]<0&&d.clientHeight<=R){a.setStyle(d,"top",h+(v-R))}if(!y){o.fire("ObjectResizeStart",{target:c,width:b,height:v});y=true}}function x(){y=false;function e(e,t){if(t){if(c.style[e]||!o.schema.isValid(c.nodeName.toLowerCase(),e)){a.setStyle(c,e,t)}else{a.setAttrib(c,e,t)}}}e("width",z);e("height",R);a.unbind(w,"mousemove",A);a.unbind(w,"mouseup",x);if(E!=w){a.unbind(E,"mousemove",A);a.unbind(E,"mouseup",x)}a.remove(d);if(!B||c.nodeName=="TABLE"){C(c)}o.fire("ObjectResized",{target:c,width:z,height:R});o.nodeChanged()}function C(e,t,i){var f,y,B,S,C,M=o.getBody();j();f=a.getPos(e,M);g=f.x;h=f.y;C=e.getBoundingClientRect();y=C.width||C.right-C.left;B=C.height||C.bottom-C.top;if(c!=e){O();c=e;z=R=0}S=o.fire("ObjectSelected",{target:e});if(N(e)&&!S.isDefaultPrevented()){r(s,function(e,r){var s,f;function z(t){u=t.screenX;m=t.screenY;b=c.clientWidth;v=c.clientHeight;p=v/b;l=e;d=c.cloneNode(true);a.addClass(d,"mce-clonedresizable");d.contentEditable=false;d.unSelectabe=true;a.setStyles(d,{left:g,top:h,margin:0});d.removeAttribute("data-mce-selected");o.getBody().appendChild(d);a.bind(w,"mousemove",A);a.bind(w,"mouseup",x);if(E!=w){a.bind(E,"mousemove",A);a.bind(E,"mouseup",x)}}if(t){if(r==t){z(i)}return}s=a.get("mceResizeHandle"+r);if(!s){f=o.getBody();s=a.add(f,"div",{id:"mceResizeHandle"+r,"data-mce-bogus":true,class:"mce-resizehandle",unselectable:true,style:"cursor:"+r+"-resize; margin:0; padding:0"});if(n.ie){s.contentEditable=false}}else{a.show(s)}if(!e.elm){a.bind(s,"mousedown",function(e){e.stopImmediatePropagation();e.preventDefault();z(e)});e.elm=s}a.setStyles(s,{left:y*e[0]+g-s.offsetWidth/2,top:B*e[1]+h-s.offsetHeight/2})})}else{H()}c.setAttribute("data-mce-selected","1")}function H(){var e,t;j();if(c){c.removeAttribute("data-mce-selected")}for(e in s){t=a.get("mceResizeHandle"+e);if(t){a.unbind(t);a.remove(t)}}}function M(e){var t;function n(e,t){if(e){do{if(e===t){return true}}while(e=e.parentNode)}}r(a.select("img[data-mce-selected],hr[data-mce-selected]"),function(e){e.removeAttribute("data-mce-selected")});t=e.type=="mousedown"?e.target:i.getNode();t=a.getParent(t,B?"table":"table,img,hr");if(n(t,o.getBody())){D();if(n(i.getStart(),t)&&n(i.getEnd(),t)){if(!B||t!=i.getStart()&&i.getStart().nodeName!=="IMG"){C(t);return}}}H()}function k(e,t,n){if(e&&e.attachEvent){e.attachEvent("on"+t,n)}}function T(e,t,n){if(e&&e.detachEvent){e.detachEvent("on"+t,n)}}function L(e){var t=e.srcElement,n,i,a,r,c,d,u;n=t.getBoundingClientRect();d=f.clientX-n.left;u=f.clientY-n.top;for(i in s){a=s[i];r=t.offsetWidth*a[0];c=t.offsetHeight*a[1];if(Math.abs(r-d)<8&&Math.abs(c-u)<8){l=a;break}}y=true;o.getDoc().selection.empty();C(t,i,f)}function I(e){var t=e.srcElement;if(t!=c){O();if(t.id.indexOf("mceResizeHandle")===0){e.returnValue=false;return}if(t.nodeName=="IMG"||t.nodeName=="TABLE"){H();c=t;k(t,"resizestart",L)}}}function O(){T(c,"resizestart",L)}function j(){for(var e in s){var t=s[e];if(t.elm){a.unbind(t.elm);delete t.elm}}}function D(){try{o.getDoc().execCommand("enableObjectResizing",false,false)}catch(e){}}function G(e){var t;if(!B){return}t=w.body.createControlRange();try{t.addElement(e);t.select();return true}catch(e){}}o.on("init",function(){if(B){o.on("ObjectResized",function(e){if(e.target.nodeName!="TABLE"){H();G(e.target)}});k(o.getBody(),"controlselect",I);o.on("mousedown",function(e){f=e})}else{D();if(n.ie>=11){o.on("mouseup",function(e){var t=e.target.nodeName;if(/^(TABLE|IMG|HR)$/.test(t)){o.selection.select(e.target,t=="TABLE");o.nodeChanged()}});o.dom.bind(o.getBody(),"mscontrolselect",function(e){if(/^(TABLE|IMG|HR)$/.test(e.target.nodeName)){e.preventDefault();if(e.target.tagName=="IMG"){window.setTimeout(function(){o.selection.select(e.target)},0)}}})}}o.on("nodechange mousedown mouseup ResizeEditor",M);o.on("keydown keyup",function(e){if(c&&c.nodeName=="TABLE"){M(e)}})});o.on("remove",j);function P(){c=d=null;if(B){O();T(o.getBody(),"controlselect",I)}}return{isResizable:N,showResizeRect:C,hideResizeRect:H,updateResizeRect:M,controlSelect:G,destroy:P}}});