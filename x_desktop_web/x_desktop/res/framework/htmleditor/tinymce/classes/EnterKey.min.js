define("tinymce/EnterKey",["tinymce/dom/TreeWalker","tinymce/dom/RangeUtils","tinymce/Env"],function(e,t,n){var r=n.ie&&n.ie<11;return function(i){var o=i.dom,s=i.selection,a=i.settings;var d=i.undoManager,f=i.schema,l=f.getNonEmptyElements();function c(c){var u,p,h,C,N,g,m,b,B,v,E,y,w,T,A;function L(e){return e&&o.isBlock(e)&&!/^(TD|TH|CAPTION|FORM)$/.test(e.nodeName)&&!/^(fixed|absolute)/i.test(e.style.position)&&o.getContentEditable(e)!=="true"}function S(e){var t;if(o.isBlock(e)){t=s.getRng();e.appendChild(o.create("span",null," "));s.select(e);e.lastChild.outerHTML="";s.setRng(t)}}function R(e){var t=e,n=[],r;while(t=t.firstChild){if(o.isBlock(t)){return}if(t.nodeType==1&&!l[t.nodeName.toLowerCase()]){n.push(t)}}r=n.length;while(r--){t=n[r];if(!t.hasChildNodes()||t.firstChild==t.lastChild&&t.firstChild.nodeValue===""){o.remove(t)}else{if(t.nodeName=="A"&&(t.innerText||t.textContent)===" "){o.remove(t)}}}}function k(t){var r,i,a,d=t,f;function c(e){while(e){if(e.nodeType==1||e.nodeType==3&&e.data&&/[\r\n\s]/.test(e.data)){return e}e=e.nextSibling}}if(n.ie&&n.ie<9&&g&&g.firstChild){if(g.firstChild==g.lastChild&&g.firstChild.tagName=="BR"){o.remove(g.firstChild)}}if(t.nodeName=="LI"){var u=c(t.firstChild);if(u&&/^(UL|OL)$/.test(u.nodeName)){t.insertBefore(o.doc.createTextNode(" "),t.firstChild)}}a=o.createRng();if(t.hasChildNodes()){r=new e(t,t);while(i=r.current()){if(i.nodeType==3){a.setStart(i,0);a.setEnd(i,0);break}if(l[i.nodeName.toLowerCase()]){a.setStartBefore(i);a.setEndBefore(i);break}d=i;i=r.next()}if(!i){a.setStart(d,0);a.setEnd(d,0)}}else{if(t.nodeName=="BR"){if(t.nextSibling&&o.isBlock(t.nextSibling)){if(!m||m<9){f=o.create("br");t.parentNode.insertBefore(f,t)}a.setStartBefore(t);a.setEndBefore(t)}else{a.setStartAfter(t);a.setEndAfter(t)}}else{a.setStart(t,0);a.setEnd(t,0)}}s.setRng(a);o.remove(f);s.scrollIntoView(t)}function x(e){var t=a.forced_root_block;if(t&&t.toLowerCase()===e.tagName.toLowerCase()){o.setAttribs(e,a.forced_root_block_attrs)}}function I(e){var t=C,n,i,s;if(e||y=="TABLE"){n=o.create(e||T);x(n)}else{n=g.cloneNode(false)}s=n;if(a.keep_styles!==false){do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U|VAR|CITE|DFN|CODE|MARK|Q|SUP|SUB|SAMP)$/.test(t.nodeName)){if(t.id=="_mce_caret"){continue}i=t.cloneNode(false);o.setAttrib(i,"id","");if(n.hasChildNodes()){i.appendChild(n.firstChild);n.appendChild(i)}else{s=i;n.appendChild(i)}}}while(t=t.parentNode)}if(!r){s.innerHTML='<br data-mce-bogus="1">'}return n}function _(t){var n,r,i;if(C.nodeType==3&&(t?N>0:N<C.nodeValue.length)){return false}if(C.parentNode==g&&A&&!t){return true}if(t&&C.nodeType==1&&C==g.firstChild){return true}if(C.nodeName==="TABLE"||C.previousSibling&&C.previousSibling.nodeName=="TABLE"){return A&&!t||!A&&t}n=new e(C,g);if(C.nodeType==3){if(t&&N===0){n.prev()}else if(!t&&N==C.nodeValue.length){n.next()}}while(r=n.current()){if(r.nodeType===1){if(!r.getAttribute("data-mce-bogus")){i=r.nodeName.toLowerCase();if(l[i]&&i!=="br"){return false}}}else if(r.nodeType===3&&!/^[ \t\r\n]*$/.test(r.nodeValue)){return false}if(t){n.prev()}else{n.next()}}return true}function P(e,t){var n,r,s,a,d,l,c=T||"P";r=o.getParent(e,o.isBlock);l=i.getBody().nodeName.toLowerCase();if(!r||!L(r)){r=r||h;if(!r.hasChildNodes()){n=o.create(c);x(n);r.appendChild(n);u.setStart(n,0);u.setEnd(n,0);return n}a=e;while(a.parentNode!=r){a=a.parentNode}while(a&&!o.isBlock(a)){s=a;a=a.previousSibling}if(s&&f.isValidChild(l,c.toLowerCase())){n=o.create(c);x(n);s.parentNode.insertBefore(n,s);a=s;while(a&&!o.isBlock(a)){d=a.nextSibling;n.appendChild(a);a=d}u.setStart(e,t);u.setEnd(e,t)}}return e}function V(){function e(e){var t=E[e?"firstChild":"lastChild"];while(t){if(t.nodeType==1){break}t=t[e?"nextSibling":"previousSibling"]}return t===g}function t(){var e=E.parentNode;if(e.nodeName=="LI"){return e}return E}var n=E.parentNode.nodeName;if(/^(OL|UL|LI)$/.test(n)){T="LI"}B=T?I(T):o.create("BR");if(e(true)&&e()){if(n=="LI"){o.insertAfter(B,t())}else{o.replace(B,E)}}else if(e(true)){if(n=="LI"){o.insertAfter(B,t());B.appendChild(o.doc.createTextNode(" "));B.appendChild(E)}else{E.parentNode.insertBefore(B,E)}}else if(e()){o.insertAfter(B,t());S(B)}else{E=t();p=u.cloneRange();p.setStartAfter(g);p.setEndAfter(E);v=p.extractContents();if(T=="LI"&&v.firstChild.nodeName=="LI"){B=v.firstChild;o.insertAfter(v,E)}else{o.insertAfter(v,E);o.insertAfter(B,E)}}o.remove(g);k(B);d.add()}function U(){var t=new e(C,g),n;while(n=t.next()){if(l[n.nodeName.toLowerCase()]||n.length>0){return true}}}function M(){var e,t,n;if(C&&C.nodeType==3&&N>=C.nodeValue.length){if(!r&&!U()){e=o.create("br");u.insertNode(e);u.setStartAfter(e);u.setEndAfter(e);t=true}}e=o.create("br");u.insertNode(e);if(r&&y=="PRE"&&(!m||m<8)){e.parentNode.insertBefore(o.doc.createTextNode("\r"),e)}n=o.create("span",{},"&nbsp;");e.parentNode.insertBefore(n,e);s.scrollIntoView(n);o.remove(n);if(!t){u.setStartAfter(e);u.setEndAfter(e)}else{u.setStartBefore(e);u.setEndBefore(e)}s.setRng(u);d.add()}function O(e){do{if(e.nodeType===3){e.nodeValue=e.nodeValue.replace(/^[\r\n]+/,"")}e=e.firstChild}while(e)}function $(e){var t=o.getRoot(),n,r;n=e;while(n!==t&&o.getContentEditable(n)!=="false"){if(o.getContentEditable(n)==="true"){r=n}n=n.parentNode}return n!==t?r:t}function D(e){var t;if(!r){e.normalize();t=e.lastChild;if(!t||/^(left|right)$/gi.test(o.getStyle(t,"float",true))){o.add(e,"br")}}}u=s.getRng(true);if(c.isDefaultPrevented()){return}if(!u.collapsed){i.execCommand("Delete");return}new t(o).normalize(u);C=u.startContainer;N=u.startOffset;T=(a.force_p_newlines?"p":"")||a.forced_root_block;T=T?T.toUpperCase():"";m=o.doc.documentMode;b=c.shiftKey;if(C.nodeType==1&&C.hasChildNodes()){A=N>C.childNodes.length-1;C=C.childNodes[Math.min(N,C.childNodes.length-1)]||C;if(A&&C.nodeType==3){N=C.nodeValue.length}else{N=0}}h=$(C);if(!h){return}d.beforeChange();if(!o.isBlock(h)&&h!=o.getRoot()){if(!T||b){M()}return}if(T&&!b||!T&&b){C=P(C,N)}g=o.getParent(C,o.isBlock);E=g?o.getParent(g.parentNode,o.isBlock):null;y=g?g.nodeName.toUpperCase():"";w=E?E.nodeName.toUpperCase():"";if(w=="LI"&&!c.ctrlKey){g=E;y=w}if(y=="LI"){if(!T&&b){M();return}if(o.isEmpty(g)){V();return}}if(y=="PRE"&&a.br_in_pre!==false){if(!b){M();return}}else{if(!T&&!b&&y!="LI"||T&&b){M();return}}if(T&&g===i.getBody()){return}T=T||"P";if(_()){if(/^(H[1-6]|PRE|FIGURE)$/.test(y)&&w!="HGROUP"){B=I(T)}else{B=I()}if(a.end_container_on_empty_block&&L(E)&&o.isEmpty(g)){B=o.split(E,g)}else{o.insertAfter(B,g)}k(B)}else if(_(true)){B=g.parentNode.insertBefore(I(),g);S(B);k(g)}else{p=u.cloneRange();p.setEndAfter(g);v=p.extractContents();O(v);B=v.firstChild;o.insertAfter(v,g);R(B);D(g);k(B)}o.setAttrib(B,"id","");i.fire("NewBlock",{newBlock:B});d.add()}i.on("keydown",function(e){if(e.keyCode==13){if(c(e)!==false){e.preventDefault()}}})}});