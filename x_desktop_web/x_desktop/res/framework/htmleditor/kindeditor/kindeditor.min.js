(function(window,undefined){if(window.KindEditor){return}if(!window.console){window.console={}}if(!console.log){console.log=function(){}}var _VERSION="4.1.10 (2013-11-23)",_ua=navigator.userAgent.toLowerCase(),_IE=_ua.indexOf("msie")>-1&&_ua.indexOf("opera")==-1,_NEWIE=_ua.indexOf("msie")==-1&&_ua.indexOf("trident")>-1,_GECKO=_ua.indexOf("gecko")>-1&&_ua.indexOf("khtml")==-1,_WEBKIT=_ua.indexOf("applewebkit")>-1,_OPERA=_ua.indexOf("opera")>-1,_MOBILE=_ua.indexOf("mobile")>-1,_IOS=/ipad|iphone|ipod/.test(_ua),_QUIRKS=document.compatMode!="CSS1Compat",_IERANGE=!window.getSelection,_matches=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(_ua),_V=_matches?_matches[1]:"0",_TIME=(new Date).getTime();function _isArray(e){if(!e){return false}return Object.prototype.toString.call(e)==="[object Array]"}function _isFunction(e){if(!e){return false}return Object.prototype.toString.call(e)==="[object Function]"}function _inArray(e,t){for(var n=0,i=t.length;n<i;n++){if(e===t[n]){return n}}return-1}function _each(e,t){if(_isArray(e)){for(var n=0,i=e.length;n<i;n++){if(t.call(e[n],n,e[n])===false){break}}}else{for(var r in e){if(e.hasOwnProperty(r)){if(t.call(e[r],r,e[r])===false){break}}}}}function _trim(e){return e.replace(/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")}function _inString(e,t,n){n=n===undefined?",":n;return(n+t+n).indexOf(n+e+n)>=0}function _addUnit(e,t){t=t||"px";return e&&/^\d+$/.test(e)?e+t:e}function _removeUnit(e){var t;return e&&(t=/(\d+)/.exec(e))?parseInt(t[1],10):0}function _escape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function _unescape(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}function _toCamel(e){var t=e.split("-");e="";_each(t,function(t,n){e+=t>0?n.charAt(0).toUpperCase()+n.substr(1):n});return e}function _toHex(e){function t(e){var t=parseInt(e,10).toString(16).toUpperCase();return t.length>1?t:"0"+t}return e.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/gi,function(e,n,i,r){return"#"+t(n)+t(i)+t(r)})}function _toMap(e,t){t=t===undefined?",":t;var n={},i=_isArray(e)?e:e.split(t),r;_each(i,function(e,t){if(r=/^(\d+)\.\.(\d+)$/.exec(t)){for(var i=parseInt(r[1],10);i<=parseInt(r[2],10);i++){n[i.toString()]=true}}else{n[t]=true}});return n}function _toArray(e,t){return Array.prototype.slice.call(e,t||0)}function _undef(e,t){return e===undefined?t:e}function _invalidUrl(e){return!e||/[<>"]/.test(e)}function _addParam(e,t){return e.indexOf("?")>=0?e+"&"+t:e+"?"+t}function _extend(e,t,n){if(!n){n=t;t=null}var i;if(t){var r=function(){};r.prototype=t.prototype;i=new r;_each(n,function(e,t){i[e]=t})}else{i=n}i.constructor=e;e.prototype=i;e.parent=t?t.prototype:null}function _json(text){var match;if(match=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(text)){text=match[0]}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")}throw"JSON parse error"}var _round=Math.round;var K={DEBUG:false,VERSION:_VERSION,IE:_IE,GECKO:_GECKO,WEBKIT:_WEBKIT,OPERA:_OPERA,V:_V,TIME:_TIME,each:_each,isArray:_isArray,isFunction:_isFunction,inArray:_inArray,inString:_inString,trim:_trim,addUnit:_addUnit,removeUnit:_removeUnit,escape:_escape,unescape:_unescape,toCamel:_toCamel,toHex:_toHex,toMap:_toMap,toArray:_toArray,undef:_undef,invalidUrl:_invalidUrl,addParam:_addParam,extend:_extend,json:_json};var _INLINE_TAG_MAP=_toMap("a,abbr,acronym,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,img,input,ins,kbd,label,map,q,s,samp,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),_BLOCK_TAG_MAP=_toMap("address,applet,blockquote,body,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,iframe,ins,isindex,li,map,menu,meta,noframes,noscript,object,ol,p,pre,script,style,table,tbody,td,tfoot,th,thead,title,tr,ul"),_SINGLE_TAG_MAP=_toMap("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),_STYLE_TAG_MAP=_toMap("b,basefont,big,del,em,font,i,s,small,span,strike,strong,sub,sup,u"),_CONTROL_TAG_MAP=_toMap("img,table,input,textarea,button"),_PRE_TAG_MAP=_toMap("pre,style,script"),_NOSPLIT_TAG_MAP=_toMap("html,head,body,td,tr,table,ol,ul,li"),_AUTOCLOSE_TAG_MAP=_toMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),_FILL_ATTR_MAP=_toMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),_VALUE_TAG_MAP=_toMap("input,button,textarea,select");function _getBasePath(){var e=document.getElementsByTagName("script"),t;for(var n=0,i=e.length;n<i;n++){t=e[n].src||"";if(/kindeditor[\w\-\.]*\.js/.test(t)){return t.substring(0,t.lastIndexOf("/")+1)}}return""}K.basePath=_getBasePath();K.options={designMode:true,fullscreenMode:false,filterMode:true,wellFormatMode:true,shadowMode:true,loadStyleMode:true,basePath:K.basePath,themesPath:K.basePath+"themes/",langPath:K.basePath+"lang/",pluginsPath:K.basePath+"plugins/",themeType:"default",langType:"zh_CN",urlType:"",newlineTag:"p",resizeType:2,syncType:"form",pasteType:2,dialogAlignType:"page",useContextmenu:true,fullscreenShortcut:false,bodyClass:"ke-content",indentChar:"\t",cssPath:"",cssData:"",minWidth:650,minHeight:100,minChangeSize:50,zIndex:811213,items:["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],noDisableItems:["source","fullscreen"],colorTable:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],fontSizeTable:["9px","10px","12px","14px","16px","18px","24px","32px"],htmlTags:{font:["id","class","color","size","face",".background-color"],span:["id","class",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".line-height"],div:["id","class","align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["id","class","border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height",".border-collapse"],"td,th":["id","class","align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background",".border"],a:["id","class","href","target","name"],embed:["id","class","src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess"],img:["id","class","src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["id","class","align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["id","class"],hr:["id","class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":["id","class"],iframe:["id","class","src","frameborder","width","height",".width",".height"]},layout:'<div class="container"><div class="toolbar"></div><div class="edit"></div><div class="statusbar"></div></div>'};var _useCapture=false;var _INPUT_KEY_MAP=_toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222");var _CURSORMOVE_KEY_MAP=_toMap("33..40");var _CHANGE_KEY_MAP={};_each(_INPUT_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t});_each(_CURSORMOVE_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t});function _bindEvent(e,t,n){if(e.addEventListener){e.addEventListener(t,n,_useCapture)}else if(e.attachEvent){e.attachEvent("on"+t,n)}}function _unbindEvent(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,_useCapture)}else if(e.detachEvent){e.detachEvent("on"+t,n)}}var _EVENT_PROPS=("altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,"+"data,detail,eventPhase,fromElement,handler,keyCode,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,"+"pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which").split(",");function KEvent(e,t){this.init(e,t)}_extend(KEvent,{init:function(e,t){var n=this,i=e.ownerDocument||e.document||e;n.event=t;_each(_EVENT_PROPS,function(e,i){n[i]=t[i]});if(!n.target){n.target=n.srcElement||i}if(n.target.nodeType===3){n.target=n.target.parentNode}if(!n.relatedTarget&&n.fromElement){n.relatedTarget=n.fromElement===n.target?n.toElement:n.fromElement}if(n.pageX==null&&n.clientX!=null){var r=i.documentElement,a=i.body;n.pageX=n.clientX+(r&&r.scrollLeft||a&&a.scrollLeft||0)-(r&&r.clientLeft||a&&a.clientLeft||0);n.pageY=n.clientY+(r&&r.scrollTop||a&&a.scrollTop||0)-(r&&r.clientTop||a&&a.clientTop||0)}if(!n.which&&(n.charCode||n.charCode===0?n.charCode:n.keyCode)){n.which=n.charCode||n.keyCode}if(!n.metaKey&&n.ctrlKey){n.metaKey=n.ctrlKey}if(!n.which&&n.button!==undefined){n.which=n.button&1?1:n.button&2?3:n.button&4?2:0}switch(n.which){case 186:n.which=59;break;case 187:case 107:case 43:n.which=61;break;case 189:case 45:n.which=109;break;case 42:n.which=106;break;case 47:n.which=111;break;case 78:n.which=110;break}if(n.which>=96&&n.which<=105){n.which-=48}},preventDefault:function(){var e=this.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){var e=this.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},stop:function(){this.preventDefault();this.stopPropagation()}});var _eventExpendo="kindeditor_"+_TIME,_eventId=0,_eventData={};function _getId(e){return e[_eventExpendo]||null}function _setId(e){e[_eventExpendo]=++_eventId;return _eventId}function _removeId(e){try{delete e[_eventExpendo]}catch(t){if(e.removeAttribute){e.removeAttribute(_eventExpendo)}}}function _bind(e,t,n){if(t.indexOf(",")>=0){_each(t.split(","),function(){_bind(e,this,n)});return}var i=_getId(e);if(!i){i=_setId(e)}if(_eventData[i]===undefined){_eventData[i]={}}var r=_eventData[i][t];if(r&&r.length>0){_unbindEvent(e,t,r[0])}else{_eventData[i][t]=[];_eventData[i].el=e}r=_eventData[i][t];if(r.length===0){r[0]=function(t){var n=t?new KEvent(e,t):undefined;_each(r,function(t,i){if(t>0&&i){i.call(e,n)}})}}if(_inArray(n,r)<0){r.push(n)}_bindEvent(e,t,r[0])}function _unbind(e,t,n){if(t&&t.indexOf(",")>=0){_each(t.split(","),function(){_unbind(e,this,n)});return}var i=_getId(e);if(!i){return}if(t===undefined){if(i in _eventData){_each(_eventData[i],function(t,n){if(t!="el"&&n.length>0){_unbindEvent(e,t,n[0])}});delete _eventData[i];_removeId(e)}return}if(!_eventData[i]){return}var r=_eventData[i][t];if(r&&r.length>0){if(n===undefined){_unbindEvent(e,t,r[0]);delete _eventData[i][t]}else{_each(r,function(e,t){if(e>0&&t===n){r.splice(e,1)}});if(r.length==1){_unbindEvent(e,t,r[0]);delete _eventData[i][t]}}var a=0;_each(_eventData[i],function(){a++});if(a<2){delete _eventData[i];_removeId(e)}}}function _fire(e,t){if(t.indexOf(",")>=0){_each(t.split(","),function(){_fire(e,this)});return}var n=_getId(e);if(!n){return}var i=_eventData[n][t];if(_eventData[n]&&i&&i.length>0){i[0]()}}function _ctrl(e,t,n){var i=this;t=/^\d{2,}$/.test(t)?t:t.toUpperCase().charCodeAt(0);_bind(e,"keydown",function(i){if(i.ctrlKey&&i.which==t&&!i.shiftKey&&!i.altKey){n.call(e);i.stop()}})}var _readyFinished=false;function _ready(e){if(_readyFinished){e(KindEditor);return}var t=false;function n(){if(!t){t=true;e(KindEditor);_readyFinished=true}}function i(){if(!t){try{document.documentElement.doScroll("left")}catch(e){setTimeout(i,100);return}n()}}function r(){if(document.readyState==="complete"){n()}}if(document.addEventListener){_bind(document,"DOMContentLoaded",n)}else if(document.attachEvent){_bind(document,"readystatechange",r);var a=false;try{a=window.frameElement==null}catch(e){}if(document.documentElement.doScroll&&a){i()}}_bind(window,"load",n)}if(_IE){window.attachEvent("onunload",function(){_each(_eventData,function(e,t){if(t.el){_unbind(t.el)}})})}K.ctrl=_ctrl;K.ready=_ready;function _getCssList(e){var t={},n=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g,i;while(i=n.exec(e)){var r=_trim(i[1].toLowerCase()),a=_trim(_toHex(i[2]));t[r]=a}return t}function _getAttrList(e){var t={},n=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g,i;while(i=n.exec(e)){var r=(i[1]||i[2]||i[4]||i[6]).toLowerCase(),a=(i[2]?i[3]:i[4]?i[5]:i[7])||"";t[r]=a}return t}function _addClassToTag(e,t){if(/\s+class\s*=/.test(e)){e=e.replace(/(\s+class=["']?)([^"']*)(["']?[\s>])/,function(e,n,i,r){if((" "+i+" ").indexOf(" "+t+" ")<0){return i===""?n+t+r:n+i+" "+t+r}else{return e}})}else{e=e.substr(0,e.length-1)+' class="'+t+'">'}return e}function _formatCss(e){var t="";_each(_getCssList(e),function(e,n){t+=e+":"+n+";"});return t}function _formatUrl(e,t,n,i){t=_undef(t,"").toLowerCase();if(e.substr(0,5)!="data:"){e=e.replace(/([^:])\/\//g,"$1/")}if(_inArray(t,["absolute","relative","domain"])<0){return e}n=n||location.protocol+"//"+location.host;if(i===undefined){var r=location.pathname.match(/^(\/.*)\//);i=r?r[1]:""}var a;if(a=/^(\w+:\/\/[^\/]*)/.exec(e)){if(a[1]!==n){return e}}else if(/^\w+:/.test(e)){return e}function o(e){var t=e.split("/"),n=[];for(var i=0,r=t.length;i<r;i++){var a=t[i];if(a==".."){if(n.length>0){n.pop()}}else if(a!==""&&a!="."){n.push(a)}}return"/"+n.join("/")}if(/^\//.test(e)){e=n+o(e.substr(1))}else if(!/^\w+:\/\//.test(e)){e=n+o(i+"/"+e)}function s(t,n){if(e.substr(0,t.length)===t){var r=[];for(var o=0;o<n;o++){r.push("..")}var l=".";if(r.length>0){l+="/"+r.join("/")}if(i=="/"){l+="/"}return l+e.substr(t.length)}else{if(a=/^(.*)\//.exec(t)){return s(a[1],++n)}}}if(t==="relative"){e=s(n+i,0).substr(2)}else if(t==="absolute"){if(e.substr(0,n.length)===n){e=e.substr(n.length)}}return e}function _formatHtml(e,t,n,i,r){if(e==null){e=""}n=n||"";i=_undef(i,false);r=_undef(r,"\t");var a="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(e,t,n,i){return t+n.replace(/<(?:br|br\s[^>]*)>/gi,"\n")+i});e=e.replace(/<(?:br|br\s[^>]*)\s*\/?>\s*<\/p>/gi,"</p>");e=e.replace(/(<(?:p|p\s[^>]*)>)\s*(<\/p>)/gi,"$1<br />$2");e=e.replace(/\u200B/g,"");e=e.replace(/\u00A9/g,"&copy;");e=e.replace(/\u00AE/g,"&reg;");e=e.replace(/<[^>]+/g,function(e){return e.replace(/\s+/g," ")});var o={};if(t){_each(t,function(e,t){var n=e.split(",");for(var i=0,r=n.length;i<r;i++){o[n[i]]=_toMap(t)}});if(!o.script){e=e.replace(/(<(?:script|script\s[^>]*)>)([\s\S]*?)(<\/script>)/gi,"")}if(!o.style){e=e.replace(/(<(?:style|style\s[^>]*)>)([\s\S]*?)(<\/style>)/gi,"")}}var s=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g;var l=[];e=e.replace(s,function(e,s,c,d,u,f,h){var m=e,p=s||"",_=c||"",g=d.toLowerCase(),v=u||"",b=f?" "+f:"",y=h||"";if(t&&!o[g]){return""}if(b===""&&_SINGLE_TAG_MAP[g]){b=" /"}if(_INLINE_TAG_MAP[g]){if(p){p=" "}if(y){y=" "}}if(_PRE_TAG_MAP[g]){if(_){y="\n"}else{p="\n"}}if(i&&g=="br"){y="\n"}if(_BLOCK_TAG_MAP[g]&&!_PRE_TAG_MAP[g]){if(i){if(_&&l.length>0&&l[l.length-1]===g){l.pop()}else{l.push(g)}p="\n";y="\n";for(var k=0,C=_?l.length:l.length-1;k<C;k++){p+=r;if(!_){y+=r}}if(b){l.pop()}else if(!_){y+=r}}else{p=y=""}}if(v!==""){var E=_getAttrList(m);if(g==="font"){var K={},w="";_each(E,function(e,t){if(e==="color"){K.color=t;delete E[e]}if(e==="size"){K["font-size"]=a[parseInt(t,10)-1]||"";delete E[e]}if(e==="face"){K["font-family"]=t;delete E[e]}if(e==="style"){w=t}});if(w&&!/;$/.test(w)){w+=";"}_each(K,function(e,t){if(t===""){return}if(/\s/.test(t)){t="'"+t+"'"}w+=e+":"+t+";"});E.style=w}_each(E,function(e,i){if(_FILL_ATTR_MAP[e]){E[e]=e}if(_inArray(e,["src","href"])>=0){E[e]=_formatUrl(i,n)}if(t&&e!=="style"&&!o[g]["*"]&&!o[g][e]||g==="body"&&e==="contenteditable"||/^kindeditor_\d+$/.test(e)){delete E[e]}if(e==="style"&&i!==""){var r=_getCssList(i);_each(r,function(e,n){if(t&&!o[g].style&&!o[g]["."+e]){delete r[e]}});var a="";_each(r,function(e,t){a+=e+":"+t+";"});E.style=a}});v="";_each(E,function(e,t){if(e==="style"&&t===""){return}t=t.replace(/"/g,"&quot;");v+=" "+e+'="'+t+'"'})}if(g==="font"){g="span"}return p+"<"+_+g+v+b+">"+y});e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(e,t,n,i){return t+n.replace(/\n/g,'<span id="__kindeditor_pre_newline__">\n')+i});e=e.replace(/\n\s*\n/g,"\n");e=e.replace(/<span id="__kindeditor_pre_newline__">\n/g,"\n");return _trim(e)}function _clearMsWord(e,t){e=e.replace(/<meta[\s\S]*?>/gi,"").replace(/<![\s\S]*?>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<w:[^>]+>[\s\S]*?<\/w:[^>]+>/gi,"").replace(/<o:[^>]+>[\s\S]*?<\/o:[^>]+>/gi,"").replace(/<xml>[\s\S]*?<\/xml>/gi,"").replace(/<(?:table|td)[^>]*>/gi,function(e){return e.replace(/border-bottom:([#\w\s]+)/gi,"border:$1")});return _formatHtml(e,t)}function _mediaType(e){if(/\.(rm|rmvb)(\?|$)/i.test(e)){return"audio/x-pn-realaudio-plugin"}if(/\.(swf|flv)(\?|$)/i.test(e)){return"application/x-shockwave-flash"}return"video/x-ms-asf-plugin"}function _mediaClass(e){if(/realaudio/i.test(e)){return"ke-rm"}if(/flash/i.test(e)){return"ke-flash"}return"ke-media"}function _mediaAttrs(e){return _getAttrList(unescape(e))}function _mediaEmbed(e){var t="<embed ";_each(e,function(e,n){t+=e+'="'+n+'" '});t+="/>";return t}function _mediaImg(e,t){var n=t.width,i=t.height,r=t.type||_mediaType(t.src),a=_mediaEmbed(t),o="";if(/\D/.test(n)){o+="width:"+n+";"}else if(n>0){o+="width:"+n+"px;"}if(/\D/.test(i)){o+="height:"+i+";"}else if(i>0){o+="height:"+i+"px;"}var s='<img class="'+_mediaClass(r)+'" src="'+e+'" ';if(o!==""){s+='style="'+o+'" '}s+='data-ke-tag="'+escape(a)+'" alt="" />';return s}function _tmpl(e,t){var n=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return t?n(t):n}K.formatUrl=_formatUrl;K.formatHtml=_formatHtml;K.getCssList=_getCssList;K.getAttrList=_getAttrList;K.mediaType=_mediaType;K.mediaAttrs=_mediaAttrs;K.mediaEmbed=_mediaEmbed;K.mediaImg=_mediaImg;K.clearMsWord=_clearMsWord;K.tmpl=_tmpl;function _contains(e,t){if(e.nodeType==9&&t.nodeType!=9){return true}while(t=t.parentNode){if(t==e){return true}}return false}var _getSetAttrDiv=document.createElement("div");_getSetAttrDiv.setAttribute("className","t");var _GET_SET_ATTRIBUTE=_getSetAttrDiv.className!=="t";function _getAttr(e,t){t=t.toLowerCase();var n=null;if(!_GET_SET_ATTRIBUTE&&e.nodeName.toLowerCase()!="script"){var i=e.ownerDocument.createElement("div");i.appendChild(e.cloneNode(false));var r=_getAttrList(_unescape(i.innerHTML));if(t in r){n=r[t]}}else{try{n=e.getAttribute(t,2)}catch(i){n=e.getAttribute(t,1)}}if(t==="style"&&n!==null){n=_formatCss(n)}return n}function _queryAll(e,t){var n=e.split(",");if(n.length>1){var i=[];_each(n,function(){_each(_queryAll(this,t),function(){if(_inArray(this,i)<0){i.push(this)}})});return i}t=t||document;function r(e){if(typeof e!="string"){return e}return e.replace(/([^\w\-])/g,"\\$1")}function a(e){return e.replace(/\\/g,"")}function o(e,t){return e==="*"||e.toLowerCase()===r(t.toLowerCase())}function s(e,t,n){var i=[],r=n.ownerDocument||n,s=r.getElementById(a(e));if(s){if(o(t,s.nodeName)&&_contains(n,s)){i.push(s)}}return i}function l(e,t,n){var i=n.ownerDocument||n,r=[],s,l,c,d;if(n.getElementsByClassName){s=n.getElementsByClassName(a(e));for(l=0,c=s.length;l<c;l++){d=s[l];if(o(t,d.nodeName)){r.push(d)}}}else if(i.querySelectorAll){s=i.querySelectorAll((n.nodeName!=="#document"?n.nodeName+" ":"")+t+"."+e);for(l=0,c=s.length;l<c;l++){d=s[l];if(_contains(n,d)){r.push(d)}}}else{s=n.getElementsByTagName(t);e=" "+e+" ";for(l=0,c=s.length;l<c;l++){d=s[l];if(d.nodeType==1){var u=d.className;if(u&&(" "+u+" ").indexOf(e)>-1){r.push(d)}}}}return r}function c(e,t,n){var i=[],r=n.ownerDocument||n,s=r.getElementsByName(a(e)),l;for(var c=0,d=s.length;c<d;c++){l=s[c];if(o(t,l.nodeName)&&_contains(n,l)){if(l.getAttribute("name")!==null){i.push(l)}}}return i}function d(e,t,n,i){var a=[],o=i.getElementsByTagName(n),s;for(var l=0,c=o.length;l<c;l++){s=o[l];if(s.nodeType==1){if(t===null){if(_getAttr(s,e)!==null){a.push(s)}}else{if(t===r(_getAttr(s,e))){a.push(s)}}}}return a}function u(e,t){var n=[],i;i=/^((?:\\.|[^.#\s\[<>])+)/.exec(e);var r=i?i[1]:"*";if(i=/#((?:[\w\-]|\\.)+)$/.exec(e)){n=s(i[1],r,t)}else if(i=/\.((?:[\w\-]|\\.)+)$/.exec(e)){n=l(i[1],r,t)}else if(i=/\[((?:[\w\-]|\\.)+)\]/.exec(e)){n=d(i[1].toLowerCase(),null,r,t)}else if(i=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(e)){var a=i[1].toLowerCase(),o=i[2];if(a==="id"){n=s(o,r,t)}else if(a==="class"){n=l(o,r,t)}else if(a==="name"){n=c(o,r,t)}else{n=d(a,o,r,t)}}else{var u=t.getElementsByTagName(r),f;for(var h=0,m=u.length;h<m;h++){f=u[h];if(f.nodeType==1){n.push(f)}}}return n}var f=[],h,m=/((?:\\.|[^\s>])+|[\s>])/g;while(h=m.exec(e)){if(h[1]!==" "){f.push(h[1])}}var p=[];if(f.length==1){return u(f[0],t)}var _=false,g,v,b,y,k,C,E,K,w,T,x;for(C=0,lenth=f.length;C<lenth;C++){g=f[C];if(g===">"){_=true;continue}if(C>0){v=[];for(E=0,T=p.length;E<T;E++){y=p[E];b=u(g,y);for(K=0,x=b.length;K<x;K++){k=b[K];if(_){if(y===k.parentNode){v.push(k)}}else{v.push(k)}}}p=v}else{p=u(g,t)}if(p.length===0){return[]}}return p}function _query(e,t){var n=_queryAll(e,t);return n.length>0?n[0]:null}K.query=_query;K.queryAll=_queryAll;function _get(e){return K(e)[0]}function _getDoc(e){if(!e){return document}return e.ownerDocument||e.document||e}function _getWin(e){if(!e){return window}var t=_getDoc(e);return t.parentWindow||t.defaultView}function _setHtml(e,t){if(e.nodeType!=1){return}var n=_getDoc(e);try{e.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var i=n.getElementById("__kindeditor_temp_tag__");i.parentNode.removeChild(i)}catch(i){K(e).empty();K("@"+t,n).each(function(){e.appendChild(this)})}}function _hasClass(e,t){return _inString(t,e.className," ")}function _setAttr(e,t,n){if(_IE&&_V<8&&t.toLowerCase()=="class"){t="className"}e.setAttribute(t,""+n)}function _removeAttr(e,t){if(_IE&&_V<8&&t.toLowerCase()=="class"){t="className"}_setAttr(e,t,"");e.removeAttribute(t)}function _getNodeName(e){if(!e||!e.nodeName){return""}return e.nodeName.toLowerCase()}function _computedCss(e,t){var n=this,i=_getWin(e),r=_toCamel(t),a="";if(i.getComputedStyle){var o=i.getComputedStyle(e,null);a=o[r]||o.getPropertyValue(t)||e.style[r]}else if(e.currentStyle){a=e.currentStyle[r]||e.style[r]}return a}function _hasVal(e){return!!_VALUE_TAG_MAP[_getNodeName(e)]}function _docElement(e){e=e||document;return _QUIRKS?e.body:e.documentElement}function _docHeight(e){var t=_docElement(e);return Math.max(t.scrollHeight,t.clientHeight)}function _docWidth(e){var t=_docElement(e);return Math.max(t.scrollWidth,t.clientWidth)}function _getScrollPos(e){e=e||document;var t,n;if(_IE||_NEWIE||_OPERA){t=_docElement(e).scrollLeft;n=_docElement(e).scrollTop}else{t=_getWin(e).scrollX;n=_getWin(e).scrollY}return{x:t,y:n}}function KNode(e){this.init(e)}_extend(KNode,{init:function(e){var t=this;e=_isArray(e)?e:[e];var n=0;for(var i=0,r=e.length;i<r;i++){if(e[i]){t[i]=e[i].constructor===KNode?e[i][0]:e[i];n++}}t.length=n;t.doc=_getDoc(t[0]);t.name=_getNodeName(t[0]);t.type=t.length>0?t[0].nodeType:null;t.win=_getWin(t[0])},each:function(e){var t=this;for(var n=0;n<t.length;n++){if(e.call(t[n],n,t[n])===false){return t}}return t},bind:function(e,t){this.each(function(){_bind(this,e,t)});return this},unbind:function(e,t){this.each(function(){_unbind(this,e,t)});return this},fire:function(e){if(this.length<1){return this}_fire(this[0],e);return this},hasAttr:function(e){if(this.length<1){return false}return!!_getAttr(this[0],e)},attr:function(e,t){var n=this;if(e===undefined){return _getAttrList(n.outer())}if(typeof e==="object"){_each(e,function(e,t){n.attr(e,t)});return n}if(t===undefined){t=n.length<1?null:_getAttr(n[0],e);return t===null?"":t}n.each(function(){_setAttr(this,e,t)});return n},removeAttr:function(e){this.each(function(){_removeAttr(this,e)});return this},get:function(e){if(this.length<1){return null}return this[e||0]},eq:function(e){if(this.length<1){return null}return this[e]?new KNode(this[e]):null},hasClass:function(e){if(this.length<1){return false}return _hasClass(this[0],e)},addClass:function(e){this.each(function(){if(!_hasClass(this,e)){this.className=_trim(this.className+" "+e)}});return this},removeClass:function(e){this.each(function(){if(_hasClass(this,e)){this.className=_trim(this.className.replace(new RegExp("(^|\\s)"+e+"(\\s|$)")," "))}});return this},html:function(e){var t=this;if(e===undefined){if(t.length<1||t.type!=1){return""}return _formatHtml(t[0].innerHTML)}t.each(function(){_setHtml(this,e)});return t},text:function(){var e=this;if(e.length<1){return""}return _IE?e[0].innerText:e[0].textContent},hasVal:function(){if(this.length<1){return false}return _hasVal(this[0])},val:function(e){var t=this;if(e===undefined){if(t.length<1){return""}return t.hasVal()?t[0].value:t.attr("value")}else{t.each(function(){if(_hasVal(this)){this.value=e}else{_setAttr(this,"value",e)}});return t}},css:function(e,t){var n=this;if(e===undefined){return _getCssList(n.attr("style"))}if(typeof e==="object"){_each(e,function(e,t){n.css(e,t)});return n}if(t===undefined){if(n.length<1){return""}return n[0].style[_toCamel(e)]||_computedCss(n[0],e)||""}n.each(function(){this.style[_toCamel(e)]=t});return n},width:function(e){var t=this;if(e===undefined){if(t.length<1){return 0}return t[0].offsetWidth}return t.css("width",_addUnit(e))},height:function(e){var t=this;if(e===undefined){if(t.length<1){return 0}return t[0].offsetHeight}return t.css("height",_addUnit(e))},opacity:function(e){this.each(function(){if(this.style.opacity===undefined){this.style.filter=e==1?"":"alpha(opacity="+e*100+")"}else{this.style.opacity=e==1?"":e}});return this},data:function(e,t){var n=this;e="kindeditor_data_"+e;if(t===undefined){if(n.length<1){return null}return n[0][e]}this.each(function(){this[e]=t});return n},pos:function(){var e=this,t=e[0],n=0,i=0;if(t){if(t.getBoundingClientRect){var r=t.getBoundingClientRect(),a=_getScrollPos(e.doc);n=r.left+a.x;i=r.top+a.y}else{while(t){n+=t.offsetLeft;i+=t.offsetTop;t=t.offsetParent}}}return{x:_round(n),y:_round(i)}},clone:function(e){if(this.length<1){return new KNode([])}return new KNode(this[0].cloneNode(e))},append:function(e){this.each(function(){if(this.appendChild){this.appendChild(_get(e))}});return this},appendTo:function(e){this.each(function(){_get(e).appendChild(this)});return this},before:function(e){this.each(function(){this.parentNode.insertBefore(_get(e),this)});return this},after:function(e){this.each(function(){if(this.nextSibling){this.parentNode.insertBefore(_get(e),this.nextSibling)}else{this.parentNode.appendChild(_get(e))}});return this},replaceWith:function(e){var t=[];this.each(function(n,i){_unbind(i);var r=_get(e);i.parentNode.replaceChild(r,i);t.push(r)});return K(t)},empty:function(){var e=this;e.each(function(e,t){var n=t.firstChild;while(n){if(!t.parentNode){return}var i=n.nextSibling;n.parentNode.removeChild(n);n=i}});return e},remove:function(e){var t=this;t.each(function(n,i){if(!i.parentNode){return}_unbind(i);if(e){var r=i.firstChild;while(r){var a=r.nextSibling;i.parentNode.insertBefore(r,i);r=a}}i.parentNode.removeChild(i);delete t[n]});t.length=0;return t},show:function(e){var t=this;if(e===undefined){e=t._originDisplay||""}if(t.css("display")!="none"){return t}return t.css("display",e)},hide:function(){var e=this;if(e.length<1){return e}e._originDisplay=e[0].style.display;return e.css("display","none")},outer:function(){var e=this;if(e.length<1){return""}var t=e.doc.createElement("div"),n;t.appendChild(e[0].cloneNode(true));n=_formatHtml(t.innerHTML);t=null;return n},isSingle:function(){return!!_SINGLE_TAG_MAP[this.name]},isInline:function(){return!!_INLINE_TAG_MAP[this.name]},isBlock:function(){return!!_BLOCK_TAG_MAP[this.name]},isStyle:function(){return!!_STYLE_TAG_MAP[this.name]},isControl:function(){return!!_CONTROL_TAG_MAP[this.name]},contains:function(e){if(this.length<1){return false}return _contains(this[0],_get(e))},parent:function(){if(this.length<1){return null}var e=this[0].parentNode;return e?new KNode(e):null},children:function(){if(this.length<1){return new KNode([])}var e=[],t=this[0].firstChild;while(t){if(t.nodeType!=3||_trim(t.nodeValue)!==""){e.push(t)}t=t.nextSibling}return new KNode(e)},first:function(){var e=this.children();return e.length>0?e.eq(0):null},last:function(){var e=this.children();return e.length>0?e.eq(e.length-1):null},index:function(){if(this.length<1){return-1}var e=-1,t=this[0];while(t){e++;t=t.previousSibling}return e},prev:function(){if(this.length<1){return null}var e=this[0].previousSibling;return e?new KNode(e):null},next:function(){if(this.length<1){return null}var e=this[0].nextSibling;return e?new KNode(e):null},scan:function(e,t){if(this.length<1){return}t=t===undefined?true:t;function n(i){var r=t?i.firstChild:i.lastChild;while(r){var a=t?r.nextSibling:r.previousSibling;if(e(r)===false){return false}if(n(r)===false){return false}r=a}}n(this[0]);return this}});_each(("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,"+"mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,"+"change,select,submit,keydown,keypress,keyup,error,contextmenu").split(","),function(e,t){KNode.prototype[t]=function(e){return e?this.bind(t,e):this.fire(t)}});var _K=K;K=function(e,t){if(e===undefined||e===null){return}function n(e){if(!e[0]){e=[]}return new KNode(e)}if(typeof e==="string"){if(t){t=_get(t)}var i=e.length;if(e.charAt(0)==="@"){e=e.substr(1)}if(e.length!==i||/<.+>/.test(e)){var r=t?t.ownerDocument||t:document,a=r.createElement("div"),o=[];a.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+e;for(var s=0,l=a.childNodes.length;s<l;s++){var c=a.childNodes[s];if(c.id=="__kindeditor_temp_tag__"){continue}o.push(c)}return n(o)}return n(_queryAll(e,t))}if(e&&e.constructor===KNode){return e}if(e.toArray){e=e.toArray()}if(_isArray(e)){return n(e)}return n(_toArray(arguments))};_each(_K,function(e,t){K[e]=t});K.NodeClass=KNode;window.KindEditor=K;var _START_TO_START=0,_START_TO_END=1,_END_TO_END=2,_END_TO_START=3,_BOOKMARK_ID=0;function _updateCollapsed(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;return e}function _copyAndDelete(e,t,n){var i=e.doc,r=[];function a(i,a,o){var s=i.nodeValue.length,l;if(t){var c=i.cloneNode(true);
if(a>0){l=c.splitText(a)}else{l=c}if(o<s){l.splitText(o-a)}}if(n){var d=i;if(a>0){d=i.splitText(a);e.setStart(i,a)}if(o<s){var u=d.splitText(o-a);e.setEnd(u,0)}r.push(d)}return l}function o(){if(n){e.up().collapse(true)}for(var t=0,i=r.length;t<i;t++){var a=r[t];if(a.parentNode){a.parentNode.removeChild(a)}}}var s=e.cloneRange().down();var l=-1,c=-1,d=-1,u=-1,f=e.commonAncestor(),h=i.createDocumentFragment();if(f.nodeType==3){var m=a(f,e.startOffset,e.endOffset);if(t){h.appendChild(m)}o();return t?h:e}function p(o,f){var h=o.firstChild,m;while(h){var _=new KRange(i).selectNode(h);l=_.compareBoundaryPoints(_START_TO_END,e);if(l>=0&&c<=0){c=_.compareBoundaryPoints(_START_TO_START,e)}if(c>=0&&d<=0){d=_.compareBoundaryPoints(_END_TO_END,e)}if(d>=0&&u<=0){u=_.compareBoundaryPoints(_END_TO_START,e)}if(u>=0){return false}m=h.nextSibling;if(l>0){if(h.nodeType==1){if(c>=0&&d<=0){if(t){f.appendChild(h.cloneNode(true))}if(n){r.push(h)}}else{var g;if(t){g=h.cloneNode(false);f.appendChild(g)}if(p(h,g)===false){return false}}}else if(h.nodeType==3){var v;if(h==s.startContainer){v=a(h,s.startOffset,h.nodeValue.length)}else if(h==s.endContainer){v=a(h,0,s.endOffset)}else{v=a(h,0,h.nodeValue.length)}if(t){try{f.appendChild(v)}catch(e){}}}}h=m}}p(f,h);if(n){e.up().collapse(true)}for(var _=0,g=r.length;_<g;_++){var v=r[_];if(v.parentNode){v.parentNode.removeChild(v)}}return t?h:e}function _moveToElementText(e,t){var n=t;while(n){var i=K(n);if(i.name=="marquee"||i.name=="select"){return}n=n.parentNode}try{e.moveToElementText(t)}catch(e){}}function _getStartEnd(e,t){var n=e.parentElement().ownerDocument,i=e.duplicate();i.collapse(t);var r=i.parentElement(),a=r.childNodes;if(a.length===0){return{node:r.parentNode,offset:K(r).index()}}var o=n,s=0,l=-1;var c=e.duplicate();_moveToElementText(c,r);for(var d=0,u=a.length;d<u;d++){var f=a[d];l=c.compareEndPoints("StartToStart",i);if(l===0){return{node:f.parentNode,offset:d}}if(f.nodeType==1){var h=e.duplicate(),m,p=K(f),_=f;if(p.isControl()){m=n.createElement("span");p.after(m);_=m;s+=p.text().replace(/\r\n|\n|\r/g,"").length}_moveToElementText(h,_);c.setEndPoint("StartToEnd",h);if(l>0){s+=h.text.replace(/\r\n|\n|\r/g,"").length}else{s=0}if(m){K(m).remove()}}else if(f.nodeType==3){c.moveStart("character",f.nodeValue.length);s+=f.nodeValue.length}if(l<0){o=f}}if(l<0&&o.nodeType==1){return{node:r,offset:K(r.lastChild).index()+1}}if(l>0){while(o.nextSibling&&o.nodeType==1){o=o.nextSibling}}c=e.duplicate();_moveToElementText(c,r);c.setEndPoint("StartToEnd",i);s-=c.text.replace(/\r\n|\n|\r/g,"").length;if(l>0&&o.nodeType==3){var g=o.previousSibling;while(g&&g.nodeType==3){s-=g.nodeValue.length;g=g.previousSibling}}return{node:o,offset:s}}function _getEndRange(e,t){var n=e.ownerDocument||e,i=n.body.createTextRange();if(n==e){i.collapse(true);return i}if(e.nodeType==1&&e.childNodes.length>0){var r=e.childNodes,a,o;if(t===0){o=r[0];a=true}else{o=r[t-1];a=false}if(!o){return i}if(K(o).name==="head"){if(t===1){a=true}if(t===2){a=false}i.collapse(a);return i}if(o.nodeType==1){var s=K(o),l;if(s.isControl()){l=n.createElement("span");if(a){s.before(l)}else{s.after(l)}o=l}_moveToElementText(i,o);i.collapse(a);if(l){K(l).remove()}return i}e=o;t=a?0:o.nodeValue.length}var c=n.createElement("span");K(e).before(c);_moveToElementText(i,c);i.moveStart("character",t);K(c).remove();return i}function _toRange(e){var t,n;function i(e){if(K(e.node).name=="tr"){e.node=e.node.cells[e.offset];e.offset=0}}if(_IERANGE){if(e.item){t=_getDoc(e.item(0));n=new KRange(t);n.selectNode(e.item(0));return n}t=e.parentElement().ownerDocument;var r=_getStartEnd(e,true),a=_getStartEnd(e,false);i(r);i(a);n=new KRange(t);n.setStart(r.node,r.offset);n.setEnd(a.node,a.offset);return n}var o=e.startContainer;t=o.ownerDocument||o;n=new KRange(t);n.setStart(o,e.startOffset);n.setEnd(e.endContainer,e.endOffset);return n}function KRange(e){this.init(e)}_extend(KRange,{init:function(e){var t=this;t.startContainer=e;t.startOffset=0;t.endContainer=e;t.endOffset=0;t.collapsed=true;t.doc=e},commonAncestor:function(){function e(e){var t=[];while(e){t.push(e);e=e.parentNode}return t}var t=e(this.startContainer),n=e(this.endContainer),i=0,r=t.length,a=n.length,o,s;while(++i){o=t[r-i];s=n[a-i];if(!o||!s||o!==s){break}}return t[r-i+1]},setStart:function(e,t){var n=this,i=n.doc;n.startContainer=e;n.startOffset=t;if(n.endContainer===i){n.endContainer=e;n.endOffset=t}return _updateCollapsed(this)},setEnd:function(e,t){var n=this,i=n.doc;n.endContainer=e;n.endOffset=t;if(n.startContainer===i){n.startContainer=e;n.startOffset=t}return _updateCollapsed(this)},setStartBefore:function(e){return this.setStart(e.parentNode||this.doc,K(e).index())},setStartAfter:function(e){return this.setStart(e.parentNode||this.doc,K(e).index()+1)},setEndBefore:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index())},setEndAfter:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index()+1)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){var t=K(e);if(t.type==3||t.isSingle()){return this.selectNode(e)}var n=t.children();if(n.length>0){return this.setStartBefore(n[0]).setEndAfter(n[n.length-1])}return this.setStart(e,0).setEnd(e,0)},collapse:function(e){if(e){return this.setEnd(this.startContainer,this.startOffset)}return this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(e,t){var n=this.get(),i=t.get();if(_IERANGE){var r={};r[_START_TO_START]="StartToStart";r[_START_TO_END]="EndToStart";r[_END_TO_END]="EndToEnd";r[_END_TO_START]="StartToEnd";var a=n.compareEndPoints(r[e],i);if(a!==0){return a}var o,s,l,c,d;if(e===_START_TO_START||e===_END_TO_START){o=this.startContainer;c=this.startOffset}if(e===_START_TO_END||e===_END_TO_END){o=this.endContainer;c=this.endOffset}if(e===_START_TO_START||e===_START_TO_END){s=t.startContainer;d=t.startOffset}if(e===_END_TO_END||e===_END_TO_START){s=t.endContainer;d=t.endOffset}if(o===s){var u=c-d;return u>0?1:u<0?-1:0}l=s;while(l&&l.parentNode!==o){l=l.parentNode}if(l){return K(l).index()>=c?-1:1}l=o;while(l&&l.parentNode!==s){l=l.parentNode}if(l){return K(l).index()>=d?1:-1}l=K(s).next();if(l&&l.contains(o)){return 1}l=K(o).next();if(l&&l.contains(s)){return-1}}else{return n.compareBoundaryPoints(e,i)}},cloneRange:function(){return new KRange(this.doc).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var e=this.get(),t=_IERANGE?e.text:e.toString();return t.replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return _copyAndDelete(this,true,false)},deleteContents:function(){return _copyAndDelete(this,false,true)},extractContents:function(){return _copyAndDelete(this,true,true)},insertNode:function(e){var t=this,n=t.startContainer,i=t.startOffset,r=t.endContainer,a=t.endOffset,o,s,l,c=1;if(e.nodeName.toLowerCase()==="#document-fragment"){o=e.firstChild;s=e.lastChild;c=e.childNodes.length}if(n.nodeType==1){l=n.childNodes[i];if(l){n.insertBefore(e,l);if(n===r){a+=c}}else{n.appendChild(e)}}else if(n.nodeType==3){if(i===0){n.parentNode.insertBefore(e,n);if(n.parentNode===r){a+=c}}else if(i>=n.nodeValue.length){if(n.nextSibling){n.parentNode.insertBefore(e,n.nextSibling)}else{n.parentNode.appendChild(e)}}else{if(i>0){l=n.splitText(i)}else{l=n}n.parentNode.insertBefore(e,l);if(n===r){r=l;a-=i}}}if(o){t.setStartBefore(o).setEndAfter(s)}else{t.selectNode(e)}if(t.compareBoundaryPoints(_END_TO_END,t.cloneRange().setEnd(r,a))>=1){return t}return t.setEnd(r,a)},surroundContents:function(e){e.appendChild(this.extractContents());return this.insertNode(e).selectNode(e)},isControl:function(){var e=this,t=e.startContainer,n=e.startOffset,i=e.endContainer,r=e.endOffset,a;return t.nodeType==1&&t===i&&n+1===r&&K(t.childNodes[n]).isControl()},get:function(e){var t=this,n=t.doc,i,r;if(!_IERANGE){r=n.createRange();try{r.setStart(t.startContainer,t.startOffset);r.setEnd(t.endContainer,t.endOffset)}catch(e){}return r}if(e&&t.isControl()){r=n.body.createControlRange();r.addElement(t.startContainer.childNodes[t.startOffset]);return r}var a=t.cloneRange().down();r=n.body.createTextRange();r.setEndPoint("StartToStart",_getEndRange(a.startContainer,a.startOffset));r.setEndPoint("EndToStart",_getEndRange(a.endContainer,a.endOffset));return r},html:function(){return K(this.cloneContents()).outer()},down:function(){var e=this;function t(t,n,i){if(t.nodeType!=1){return}var r=K(t).children();if(r.length===0){return}var a,o,s,l;if(n>0){a=r.eq(n-1)}if(n<r.length){o=r.eq(n)}if(a&&a.type==3){s=a[0];l=s.nodeValue.length}if(o&&o.type==3){s=o[0];l=0}if(!s){return}if(i){e.setStart(s,l)}else{e.setEnd(s,l)}}t(e.startContainer,e.startOffset,true);t(e.endContainer,e.endOffset,false);return e},up:function(){var e=this;function t(t,n,i){if(t.nodeType!=3){return}if(n===0){if(i){e.setStartBefore(t)}else{e.setEndBefore(t)}}else if(n==t.nodeValue.length){if(i){e.setStartAfter(t)}else{e.setEndAfter(t)}}}t(e.startContainer,e.startOffset,true);t(e.endContainer,e.endOffset,false);return e},enlarge:function(e){var t=this;t.up();function n(n,i,r){var a=K(n),o;if(a.type==3||_NOSPLIT_TAG_MAP[a.name]||!e&&a.isBlock()){return}if(i===0){while(!a.prev()){o=a.parent();if(!o||_NOSPLIT_TAG_MAP[o.name]||!e&&o.isBlock()){break}a=o}if(r){t.setStartBefore(a[0])}else{t.setEndBefore(a[0])}}else if(i==a.children().length){while(!a.next()){o=a.parent();if(!o||_NOSPLIT_TAG_MAP[o.name]||!e&&o.isBlock()){break}a=o}if(r){t.setStartAfter(a[0])}else{t.setEndAfter(a[0])}}}n(t.startContainer,t.startOffset,true);n(t.endContainer,t.endOffset,false);return t},shrink:function(){var e=this,t,n=e.collapsed;while(e.startContainer.nodeType==1&&(t=e.startContainer.childNodes[e.startOffset])&&t.nodeType==1&&!K(t).isSingle()){e.setStart(t,0)}if(n){return e.collapse(n)}while(e.endContainer.nodeType==1&&e.endOffset>0&&(t=e.endContainer.childNodes[e.endOffset-1])&&t.nodeType==1&&!K(t).isSingle()){e.setEnd(t,t.childNodes.length)}return e},createBookmark:function(e){var t=this,n=t.doc,i,r=K('<span style="display:none;"></span>',n)[0];r.id="__kindeditor_bookmark_start_"+_BOOKMARK_ID++ +"__";if(!t.collapsed){i=r.cloneNode(true);i.id="__kindeditor_bookmark_end_"+_BOOKMARK_ID++ +"__"}if(i){t.cloneRange().collapse(false).insertNode(i).setEndBefore(i)}t.insertNode(r).setStartAfter(r);return{start:e?"#"+r.id:r,end:i?e?"#"+i.id:i:null}},moveToBookmark:function(e){var t=this,n=t.doc,i=K(e.start,n),r=e.end?K(e.end,n):null;if(!i||i.length<1){return t}t.setStartBefore(i[0]);i.remove();if(r&&r.length>0){t.setEndBefore(r[0]);r.remove()}else{t.collapse(true)}return t},dump:function(){console.log("--------------------");console.log(this.startContainer.nodeType==3?this.startContainer.nodeValue:this.startContainer,this.startOffset);console.log(this.endContainer.nodeType==3?this.endContainer.nodeValue:this.endContainer,this.endOffset)}});function _range(e){if(!e.nodeName){return e.constructor===KRange?e:_toRange(e)}return new KRange(e)}K.RangeClass=KRange;K.range=_range;K.START_TO_START=_START_TO_START;K.START_TO_END=_START_TO_END;K.END_TO_END=_END_TO_END;K.END_TO_START=_END_TO_START;function _nativeCommand(e,t,n){try{e.execCommand(t,false,n)}catch(e){}}function _nativeCommandValue(e,t){var n="";try{n=e.queryCommandValue(t)}catch(e){}if(typeof n!=="string"){n=""}return n}function _getSel(e){var t=_getWin(e);return _IERANGE?e.selection:t.getSelection()}function _getRng(e){var t=_getSel(e),n;try{if(t.rangeCount>0){n=t.getRangeAt(0)}else{n=t.createRange()}}catch(e){}if(_IERANGE&&(!n||!n.item&&n.parentElement().ownerDocument!==e)){return null}return n}function _singleKeyMap(e){var t={},n,i;_each(e,function(e,r){n=e.split(",");for(var a=0,o=n.length;a<o;a++){i=n[a];t[i]=r}});return t}function _hasAttrOrCss(e,t){return _hasAttrOrCssByKey(e,t,"*")||_hasAttrOrCssByKey(e,t)}function _hasAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1){return false}var i=_singleKeyMap(t);if(!i[n]){return false}var r=i[n].split(",");for(var a=0,o=r.length;a<o;a++){var s=r[a];if(s==="*"){return true}var l=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(s);var c=l[1]?"css":"attr";s=l[2];var d=l[3]||"";if(d===""&&e[c](s)!==""){return true}if(d!==""&&e[c](s)===d){return true}}return false}function _removeAttrOrCss(e,t){if(e.type!=1){return}_removeAttrOrCssByKey(e,t,"*");_removeAttrOrCssByKey(e,t)}function _removeAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1){return}var i=_singleKeyMap(t);if(!i[n]){return}var r=i[n].split(","),a=false;for(var o=0,s=r.length;o<s;o++){var l=r[o];if(l==="*"){a=true;break}var c=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(l);l=c[2];if(c[1]){l=_toCamel(l);if(e[0].style[l]){e[0].style[l]=""}}else{e.removeAttr(l)}}if(a){e.remove(true)}}function _getInnerNode(e){var t=e;while(t.first()){t=t.first()}return t}function _isEmptyNode(e){if(e.type!=1||e.isSingle()){return false}return e.html().replace(/<[^>]+>/g,"")===""}function _mergeWrapper(e,t){e=e.clone(true);var n=_getInnerNode(e),i=e,r=false;while(t){while(i){if(i.name===t.name){_mergeAttrs(i,t.attr(),t.css());r=true}i=i.first()}if(!r){n.append(t.clone(false))}r=false;t=t.first()}return e}function _wrapNode(e,t){t=t.clone(true);if(e.type==3){_getInnerNode(t).append(e.clone(false));e.replaceWith(t);return t}var n=e,i;while((i=e.first())&&i.children().length==1){e=i}i=e.first();var r=e.doc.createDocumentFragment();while(i){r.appendChild(i[0]);i=i.next()}t=_mergeWrapper(n,t);if(r.firstChild){_getInnerNode(t).append(r)}n.replaceWith(t);return t}function _mergeAttrs(e,t,n){_each(t,function(t,n){if(t!=="style"){e.attr(t,n)}});_each(n,function(t,n){e.css(t,n)})}function _inPreElement(e){while(e&&e.name!="body"){if(_PRE_TAG_MAP[e.name]||e.name=="div"&&e.hasClass("ke-script")){return true}e=e.parent()}return false}function KCmd(e){this.init(e)}_extend(KCmd,{init:function(e){var t=this,n=e.doc;t.doc=n;t.win=_getWin(n);t.sel=_getSel(n);t.range=e},selection:function(e){var t=this,n=t.doc,i=_getRng(n);t.sel=_getSel(n);if(i){t.range=_range(i);if(K(t.range.startContainer).name=="html"){t.range.selectNodeContents(n.body).collapse(false)}return t}if(e){t.range.selectNodeContents(n.body).collapse(false)}return t},select:function(e){e=_undef(e,true);var t=this,n=t.sel,i=t.range.cloneRange().shrink(),r=i.startContainer,a=i.startOffset,o=i.endContainer,s=i.endOffset,l=_getDoc(r),c=t.win,d,u=false;if(e&&r.nodeType==1&&i.collapsed){if(_IERANGE){var f=K("<span>&nbsp;</span>",l);i.insertNode(f[0]);d=l.body.createTextRange();try{d.moveToElementText(f[0])}catch(e){}d.collapse(false);d.select();f.remove();c.focus();return t}if(_WEBKIT){var h=r.childNodes;if(K(r).isInline()||a>0&&K(h[a-1]).isInline()||h[a]&&K(h[a]).isInline()){i.insertNode(l.createTextNode("​"));u=true}}}if(_IERANGE){try{d=i.get(true);d.select()}catch(e){}}else{if(u){i.collapse(false)}d=i.get(true);n.removeAllRanges();n.addRange(d);if(l!==document){var m=K(d.endContainer).pos();c.scrollTo(m.x,m.y)}}c.focus();return t},wrap:function(e){var t=this,n=t.doc,i=t.range,r;r=K(e,n);if(i.collapsed){i.shrink();i.insertNode(r[0]).selectNodeContents(r[0]);return t}if(r.isBlock()){var a=r.clone(true),o=a;while(o.first()){o=o.first()}o.append(i.extractContents());i.insertNode(a[0]).selectNode(a[0]);return t}i.enlarge();var s=i.createBookmark(),l=i.commonAncestor(),c=false;K(l).scan(function(e){if(!c&&e==s.start){c=true;return}if(c){if(e==s.end){return false}var t=K(e);if(_inPreElement(t)){return}if(t.type==3&&_trim(e.nodeValue).length>0){var n;while((n=t.parent())&&n.isStyle()&&n.children().length==1){t=n}_wrapNode(t,r)}}});i.moveToBookmark(s);return t},split:function(e,t){var n=this.range,i=n.doc;var r=n.cloneRange().collapse(e);var a=r.startContainer,o=r.startOffset,s=a.nodeType==3?a.parentNode:a,l=false,c;while(s&&s.parentNode){c=K(s);if(t){if(!c.isStyle()){break}if(!_hasAttrOrCss(c,t)){break}}else{if(_NOSPLIT_TAG_MAP[c.name]){break}}l=true;s=s.parentNode}if(l){var d=i.createElement("span");n.cloneRange().collapse(!e).insertNode(d);if(e){r.setStartBefore(s.firstChild).setEnd(a,o)}else{r.setStart(a,o).setEndAfter(s.lastChild)}var u=r.extractContents(),f=u.firstChild,h=u.lastChild;if(e){r.insertNode(u);n.setStartAfter(h).setEndBefore(d)}else{s.appendChild(u);n.setStartBefore(d).setEndBefore(f)}var m=d.parentNode;if(m==n.endContainer){var p=K(d).prev(),_=K(d).next();if(p&&_&&p.type==3&&_.type==3){n.setEnd(p[0],p[0].nodeValue.length)}else if(!e){n.setEnd(n.endContainer,n.endOffset-1)}}m.removeChild(d)}return this},remove:function(e){var t=this,n=t.doc,i=t.range;i.enlarge();if(i.startOffset===0){var r=K(i.startContainer),a;while((a=r.parent())&&a.isStyle()&&a.children().length==1){r=a}i.setStart(r[0],0);r=K(i.startContainer);if(r.isBlock()){_removeAttrOrCss(r,e)}var o=r.parent();if(o&&o.isBlock()){_removeAttrOrCss(o,e)}}var s,l;if(i.collapsed){t.split(true,e);s=i.startContainer;l=i.startOffset;if(l>0){var c=K(s.childNodes[l-1]);if(c&&_isEmptyNode(c)){c.remove();i.setStart(s,l-1)}}var d=K(s.childNodes[l]);if(d&&_isEmptyNode(d)){d.remove()}if(_isEmptyNode(s)){i.startBefore(s);s.remove()}i.collapse(true);return t}t.split(true,e);t.split(false,e);var u=n.createElement("span"),f=n.createElement("span");i.cloneRange().collapse(false).insertNode(f);i.cloneRange().collapse(true).insertNode(u);var h=[],m=false;K(i.commonAncestor()).scan(function(e){if(!m&&e==u){m=true;return}if(e==f){return false}if(m){h.push(e)}});K(u).remove();K(f).remove();s=i.startContainer;l=i.startOffset;var p=i.endContainer,_=i.endOffset;if(l>0){var g=K(s.childNodes[l-1]);if(g&&_isEmptyNode(g)){g.remove();i.setStart(s,l-1);if(s==p){i.setEnd(p,_-1)}}var v=K(s.childNodes[l]);if(v&&_isEmptyNode(v)){v.remove();if(s==p){i.setEnd(p,_-1)}}}var b=K(p.childNodes[i.endOffset]);if(b&&_isEmptyNode(b)){b.remove()}var y=i.createBookmark(true);_each(h,function(t,n){_removeAttrOrCss(K(n),e)});i.moveToBookmark(y);return t},commonNode:function(e){var t=this.range;var n=t.endContainer,i=t.endOffset,r=n.nodeType==3||i===0?n:n.childNodes[i-1];function a(t){var n=t,i=t;while(i){if(_hasAttrOrCss(K(i),e)){return K(i)}i=i.parentNode}while(n&&(n=n.lastChild)){if(_hasAttrOrCss(K(n),e)){return K(n)}}return null}var o=a(r);if(o){return o}if(r.nodeType==1||n.nodeType==3&&i===0){var s=K(r).prev();if(s){return a(s)}}return null},commonAncestor:function(e){var t=this.range,n=t.startContainer,i=t.startOffset,r=t.endContainer,a=t.endOffset,o=n.nodeType==3||i===0?n:n.childNodes[i-1],s=r.nodeType==3||a===0?r:r.childNodes[a-1];function l(t){while(t){if(t.nodeType==1){if(t.tagName.toLowerCase()===e){return t}}t=t.parentNode}return null}var c=l(o),d=l(s);if(c&&d&&c===d){return K(c)}return null},state:function(e){var t=this,n=t.doc,i=false;try{i=n.queryCommandState(e)}catch(e){}return i},val:function(e){var t=this,n=t.doc,i=t.range;function r(e){return e.toLowerCase()}e=r(e);var a="",o;if(e==="fontfamily"||e==="fontname"){a=_nativeCommandValue(n,"fontname");a=a.replace(/['"]/g,"");return r(a)}if(e==="formatblock"){a=_nativeCommandValue(n,e);if(a===""){o=t.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"});if(o){a=o.name}}if(a==="Normal"){a="p"}return r(a)}if(e==="fontsize"){o=t.commonNode({"*":".font-size"});if(o){a=o.css("font-size")}return r(a)}if(e==="forecolor"){o=t.commonNode({"*":".color"});if(o){a=o.css("color")}a=_toHex(a);if(a===""){a="default"}return r(a)}if(e==="hilitecolor"){o=t.commonNode({"*":".background-color"});if(o){a=o.css("background-color")}a=_toHex(a);if(a===""){a="default"}return r(a)}return a},toggle:function(e,t){var n=this;if(n.commonNode(t)){n.remove(t)}else{n.wrap(e)}return n.select()},bold:function(){return this.toggle("<strong></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",{span:".text-decoration=line-through",s:"*"})},forecolor:function(e){return this.wrap('<span style="color:'+e+';"></span>').select()},hilitecolor:function(e){return this.wrap('<span style="background-color:'+e+';"></span>').select()},fontsize:function(e){return this.wrap('<span style="font-size:'+e+';"></span>').select()},fontname:function(e){return this.fontfamily(e)},fontfamily:function(e){return this.wrap('<span style="font-family:'+e+';"></span>').select()},removeformat:function(){var e={"*":".font-weight,.font-style,.text-decoration,.color,.background-color,.font-size,.font-family,.text-indent"},t=_STYLE_TAG_MAP;_each(t,function(t,n){e[t]="*"});this.remove(e);return this.select()},inserthtml:function(e,t){var n=this,i=n.range;if(e===""){return n}function r(e,t){t='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var i=e.get();if(i.item){i.item(0).outerHTML=t}else{i.pasteHTML(t)}var r=e.doc.getElementById("__kindeditor_temp_tag__");r.parentNode.removeChild(r);var a=_toRange(i);e.setEnd(a.endContainer,a.endOffset);e.collapse(false);n.select(false)}function a(e,t){var i=e.doc,r=i.createDocumentFragment();K("@"+t,i).each(function(){r.appendChild(this)});e.deleteContents();e.insertNode(r);e.collapse(false);n.select(false)}if(_IERANGE&&t){try{r(i,e)}catch(t){a(i,e)}return n}a(i,e);return n},hr:function(){return this.inserthtml("<hr />")},print:function(){this.win.print();return this},insertimage:function(e,t,n,i,r,a){t=_undef(t,"");r=_undef(r,0);var o='<img src="'+_escape(e)+'" data-ke-src="'+_escape(e)+'" ';if(n){o+='width="'+_escape(n)+'" '}if(i){o+='height="'+_escape(i)+'" '}if(t){o+='title="'+_escape(t)+'" '}if(a){o+='align="'+_escape(a)+'" '}o+='alt="'+_escape(t)+'" ';o+="/>";return this.inserthtml(o)},createlink:function(e,t){var n=this,i=n.doc,r=n.range;n.select();var a=n.commonNode({a:"*"});if(a&&!r.isControl()){r.selectNode(a.get());n.select()}var o='<a href="'+_escape(e)+'" data-ke-src="'+_escape(e)+'" ';if(t){o+=' target="'+_escape(t)+'"'}if(r.collapsed){o+=">"+_escape(e)+"</a>";return n.inserthtml(o)}if(r.isControl()){var s=K(r.startContainer.childNodes[r.startOffset]);o+="></a>";s.after(K(o,i));s.next().append(s);r.selectNode(s[0]);return n.select()}function l(e,t,n){K(e).attr("href",t).attr("data-ke-src",t);if(n){K(e).attr("target",n)}else{K(e).removeAttr("target")}}var c=r.startContainer,d=r.startOffset,u=r.endContainer,f=r.endOffset;if(c.nodeType==1&&c===u&&d+1===f){var h=c.childNodes[d];if(h.nodeName.toLowerCase()=="a"){l(h,e,t);return n}}_nativeCommand(i,"createlink","__kindeditor_temp_url__");K('a[href="__kindeditor_temp_url__"]',i).each(function(){l(this,e,t)});return n},unlink:function(){var e=this,t=e.doc,n=e.range;e.select();if(n.collapsed){var i=e.commonNode({a:"*"});if(i){n.selectNode(i.get());e.select()}_nativeCommand(t,"unlink",null);if(_WEBKIT&&K(n.startContainer).name==="img"){var r=K(n.startContainer).parent();if(r.name==="a"){r.remove(true)}}}else{_nativeCommand(t,"unlink",null)}return e}});_each(("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,"+"insertunorderedlist,indent,outdent,subscript,superscript").split(","),function(e,t){KCmd.prototype[t]=function(e){var n=this;n.select();_nativeCommand(n.doc,t,e);if(_IERANGE&&_inArray(t,"justifyleft,justifycenter,justifyright,justifyfull".split(","))>=0){n.selection()}if(!_IERANGE||_inArray(t,"formatblock,selectall,insertorderedlist,insertunorderedlist".split(","))>=0){n.selection()}return n}});_each("cut,copy,paste".split(","),function(e,t){KCmd.prototype[t]=function(){var e=this;if(!e.doc.queryCommandSupported(t)){throw"not supported"}e.select();_nativeCommand(e.doc,t,null);return e}});function _cmd(e){if(e.nodeName){var t=_getDoc(e);e=_range(t).selectNodeContents(t.body).collapse(false)}return new KCmd(e)}K.CmdClass=KCmd;K.cmd=_cmd;function _drag(e){var t=e.moveEl,n=e.moveFn,i=e.clickEl||t,r=e.beforeDrag,a=e.iframeFix===undefined?true:e.iframeFix;var o=[document];if(a){K("iframe").each(function(){var e=_formatUrl(this.src||"","absolute");if(/^https?:\/\//.test(e)){return}var t;try{t=_iframeDoc(this)}catch(e){}if(t){var n=K(this).pos();K(t).data("pos-x",n.x);K(t).data("pos-y",n.y);o.push(t)}})}i.mousedown(function(e){e.stopPropagation();var a=i.get(),s=_removeUnit(t.css("left")),l=_removeUnit(t.css("top")),c=t.width(),d=t.height(),u=e.pageX,f=e.pageY;if(r){r()}function h(e){e.preventDefault();var t=K(_getDoc(e.target));var r=_round((t.data("pos-x")||0)+e.pageX-u);var a=_round((t.data("pos-y")||0)+e.pageY-f);n.call(i,s,l,c,d,r,a)}function m(e){e.preventDefault()}function p(e){e.preventDefault();K(o).unbind("mousemove",h).unbind("mouseup",p).unbind("selectstart",m);if(a.releaseCapture){a.releaseCapture()}}K(o).mousemove(h).mouseup(p).bind("selectstart",m);if(a.setCapture){a.setCapture()}})}function KWidget(e){this.init(e)}_extend(KWidget,{init:function(e){var t=this;t.name=e.name||"";t.doc=e.doc||document;t.win=_getWin(t.doc);t.x=_addUnit(e.x);t.y=_addUnit(e.y);t.z=e.z;t.width=_addUnit(e.width);t.height=_addUnit(e.height);t.div=K('<div style="display:block;"></div>');t.options=e;t._alignEl=e.alignEl;if(t.width){t.div.css("width",t.width)}if(t.height){t.div.css("height",t.height)}if(t.z){t.div.css({position:"absolute",left:t.x,top:t.y,"z-index":t.z})}if(t.z&&(t.x===undefined||t.y===undefined)){t.autoPos(t.width,t.height)}if(e.cls){t.div.addClass(e.cls)}if(e.shadowMode){t.div.addClass("ke-shadow")}if(e.css){t.div.css(e.css)}if(e.src){K(e.src).replaceWith(t.div)}else{K(t.doc.body).append(t.div)}if(e.html){t.div.html(e.html)}if(e.autoScroll){if(_IE&&_V<7||_QUIRKS){var n=_getScrollPos();K(t.win).bind("scroll",function(e){var i=_getScrollPos(),r=i.x-n.x,a=i.y-n.y;t.pos(_removeUnit(t.x)+r,_removeUnit(t.y)+a,false)})}else{t.div.css("position","fixed")}}},pos:function(e,t,n){var i=this;n=_undef(n,true);if(e!==null){e=e<0?0:_addUnit(e);i.div.css("left",e);if(n){i.x=e}}if(t!==null){t=t<0?0:_addUnit(t);i.div.css("top",t);if(n){i.y=t}}return i},autoPos:function(e,t){var n=this,i=_removeUnit(e)||0,r=_removeUnit(t)||0,a=_getScrollPos();if(n._alignEl){var o=K(n._alignEl),s=o.pos(),l=_round(o[0].clientWidth/2-i/2),c=_round(o[0].clientHeight/2-r/2);x=l<0?s.x:s.x+l;y=c<0?s.y:s.y+c}else{var d=_docElement(n.doc);x=_round(a.x+(d.clientWidth-i)/2);y=_round(a.y+(d.clientHeight-r)/2)}if(!(_IE&&_V<7||_QUIRKS)){x-=a.x;y-=a.y}return n.pos(x,y)},remove:function(){var e=this;if(_IE&&_V<7||_QUIRKS){K(e.win).unbind("scroll")}e.div.remove();_each(e,function(t){e[t]=null});return this},show:function(){this.div.show();return this},hide:function(){this.div.hide();return this},draggable:function(e){var t=this;e=e||{};e.moveEl=t.div;e.moveFn=function(e,n,i,r,a,o){if((e=e+a)<0){e=0}if((n=n+o)<0){n=0}t.pos(e,n)};_drag(e);return t}});function _widget(e){return new KWidget(e)}K.WidgetClass=KWidget;K.widget=_widget;function _iframeDoc(e){e=_get(e);return e.contentDocument||e.contentWindow.document}var html,_direction="";if(html=document.getElementsByTagName("html")){_direction=html[0].dir}function _getInitHtml(e,t,n,i){var r=[_direction===""?"<html>":'<html dir="'+_direction+'">','<head><meta charset="utf-8" /><title></title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:5px;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"body, p, div {word-wrap: break-word;}","p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}","img.ke-flash {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/flash.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-rm {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/rm.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-media {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/media.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-anchor {","\tborder:1px dashed #666;","\twidth:16px;","\theight:16px;","}",".ke-script, .ke-noscript, .ke-display-none {","\tdisplay:none;","\tfont-size:0;","\twidth:0;","\theight:0;","}",".ke-pagebreak {","\tborder:1px dotted #AAA;","\tfont-size:0;","\theight:2px;","}","</style>"];if(!_isArray(n)){n=[n]}_each(n,function(e,t){if(t){r.push('<link href="'+t+'" rel="stylesheet" />')}});if(i){r.push("<style>"+i+"</style>")}r.push("</head><body "+(t?'class="'+t+'"':"")+"></body></html>");return r.join("\n")}function _elementVal(e,t){if(e.hasVal()){if(t===undefined){var n=e.val();n=n.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"");return n}return e.val(t)}return e.html(t)}function KEdit(e){this.init(e)}_extend(KEdit,KWidget,{init:function(e){var t=this;KEdit.parent.init.call(t,e);t.srcElement=K(e.srcElement);t.div.addClass("ke-edit");t.designMode=_undef(e.designMode,true);t.beforeGetHtml=e.beforeGetHtml;t.beforeSetHtml=e.beforeSetHtml;t.afterSetHtml=e.afterSetHtml;var n=_undef(e.themesPath,""),i=e.bodyClass,r=e.cssPath,a=e.cssData,o=location.protocol!="res:"&&location.host.replace(/:\d+/,"")!==document.domain,s="document.open();"+(o?'document.domain="'+document.domain+'";':"")+"document.close();",l=_IE?' src="javascript:void(function(){'+encodeURIComponent(s)+'}())"':"";t.iframe=K('<iframe class="ke-edit-iframe" hidefocus="true" frameborder="0"'+l+"></iframe>").css("width","100%");t.textarea=K('<textarea class="ke-edit-textarea" hidefocus="true"></textarea>').css("width","100%");t.tabIndex=isNaN(parseInt(e.tabIndex,10))?t.srcElement.attr("tabindex"):parseInt(e.tabIndex,10);t.iframe.attr("tabindex",t.tabIndex);t.textarea.attr("tabindex",t.tabIndex);if(t.width){t.setWidth(t.width)}if(t.height){t.setHeight(t.height)}if(t.designMode){t.textarea.hide()}else{t.iframe.hide()}function c(){var s=_iframeDoc(t.iframe);s.open();if(o){s.domain=document.domain}s.write(_getInitHtml(n,i,r,a));s.close();t.win=t.iframe[0].contentWindow;t.doc=s;var l=_cmd(s);t.afterChange(function(e){l.selection()});if(_WEBKIT){K(s).click(function(e){if(K(e.target).name==="img"){l.selection(true);l.range.selectNode(e.target);l.select()}})}if(_IE){t._mousedownHandler=function(){var e=l.range.cloneRange();e.shrink();if(e.isControl()){t.blur()}};K(document).mousedown(t._mousedownHandler);K(s).keydown(function(e){if(e.which==8){l.selection();var t=l.range;if(t.isControl()){t.collapse(true);K(t.startContainer.childNodes[t.startOffset]).remove();e.preventDefault()}}})}t.cmd=l;t.html(_elementVal(t.srcElement));if(_IE){s.body.disabled=true;s.body.contentEditable=true;s.body.removeAttribute("disabled")}else{s.designMode="on"}if(e.afterCreate){e.afterCreate.call(t)}}if(o){t.iframe.bind("load",function(e){t.iframe.unbind("load");if(_IE){c()}else{setTimeout(c,0)}})}t.div.append(t.iframe);t.div.append(t.textarea);t.srcElement.hide();!o&&c()},setWidth:function(e){var t=this;e=_addUnit(e);t.width=e;t.div.css("width",e);return t},setHeight:function(e){var t=this;e=_addUnit(e);t.height=e;t.div.css("height",e);t.iframe.css("height",e);if(_IE&&_V<8||_QUIRKS){e=_addUnit(_removeUnit(e)-2)}t.textarea.css("height",e);return t},remove:function(){var e=this,t=e.doc;K(t.body).unbind();K(t).unbind();K(e.win).unbind();if(e._mousedownHandler){K(document).unbind("mousedown",e._mousedownHandler)}_elementVal(e.srcElement,e.html());e.srcElement.show();t.write("");e.iframe.unbind();e.textarea.unbind();KEdit.parent.remove.call(e)},html:function(e,t){var n=this,i=n.doc;if(n.designMode){var r=i.body;if(e===undefined){if(t){e="<!doctype html><html>"+r.parentNode.innerHTML+"</html>"}else{e=r.innerHTML}if(n.beforeGetHtml){e=n.beforeGetHtml(e)}if(_GECKO&&e=="<br />"){e=""}return e}if(n.beforeSetHtml){e=n.beforeSetHtml(e)}if(_IE&&_V>=9){e=e.replace(/(<.*?checked=")checked(".*>)/gi,"$1$2")}K(r).html(e);if(n.afterSetHtml){n.afterSetHtml()}return n}if(e===undefined){return n.textarea.val()}n.textarea.val(e);return n},design:function(e){var t=this,n;if(e===undefined?!t.designMode:e){if(!t.designMode){n=t.html();t.designMode=true;t.html(n);t.textarea.hide();t.iframe.show()}}else{if(t.designMode){
n=t.html();t.designMode=false;t.html(n);t.iframe.hide();t.textarea.show()}}return t.focus()},focus:function(){var e=this;e.designMode?e.win.focus():e.textarea[0].focus();return e},blur:function(){var e=this;if(_IE){var t=K('<input type="text" style="float:left;width:0;height:0;padding:0;margin:0;border:0;" value="" />',e.div);e.div.append(t);t[0].focus();t.remove()}else{e.designMode?e.win.blur():e.textarea[0].blur()}return e},afterChange:function(e){var t=this,n=t.doc,i=n.body;K(n).keyup(function(t){if(!t.ctrlKey&&!t.altKey&&_CHANGE_KEY_MAP[t.which]){e(t)}});K(n).mouseup(e).contextmenu(e);K(t.win).blur(e);function r(t){setTimeout(function(){e(t)},1)}K(i).bind("paste",r);K(i).bind("cut",r);return t}});function _edit(e){return new KEdit(e)}K.EditClass=KEdit;K.edit=_edit;K.iframeDoc=_iframeDoc;function _selectToolbar(e,t){var n=this,i=n.get(e);if(i){if(i.hasClass("ke-disabled")){return}t(i)}}function KToolbar(e){this.init(e)}_extend(KToolbar,KWidget,{init:function(e){var t=this;KToolbar.parent.init.call(t,e);t.disableMode=_undef(e.disableMode,false);t.noDisableItemMap=_toMap(_undef(e.noDisableItems,[]));t._itemMap={};t.div.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()}).attr("unselectable","on");function n(e){var t=K(e);if(t.hasClass("ke-outline")){return t}if(t.hasClass("ke-toolbar-icon")){return t.parent()}}function i(e,t){var i=n(e.target);if(i){if(i.hasClass("ke-disabled")){return}if(i.hasClass("ke-selected")){return}i[t]("ke-on")}}t.div.mouseover(function(e){i(e,"addClass")}).mouseout(function(e){i(e,"removeClass")}).click(function(e){var i=n(e.target);if(i){if(i.hasClass("ke-disabled")){return}t.options.click.call(this,e,i.attr("data-name"))}})},get:function(e){if(this._itemMap[e]){return this._itemMap[e]}return this._itemMap[e]=K("span.ke-icon-"+e,this.div).parent()},select:function(e){_selectToolbar.call(this,e,function(e){e.addClass("ke-selected")});return self},unselect:function(e){_selectToolbar.call(this,e,function(e){e.removeClass("ke-selected").removeClass("ke-on")});return self},enable:function(e){var t=this,n=e.get?e:t.get(e);if(n){n.removeClass("ke-disabled");n.opacity(1)}return t},disable:function(e){var t=this,n=e.get?e:t.get(e);if(n){n.removeClass("ke-selected").addClass("ke-disabled");n.opacity(.5)}return t},disableAll:function(e,t){var n=this,i=n.noDisableItemMap,r;if(t){i=_toMap(t)}if(e===undefined?!n.disableMode:e){K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);if(!i[t]){n.disable(e)}});n.disableMode=true}else{K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);if(!i[t]){n.enable(e)}});n.disableMode=false}return n}});function _toolbar(e){return new KToolbar(e)}K.ToolbarClass=KToolbar;K.toolbar=_toolbar;function KMenu(e){this.init(e)}_extend(KMenu,KWidget,{init:function(e){var t=this;e.z=e.z||811213;KMenu.parent.init.call(t,e);t.centerLineMode=_undef(e.centerLineMode,true);t.div.addClass("ke-menu").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on")},addItem:function(e){var t=this;if(e.title==="-"){t.div.append(K('<div class="ke-menu-separator"></div>'));return}var n=K('<div class="ke-menu-item" unselectable="on"></div>'),i=K('<div class="ke-inline-block ke-menu-item-left"></div>'),r=K('<div class="ke-inline-block ke-menu-item-right"></div>'),a=_addUnit(e.height),o=_undef(e.iconClass,"");t.div.append(n);if(a){n.css("height",a);r.css("line-height",a)}var s;if(t.centerLineMode){s=K('<div class="ke-inline-block ke-menu-item-center"></div>');if(a){s.css("height",a)}}n.mouseover(function(e){K(this).addClass("ke-menu-item-on");if(s){s.addClass("ke-menu-item-center-on")}}).mouseout(function(e){K(this).removeClass("ke-menu-item-on");if(s){s.removeClass("ke-menu-item-center-on")}}).click(function(t){e.click.call(K(this));t.stopPropagation()}).append(i);if(s){n.append(s)}n.append(r);if(e.checked){o="ke-icon-checked"}if(o!==""){i.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+o+'"></span>')}r.html(e.title);return t},remove:function(){var e=this;if(e.options.beforeRemove){e.options.beforeRemove.call(e)}K(".ke-menu-item",e.div[0]).unbind();KMenu.parent.remove.call(e);return e}});function _menu(e){return new KMenu(e)}K.MenuClass=KMenu;K.menu=_menu;function KColorPicker(e){this.init(e)}_extend(KColorPicker,KWidget,{init:function(e){var t=this;e.z=e.z||811213;KColorPicker.parent.init.call(t,e);var n=e.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]];t.selectedColor=(e.selectedColor||"").toLowerCase();t._cells=[];t.div.addClass("ke-colorpicker").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on");var i=t.doc.createElement("table");t.div.append(i);i.className="ke-colorpicker-table";i.cellPadding=0;i.cellSpacing=0;i.border=0;var r=i.insertRow(0),a=r.insertCell(0);a.colSpan=n[0].length;t._addAttr(a,"","ke-colorpicker-cell-top");for(var o=0;o<n.length;o++){r=i.insertRow(o+1);for(var s=0;s<n[o].length;s++){a=r.insertCell(s);t._addAttr(a,n[o][s],"ke-colorpicker-cell")}}},_addAttr:function(e,t,n){var i=this;e=K(e).addClass(n);if(i.selectedColor===t.toLowerCase()){e.addClass("ke-colorpicker-cell-selected")}e.attr("title",t||i.options.noColor);e.mouseover(function(e){K(this).addClass("ke-colorpicker-cell-on")});e.mouseout(function(e){K(this).removeClass("ke-colorpicker-cell-on")});e.click(function(e){e.stop();i.options.click.call(K(this),t)});if(t){e.append(K('<div class="ke-colorpicker-cell-color" unselectable="on"></div>').css("background-color",t))}else{e.html(i.options.noColor)}K(e).attr("unselectable","on");i._cells.push(e)},remove:function(){var e=this;_each(e._cells,function(){this.unbind()});KColorPicker.parent.remove.call(e);return e}});function _colorpicker(e){return new KColorPicker(e)}K.ColorPickerClass=KColorPicker;K.colorpicker=_colorpicker;function KUploadButton(e){this.init(e)}_extend(KUploadButton,{init:function(e){var t=this,n=K(e.button),i=e.fieldName||"file",r=e.url||"",a=n.val(),o=e.extraParams||{},s=n[0].className||"",l=e.target||"kindeditor_upload_iframe_"+(new Date).getTime();e.afterError=e.afterError||function(e){alert(e)};var c=[];for(var d in o){c.push('<input type="hidden" name="'+d+'" value="'+o[d]+'" />')}var u=['<div class="ke-inline-block '+s+'">',e.target?"":'<iframe name="'+l+'" style="display:none;"></iframe>',e.form?'<div class="ke-upload-area">':'<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+l+'" action="'+r+'">','<span class="ke-button-common">',c.join(""),'<input type="button" class="ke-button-common ke-button" value="'+a+'" />',"</span>",'<input type="file" class="ke-upload-file" name="'+i+'" tabindex="-1" />',e.form?"</div>":"</form>","</div>"].join("");var f=K(u,n.doc);n.hide();n.before(f);t.div=f;t.button=n;t.iframe=e.target?K('iframe[name="'+l+'"]'):K("iframe",f);t.form=e.form?K(e.form):K("form",f);t.fileBox=K(".ke-upload-file",f);var h=e.width||K(".ke-button-common",f).width();K(".ke-upload-area",f).width(h);t.options=e},submit:function(){var e=this,t=e.iframe;t.bind("load",function(){t.unbind();var n=document.createElement("form");e.fileBox.before(n);K(n).append(e.fileBox);n.reset();K(n).remove(true);var i=K.iframeDoc(t),r=i.getElementsByTagName("pre")[0],a="",o;if(r){a=r.innerHTML}else{a=i.body.innerHTML}a=_unescape(a);t[0].src="javascript:false";try{o=K.json(a)}catch(t){e.options.afterError.call(e,"<!doctype html><html>"+i.body.parentNode.innerHTML+"</html>")}if(o){e.options.afterUpload.call(e,o)}});e.form[0].submit();return e},remove:function(){var e=this;if(e.fileBox){e.fileBox.unbind()}e.iframe.remove();e.div.remove();e.button.show();return e}});function _uploadbutton(e){return new KUploadButton(e)}K.UploadButtonClass=KUploadButton;K.uploadbutton=_uploadbutton;function _createButton(e){e=e||{};var t=e.name||"",n=K('<span class="ke-button-common ke-button-outer" title="'+t+'"></span>'),i=K('<input class="ke-button-common ke-button" type="button" value="'+t+'" />');if(e.click){i.click(e.click)}n.append(i);return n}function KDialog(e){this.init(e)}_extend(KDialog,KWidget,{init:function(e){var t=this;var n=_undef(e.shadowMode,true);e.z=e.z||811213;e.shadowMode=false;e.autoScroll=_undef(e.autoScroll,true);KDialog.parent.init.call(t,e);var i=e.title,r=K(e.body,t.doc),a=e.previewBtn,o=e.yesBtn,s=e.noBtn,l=e.closeBtn,c=_undef(e.showMask,true);t.div.addClass("ke-dialog").bind("click,mousedown",function(e){e.stopPropagation()});var d=K('<div class="ke-dialog-content"></div>').appendTo(t.div);if(_IE&&_V<7){t.iframeMask=K('<iframe src="about:blank" class="ke-dialog-shadow"></iframe>').appendTo(t.div)}else if(n){K('<div class="ke-dialog-shadow"></div>').appendTo(t.div)}var u=K('<div class="ke-dialog-header"></div>');d.append(u);u.html(i);t.closeIcon=K('<span class="ke-dialog-icon-close" title="'+l.name+'"></span>').click(l.click);u.append(t.closeIcon);t.draggable({clickEl:u,beforeDrag:e.beforeDrag});var f=K('<div class="ke-dialog-body"></div>');d.append(f);f.append(r);var h=K('<div class="ke-dialog-footer"></div>');if(a||o||s){d.append(h)}_each([{btn:a,name:"preview"},{btn:o,name:"yes"},{btn:s,name:"no"}],function(){if(this.btn){var e=_createButton(this.btn);e.addClass("ke-dialog-"+this.name);h.append(e)}});if(t.height){f.height(_removeUnit(t.height)-u.height()-h.height())}t.div.width(t.div.width());t.div.height(t.div.height());t.mask=null;if(c){var m=_docElement(t.doc),p=Math.max(m.scrollWidth,m.clientWidth),_=Math.max(m.scrollHeight,m.clientHeight);t.mask=_widget({x:0,y:0,z:t.z-1,cls:"ke-dialog-mask",width:p,height:_})}t.autoPos(t.div.width(),t.div.height());t.footerDiv=h;t.bodyDiv=f;t.headerDiv=u;t.isLoading=false},setMaskIndex:function(e){var t=this;t.mask.div.css("z-index",e)},showLoading:function(e){e=_undef(e,"");var t=this,n=t.bodyDiv;t.loading=K('<div class="ke-dialog-loading"><div class="ke-inline-block ke-dialog-loading-content" style="margin-top:'+Math.round(n.height()/3)+'px;">'+e+"</div></div>").width(n.width()).height(n.height()).css("top",t.headerDiv.height()+"px");n.css("visibility","hidden").after(t.loading);t.isLoading=true;return t},hideLoading:function(){this.loading&&this.loading.remove();this.bodyDiv.css("visibility","visible");this.isLoading=false;return this},remove:function(){var e=this;if(e.options.beforeRemove){e.options.beforeRemove.call(e)}e.mask&&e.mask.remove();e.iframeMask&&e.iframeMask.remove();e.closeIcon.unbind();K("input",e.div).unbind();K("button",e.div).unbind();e.footerDiv.unbind();e.bodyDiv.unbind();e.headerDiv.unbind();K("iframe",e.div).each(function(){K(this).remove()});KDialog.parent.remove.call(e);return e}});function _dialog(e){return new KDialog(e)}K.DialogClass=KDialog;K.dialog=_dialog;function _tabs(e){var t=_widget(e),n=t.remove,i=e.afterSelect,r=t.div,a=[];r.addClass("ke-tabs").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()});var o=K('<ul class="ke-tabs-ul ke-clearfix"></ul>');r.append(o);t.add=function(e){var t=K('<li class="ke-tabs-li">'+e.title+"</li>");t.data("tab",e);a.push(t);o.append(t)};t.selectedIndex=0;t.select=function(e){t.selectedIndex=e;_each(a,function(n,i){i.unbind();if(n===e){i.addClass("ke-tabs-li-selected");K(i.data("tab").panel).show("")}else{i.removeClass("ke-tabs-li-selected").removeClass("ke-tabs-li-on").mouseover(function(){K(this).addClass("ke-tabs-li-on")}).mouseout(function(){K(this).removeClass("ke-tabs-li-on")}).click(function(){t.select(n)});K(i.data("tab").panel).hide()}});if(i){i.call(t,e)}};t.remove=function(){_each(a,function(){this.remove()});o.remove();n.call(t)};return t}K.tabs=_tabs;function _loadScript(e,t){var n=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),i=document.createElement("script");n.appendChild(i);i.src=e;i.charset="utf-8";i.onload=i.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"){if(t){t()}i.onload=i.onreadystatechange=null;n.removeChild(i)}}}function _chopQuery(e){var t=e.indexOf("?");return t>0?e.substr(0,t):e}function _loadStyle(e){var t=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),n=document.createElement("link"),i=_chopQuery(_formatUrl(e,"absolute"));var r=K('link[rel="stylesheet"]',t);for(var a=0,o=r.length;a<o;a++){if(_chopQuery(_formatUrl(r[a].href,"absolute"))===i){return}}t.appendChild(n);n.href=e;n.rel="stylesheet"}function _ajax(e,t,n,i,r){n=n||"GET";r=r||"json";var a=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open(n,e,true);a.onreadystatechange=function(){if(a.readyState==4&&a.status==200){if(t){var e=_trim(a.responseText);if(r=="json"){e=_json(e)}t(e)}}};if(n=="POST"){var o=[];_each(i,function(e,t){o.push(encodeURIComponent(e)+"="+encodeURIComponent(t))});try{a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(e){}a.send(o.join("&"))}else{a.send(null)}}K.loadScript=_loadScript;K.loadStyle=_loadStyle;K.ajax=_ajax;var _plugins={};function _plugin(e,t){if(e===undefined){return _plugins}if(!t){return _plugins[e]}_plugins[e]=t}var _language={};function _parseLangKey(e){var t,n="core";if(t=/^(\w+)\.(\w+)$/.exec(e)){n=t[1];e=t[2]}return{ns:n,key:e}}function _lang(e,t){t=t===undefined?K.options.langType:t;if(typeof e==="string"){if(!_language[t]){return"no language"}var n=e.length-1;if(e.substr(n)==="."){return _language[t][e.substr(0,n)]}var i=_parseLangKey(e);return _language[t][i.ns][i.key]}_each(e,function(e,n){var i=_parseLangKey(e);if(!_language[t]){_language[t]={}}if(!_language[t][i.ns]){_language[t][i.ns]={}}_language[t][i.ns][i.key]=n})}function _getImageFromRange(e,t){if(e.collapsed){return}e=e.cloneRange().up();var n=e.startContainer,i=e.startOffset;if(!_WEBKIT&&!e.isControl()){return}var r=K(n.childNodes[i]);if(!r||r.name!="img"){return}if(t(r)){return r}}function _bindContextmenuEvent(){var e=this,t=e.edit.doc;K(t).contextmenu(function(t){if(e.menu){e.hideMenu()}if(!e.useContextmenu){t.preventDefault();return}if(e._contextmenus.length===0){return}var n=0,i=[];_each(e._contextmenus,function(){if(this.title=="-"){i.push(this);return}if(this.cond&&this.cond()){i.push(this);if(this.width&&this.width>n){n=this.width}}});while(i.length>0&&i[0].title=="-"){i.shift()}while(i.length>0&&i[i.length-1].title=="-"){i.pop()}var r=null;_each(i,function(e){if(this.title=="-"&&r.title=="-"){delete i[e]}r=this});if(i.length>0){t.preventDefault();var a=K(e.edit.iframe).pos(),o=_menu({x:a.x+t.clientX,y:a.y+t.clientY,width:n,css:{visibility:"hidden"},shadowMode:e.shadowMode});_each(i,function(){if(this.title){o.addItem(this)}});var s=_docElement(o.doc),l=o.div.height();if(t.clientY+l>=s.clientHeight-100){o.pos(o.x,_removeUnit(o.y)-l)}o.div.css("visibility","visible");e.menu=o}})}function _bindNewlineEvent(){var e=this,t=e.edit.doc,n=e.newlineTag;if(_IE&&n!=="br"){return}if(_GECKO&&_V<3&&n!=="p"){return}if(_OPERA&&_V<9){return}var i=_toMap("h1,h2,h3,h4,h5,h6,pre,li"),r=_toMap("p,h1,h2,h3,h4,h5,h6,pre,li,blockquote");function a(e){var t=K(e.commonAncestor());while(t){if(t.type==1&&!t.isStyle()){break}t=t.parent()}return t.name}K(t).keydown(function(o){if(o.which!=13||o.shiftKey||o.ctrlKey||o.altKey){return}e.cmd.selection();var s=a(e.cmd.range);if(s=="marquee"||s=="select"){return}if(n==="br"&&!i[s]){o.preventDefault();e.insertHtml("<br />"+(_IE&&_V<9?"":"​"));return}if(!r[s]){_nativeCommand(t,"formatblock","<p>")}});K(t).keyup(function(i){if(i.which!=13||i.shiftKey||i.ctrlKey||i.altKey){return}if(n=="br"){return}if(_GECKO){var o=e.cmd.commonAncestor("p");var s=e.cmd.commonAncestor("a");if(s&&s.text()==""){s.remove(true);e.cmd.range.selectNodeContents(o[0]).collapse(true);e.cmd.select()}return}e.cmd.selection();var l=a(e.cmd.range);if(l=="marquee"||l=="select"){return}if(!r[l]){_nativeCommand(t,"formatblock","<p>")}var c=e.cmd.commonAncestor("div");if(c){var d=K("<p></p>"),u=c[0].firstChild;while(u){var f=u.nextSibling;d.append(u);u=f}c.before(d);c.remove();e.cmd.range.selectNodeContents(d[0]);e.cmd.select()}})}function _bindTabEvent(){var e=this,t=e.edit.doc;K(t).keydown(function(n){if(n.which==9){n.preventDefault();if(e.afterTab){e.afterTab.call(e,n);return}var i=e.cmd,r=i.range;r.shrink();if(r.collapsed&&r.startContainer.nodeType==1){r.insertNode(K("@&nbsp;",t)[0]);i.select()}e.insertHtml("&nbsp;&nbsp;&nbsp;&nbsp;")}})}function _bindFocusEvent(){var e=this;K(e.edit.textarea[0],e.edit.win).focus(function(t){if(e.afterFocus){e.afterFocus.call(e,t)}}).blur(function(t){if(e.afterBlur){e.afterBlur.call(e,t)}})}function _removeBookmarkTag(e){return _trim(e.replace(/<span [^>]*id="?__kindeditor_bookmark_\w+_\d+__"?[^>]*><\/span>/gi,""))}function _removeTempTag(e){return e.replace(/<div[^>]+class="?__kindeditor_paste__"?[^>]*>[\s\S]*?<\/div>/gi,"")}function _addBookmarkToStack(e,t){if(e.length===0){e.push(t);return}var n=e[e.length-1];if(_removeBookmarkTag(t.html)!==_removeBookmarkTag(n.html)){e.push(t)}}function _undoToRedo(e,t){var n=this,i=n.edit,r=i.doc.body,a,o;if(e.length===0){return n}if(i.designMode){a=n.cmd.range;o=a.createBookmark(true);o.html=r.innerHTML}else{o={html:r.innerHTML}}_addBookmarkToStack(t,o);var s=e.pop();if(_removeBookmarkTag(o.html)===_removeBookmarkTag(s.html)&&e.length>0){s=e.pop()}if(i.designMode){i.html(s.html);if(s.start){a.moveToBookmark(s);n.select()}}else{K(r).html(_removeBookmarkTag(s.html))}return n}function KEditor(e){var t=this;t.options={};function n(e,n){if(KEditor.prototype[e]===undefined){t[e]=n}t.options[e]=n}_each(e,function(t,i){n(t,e[t])});_each(K.options,function(e,i){if(t[e]===undefined){n(e,i)}});var i=K(t.srcElement||"<textarea/>");if(!t.width){t.width=i[0].style.width||i.width()}if(!t.height){t.height=i[0].style.height||i.height()}n("width",_undef(t.width,t.minWidth));n("height",_undef(t.height,t.minHeight));n("width",_addUnit(t.width));n("height",_addUnit(t.height));if(_MOBILE&&(!_IOS||_V<534)){t.designMode=false}t.srcElement=i;t.initContent="";t.plugin={};t.isCreated=false;t._handlers={};t._contextmenus=[];t._undoStack=[];t._redoStack=[];t._firstAddBookmark=true;t.menu=t.contextmenu=null;t.dialogs=[]}KEditor.prototype={lang:function(e){return _lang(e,this.langType)},loadPlugin:function(e,t){var n=this;if(_plugins[e]){if(!_isFunction(_plugins[e])){setTimeout(function(){n.loadPlugin(e,t)},100);return n}_plugins[e].call(n,KindEditor);if(t){t.call(n)}return n}_plugins[e]="loading";_loadScript(n.pluginsPath+e+"/"+e+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){setTimeout(function(){if(_plugins[e]){n.loadPlugin(e,t)}},0)});return n},handler:function(e,t){var n=this;if(!n._handlers[e]){n._handlers[e]=[]}if(_isFunction(t)){n._handlers[e].push(t);return n}_each(n._handlers[e],function(){t=this.call(n,t)});return t},clickToolbar:function(e,t){var n=this,i="clickToolbar"+e;if(t===undefined){if(n._handlers[i]){return n.handler(i)}n.loadPlugin(e,function(){n.handler(i)});return n}return n.handler(i,t)},updateState:function(){var e=this;_each(("justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,"+"subscript,superscript,bold,italic,underline,strikethrough").split(","),function(t,n){e.cmd.state(n)?e.toolbar.select(n):e.toolbar.unselect(n)});return e},addContextmenu:function(e){this._contextmenus.push(e);return this},afterCreate:function(e){return this.handler("afterCreate",e)},beforeRemove:function(e){return this.handler("beforeRemove",e)},beforeGetHtml:function(e){return this.handler("beforeGetHtml",e)},beforeSetHtml:function(e){return this.handler("beforeSetHtml",e)},afterSetHtml:function(e){return this.handler("afterSetHtml",e)},create:function(){var e=this,t=e.fullscreenMode;if(e.isCreated){return e}if(e.srcElement.data("kindeditor")){return e}e.srcElement.data("kindeditor","true");if(t){_docElement().style.overflow="hidden"}else{_docElement().style.overflow=""}var n=t?_docElement().clientWidth+"px":e.width,i=t?_docElement().clientHeight+"px":e.height;if(_IE&&_V<8||_QUIRKS){i=_addUnit(_removeUnit(i)+2)}var r=e.container=K(e.layout);if(t){K(document.body).append(r)}else{e.srcElement.before(r)}var a=K(".toolbar",r),o=K(".edit",r),s=e.statusbar=K(".statusbar",r);r.removeClass("container").addClass("ke-container ke-container-"+e.themeType).css("width",n);if(t){r.css({position:"absolute",left:0,top:0,"z-index":811211});if(!_GECKO){e._scrollPos=_getScrollPos()}window.scrollTo(0,0);K(document.body).css({height:"1px",overflow:"hidden"});K(document.body.parentNode).css("overflow","hidden");e._fullscreenExecuted=true}else{if(e._fullscreenExecuted){K(document.body).css({height:"",overflow:""});K(document.body.parentNode).css("overflow","")}if(e._scrollPos){window.scrollTo(e._scrollPos.x,e._scrollPos.y)}}var l=[];K.each(e.items,function(t,n){if(n=="|"){l.push('<span class="ke-inline-block ke-separator"></span>')}else if(n=="/"){l.push('<div class="ke-hr"></div>')}else{l.push('<span class="ke-outline" data-name="'+n+'" title="'+e.lang(n)+'" unselectable="on">');l.push('<span class="ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+n+'" unselectable="on"></span></span>')}});var c=e.toolbar=_toolbar({src:a,html:l.join(""),noDisableItems:e.noDisableItems,click:function(t,n){t.stop();if(e.menu){var i=e.menu.name;e.hideMenu();if(i===n){return}}e.clickToolbar(n)}});var d=_removeUnit(i)-c.div.height();var u=e.edit=_edit({height:d>0&&_removeUnit(i)>e.minHeight?d:e.minHeight,src:o,srcElement:e.srcElement,designMode:e.designMode,themesPath:e.themesPath,bodyClass:e.bodyClass,cssPath:e.cssPath,cssData:e.cssData,beforeGetHtml:function(t){t=e.beforeGetHtml(t);t=_removeBookmarkTag(_removeTempTag(t));return _formatHtml(t,e.filterMode?e.htmlTags:null,e.urlType,e.wellFormatMode,e.indentChar)},beforeSetHtml:function(t){t=_formatHtml(t,e.filterMode?e.htmlTags:null,"",false);return e.beforeSetHtml(t)},afterSetHtml:function(){e.edit=u=this;e.afterSetHtml()},afterCreate:function(){e.edit=u=this;e.cmd=u.cmd;e._docMousedownFn=function(t){if(e.menu){e.hideMenu()}};K(u.doc,document).mousedown(e._docMousedownFn);_bindContextmenuEvent.call(e);_bindNewlineEvent.call(e);_bindTabEvent.call(e);_bindFocusEvent.call(e);u.afterChange(function(t){if(!u.designMode){return}e.updateState();e.addBookmark();if(e.options.afterChange){e.options.afterChange.call(e)}});u.textarea.keyup(function(t){if(!t.ctrlKey&&!t.altKey&&_INPUT_KEY_MAP[t.which]){if(e.options.afterChange){e.options.afterChange.call(e)}}});if(e.readonlyMode){e.readonly()}e.isCreated=true;if(e.initContent===""){e.initContent=e.html()}if(e._undoStack.length>0){var t=e._undoStack.pop();if(t.start){e.html(t.html);u.cmd.range.moveToBookmark(t);e.select()}}e.afterCreate();if(e.options.afterCreate){e.options.afterCreate.call(e)}}});s.removeClass("statusbar").addClass("ke-statusbar").append('<span class="ke-inline-block ke-statusbar-center-icon"></span>').append('<span class="ke-inline-block ke-statusbar-right-icon"></span>');if(e._fullscreenResizeHandler){K(window).unbind("resize",e._fullscreenResizeHandler);e._fullscreenResizeHandler=null}function f(){if(s.height()===0){setTimeout(f,100);return}e.resize(n,i,false)}f();if(t){e._fullscreenResizeHandler=function(t){if(e.isCreated){e.resize(_docElement().clientWidth,_docElement().clientHeight,false)}};K(window).bind("resize",e._fullscreenResizeHandler);c.select("fullscreen");s.first().css("visibility","hidden");s.last().css("visibility","hidden")}else{if(_GECKO){K(window).bind("scroll",function(t){e._scrollPos=_getScrollPos()})}if(e.resizeType>0){_drag({moveEl:r,clickEl:s,moveFn:function(t,n,i,r,a,o){r+=o;e.resize(null,r)}})}else{s.first().css("visibility","hidden")}if(e.resizeType===2){_drag({moveEl:r,clickEl:s.last(),moveFn:function(t,n,i,r,a,o){i+=a;r+=o;e.resize(i,r)}})}else{s.last().css("visibility","hidden")}}return e},remove:function(){var e=this;if(!e.isCreated){return e}e.beforeRemove();e.srcElement.data("kindeditor","");if(e.menu){e.hideMenu()}_each(e.dialogs,function(){e.hideDialog()});K(document).unbind("mousedown",e._docMousedownFn);e.toolbar.remove();e.edit.remove();e.statusbar.last().unbind();e.statusbar.unbind();e.container.remove();e.container=e.toolbar=e.edit=e.menu=null;e.dialogs=[];e.isCreated=false;return e},resize:function(e,t,n){var i=this;n=_undef(n,true);if(e){if(!/%/.test(e)){e=_removeUnit(e);e=e<i.minWidth?i.minWidth:e}i.container.css("width",_addUnit(e));if(n){i.width=_addUnit(e)}}if(t){t=_removeUnit(t);editHeight=_removeUnit(t)-i.toolbar.div.height()-i.statusbar.height();editHeight=editHeight<i.minHeight?i.minHeight:editHeight;i.edit.setHeight(editHeight);if(n){i.height=_addUnit(t)}}return i},select:function(){this.isCreated&&this.cmd.select();return this},html:function(e){var t=this;if(e===undefined){return t.isCreated?t.edit.html():_elementVal(t.srcElement)}t.isCreated?t.edit.html(e):_elementVal(t.srcElement,e);if(t.isCreated){t.cmd.selection()}return t},fullHtml:function(){return this.isCreated?this.edit.html(undefined,true):""},text:function(e){var t=this;if(e===undefined){return _trim(t.html().replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," "))}else{return t.html(_escape(e))}},isEmpty:function(){return _trim(this.text().replace(/\r\n|\n|\r/,""))===""},isDirty:function(){return _trim(this.initContent.replace(/\r\n|\n|\r|t/g,""))!==_trim(this.html().replace(/\r\n|\n|\r|t/g,""))},selectedHtml:function(){var e=this.isCreated?this.cmd.range.html():"";e=_removeBookmarkTag(_removeTempTag(e));return e},count:function(e){var t=this;e=(e||"html").toLowerCase();if(e==="html"){return t.html().length}if(e==="text"){return t.text().replace(/<(?:img|embed).*?>/gi,"K").replace(/\r\n|\n|\r/g,"").length}return 0},exec:function(e){e=e.toLowerCase();var t=this,n=t.cmd,i=_inArray(e,"selectall,copy,paste,print".split(","))<0;if(i){t.addBookmark(false)}n[e].apply(n,_toArray(arguments,1));if(i){t.updateState();t.addBookmark(false);if(t.options.afterChange){t.options.afterChange.call(t)}}return t},insertHtml:function(e,t){if(!this.isCreated){return this}e=this.beforeSetHtml(e);this.exec("inserthtml",e,t);return this},appendHtml:function(e){this.html(this.html()+e);if(this.isCreated){var t=this.cmd;t.range.selectNodeContents(t.doc.body).collapse(false);t.select()}return this},sync:function(){_elementVal(this.srcElement,this.html());return this},focus:function(){this.isCreated?this.edit.focus():this.srcElement[0].focus();return this},blur:function(){this.isCreated?this.edit.blur():this.srcElement[0].blur();return this},addBookmark:function(e){e=_undef(e,true);var t=this,n=t.edit,i=n.doc.body,r=_removeTempTag(i.innerHTML),a;if(e&&t._undoStack.length>0){var o=t._undoStack[t._undoStack.length-1];if(Math.abs(r.length-_removeBookmarkTag(o.html).length)<t.minChangeSize){return t}}if(n.designMode&&!t._firstAddBookmark){var s=t.cmd.range;a=s.createBookmark(true);a.html=_removeTempTag(i.innerHTML);s.moveToBookmark(a)}else{a={html:r}}t._firstAddBookmark=false;_addBookmarkToStack(t._undoStack,a);return t},undo:function(){return _undoToRedo.call(this,this._undoStack,this._redoStack)},redo:function(){return _undoToRedo.call(this,this._redoStack,this._undoStack)},fullscreen:function(e){this.fullscreenMode=e===undefined?!this.fullscreenMode:e;this.addBookmark(false);return this.remove().create()},readonly:function(e){e=_undef(e,true);var t=this,n=t.edit,i=n.doc;if(t.designMode){t.toolbar.disableAll(e,[])}else{_each(t.noDisableItems,function(){t.toolbar[e?"disable":"enable"](this)})}if(_IE){i.body.contentEditable=!e}else{i.designMode=e?"off":"on"}n.textarea[0].disabled=e},createMenu:function(e){var t=this,n=e.name,i=t.toolbar.get(n),r=i.pos();e.x=r.x;e.y=r.y+i.height();e.z=t.options.zIndex;e.shadowMode=_undef(e.shadowMode,t.shadowMode);if(e.selectedColor!==undefined){e.cls="ke-colorpicker-"+t.themeType;e.noColor=t.lang("noColor");t.menu=_colorpicker(e)}else{e.cls="ke-menu-"+t.themeType;e.centerLineMode=false;t.menu=_menu(e)}return t.menu},hideMenu:function(){this.menu.remove();this.menu=null;return this},hideContextmenu:function(){this.contextmenu.remove();this.contextmenu=null;return this},createDialog:function(e){var t=this,n=e.name;e.z=t.options.zIndex;e.shadowMode=_undef(e.shadowMode,t.shadowMode);e.closeBtn=_undef(e.closeBtn,{name:t.lang("close"),click:function(e){t.hideDialog();if(_IE&&t.cmd){t.cmd.select()}}});e.noBtn=_undef(e.noBtn,{name:t.lang(e.yesBtn?"no":"close"),click:function(e){t.hideDialog();if(_IE&&t.cmd){t.cmd.select()}}});if(t.dialogAlignType!="page"){e.alignEl=t.container}e.cls="ke-dialog-"+t.themeType;if(t.dialogs.length>0){var i=t.dialogs[0],r=t.dialogs[t.dialogs.length-1];i.setMaskIndex(r.z+2);e.z=r.z+3;e.showMask=false}var a=_dialog(e);t.dialogs.push(a);return a},hideDialog:function(){var e=this;if(e.dialogs.length>0){e.dialogs.pop().remove()}if(e.dialogs.length>0){var t=e.dialogs[0],n=e.dialogs[e.dialogs.length-1];t.setMaskIndex(n.z-1)}return e},errorDialog:function(e){var t=this;var n=t.createDialog({width:750,title:t.lang("uploadError"),body:'<div style="padding:10px 20px;"><iframe frameborder="0" style="width:708px;height:400px;"></iframe></div>'});var i=K("iframe",n.div),r=K.iframeDoc(i);r.open();r.write(e);r.close();K(r.body).css("background-color","#FFF");i[0].contentWindow.focus();return t}};function _editor(e){return new KEditor(e)}_instances=[];function _create(e,t){t=t||{};t.basePath=_undef(t.basePath,K.basePath);t.themesPath=_undef(t.themesPath,t.basePath+"themes/");t.langPath=_undef(t.langPath,t.basePath+"lang/");t.pluginsPath=_undef(t.pluginsPath,t.basePath+"plugins/");if(_undef(t.loadStyleMode,K.options.loadStyleMode)){var n=_undef(t.themeType,K.options.themeType);_loadStyle(t.themesPath+"default/default.css");_loadStyle(t.themesPath+n+"/"+n+".css")}function i(e){_each(_plugins,function(t,n){if(_isFunction(n)){n.call(e,KindEditor)}});return e.create()}var r=K(e);if(!r||r.length===0){return}if(r.length>1){r.each(function(){_create(this,t)});return _instances[0]}t.srcElement=r[0];var a=new KEditor(t);_instances.push(a);if(_language[a.langType]){return i(a)}_loadScript(a.langPath+a.langType+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){i(a)});return a}function _eachEditor(e,t){K(e).each(function(e,n){K.each(_instances,function(e,i){if(i&&i.srcElement[0]==n){t.call(i,e);return false}})})}K.remove=function(e){_eachEditor(e,function(e){this.remove();_instances.splice(e,1)})};K.sync=function(e){_eachEditor(e,function(){this.sync()})};K.html=function(e,t){_eachEditor(e,function(){this.html(t)})};K.insertHtml=function(e,t){_eachEditor(e,function(){this.insertHtml(t)})};K.appendHtml=function(e,t){_eachEditor(e,function(){this.appendHtml(t)})};if(_IE&&_V<7){_nativeCommand(document,"BackgroundImageCache",true)}K.EditorClass=KEditor;K.editor=_editor;K.create=_create;K.instances=_instances;K.plugin=_plugin;K.lang=_lang;_plugin("core",function(e){var t=this,n={undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",print:"P",selectall:"A"};t.afterSetHtml(function(){if(t.options.afterChange){t.options.afterChange.call(t)}});t.afterCreate(function(){if(t.syncType!="form"){return}var n=e(t.srcElement),i=false;while(n=n.parent()){if(n.name=="form"){i=true;break}}if(i){n.bind("submit",function(n){t.sync();e(window).bind("unload",function(){t.edit.textarea.remove()})});var r=e('[type="reset"]',n);r.click(function(){t.html(t.initContent);t.cmd.selection()});t.beforeRemove(function(){n.unbind();r.unbind()})}});t.clickToolbar("source",function(){if(t.edit.designMode){t.toolbar.disableAll(true);t.edit.design(false);t.toolbar.select("source")}else{t.toolbar.disableAll(false);t.edit.design(true);t.toolbar.unselect("source");if(_GECKO){setTimeout(function(){t.cmd.selection()},0)}else{t.cmd.selection()}}t.designMode=t.edit.designMode});t.afterCreate(function(){if(!t.designMode){t.toolbar.disableAll(true).select("source")}});t.clickToolbar("fullscreen",function(){t.fullscreen()});if(t.fullscreenShortcut){var i=false;
t.afterCreate(function(){e(t.edit.doc,t.edit.textarea).keyup(function(e){if(e.which==27){setTimeout(function(){t.fullscreen()},0)}});if(i){if(_IE&&!t.designMode){return}t.focus()}if(!i){i=true}})}_each("undo,redo".split(","),function(e,i){if(n[i]){t.afterCreate(function(){_ctrl(this.edit.doc,n[i],function(){t.clickToolbar(i)})})}t.clickToolbar(i,function(){t[i]()})});t.clickToolbar("formatblock",function(){var e=t.lang("formatblock.formatBlock"),n={h1:28,h2:24,h3:18,H4:14,p:12},i=t.cmd.val("formatblock"),r=t.createMenu({name:"formatblock",width:t.langType=="en"?200:150});_each(e,function(e,a){var o="font-size:"+n[e]+"px;";if(e.charAt(0)==="h"){o+="font-weight:bold;"}r.addItem({title:'<span style="'+o+'" unselectable="on">'+a+"</span>",height:n[e]+12,checked:i===e||i===a,click:function(){t.select().exec("formatblock","<"+e+">").hideMenu()}})})});t.clickToolbar("fontname",function(){var e=t.cmd.val("fontname"),n=t.createMenu({name:"fontname",width:150});_each(t.lang("fontname.fontName"),function(i,r){n.addItem({title:'<span style="font-family: '+i+';" unselectable="on">'+r+"</span>",checked:e===i.toLowerCase()||e===r.toLowerCase(),click:function(){t.exec("fontname",i).hideMenu()}})})});t.clickToolbar("fontsize",function(){var e=t.cmd.val("fontsize"),n=t.createMenu({name:"fontsize",width:150});_each(t.fontSizeTable,function(i,r){n.addItem({title:'<span style="font-size:'+r+';" unselectable="on">'+r+"</span>",height:_removeUnit(r)+12,checked:e===r,click:function(){t.exec("fontsize",r).hideMenu()}})})});_each("forecolor,hilitecolor".split(","),function(e,n){t.clickToolbar(n,function(){t.createMenu({name:n,selectedColor:t.cmd.val(n)||"default",colors:t.colorTable,click:function(e){t.exec(n,e).hideMenu()}})})});_each("cut,copy,paste".split(","),function(e,n){t.clickToolbar(n,function(){t.focus();try{t.exec(n,null)}catch(e){alert(t.lang(n+"Error"))}})});t.clickToolbar("about",function(){var e='<div style="margin:20px;">'+"<div>KindEditor "+_VERSION+"</div>"+'<div>Copyright &copy; <a href="http://www.kindsoft.net/" target="_blank">kindsoft.net</a> All rights reserved.</div>'+"</div>";t.createDialog({name:"about",width:350,title:t.lang("about"),body:e})});t.plugin.getSelectedLink=function(){return t.cmd.commonAncestor("a")};t.plugin.getSelectedImage=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return!/^ke-\w+$/i.test(e[0].className)})};t.plugin.getSelectedFlash=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-flash"})};t.plugin.getSelectedMedia=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-media"||e[0].className=="ke-rm"})};t.plugin.getSelectedAnchor=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-anchor"})};_each("link,image,flash,media,anchor".split(","),function(e,n){var i=n.charAt(0).toUpperCase()+n.substr(1);_each("edit,delete".split(","),function(e,r){t.addContextmenu({title:t.lang(r+i),click:function(){t.loadPlugin(n,function(){t.plugin[n][r]();t.hideMenu()})},cond:t.plugin["getSelected"+i],width:150,iconClass:r=="edit"?"ke-icon-"+n:undefined})});t.addContextmenu({title:"-"})});t.plugin.getSelectedTable=function(){return t.cmd.commonAncestor("table")};t.plugin.getSelectedRow=function(){return t.cmd.commonAncestor("tr")};t.plugin.getSelectedCell=function(){return t.cmd.commonAncestor("td")};_each(("prop,cellprop,colinsertleft,colinsertright,rowinsertabove,rowinsertbelow,rowmerge,colmerge,"+"rowsplit,colsplit,coldelete,rowdelete,insert,delete").split(","),function(e,n){var i=_inArray(n,["prop","delete"])<0?t.plugin.getSelectedCell:t.plugin.getSelectedTable;t.addContextmenu({title:t.lang("table"+n),click:function(){t.loadPlugin("table",function(){t.plugin.table[n]();t.hideMenu()})},cond:i,width:170,iconClass:"ke-icon-table"+n})});t.addContextmenu({title:"-"});_each(("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,"+"insertunorderedlist,indent,outdent,subscript,superscript,hr,print,"+"bold,italic,underline,strikethrough,removeformat,unlink").split(","),function(e,i){if(n[i]){t.afterCreate(function(){_ctrl(this.edit.doc,n[i],function(){t.cmd.selection();t.clickToolbar(i)})})}t.clickToolbar(i,function(){t.focus().exec(i,null)})});t.afterCreate(function(){var n=t.edit.doc,i,r,a,o="__kindeditor_paste__",s=false;function l(){i.range.moveToBookmark(r);i.select();if(_WEBKIT){e("div."+o,a).each(function(){e(this).after("<br />").remove(true)});e("span.Apple-style-span",a).remove(true);e("span.Apple-tab-span",a).remove(true);e("span[style]",a).each(function(){if(e(this).css("white-space")=="nowrap"){e(this).remove(true)}});e("meta",a).remove()}var n=a[0].innerHTML;a.remove();if(n===""){return}if(_WEBKIT){n=n.replace(/(<br>)\1/gi,"$1")}if(t.pasteType===2){n=n.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"");if(/schemas-microsoft-com|worddocument|mso-\w+/i.test(n)){n=_clearMsWord(n,t.filterMode?t.htmlTags:e.options.htmlTags)}else{n=_formatHtml(n,t.filterMode?t.htmlTags:null);n=t.beforeSetHtml(n)}}if(t.pasteType===1){n=n.replace(/&nbsp;/gi," ");n=n.replace(/\n\s*\n/g,"\n");n=n.replace(/<br[^>]*>/gi,"\n");n=n.replace(/<\/p><p[^>]*>/gi,"\n");n=n.replace(/<[^>]+>/g,"");n=n.replace(/ {2}/g," &nbsp;");if(t.newlineTag=="p"){if(/\n/.test(n)){n=n.replace(/^/,"<p>").replace(/$/,"<br /></p>").replace(/\n/g,"<br /></p><p>")}}else{n=n.replace(/\n/g,"<br />$&")}}t.insertHtml(n,true)}e(n.body).bind("paste",function(c){if(t.pasteType===0){c.stop();return}if(s){return}s=true;e("div."+o,n).remove();i=t.cmd.selection();r=i.range.createBookmark();a=e('<div class="'+o+'"></div>',n).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:"-1981px",top:e(r.start).pos().y+"px","white-space":"nowrap"});e(n.body).append(a);if(_IE){var d=i.range.get(true);d.moveToElementText(a[0]);d.select();d.execCommand("paste");c.preventDefault()}else{i.range.selectNodeContents(a[0]);i.select()}setTimeout(function(){l();s=false},0)})});t.beforeGetHtml(function(e){if(_IE&&_V<=8){e=e.replace(/<div\s+[^>]*data-ke-input-tag="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t){return unescape(t)});e=e.replace(/(<input)((?:\s+[^>]*)?>)/gi,function(e,t,n){if(!/\s+type="[^"]+"/i.test(e)){return t+' type="text"'+n}return e})}return e.replace(/(<(?:noscript|noscript\s[^>]*)>)([\s\S]*?)(<\/noscript>)/gi,function(e,t,n,i){return t+_unescape(n).replace(/\s+/g," ")+i}).replace(/<img[^>]*class="?ke-(flash|rm|media)"?[^>]*>/gi,function(e){var t=_getAttrList(e);var n=_getCssList(t.style||"");var i=_mediaAttrs(t["data-ke-tag"]);var r=_undef(n.width,"");var a=_undef(n.height,"");if(/px/i.test(r)){r=_removeUnit(r)}if(/px/i.test(a)){a=_removeUnit(a)}i.width=_undef(t.width,r);i.height=_undef(t.height,a);return _mediaEmbed(i)}).replace(/<img[^>]*class="?ke-anchor"?[^>]*>/gi,function(e){var t=_getAttrList(e);return'<a name="'+unescape(t["data-ke-name"])+'"></a>'}).replace(/<div\s+[^>]*data-ke-script-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t,n){return"<script"+unescape(t)+">"+unescape(n)+"</script>"}).replace(/<div\s+[^>]*data-ke-noscript-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t,n){return"<noscript"+unescape(t)+">"+unescape(n)+"</noscript>"}).replace(/(<[^>]*)data-ke-src="([^"]*)"([^>]*>)/gi,function(e,t,n,i){e=e.replace(/(\s+(?:href|src)=")[^"]*(")/i,function(e,t,i){return t+_unescape(n)+i});e=e.replace(/\s+data-ke-src="[^"]*"/i,"");return e}).replace(/(<[^>]+\s)data-ke-(on\w+="[^"]*"[^>]*>)/gi,function(e,t,n){return t+n})});t.beforeSetHtml(function(e){if(_IE&&_V<=8){e=e.replace(/<input[^>]*>|<(select|button)[^>]*>[\s\S]*?<\/\1>/gi,function(e){var t=_getAttrList(e);var n=_getCssList(t.style||"");if(n.display=="none"){return'<div class="ke-display-none" data-ke-input-tag="'+escape(e)+'"></div>'}return e})}return e.replace(/<embed[^>]*type="([^"]+)"[^>]*>(?:<\/embed>)?/gi,function(e){var n=_getAttrList(e);n.src=_undef(n.src,"");n.width=_undef(n.width,0);n.height=_undef(n.height,0);return _mediaImg(t.themesPath+"common/blank.gif",n)}).replace(/<a[^>]*name="([^"]+)"[^>]*>(?:<\/a>)?/gi,function(e){var n=_getAttrList(e);if(n.href!==undefined){return e}return'<img class="ke-anchor" src="'+t.themesPath+'common/anchor.gif" data-ke-name="'+escape(n.name)+'" />'}).replace(/<script([^>]*)>([\s\S]*?)<\/script>/gi,function(e,t,n){return'<div class="ke-script" data-ke-script-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/<noscript([^>]*)>([\s\S]*?)<\/noscript>/gi,function(e,t,n){return'<div class="ke-noscript" data-ke-noscript-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/(<[^>]*)(href|src)="([^"]*)"([^>]*>)/gi,function(e,t,n,i,r){if(e.match(/\sdata-ke-src="[^"]*"/i)){return e}e=t+n+'="'+i+'"'+' data-ke-src="'+_escape(i)+'"'+r;return e}).replace(/(<[^>]+\s)(on\w+="[^"]*"[^>]*>)/gi,function(e,t,n){return t+"data-ke-"+n}).replace(/<table[^>]*\s+border="0"[^>]*>/gi,function(e){if(e.indexOf("ke-zeroborder")>=0){return e}return _addClassToTag(e,"ke-zeroborder")})})})})(window);