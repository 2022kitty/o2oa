KindEditor.plugin("flash",function(e){var a=this,t="flash",l=a.lang(t+"."),i=e.undef(a.allowFlashUpload,true),n=e.undef(a.allowFileManager,false),o=e.undef(a.formatUploadUrl,true),d=e.undef(a.extraFileUploadParams,{}),r=e.undef(a.filePostName,"imgFile"),u=e.undef(a.uploadJson,a.basePath+"php/upload_json.php");a.plugin.flash={edit:function(){var s=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+l.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+l.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+l.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+l.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" /> ',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+l.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" /> ',"</div>","</div>"].join("");var h=a.createDialog({name:t,width:450,title:a.lang(t),body:s,yesBtn:{name:a.lang("yes"),click:function(t){var l=e.trim(p.val()),i=c.val(),n=v.val();if(l=="http://"||e.invalidUrl(l)){alert(a.lang("invalidUrl"));p[0].focus();return}if(!/^\d*$/.test(i)){alert(a.lang("invalidWidth"));c[0].focus();return}if(!/^\d*$/.test(n)){alert(a.lang("invalidHeight"));v[0].focus();return}var o=e.mediaImg(a.themesPath+"common/blank.gif",{src:l,type:e.mediaType(".swf"),width:i,height:n,quality:"high"});a.insertHtml(o).hideDialog().focus()}}}),f=h.div,p=e('[name="url"]',f),g=e('[name="viewServer"]',f),c=e('[name="width"]',f),v=e('[name="height"]',f);p.val("http://");if(i){var m=e.uploadbutton({button:e(".ke-upload-button",f)[0],fieldName:r,extraParams:d,url:e.addParam(u,"dir=flash"),afterUpload:function(l){h.hideLoading();if(l.error===0){var i=l.url;if(o){i=e.formatUrl(i,"absolute")}p.val(i);if(a.afterUpload){a.afterUpload.call(a,i,l,t)}alert(a.lang("uploadSuccess"))}else{alert(l.message)}},afterError:function(e){h.hideLoading();a.errorDialog(e)}});m.fileBox.change(function(e){h.showLoading(a.lang("uploadLoading"));m.submit()})}else{e(".ke-upload-button",f).hide()}if(n){g.click(function(t){a.loadPlugin("filemanager",function(){a.plugin.filemanagerDialog({viewType:"LIST",dirName:"flash",clickFn:function(t,l){if(a.dialogs.length>1){e('[name="url"]',f).val(t);if(a.afterSelectFile){a.afterSelectFile.call(a,t)}a.hideDialog()}}})})})}else{g.hide()}var k=a.plugin.getSelectedFlash();if(k){var b=e.mediaAttrs(k.attr("data-ke-tag"));p.val(b.src);c.val(e.removeUnit(k.css("width"))||b.width||0);v.val(e.removeUnit(k.css("height"))||b.height||0)}p[0].focus();p[0].select()},delete:function(){a.plugin.getSelectedFlash().remove();a.addBookmark()}};a.clickToolbar(t,a.plugin.flash.edit)});