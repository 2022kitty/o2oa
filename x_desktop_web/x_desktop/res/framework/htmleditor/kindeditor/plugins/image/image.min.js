KindEditor.plugin("image",function(e){var t=this,a="image",i=e.undef(t.allowImageUpload,true),l=e.undef(t.allowImageRemote,true),n=e.undef(t.formatUploadUrl,true),r=e.undef(t.allowFileManager,false),o=e.undef(t.uploadJson,t.basePath+"php/upload_json.php"),d=e.undef(t.imageTabIndex,0),s=t.pluginsPath+"image/images/",u=e.undef(t.extraFileUploadParams,{}),g=e.undef(t.filePostName,"imgFile"),c=e.undef(t.fillDescAfterUploadImage,false),m=t.lang(a+".");t.plugin.imageDialog=function(i){var l=i.imageUrl,d=e.undef(i.imageWidth,""),f=e.undef(i.imageHeight,""),h=e.undef(i.imageTitle,""),p=e.undef(i.imageAlign,""),v=e.undef(i.showRemote,true),b=e.undef(i.showLocal,true),k=e.undef(i.tabIndex,0),w=i.clickFn;var y="kindeditor_upload_iframe_"+(new Date).getTime();var x=[];for(var U in u){x.push('<input type="hidden" name="'+U+'" value="'+u[U]+'" />')}var I=['<div style="padding:20px;">','<div class="tabs"></div>','<div class="tab1" style="display:none;">','<div class="ke-dialog-row">','<label for="remoteUrl" style="width:60px;">'+m.remoteUrl+"</label>",'<input type="text" id="remoteUrl" class="ke-input-text" name="url" value="" style="width:200px;" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+m.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="remoteWidth" style="width:60px;">'+m.size+"</label>",m.width+' <input type="text" id="remoteWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> ',m.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> ','<img class="ke-refresh-btn" src="'+s+'refresh.png" width="16" height="16" alt="" style="cursor:pointer;" title="'+m.resetSize+'" />',"</div>",'<div class="ke-dialog-row">','<label style="width:60px;">'+m.align+"</label>",'<input type="radio" name="align" class="ke-inline-block" value="" checked="checked" /> <img name="defaultImg" src="'+s+'align_top.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="left" /> <img name="leftImg" src="'+s+'align_left.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="right" /> <img name="rightImg" src="'+s+'align_right.gif" width="23" height="25" alt="" />',"</div>",'<div class="ke-dialog-row">','<label for="remoteTitle" style="width:60px;">'+m.imgTitle+"</label>",'<input type="text" id="remoteTitle" class="ke-input-text" name="title" value="" style="width:200px;" />',"</div>","</div>",'<div class="tab2" style="display:none;">','<iframe name="'+y+'" style="display:none;"></iframe>','<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+y+'" action="'+e.addParam(o,"dir=image")+'">','<div class="ke-dialog-row">',x.join(""),'<label style="width:60px;">'+m.localUrl+"</label>",'<input type="text" name="localUrl" class="ke-input-text" tabindex="-1" style="width:200px;" readonly="true" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+m.upload+'" />',"</div>","</form>","</div>","</div>"].join("");var T=b||r?450:400,S=b&&v?300:250;var D=t.createDialog({name:a,width:T,height:S,title:t.lang(a),body:I,yesBtn:{name:t.lang("yes"),click:function(a){if(D.isLoading){return}if(b&&v&&j&&j.selectedIndex===1||!v){if(E.fileBox.val()==""){alert(t.lang("pleaseSelectFile"));return}D.showLoading(t.lang("uploadLoading"));E.submit();W.val("");return}var i=e.trim(L.val()),l=P.val(),n=B.val(),r=H.val(),o="";R.each(function(){if(this.checked){o=this.value;return false}});if(i=="http://"||e.invalidUrl(i)){alert(t.lang("invalidUrl"));L[0].focus();return}if(!/^\d*$/.test(l)){alert(t.lang("invalidWidth"));P[0].focus();return}if(!/^\d*$/.test(n)){alert(t.lang("invalidHeight"));B[0].focus();return}w.call(t,i,r,l,n,0,o)}},beforeRemove:function(){_.unbind();P.unbind();B.unbind();A.unbind()}}),F=D.div;var L=e('[name="url"]',F),W=e('[name="localUrl"]',F),_=e('[name="viewServer"]',F),P=e('.tab1 [name="width"]',F),B=e('.tab1 [name="height"]',F),A=e(".ke-refresh-btn",F),H=e('.tab1 [name="title"]',F),R=e('.tab1 [name="align"]',F);var j;if(v&&b){j=e.tabs({src:e(".tabs",F),afterSelect:function(e){}});j.add({title:m.remoteImage,panel:e(".tab1",F)});j.add({title:m.localImage,panel:e(".tab2",F)});j.select(k)}else if(v){e(".tab1",F).show()}else if(b){e(".tab2",F).show()}var E=e.uploadbutton({button:e(".ke-upload-button",F)[0],fieldName:g,form:e(".ke-form",F),target:y,width:60,afterUpload:function(i){D.hideLoading();if(i.error===0){var l=i.url;if(n){l=e.formatUrl(l,"absolute")}if(t.afterUpload){t.afterUpload.call(t,l,i,a)}if(!c){w.call(t,l,i.title,i.width,i.height,i.border,i.align)}else{e(".ke-dialog-row #remoteUrl",F).val(l);e(".ke-tabs-li",F)[0].click();e(".ke-refresh-btn",F).click()}}else{alert(i.message)}},afterError:function(e){D.hideLoading();t.errorDialog(e)}});E.fileBox.change(function(e){W.val(E.fileBox.val())});if(r){_.click(function(a){t.loadPlugin("filemanager",function(){t.plugin.filemanagerDialog({viewType:"VIEW",dirName:"image",clickFn:function(a,i){if(t.dialogs.length>1){e('[name="url"]',F).val(a);if(t.afterSelectFile){t.afterSelectFile.call(t,a)}t.hideDialog()}}})})})}else{_.hide()}var M=0,N=0;function z(e,t){P.val(e);B.val(t);M=e;N=t}A.click(function(t){var a=e('<img src="'+L.val()+'" />',document).css({position:"absolute",visibility:"hidden",top:0,left:"-1000px"});a.bind("load",function(){z(a.width(),a.height());a.remove()});e(document.body).append(a)});P.change(function(e){if(M>0){B.val(Math.round(N/M*parseInt(this.value,10)))}});B.change(function(e){if(N>0){P.val(Math.round(M/N*parseInt(this.value,10)))}});L.val(i.imageUrl);z(i.imageWidth,i.imageHeight);H.val(i.imageTitle);R.each(function(){if(this.value===i.imageAlign){this.checked=true;return false}});if(v&&k===0){L[0].focus();L[0].select()}return D};t.plugin.image={edit:function(){var e=t.plugin.getSelectedImage();t.plugin.imageDialog({imageUrl:e?e.attr("data-ke-src"):"http://",imageWidth:e?e.width():"",imageHeight:e?e.height():"",imageTitle:e?e.attr("title"):"",imageAlign:e?e.attr("align"):"",showRemote:l,showLocal:i,tabIndex:e?0:d,clickFn:function(a,i,l,n,r,o){if(e){e.attr("src",a);e.attr("data-ke-src",a);e.attr("width",l);e.attr("height",n);e.attr("title",i);e.attr("align",o);e.attr("alt",i)}else{t.exec("insertimage",a,i,l,n,r,o)}setTimeout(function(){t.hideDialog().focus()},0)}})},delete:function(){var e=t.plugin.getSelectedImage();if(e.parent().name=="a"){e=e.parent()}e.remove();t.addBookmark()}};t.clickToolbar(a,t.plugin.image.edit)});