KindEditor.plugin("baidumap",function(e){var a=this,i="baidumap",t=a.lang(i+".");var n=e.undef(a.mapWidth,558);var d=e.undef(a.mapHeight,360);a.clickToolbar(i,function(){var r=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',t.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+t.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+t.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+n+"px;height:"+d+'px;"></div>',"</div>"].join("");var o=a.createDialog({name:i,width:n+42,title:a.lang(i),body:r,yesBtn:{name:a.lang("yes"),click:function(e){var i=p.map;var t=i.getCenter();var r=t.lng+","+t.lat;var o=i.getZoom();var s=[l[0].checked?a.pluginsPath+"baidumap/index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(r),"&zoom="+encodeURIComponent(o),"&width="+n,"&height="+d,"&markers="+encodeURIComponent(r),"&markerStyles="+encodeURIComponent("l,A")].join("");if(l[0].checked){a.insertHtml('<iframe src="'+s+'" frameborder="0" style="width:'+(n+2)+"px;height:"+(d+2)+'px;"></iframe>')}else{a.exec("insertimage",s)}a.hideDialog().focus()}},beforeRemove:function(){m.remove();if(u){u.write("")}h.remove()}});var s=o.div,c=e('[name="address"]',s),m=e('[name="searchBtn"]',s),l=e('[name="insertDynamicMap"]',o.div),p,u;var h=e('<iframe class="ke-textarea" frameborder="0" src="'+a.pluginsPath+'baidumap/map.html" style="width:'+n+"px;height:"+d+'px;"></iframe>');function v(){p=h[0].contentWindow;u=e.iframeDoc(h)}h.bind("load",function(){h.unbind("load");if(e.IE){v()}else{setTimeout(v,0)}});e(".ke-map",s).replaceWith(h);m.click(function(){p.search(c.val())})})});