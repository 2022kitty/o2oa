KindEditor.plugin("emoticons",function(e){var i=this,n="emoticons",s=i.emoticonsPath||i.pluginsPath+"emoticons/images/",o=i.allowPreviewEmoticons===undefined?true:i.allowPreviewEmoticons,a=1;i.clickToolbar(n,function(){var t=5,c=9,r=135,l=0,u=t*c,d=Math.ceil(r/u),p=Math.floor(c/2),f=e('<div class="ke-plugin-emoticons"></div>'),v=[],m=i.createMenu({name:n,beforeRemove:function(){C()}});m.div.append(f);var g,h;if(o){g=e('<div class="ke-preview"></div>').css("right",0);h=e('<img class="ke-preview-img" src="'+s+l+'.gif" />');f.append(g);g.append(h)}function k(n,o,a){if(g){n.mouseover(function(){if(o>p){g.css("left",0);g.css("right","")}else{g.css("left","");g.css("right",0)}h.attr("src",s+a+".gif");e(this).addClass("ke-on")})}else{n.mouseover(function(){e(this).addClass("ke-on")})}n.mouseout(function(){e(this).removeClass("ke-on")});n.click(function(e){i.insertHtml('<img src="'+s+a+'.gif" border="0" alt="" />').hideMenu().focus();e.stop()})}function b(i,n){var o=document.createElement("table");n.append(o);if(g){e(o).mouseover(function(){g.show("block")});e(o).mouseout(function(){g.hide()});v.push(e(o))}o.className="ke-table";o.cellPadding=0;o.cellSpacing=0;o.border=0;var a=(i-1)*u+l;for(var r=0;r<t;r++){var d=o.insertRow(r);for(var p=0;p<c;p++){var f=e(d.insertCell(p));f.addClass("ke-cell");k(f,p,a);var m=e('<span class="ke-img"></span>').css("background-position","-"+24*a+"px 0px").css("background-image","url("+s+"static.gif)");f.append(m);v.push(f);a++}}return o}var w=b(a,f);function C(){e.each(v,function(){this.unbind()})}var P;function E(e,i){e.click(function(e){C();w.parentNode.removeChild(w);P.remove();w=b(i,f);M(i);a=i;e.stop()})}function M(i){P=e('<div class="ke-page"></div>');f.append(P);for(var n=1;n<=d;n++){if(i!==n){var s=e('<a href="javascript:;">['+n+"]</a>");E(s,n);P.append(s);v.push(s)}else{P.append(e("@["+n+"]"))}P.append(e("@&nbsp;"))}}M(a)})});