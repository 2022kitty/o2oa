KindEditor.plugin("filemanager",function(e){var i=this,a="filemanager",n=e.undef(i.fileManagerJson,i.basePath+"php/file_manager_json.php"),l=i.pluginsPath+a+"/images/",t=i.lang(a+".");function r(e,i,a){return e+" ("+Math.ceil(i/1024)+"KB, "+a+")"}function o(e,i){if(i.is_dir){e.attr("title",i.filename)}else{e.attr("title",r(i.filename,i.filesize,i.datetime))}}i.plugin.filemanagerDialog=function(r){var s=e.undef(r.width,650),d=e.undef(r.height,510),c=e.undef(r.dirName,""),f=e.undef(r.viewType,"VIEW").toUpperCase(),m=r.clickFn;var p=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+l+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+t.moveup+"</a>","</div>",'<div class="ke-right">',t.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+t.viewImage+"</option>",'<option value="LIST">'+t.listImage+"</option>","</select> ",t.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+t.fileName+"</option>",'<option value="SIZE">'+t.fileSize+"</option>",'<option value="TYPE">'+t.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join("");var u=i.createDialog({name:a,width:s,height:d,title:i.lang(a),body:p}),v=u.div,h=e(".ke-plugin-filemanager-body",v),g=e('[name="moveupImg"]',v),k=e('[name="moveupLink"]',v),_=e('[name="viewServer"]',v),b=e('[name="viewType"]',v),w=e('[name="orderType"]',v);function y(a,l,t){var r="path="+a+"&order="+l+"&dir="+c;u.showLoading(i.lang("ajaxLoading"));e.ajax(e.addParam(n,r+"&"+(new Date).getTime()),function(e){u.hideLoading();t(e)})}var C=[];function T(i,a,n,l){var t=e.formatUrl(a.current_url+n.filename,"absolute"),r=encodeURIComponent(a.current_dir_path+n.filename+"/");if(n.is_dir){i.click(function(e){y(r,w.val(),l)})}else if(n.is_photo){i.click(function(e){m.call(this,t,n.filename)})}else{i.click(function(e){m.call(this,t,n.filename)})}C.push(i)}function I(i,a){e.each(C,function(){this.unbind()});k.unbind();b.unbind();w.unbind();if(i.current_dir_path){k.click(function(e){y(i.moveup_dir_path,w.val(),a)})}function n(){if(b.val()=="VIEW"){y(i.current_dir_path,w.val(),x)}else{y(i.current_dir_path,w.val(),E)}}b.change(n);w.change(n);h.html("")}function E(i){I(i,E);var a=document.createElement("table");a.className="ke-table";a.cellPadding=0;a.cellSpacing=0;a.border=0;h.append(a);var n=i.file_list;for(var r=0,o=n.length;r<o;r++){var s=n[r],d=e(a.insertRow(r));d.mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});var c=l+(s.is_dir?"folder-16.gif":"file-16.gif"),f=e('<img src="'+c+'" width="16" height="16" alt="'+s.filename+'" align="absmiddle" />'),m=e(d[0].insertCell(0)).addClass("ke-cell ke-name").append(f).append(document.createTextNode(" "+s.filename));if(!s.is_dir||s.has_file){d.css("cursor","pointer");m.attr("title",s.filename);T(m,i,s,E)}else{m.attr("title",t.emptyFolder)}e(d[0].insertCell(1)).addClass("ke-cell ke-size").html(s.is_dir?"-":Math.ceil(s.filesize/1024)+"KB");e(d[0].insertCell(2)).addClass("ke-cell ke-datetime").html(s.datetime)}}function x(i){I(i,x);var a=i.file_list;for(var n=0,r=a.length;n<r;n++){var s=a[n],d=e('<div class="ke-inline-block ke-item"></div>');h.append(d);var c=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});d.append(c);var f=i.current_url+s.filename,m=s.is_dir?l+"folder-64.gif":s.is_photo?f:l+"file-64.gif";var p=e('<img src="'+m+'" width="80" height="80" alt="'+s.filename+'" />');if(!s.is_dir||s.has_file){c.css("cursor","pointer");o(c,s);T(c,i,s,x)}else{c.attr("title",t.emptyFolder)}c.append(p);d.append('<div class="ke-name" title="'+s.filename+'">'+s.filename+"</div>")}}b.val(f);y("",w.val(),f=="VIEW"?x:E);return u}});