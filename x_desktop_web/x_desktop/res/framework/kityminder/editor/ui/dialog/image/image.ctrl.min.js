angular.module("kityminderEditor").controller("image.ctrl",["$http","$scope","$modalInstance","image",function(e,t,a,l){t.data={list:[],url:l.url||"",title:l.title||"",R_URL:/^https?\:\/\/(\w+\.)+\w+/};setTimeout(function(){var e=$("#image-url");e.focus();e[0].setSelectionRange(0,t.data.url.length)},300);t.searchImage=function(){t.list=[];i().success(function(e){if(e&&e.data){for(var a=0;a<e.data.length;a++){if(e.data[a].objURL){t.list.push({title:e.data[a].fromPageTitleEnc,src:e.data[a].middleURL,url:e.data[a].middleURL})}}}}).error(function(){})};t.selectImage=function(e){var a=$("#img-item"+this.$index);var l=$("#img-"+this.$index);a.siblings(".selected").removeClass("selected");a.addClass("selected");t.data.url=l.attr("src");t.data.title=l.attr("alt")};t.shortCut=function(e){e.stopPropagation();if(e.keyCode==13){t.ok()}else if(e.keyCode==27){t.cancel()}};t.ok=function(){if(t.data.R_URL.test(t.data.url)){a.close({url:t.data.url,title:t.data.title})}else{t.urlPassed=false;var e=$("#image-url");e.focus();e[0].setSelectionRange(0,t.data.url.length)}editor.receiver.selectAll()};t.cancel=function(){a.dismiss("cancel");editor.receiver.selectAll()};function i(){var a=t.data.searchKeyword2;var l=new Date;var i="http://image.baidu.com/search/acjson?tn=resultjson_com&ipn=rj&ct=201326592&fp=result&queryWord="+a+"&cl=2&lm=-1&ie=utf-8&oe=utf-8&st=-1&ic=0&word="+a+"&face=0&istype=2&nc=1&pn=60&rn=60&gsm=3c&"+l.getTime()+"=&callback=JSON_CALLBACK";return e.jsonp(i)}}]);