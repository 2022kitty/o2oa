angular.module("kityminderEditor").directive("resourceEditor",function(){return{restrict:"E",templateUrl:"ui/directive/resourceEditor/resourceEditor.html",scope:{minder:"="},replace:true,controller:function(e){var r=e.minder;var t=false;r.on("interactchange",function(){var n=e.enabled=r.queryCommandState("resource")!=-1;var u=n?r.queryCommandValue("resource"):[];var c=r.getUsedResource().map(function(e){return{name:e,selected:u.indexOf(e)>-1}});e.used=c;t=true;e.$apply();t=false});e.$watch("used",function(e){if(r.queryCommandState("resource")!=-1&&e){var n=e.filter(function(e){return e.selected}).map(function(e){return e.name});if(t){return}r.execCommand("resource",n)}},true);e.resourceColor=function(e){return r.getResourceColor(e).toHEX()};e.addResource=function(t){var n=r.queryCommandValue("resource");if(!t||!/\S/.test(t))return;if(n.indexOf(t)==-1){e.used.push({name:t,selected:true})}e.newResourceName=null}}}}).directive("clickAnywhereButHere",["$document",function(e){return{link:function(r,t,n){var u=function(e){var t=$("#resource-dropdown").has(e.target).length>0;var u=$("#resource-dropdown")==e.target;var c=t||u;if(!c){r.$apply(n.clickAnywhereButHere)}};r.$watch(n.isActive,function(r,t){if(r!==t&&r==true){e.bind("click",u)}else if(r!==t&&r==false){e.unbind("click",u)}})}}}]);