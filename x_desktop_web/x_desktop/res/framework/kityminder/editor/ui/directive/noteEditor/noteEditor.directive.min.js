angular.module("kityminderEditor").directive("noteEditor",["valueTransfer",function(e){return{restrict:"A",templateUrl:"ui/directive/noteEditor/noteEditor.html",scope:{minder:"="},replace:true,controller:function(t){var n=t.minder;var o=false;var r;t.codemirrorLoaded=function(e){r=t.cmEditor=e;e.setSize("100%","100%")};function i(){var e=t.noteEnabled=n.queryCommandState("note")!=-1;var r=n.queryCommandValue("note")||"";if(e){t.noteContent=r}o=true;t.$apply();o=false}t.$watch("noteContent",function(e){var t=n.queryCommandState("note")!=-1;if(e&&t&&!o){n.execCommand("note",e)}setTimeout(function(){r.refresh()})});var a=function(){return e.noteEditorOpen};t.$watch(a,function(n,o){if(n){setTimeout(function(){r.refresh();r.focus()})}t.noteEditorOpen=e.noteEditorOpen},true);t.closeNoteEditor=function(){e.noteEditorOpen=false;editor.receiver.selectAll()};n.on("interactchange",i)}}}]);