define(function(e,t,r){var i=e("../hotbox");var n=e("../tool/debug");var a=new n("drag");function o(){var e=this.fsm;var t=this.minder;var r=this.hotbox;var n=this.receiver;var a=n.element;o();function o(){e.when("* -> drag",function(){});e.when("drag -> *",function(e,t,r){if(r=="drag-finish"){}})}var f,s;var g=0;var v=1;var c=v;var u,l,d,h;var m=false,b=false;var E;function w(e,r){if(!e){m=b=false;E&&kity.releaseFrame(E);E=null;return}if(!E){E=kity.requestFrame(function(e,t,r){return function(i){switch(e){case"left":r._viewDragger.move({x:-t,y:0},0);break;case"top":r._viewDragger.move({x:0,y:-t},0);break;case"right":r._viewDragger.move({x:t,y:0},0);break;case"bottom":r._viewDragger.move({x:0,y:t},0);break;default:return}i.next()}}(e,r,t))}}t.on("mousedown",function(e){c=g;f=e.originEvent.clientX;s=e.originEvent.clientY;u=t.getPaper().container.clientWidth;l=t.getPaper().container.clientHeight});t.on("mousemove",function(n){if(e.state()==="drag"&&c==g&&t.getSelectedNode()&&(Math.abs(f-n.originEvent.clientX)>10||Math.abs(s-n.originEvent.clientY)>10)){d=n.originEvent.offsetX;h=n.originEvent.offsetY;if(d<10){w("right",10-d)}else if(d>u-10){w("left",10+d-u)}else{m=true}if(h<10){w("bottom",h)}else if(h>l-10){w("top",10+h-l)}else{b=true}if(m&&b){w(false)}}if(e.state()!="drag"&&c==g&&t.getSelectedNode()&&(Math.abs(f-n.originEvent.clientX)>10||Math.abs(s-n.originEvent.clientY)>10)){if(e.state()=="hotbox"){r.active(i.STATE_IDLE)}return e.jump("drag","user-drag")}});document.body.onmouseup=function(t){c=v;if(e.state()=="drag"){w(false);return e.jump("normal","drag-finish")}}}return r.exports=o});