define(function(e,t,n){var o=e("../tool/jsondiff");function a(){var e=this.minder;var t=this.hotbox;var n=100;var a;var r;var i;var s;function c(){i=[];s=[];a=e.exportJson()}function u(){var t=e.exportJson();var r=o(t,a);if(r.length){i.push(r);while(i.length>n){i.shift()}a=t;return true}}function f(){var t=e.exportJson();s.push(o(t,a));a=t}function d(){r=true;var t=i.pop();if(t){e.applyPatches(t);f()}r=false}function l(){r=true;var t=s.pop();if(t){e.applyPatches(t);u()}r=false}function p(){if(r)return;if(u())s=[]}function h(){return!!i.length}function v(){return!!s.length}function b(t){if(!r)return;var n=t.patch;switch(n.express){case"node.add":e.select(n.node.getChild(n.index),true);break;case"node.remove":case"data.replace":case"data.remove":case"data.add":e.select(n.node,true);break}}this.history={reset:c,undo:d,redo:l,hasUndo:h,hasRedo:v};c();e.on("contentchange",p);e.on("import",c);e.on("patch",b);var x=t.state("main");x.button({position:"top",label:"撤销",key:"Ctrl + Z",enable:h,action:d,next:"idle"});x.button({position:"top",label:"重做",key:"Ctrl + Y",enable:v,action:l,next:"idle"})}window.diff=o;return n.exports=a});