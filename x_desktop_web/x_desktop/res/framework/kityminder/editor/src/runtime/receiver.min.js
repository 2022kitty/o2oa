define(function(e,t,n){var r=e("../tool/key");var i=e("hotbox");function o(){var e=this.fsm;var t=this.minder;var n=this;var i=document.createElement("div");i.contentEditable=true;i.setAttribute("tabindex",-1);i.classList.add("receiver");i.onkeydown=i.onkeypress=i.onkeyup=a;this.container.appendChild(i);var o={element:i,selectAll:function(){if(!i.innerHTML)i.innerHTML="&nbsp;";var e=document.createRange();var t=window.getSelection();e.selectNodeContents(i);t.removeAllRanges();t.addRange(e);i.focus()},enable:function(){i.setAttribute("contenteditable",true)},disable:function(){i.setAttribute("contenteditable",false)},fixFFCaretDisappeared:function(){i.removeAttribute("contenteditable");i.setAttribute("contenteditable","true");i.blur();i.focus()},onblur:function(e){i.onblur=e}};o.selectAll();t.on("beforemousedown",o.selectAll);t.on("receiverfocus",o.selectAll);t.on("readonly",function(){t.disable();editor.receiver.element.parentElement.removeChild(editor.receiver.element);editor.hotbox.$container.removeChild(editor.hotbox.$element)});var l=[];o.listen=function(e,t){if(arguments.length==1){t=e;e="*"}t.notifyState=e;l.push(t)};function a(t){t.is=function(e){var t=e.split("|");for(var n=0;n<t.length;n++){if(r.is(this,t[n]))return true}return false};var n,i;for(var o=0;o<l.length;o++){n=l[o];if(n.notifyState!="*"&&n.notifyState!=e.state()){continue}if(n.call(null,t)){return}}}this.receiver=o}return n.exports=o});