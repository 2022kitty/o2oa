(function(){var e={r:function(t){if(e[t].inited){return e[t].value}if(typeof e[t].value==="function"){var n={exports:{}},r=e[t].value(null,n.exports,n);e[t].inited=true;e[t].value=r;if(r!==undefined){return r}else{for(var i in n.exports){if(n.exports.hasOwnProperty(i)){e[t].inited=true;e[t].value=n.exports;return n.exports}}}}else{e[t].inited=true;return e[t].value}}};e[0]={value:function(t,n,r){var i=[];function a(e){i.push(e)}function o(e){this.selector=e;for(var t=0;t<i.length;t++){if(typeof i[t]=="function"){i[t].call(this,this)}}}o.assemble=a;a(e.r(7));a(e.r(9));a(e.r(14));a(e.r(18));a(e.r(11));a(e.r(12));a(e.r(5));a(e.r(6));a(e.r(8));a(e.r(15));a(e.r(10));a(e.r(13));a(e.r(16));a(e.r(17));return r.exports=o}};e[1]={value:function(t,n,r){return r.exports=kityminder.Editor=e.r(0)}};e[2]={value:function(e,t,n){return n.exports=window.HotBox}};e[3]={value:function(e,t,n){}};e[4]={value:function(e,t,n){return n.exports=window.kityminder.Minder}};e[5]={value:function(e,t,n){function r(){var e="\ufeff";var t={"application/km":"￿"};var n={"\ufeff":"SPLITOR","￿":"application/km"};function r(t,n){if(!this.isPureText(n)){var r=this.whichMimeType(n);if(!r){throw new Error("unknow mimetype!")}n=this.getPureText(n)}if(t===false){return n}return t+e+n}this.registMimeTypeProtocol=function(e,r){if(r&&n[r]){throw new Error("sing has registed!")}if(e&&!!t[e]){throw new Error("mimetype has registed!")}n[r]=e;t[e]=r};this.getMimeTypeProtocol=function(e,n){var i=t[e]||false;if(n===undefined){return r.bind(this,i)}return r(i,n)};this.getSpitor=function(){return e};this.getMimeType=function(e){if(e!==undefined){return n[e]||null}return t}}r.prototype.isPureText=function(e){return!~e.indexOf(this.getSpitor())};r.prototype.getPureText=function(e){if(this.isPureText(e)){return e}return e.split(this.getSpitor())[1]};r.prototype.whichMimeType=function(e){if(this.isPureText(e)){return null}return this.getMimeType(e.split(this.getSpitor())[0])};function i(){if(this.minder.supportClipboardEvent&&!kity.Browser.gecko){this.MimeType=new r}}return n.exports=i}};e[6]={value:function(e,t,n){function r(){var e=this.minder;var t=window.kityminder.data;if(!e.supportClipboardEvent||kity.Browser.gecko){return}var n=this.fsm;var r=this.receiver;var i=this.MimeType;var a=i.getMimeTypeProtocol("application/km"),o=t.getRegisterProtocol("json").decode;var l=[];function s(n){var r=[];for(var i=0,o=n.length;i<o;i++){r.push(e.exportNode(n[i]))}return a(t.getRegisterProtocol("json").encode(r))}var c=function(t){if(document.activeElement==r.element){var i=t;var a=n.state();switch(a){case"input":{break}case"normal":{var o=[].concat(e.getSelectedNodes());if(o.length){if(o.length>1){var l;o.sort(function(e,t){return e.getLevel()-t.getLevel()});l=o[0].getLevel();if(l!==o[o.length-1].getLevel()){var c,d,u=0,m=o.length,p=m-1;d=o[p];while(d.getLevel()!==l){u=0;while(u<m&&o[u].getLevel()===l){if(o[u].isAncestorOf(d)){o.splice(p,1);break}u++}p--;d=o[p]}}}var f=s(o);i.clipboardData.setData("text/plain",f)}t.preventDefault();break}}}};var d=function(t){if(document.activeElement==r.element){if(e.getStatus()!=="normal"){t.preventDefault();return}var i=t;var a=n.state();switch(a){case"input":{break}case"normal":{var o=e.getSelectedNodes();if(o.length){i.clipboardData.setData("text/plain",s(o));e.execCommand("removenode")}t.preventDefault();break}}}};var u=function(t){if(document.activeElement==r.element){if(e.getStatus()!=="normal"){t.preventDefault();return}var a=t;var s=n.state();var c=a.clipboardData.getData("text/plain");switch(s){case"input":{if(!i.isPureText(c)){t.preventDefault();return}break}case"normal":{var d=e.getSelectedNodes();if(i.whichMimeType(c)==="application/km"){var u=o(i.getPureText(c));var m;d.forEach(function(t){for(var n=u.length-1;n>=0;n--){m=e.createNode(null,t);e.importNode(m,u[n]);l.push(m);t.appendChild(m)}});e.select(l,true);l=[];e.refresh()}else{d.forEach(function(t){e.Text2Children(t,c)})}t.preventDefault();break}}}};document.addEventListener("copy",c);document.addEventListener("cut",d);document.addEventListener("paste",u)}return n.exports=r}};e[7]={value:function(e,t,n){function r(){var e;if(typeof this.selector=="string"){e=document.querySelector(this.selector)}else{e=this.selector}if(!e)throw new Error("Invalid selector: "+this.selector);e.classList.add("km-editor");this.container=e}return n.exports=r}};e[8]={value:function(t,n,r){var i=e.r(2);var a=e.r(19);var o=new a("drag");function l(){var e=this.fsm;var t=this.minder;var n=this.hotbox;var r=this.receiver;var a=r.element;o();function o(){e.when("* -> drag",function(){});e.when("drag -> *",function(e,t,n){if(n=="drag-finish"){}})}var l,s;var c=0;var d=1;var u=d;var m,p,f,g;var v=false,h=false;var b;function y(e,n){if(!e){v=h=false;b&&kity.releaseFrame(b);b=null;return}if(!b){b=kity.requestFrame(function(e,t,n){return function(r){switch(e){case"left":n._viewDragger.move({x:-t,y:0},0);break;case"top":n._viewDragger.move({x:0,y:-t},0);break;case"right":n._viewDragger.move({x:t,y:0},0);break;case"bottom":n._viewDragger.move({x:0,y:t},0);break;default:return}r.next()}}(e,n,t))}}t.on("mousedown",function(e){u=c;l=e.originEvent.clientX;s=e.originEvent.clientY;m=t.getPaper().container.clientWidth;p=t.getPaper().container.clientHeight});t.on("mousemove",function(r){if(e.state()==="drag"&&u==c&&t.getSelectedNode()&&(Math.abs(l-r.originEvent.clientX)>10||Math.abs(s-r.originEvent.clientY)>10)){f=r.originEvent.offsetX;g=r.originEvent.offsetY;if(f<10){y("right",10-f)}else if(f>m-10){y("left",10+f-m)}else{v=true}if(g<10){y("bottom",g)}else if(g>p-10){y("top",10+g-p)}else{h=true}if(v&&h){y(false)}}if(e.state()!="drag"&&u==c&&t.getSelectedNode()&&(Math.abs(l-r.originEvent.clientX)>10||Math.abs(s-r.originEvent.clientY)>10)){if(e.state()=="hotbox"){n.active(i.STATE_IDLE)}return e.jump("drag","user-drag")}});document.body.onmouseup=function(t){u=d;if(e.state()=="drag"){y(false);return e.jump("normal","drag-finish")}}}return r.exports=l}};e[9]={value:function(t,n,r){var i=e.r(19);var a=new i("fsm");function o(e,t,n,r){if(e.when!=t)return false;if(e.enter!="*"&&e.enter!=r)return false;if(e.exit!="*"&&e.exit!=n)return;return true}function l(e){var t=e;var n=" - ";var r=" -> ";var i=[];this.jump=function(e,n){if(!n)throw new Error("Please tell fsm the reason to jump");var r=t;var l=[r,e].concat([].slice.call(arguments,1));var s,c;for(s=0;s<i.length;s++){c=i[s];if(o(c.condition,"before",r,e)){if(c.apply(null,l))return}}t=e;a.log("[{0}] {1} -> {2}",n,r,e);for(s=0;s<i.length;s++){c=i[s];if(o(c.condition,"after",r,e)){c.apply(null,l)}}return t};this.state=function(){return t};this.when=function(e,t){if(arguments.length==1){t=e;e="* -> *"}var a,o,l,s;o=e.split(n);if(o.length==2){a="before"}else{o=e.split(r);if(o.length==2){a="after"}}if(!a)throw new Error("Illegal fsm condition: "+e);l=o[0];s=o[1];t.condition={when:a,exit:l,enter:s};i.push(t)}}function s(){this.fsm=new l("normal")}return r.exports=s}};e[10]={value:function(t,n,r){var i=e.r(22);function a(){var e=this.minder;var t=this.hotbox;var n=100;var r;var a;var o;var l;function s(){o=[];l=[];r=e.exportJson()}function c(){var t=e.exportJson();var a=i(t,r);if(a.length){o.push(a);while(o.length>n){o.shift()}r=t;return true}}function d(){var t=e.exportJson();l.push(i(t,r));r=t}function u(){a=true;var t=o.pop();if(t){e.applyPatches(t);d()}a=false}function m(){a=true;var t=l.pop();if(t){e.applyPatches(t);c()}a=false}function p(){if(a)return;if(c())l=[]}function f(){return!!o.length}function g(){return!!l.length}function v(t){if(!a)return;var n=t.patch;switch(n.express){case"node.add":e.select(n.node.getChild(n.index),true);break;case"node.remove":case"data.replace":case"data.remove":case"data.add":e.select(n.node,true);break}}this.history={reset:s,undo:u,redo:m,hasUndo:f,hasRedo:g};s();e.on("contentchange",p);e.on("import",s);e.on("patch",v);var h=t.state("main");h.button({position:"top",label:"撤销",key:"Ctrl + Z",enable:f,action:u,next:"idle"});h.button({position:"top",label:"重做",key:"Ctrl + Y",enable:g,action:m,next:"idle"})}window.diff=i;return r.exports=a}};e[11]={value:function(t,n,r){var i=e.r(2);function a(){var e=this.fsm;var t=this.minder;var n=this.receiver;var r=this.container;var a=new i(r);a.setParentFSM(e);e.when("normal -> hotbox",function(e,n,r){var i=t.getSelectedNode();var o;if(i){var l=i.getRenderBox();o={x:l.cx,y:l.cy}}a.active("main",o)});e.when("normal -> normal",function(e,n,r,i){if(r=="shortcut-handle"){var o=a.dispatch(i);if(o){i.preventDefault()}else{t.dispatchKeyEvent(i)}}});e.when("modal -> normal",function(e,t,r,i){if(r=="import-text-finish"){n.element.focus()}});this.hotbox=a}return r.exports=a}};e[12]={value:function(t,n,r){e.r(21);var i=e.r(19);var a=new i("input");function o(){var e=this.fsm;var t=this.minder;var n=this.hotbox;var r=this.receiver;var i=r.element;var o=window.kity.Browser.gecko;s();l();c();this.editText=d;function l(){e.when("* -> input",u);e.when("input -> *",function(e,t,n){switch(n){case"input-cancel":return g();case"input-commit":default:return f()}});r.onblur(function(t){if(e.state()=="input"){e.jump("normal","input-commit")}});t.on("beforemousedown",function(){if(e.state()=="input"){e.jump("normal","input-commit")}});t.on("dblclick",function(){if(t.getSelectedNode()){d()}})}function s(){if(a.flaged){i.classList.add("debug")}i.onmousedown=function(e){e.stopPropagation()};t.on("layoutallfinish viewchange viewchanged selectionchange",function(t){if(t.type=="viewchange"&&e.state()!="input")return;v()});v()}function c(){n.state("main").button({position:"center",label:"编辑",key:"F2",enable:function(){return t.queryCommandState("text")!=-1},action:d})}function d(){var n=t.getSelectedNode();if(!n){return}var a=i;i.innerText="";if(n.getData("font-weight")==="bold"){var l=document.createElement("b");a.appendChild(l);a=l}if(n.getData("font-style")==="italic"){var s=document.createElement("i");a.appendChild(s);a=s}a.innerText=t.queryCommandValue("text");if(o){r.fixFFCaretDisappeared()}e.jump("input","input-request");r.selectAll()}function u(){var e=t.getSelectedNode();if(e){var n=e.getData("font-size")||e.getStyle("font-size");i.style.fontSize=n+"px";i.style.minWidth=0;i.style.minWidth=i.clientWidth+"px";i.style.fontWeight=e.getData("font-weight")||"";i.style.fontStyle=e.getData("font-style")||"";i.classList.add("input");i.focus()}}function m(e){var n="";var r="\t",i="\n",a=/\S/,o=" ",l=new RegExp("( |"+String.fromCharCode(160)+")"),s=document.createElement("br");var c=false,d=false;for(var u,m,p,f,v,h=0,b=e.length;h<b;h++){u=e[h];switch(Object.prototype.toString.call(u)){case"[object HTMLBRElement]":{n+=i;break}case"[object Text]":{u=u.textContent.replace("&nbsp;"," ");if(!a.test(u)){p=u.length;while(p--){if(l.test(u[p])){n+=o}else if(u[p]===r){n+=r}}}else{n+=u}break}case"[object HTMLElement]":{switch(u.nodeName){case"B":{c=true;break}case"I":{d=true;break}default:{}}[].splice.apply(e,[h,1].concat([].slice.call(u.childNodes)));b=e.length;h--;break}case"[object HTMLSpanElement]":{[].splice.apply(e,[h,1].concat([].slice.call(u.childNodes)));b=e.length;h--;break}case"[object HTMLImageElement]":{if(u.src){if(/http(|s):\/\//.test(u.src)){t.execCommand("Image",u.src,u.alt)}else{}}break}case"[object HTMLDivElement]":{m=[];for(var y=0,b=u.childNodes.length;y<b;y++){m.push(u.childNodes[y])}m.push(s);[].splice.apply(e,[h,1].concat(m));b=e.length;h--;break}default:{if(u&&u.childNodes.length){m=[];for(var y=0,b=u.childNodes.length;y<b;y++){m.push(u.childNodes[y])}m.push(s);[].splice.apply(e,[h,1].concat(m));b=e.length;h--}else{if(u&&u.textContent!==undefined){n+=u.textContent}else{n+=""}}}}}n=n.replace(/^\n*|\n*$/g,"");n=n.replace(new RegExp("(\n|\r|\n\r)( |"+String.fromCharCode(160)+"){4}","g"),"$1\t");t.getSelectedNode().setText(n);if(c){t.queryCommandState("bold")||t.execCommand("bold")}else{t.queryCommandState("bold")&&t.execCommand("bold")}if(d){t.queryCommandState("italic")||t.execCommand("italic")}else{t.queryCommandState("italic")&&t.execCommand("italic")}g();return n}function p(e,n){try{t.decodeData("text",n).then(function(n){function r(e,t,n){var i=t.data;e.setText(i.text||"");var a=t.children||[];for(var o=0;o<a.length;o++){var l=n.createNode(null,e);r(l,a[o],n)}return e}r(e,n,t);t.fire("contentchange");t.getRoot().renderTree();t.layout(300)})}catch(e){t.fire("contentchange");t.getRoot().renderTree();if(e.toString()!=="Error: Invalid local format"){throw e}}}function f(){var e=[].slice.call(i.childNodes);setTimeout(function(){i.innerHTML=""},0);var n=t.getSelectedNode();e=m(e);p(n,e);if(n.type=="root"){var r=t.getRoot().getText();t.fire("initChangeRoot",{text:r})}}function g(){i.classList.remove("input");r.selectAll()}function v(){var e=v;var n=t.getSelectedNode();if(!n)return;if(!e.timer){e.timer=setTimeout(function(){var t=n.getRenderBox("TextRenderer");i.style.left=Math.round(t.x)+"px";i.style.top=(a.flaged?Math.round(t.bottom+30):Math.round(t.y))+"px";e.timer=0})}}}return r.exports=o}};e[13]={value:function(t,n,r){var i=e.r(2);function a(e){if(e.ctrlKey||e.metaKey||e.altKey)return false;if(e.keyCode>=65&&e.keyCode<=90)return true;if(e.keyCode>=48&&e.keyCode<=57)return true;if(e.keyCode!=108&&e.keyCode>=96&&e.keyCode<=111)return true;if(e.keyCode!=108&&e.keyCode>=96&&e.keyCode<=111)return true;if(e.keyCode==229||e.keyCode===0)return true;return false}function o(){var e=this.fsm;var t=this.minder;var n=this.receiver;var r=this.container;var o=n.element;var l=this.hotbox;n.listen("normal",function(r){n.enable();if(r.is("Space")){r.preventDefault();if(kity.Browser.safari){o.innerHTML=""}return e.jump("hotbox","space-trigger")}switch(r.type){case"keydown":{if(t.getSelectedNode()){if(a(r)){return e.jump("input","user-input")}}else{o.innerHTML=""}e.jump("normal","shortcut-handle",r);break}case"keyup":{break}default:{}}});n.listen("hotbox",function(t){n.disable();t.preventDefault();var r=l.dispatch(t);if(l.state()==i.STATE_IDLE&&e.state()=="hotbox"){return e.jump("normal","hotbox-idle")}});n.listen("input",function(t){n.enable();if(t.type=="keydown"){if(t.is("Enter")){t.preventDefault();return e.jump("normal","input-commit")}if(t.is("Esc")){t.preventDefault();return e.jump("normal","input-cancel")}if(t.is("Tab")||t.is("Shift + Tab")){t.preventDefault()}}else if(t.type=="keyup"&&t.is("Esc")){t.preventDefault();return e.jump("normal","input-cancel")}});var s,c;var d=2;r.addEventListener("mousedown",function(t){if(t.button==d){t.preventDefault()}if(e.state()=="hotbox"){l.active(i.STATE_IDLE);e.jump("normal","blur")}else if(e.state()=="normal"&&t.button==d){s=t.clientX;c=t.clientY}},false);r.addEventListener("mousewheel",function(t){if(e.state()=="hotbox"){l.active(i.STATE_IDLE);e.jump("normal","mousemove-blur")}},false);r.addEventListener("contextmenu",function(e){e.preventDefault()});r.addEventListener("mouseup",function(n){if(e.state()!="normal"){return}if(n.button!=d||n.clientX!=s||n.clientY!=c){return}if(!t.getSelectedNode()){return}e.jump("hotbox","content-menu")},false);l.$element.addEventListener("mousedown",function(e){e.stopPropagation()})}return r.exports=o}};e[14]={value:function(t,n,r){var i=e.r(4);function a(){var e=new i({enableKeyReceiver:false,enableAnimation:true});e.renderTo(this.selector);e.setTheme(null);e.select(e.getRoot(),true);e.execCommand("text","中心主题");this.minder=e}return r.exports=a}};e[15]={value:function(e,t,n){function r(){var e=this;var t=this.minder;var n=this.hotbox;var r=this.fsm;var i=n.state("main");var a=["前移:Alt+Up:ArrangeUp","下级:Tab|Insert:AppendChildNode","同级:Enter:AppendSiblingNode","后移:Alt+Down:ArrangeDown","删除:Delete|Backspace:RemoveNode","上级:Shift+Tab|Shift+Insert:AppendParentNode"];var o=0;a.forEach(function(n){var a=n.split(":");var l=a.shift();var s=a.shift();var c=a.shift();i.button({position:"ring",label:l,key:s,action:function(){if(c.indexOf("Append")===0){o++;t.execCommand(c,"分支主题");function n(){if(!--o){e.editText()}t.off("layoutallfinish",n)}t.on("layoutallfinish",n)}else{t.execCommand(c);r.jump("normal","command-executed")}},enable:function(){return t.queryCommandState(c)!=-1}})});i.button({position:"bottom",label:"导入节点",key:"Alt + V",enable:function(){var e=t.getSelectedNodes();return e.length==1},action:l,next:"idle"});i.button({position:"bottom",label:"导出节点",key:"Alt + C",enable:function(){var e=t.getSelectedNodes();return e.length==1},action:s,next:"idle"});function l(){t.fire("importNodeData")}function s(){t.fire("exportNodeData")}}return n.exports=r}};e[16]={value:function(e,t,n){function r(){var e=this.minder;var t=this.hotbox;var n=t.state("main");n.button({position:"top",label:"优先级",key:"P",next:"priority",enable:function(){return e.queryCommandState("priority")!=-1}});var r=t.state("priority");"123456789".replace(/./g,function(t){r.button({position:"ring",label:"P"+t,key:t,action:function(){e.execCommand("Priority",t)}})});r.button({position:"center",label:"移除",key:"Del",action:function(){e.execCommand("Priority",0)}});r.button({position:"top",label:"返回",key:"esc",next:"back"})}return n.exports=r}};e[17]={value:function(e,t,n){function r(){var e=this.minder;var t=this.hotbox;var n=t.state("main");n.button({position:"top",label:"进度",key:"G",next:"progress",enable:function(){return e.queryCommandState("progress")!=-1}});var r=t.state("progress");"012345678".replace(/./g,function(t){r.button({position:"ring",label:"G"+t,key:t,action:function(){e.execCommand("Progress",parseInt(t)+1)}})});r.button({position:"center",label:"移除",key:"Del",action:function(){e.execCommand("Progress",0)}});r.button({position:"top",label:"返回",key:"esc",next:"back"})}return n.exports=r}};e[18]={value:function(t,n,r){var i=e.r(23);var a=e.r(2);function o(){var e=this.fsm;var t=this.minder;var n=this;var r=document.createElement("div");r.contentEditable=true;r.setAttribute("tabindex",-1);r.classList.add("receiver");r.onkeydown=r.onkeypress=r.onkeyup=l;this.container.appendChild(r);var a={element:r,selectAll:function(){if(!r.innerHTML)r.innerHTML="&nbsp;";var e=document.createRange();var t=window.getSelection();e.selectNodeContents(r);t.removeAllRanges();t.addRange(e);r.focus()},enable:function(){r.setAttribute("contenteditable",true)},disable:function(){r.setAttribute("contenteditable",false)},fixFFCaretDisappeared:function(){r.removeAttribute("contenteditable");r.setAttribute("contenteditable","true");r.blur();r.focus()},onblur:function(e){r.onblur=e}};a.selectAll();t.on("beforemousedown",a.selectAll);t.on("receiverfocus",a.selectAll);t.on("readonly",function(){t.disable();editor.receiver.element.parentElement.removeChild(editor.receiver.element);editor.hotbox.$container.removeChild(editor.hotbox.$element)});var o=[];a.listen=function(e,t){if(arguments.length==1){t=e;e="*"}t.notifyState=e;o.push(t)};function l(t){t.is=function(e){var t=e.split("|");for(var n=0;n<t.length;n++){if(i.is(this,t[n]))return true}return false};var n,r;for(var a=0;a<o.length;a++){n=o[a];if(n.notifyState!="*"&&n.notifyState!=e.state()){continue}if(n.call(null,t)){return}}}this.receiver=a}return r.exports=o}};e[19]={value:function(t,n,r){var i=e.r(20);function a(){}function o(e){var t=0;for(var n=0;n<e.length;n++){t+=e.charCodeAt(n)}return t}function l(e){var t=this.flaged=window.location.search.indexOf(e)!=-1;if(t){var n=o(e)%360;var r=i("background: hsl({0}, 50%, 80%); "+"color: hsl({0}, 100%, 30%); "+"padding: 2px 3px; "+"margin: 1px 3px 0 0;"+"border-radius: 2px;",n);var l="background: none; color: black;";this.log=function(){var t=i.apply(null,arguments);console.log(i("%c{0}%c{1}",e,t),r,l)}}else{this.log=a}}return r.exports=l}};e[20]={value:function(e,t,n){function r(e,t){if(typeof t!="object"){t=[].slice.call(arguments,1)}return String(e).replace(/\{(\w+)\}/gi,function(e,n){return t[n]||n})}return n.exports=r}};e[21]={value:function(e,t,n){if(!("innerText"in document.createElement("a"))&&"getSelection"in window){HTMLElement.prototype.__defineGetter__("innerText",function(){var e=window.getSelection(),t=[],n,r;for(r=0;r<e.rangeCount;r++){t[r]=e.getRangeAt(r)}e.removeAllRanges();e.selectAllChildren(this);n=e.toString();e.removeAllRanges();for(r=0;r<t.length;r++){e.addRange(t[r])}return n});HTMLElement.prototype.__defineSetter__("innerText",function(e){this.innerHTML=(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")})}}};e[22]={value:function(e,t,n){var r=function(){if(Object.keys)return Object.keys;return function(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(n)}}return t}}();function i(e){if(e.indexOf("/")===-1&&e.indexOf("~")===-1)return e;return e.replace(/~/g,"~0").replace(/\//g,"~1")}function a(e){if(typeof e==="object"){return JSON.parse(JSON.stringify(e))}else{return e}}function o(e,t,n,l){var s=r(t);var c=r(e);var d=false;var u=false;for(var m=c.length-1;m>=0;m--){var p=c[m];var f=e[p];if(t.hasOwnProperty(p)){var g=t[p];if(typeof f=="object"&&f!=null&&typeof g=="object"&&g!=null){o(f,g,n,l+"/"+i(p))}else{if(f!=g){d=true;n.push({op:"replace",path:l+"/"+i(p),value:a(g)})}}}else{n.push({op:"remove",path:l+"/"+i(p)});u=true}}if(!u&&s.length==c.length){return}for(var m=0;m<s.length;m++){var p=s[m];if(!e.hasOwnProperty(p)){n.push({op:"add",path:l+"/"+i(p),value:a(t[p])})}}}function l(e,t){var n=[];o(e,t,n,"");return n}return n.exports=l}};e[23]={value:function(t,n,r){var i=e.r(24);var a=4096;var o=8192;var l=16384;function s(e){if(typeof e=="string"){return u(e)}return d(e)}function c(e,t){return e&&t&&s(e)==s(t)}n.hash=s;n.is=c;function d(e){var t=0;if(e.ctrlKey||e.metaKey){t|=a}if(e.altKey){t|=o}if(e.shiftKey){t|=l}if([16,17,18,91].indexOf(e.keyCode)===-1){if(e.keyCode===229&&e.keyIdentifier){return t|=parseInt(e.keyIdentifier.substr(2),16)}t|=e.keyCode}return t}function u(e){var t=0;e.toLowerCase().split(/\s*\+\s*/).forEach(function(e){switch(e){case"ctrl":case"cmd":t|=a;break;case"alt":t|=o;break;case"shift":t|=l;break;default:t|=i[e]}});return t}}};e[24]={value:function(e,t,n){var r={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var i in r){if(r.hasOwnProperty(i)){r[i.toLowerCase()]=r[i]}}var a=65;var o="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(e){r[e]=a+(e.charCodeAt(0)-o)});var l=9;do{r[l.toString()]=l+48}while(--l);n.exports=r}};var t={"expose-editor":1};function n(n){e.r([t[n]])}angular.module("kityminderEditor",["ui.bootstrap","ui.codemirror","ui.colorpicker"]).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://agroup.baidu.com:8910/**","http://cq01-fe-rdtest01.vm.baidu.com:8910/**","http://agroup.baidu.com:8911/**"])}]);angular.module("kityminderEditor").run(["$templateCache",function(e){"use strict";e.put("ui/directive/appendNode/appendNode.html","<div class=\"km-btn-group append-group\"><div class=\"km-btn-item append-child-node\" ng-disabled=\"minder.queryCommandState('AppendChildNode') === -1\" ng-click=\"minder.queryCommandState('AppendChildNode') === -1 || execCommand('AppendChildNode')\" title=\"{{ 'appendchildnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendchildnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item append-parent-node\" ng-disabled=\"minder.queryCommandState('AppendParentNode') === -1\" ng-click=\"minder.queryCommandState('AppendParentNode') === -1 || execCommand('AppendParentNode')\" title=\"{{ 'appendparentnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendparentnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item append-sibling-node\" ng-disabled=\"minder.queryCommandState('AppendSiblingNode') === -1\" ng-click=\"minder.queryCommandState('AppendSiblingNode') === -1 ||execCommand('AppendSiblingNode')\" title=\"{{ 'appendsiblingnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendsiblingnode' | lang:'ui/command' }}</span></div></div>");e.put("ui/directive/arrange/arrange.html","<div class=\"km-btn-group arrange-group\"><div class=\"km-btn-item arrange-up\" ng-disabled=\"minder.queryCommandState('ArrangeUp') === -1\" ng-click=\"minder.queryCommandState('ArrangeUp') === -1 || minder.execCommand('ArrangeUp')\" title=\"{{ 'arrangeup' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'arrangeup' | lang:'ui/command' }}</span></div><div class=\"km-btn-item arrange-down\" ng-disabled=\"minder.queryCommandState('ArrangeDown') === -1\" ng-click=\"minder.queryCommandState('ArrangeDown') === -1 || minder.execCommand('ArrangeDown');\" title=\"{{ 'arrangedown' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'arrangedown' | lang:'ui/command' }}</span></div></div>");e.put("ui/directive/colorPanel/colorPanel.html",'<div class="bg-color-wrap"><span class="quick-bg-color" ng-click="minder.queryCommandState(\'background\') === -1 || minder.execCommand(\'background\', bgColor)" ng-disabled="minder.queryCommandState(\'background\') === -1"></span> <span color-picker class="bg-color" set-color="setDefaultBg()" ng-disabled="minder.queryCommandState(\'background\') === -1"><span class="caret"></span></span> <span class="bg-color-preview" ng-style="{ \'background-color\': bgColor }" ng-click="minder.queryCommandState(\'background\') === -1 || minder.execCommand(\'background\', bgColor)" ng-disabled="minder.queryCommandState(\'background\') === -1"></span></div>');e.put("ui/directive/expandLevel/expandLevel.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default expand" title="{{ \'expandtoleaf\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="minder.execCommand(\'ExpandToLevel\', 9999)"></button> <button type="button" class="btn btn-default expand-caption dropdown-toggle" title="{{ \'expandtoleaf\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'expandtoleaf\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'expandtoleaf\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="level in levels"><a href ng-click="minder.execCommand(\'ExpandToLevel\', level)">{{ \'expandtolevel\' + level | lang:\'ui/command\' }}</a></li></ul></div>');e.put("ui/directive/fontOperator/fontOperator.html",'<div class="font-operator"><div class="dropdown font-family-list" dropdown><div class="dropdown-toggle current-font-item" dropdown-toggle ng-disabled="minder.queryCommandState(\'fontfamily\') === -1"><a href class="current-font-family" title="{{ \'fontfamily\' | lang: \'ui\' }}">{{ getFontfamilyName(minder.queryCommandValue(\'fontfamily\')) || \'字体\' }}</a> <span class="caret"></span></div><ul class="dropdown-menu font-list"><li ng-repeat="f in fontFamilyList" class="font-item-wrap"><a ng-click="minder.execCommand(\'fontfamily\', f.val)" class="font-item" ng-class="{ \'font-item-selected\' : f == minder.queryCommandValue(\'fontfamily\') }" ng-style="{\'font-family\': f.val }">{{ f.name }}</a></li></ul></div><div class="dropdown font-size-list" dropdown><div class="dropdown-toggle current-font-item" dropdown-toggle ng-disabled="minder.queryCommandState(\'fontsize\') === -1"><a href class="current-font-size" title="{{ \'fontsize\' | lang: \'ui\' }}">{{ minder.queryCommandValue(\'fontsize\') || \'字号\' }}</a> <span class="caret"></span></div><ul class="dropdown-menu font-list"><li ng-repeat="f in fontSizeList" class="font-item-wrap"><a ng-click="minder.execCommand(\'fontsize\', f)" class="font-item" ng-class="{ \'font-item-selected\' : f == minder.queryCommandValue(\'fontsize\') }" ng-style="{\'font-size\': f + \'px\'}">{{ f }}</a></li></ul></div><span class="s-btn-icon font-bold" ng-click="minder.queryCommandState(\'bold\') === -1 || minder.execCommand(\'bold\')" ng-class="{\'font-bold-selected\' : minder.queryCommandState(\'bold\') == 1}" ng-disabled="minder.queryCommandState(\'bold\') === -1"></span> <span class="s-btn-icon font-italics" ng-click="minder.queryCommandState(\'italic\') === -1 || minder.execCommand(\'italic\')" ng-class="{\'font-italics-selected\' : minder.queryCommandState(\'italic\') == 1}" ng-disabled="minder.queryCommandState(\'italic\') === -1"></span><div class="font-color-wrap"><span class="quick-font-color" ng-click="minder.queryCommandState(\'forecolor\') === -1 || minder.execCommand(\'forecolor\', foreColor)" ng-disabled="minder.queryCommandState(\'forecolor\') === -1">A</span> <span color-picker class="font-color" set-color="setDefaultColor()" ng-disabled="minder.queryCommandState(\'forecolor\') === -1"><span class="caret"></span></span> <span class="font-color-preview" ng-style="{ \'background-color\': foreColor }" ng-click="minder.queryCommandState(\'forecolor\') === -1 || minder.execCommand(\'forecolor\', foreColor)" ng-disabled="minder.queryCommandState(\'forecolor\') === -1"></span></div><color-panel minder="minder" class="inline-directive"></color-panel></div>');e.put("ui/directive/hyperLink/hyperLink.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default hyperlink" title="{{ \'link\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="addHyperlink()" ng-disabled="minder.queryCommandState(\'HyperLink\') === -1"></button> <button type="button" class="btn btn-default hyperlink-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'HyperLink\') === -1" title="{{ \'link\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'link\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'link\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li><a href ng-click="addHyperlink()">{{ \'insertlink\' | lang:\'ui\' }}</a></li><li><a href ng-click="minder.execCommand(\'HyperLink\', null)">{{ \'removelink\' | lang:\'ui\' }}</a></li></ul></div>');e.put("ui/directive/imageBtn/imageBtn.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default image-btn" title="{{ \'image\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="addImage()" ng-disabled="minder.queryCommandState(\'Image\') === -1"></button> <button type="button" class="btn btn-default image-btn-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'Image\') === -1" title="{{ \'image\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'image\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'image\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li><a href ng-click="addImage()">{{ \'insertimage\' | lang:\'ui\' }}</a></li><li><a href ng-click="minder.execCommand(\'Image\', \'\')">{{ \'removeimage\' | lang:\'ui\' }}</a></li></ul></div>');e.put("ui/directive/kityminderEditor/kityminderEditor.html",'<div class="minder-editor-container"><div class="top-tab" top-tab="minder" editor="editor" ng-if="minder"></div><div search-box minder="minder" ng-if="minder"></div><div class="minder-editor"></div><div class="km-note" note-editor minder="minder" ng-if="minder"></div><div class="note-previewer" note-previewer ng-if="minder"></div><div class="navigator" navigator minder="minder" ng-if="minder"></div></div>');e.put("ui/directive/kityminderViewer/kityminderViewer.html",'<div class="minder-editor-container"><div class="minder-viewer"></div><div class="note-previewer" note-previewer ng-if="minder"></div><div class="navigator" navigator minder="minder" ng-if="minder"></div></div>');e.put("ui/directive/layout/layout.html",'<div class="readjust-layout"><a ng-click="minder.queryCommandState(\'resetlayout\') === -1 || minder.execCommand(\'resetlayout\')" class="btn-wrap" ng-disabled="minder.queryCommandState(\'resetlayout\') === -1"><span class="btn-icon reset-layout-icon"></span> <span class="btn-label">{{ \'resetlayout\' | lang: \'ui/command\' }}</span></a></div>');
e.put("ui/directive/navigator/navigator.html",'<div class="nav-bar"><div class="nav-btn zoom-in" ng-click="minder.execCommand(\'zoomIn\')" title="{{ \'zoom-in\' | lang : \'ui\' }}" ng-class="{ \'active\' : getZoomRadio(zoom) == 0 }"><div class="icon"></div></div><div class="zoom-pan"><div class="origin" ng-style="{\'transform\': \'translate(0, \' + getHeight(100) + \'px)\'}" ng-click="minder.execCommand(\'zoom\', 100);"></div><div class="indicator" ng-style="{\n'+"             'transform': 'translate(0, ' + getHeight(zoom) + 'px)',\n"+"             'transition': 'transform 200ms'\n"+'             }"></div></div><div class="nav-btn zoom-out" ng-click="minder.execCommand(\'zoomOut\')" title="{{ \'zoom-out\' | lang : \'ui\' }}" ng-class="{ \'active\' : getZoomRadio(zoom) == 1 }"><div class="icon"></div></div><div class="nav-btn hand" ng-click="minder.execCommand(\'hand\')" title="{{ \'hand\' | lang : \'ui\' }}" ng-class="{ \'active\' : minder.queryCommandState(\'hand\') == 1 }"><div class="icon"></div></div><div class="nav-btn camera" ng-click="minder.execCommand(\'camera\', minder.getRoot(), 600);" title="{{ \'camera\' | lang : \'ui\' }}"><div class="icon"></div></div><div class="nav-btn nav-trigger" ng-class="{\'active\' : isNavOpen}" ng-click="toggleNavOpen()" title="{{ \'navigator\' | lang : \'ui\' }}"><div class="icon"></div></div></div><div class="nav-previewer" ng-show="isNavOpen"></div>');e.put("ui/directive/noteBtn/noteBtn.html",'<div class="btn-group-vertical note-btn-group" dropdown is-open="isopen"><button type="button" class="btn btn-default note-btn" title="{{ \'note\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="addNote()" ng-disabled="minder.queryCommandState(\'note\') === -1"></button> <button type="button" class="btn btn-default note-btn-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'note\') === -1" title="{{ \'note\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'note\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'note\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li><a href ng-click="addNote()">{{ \'insertnote\' | lang:\'ui\' }}</a></li><li><a href ng-click="minder.execCommand(\'note\', null)">{{ \'removenote\' | lang:\'ui\' }}</a></li></ul></div>');e.put("ui/directive/noteEditor/noteEditor.html",'<div class="panel panel-default" ng-init="noteEditorOpen = false" ng-show="noteEditorOpen"><div class="panel-heading"><h3 class="panel-title">备注</h3><span>（<a class="help" href="https://www.zybuluo.com/techird/note/46064" target="_blank">支持 GFM 语法书写</a>）</span> <i class="close-note-editor glyphicon glyphicon-remove" ng-click="closeNoteEditor()"></i></div><div class="panel-body"><div ng-show="noteEnabled" ui-codemirror="{ onLoad: codemirrorLoaded }" ng-model="noteContent" ui-codemirror-opts="{\n'+"                gfm: true,\n"+"                breaks: true,\n"+"                lineWrapping : true,\n"+"                mode: 'gfm',\n"+"                dragDrop: false,\n"+"                lineNumbers:true\n"+'             }"></div><p ng-show="!noteEnabled" class="km-note-tips">请选择节点编辑备注</p></div></div>');e.put("ui/directive/notePreviewer/notePreviewer.html",'<div id="previewer-content" ng-show="showNotePreviewer" ng-style="previewerStyle" ng-bind-html="noteContent"></div>');e.put("ui/directive/operation/operation.html","<div class=\"km-btn-group operation-group\"><div class=\"km-btn-item edit-node\" ng-disabled=\"minder.queryCommandState('text') === -1\" ng-click=\"minder.queryCommandState('text') === -1 || editNode()\" title=\"{{ 'editnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'editnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item remove-node\" ng-disabled=\"minder.queryCommandState('RemoveNode') === -1\" ng-click=\"minder.queryCommandState('RemoveNode') === -1 || minder.execCommand('RemoveNode');\" title=\"{{ 'removenode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'removenode' | lang:'ui/command' }}</span></div></div>");e.put("ui/directive/priorityEditor/priorityEditor.html",'<ul class="km-priority tool-group" ng-disabled="commandDisabled"><li class="km-priority-item tool-group-item" ng-repeat="p in priorities" ng-click="commandDisabled || minder.execCommand(\'priority\', p)" ng-class="{ active: commandValue == p }" title="{{ getPriorityTitle(p) }}"><div class="km-priority-icon tool-group-icon priority-{{p}}"></div></li></ul>');e.put("ui/directive/progressEditor/progressEditor.html",'<ul class="km-progress tool-group" ng-disabled="commandDisabled"><li class="km-progress-item tool-group-item" ng-repeat="p in progresses" ng-click="commandDisabled || minder.execCommand(\'progress\', p)" ng-class="{ active: commandValue == p }" title="{{ getProgressTitle(p) }}"><div class="km-progress-icon tool-group-icon progress-{{p}}"></div></li></ul>');e.put("ui/directive/resourceEditor/resourceEditor.html",'<div class="resource-editor"><div class="input-group"><input class="form-control" type="text" ng-model="newResourceName" ng-required ng-keypress="$event.keyCode == 13 && addResource(newResourceName)" ng-disabled="!enabled"> <span class="input-group-btn"><button class="btn btn-default" ng-click="addResource(newResourceName)" ng-disabled="!enabled">添加</button></span></div><div class="resource-dropdown clearfix" id="resource-dropdown"><ul class="km-resource" ng-init="resourceListOpen = false" ng-class="{\'open\': resourceListOpen}"><li ng-repeat="resource in used" ng-disabled="!enabled" ng-blur="blurCB()"><label style="background: {{resourceColor(resource.name)}}"><input type="checkbox" ng-model="resource.selected" ng-disabled="!enabled"> <span>{{resource.name}}</span></label></li></ul><div class="resource-caret" click-anywhere-but-here="resourceListOpen = false" is-active="resourceListOpen" ng-click="resourceListOpen = !resourceListOpen"><span class="caret"></span></div></div></div>');e.put("ui/directive/searchBox/searchBox.html",'<div id="search" class="search-box clearfix" ng-show="showSearch"><div class="input-group input-group-sm search-input-wrap"><input type="text" id="search-input" class="form-control search-input" ng-model="keyword" ng-keydown="handleKeyDown($event)" aria-describedby="basic-addon2"> <span class="input-group-addon search-addon" id="basic-addon2" ng-show="showTip" ng-bind="\'第 \' + curIndex + \' 条，共 \' + resultNum + \' 条\'"></span></div><div class="btn-group btn-group-sm prev-and-next-btn" role="group"><button type="button" class="btn btn-default" ng-click="doSearch(keyword, \'prev\')"><span class="glyphicon glyphicon-chevron-up"></span></button> <button type="button" class="btn btn-default" ng-click="doSearch(keyword, \'next\')"><span class="glyphicon glyphicon-chevron-down"></span></button></div><div class="close-search" ng-click="exitSearch()"><span class="glyphicon glyphicon-remove"></span></div></div>');e.put("ui/directive/searchBtn/searchBtn.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default search" title="{{ \'search\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="enterSearch()"></button> <button type="button" class="btn btn-default search-caption dropdown-toggle" ng-click="enterSearch()" title="{{ \'search\' | lang:\'ui\' }}"><span class="caption">{{ \'search\' | lang:\'ui\' }}</span> <span class="sr-only">{{ \'search\' | lang:\'ui\' }}</span></button></div>');e.put("ui/directive/selectAll/selectAll.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default select" title="{{ \'selectall\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="select[\'all\']()"></button> <button type="button" class="btn btn-default select-caption dropdown-toggle" title="{{ \'selectall\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'selectall\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'selectall\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="item in items"><a href ng-click="select[item]()">{{ \'select\' + item | lang:\'ui\' }}</a></li></ul></div>');e.put("ui/directive/styleOperator/styleOperator.html",'<div class="style-operator"><a ng-click="minder.queryCommandState(\'clearstyle\') === -1 || minder.execCommand(\'clearstyle\')" class="btn-wrap clear-style" ng-disabled="minder.queryCommandState(\'clearstyle\') === -1"><span class="btn-icon clear-style-icon"></span> <span class="btn-label">{{ \'clearstyle\' | lang: \'ui\' }}</span></a><div class="s-btn-group-vertical"><a class="s-btn-wrap" href ng-click="minder.queryCommandState(\'copystyle\') === -1 || minder.execCommand(\'copystyle\')" ng-disabled="minder.queryCommandState(\'copystyle\') === -1"><span class="s-btn-icon copy-style-icon"></span> <span class="s-btn-label">{{ \'copystyle\' | lang: \'ui\' }}</span></a> <a class="s-btn-wrap paste-style-wrap" href ng-click="minder.queryCommandState(\'pastestyle\') === -1 || minder.execCommand(\'pastestyle\')" ng-disabled="minder.queryCommandState(\'pastestyle\') === -1"><span class="s-btn-icon paste-style-icon"></span> <span class="s-btn-label">{{ \'pastestyle\' | lang: \'ui\' }}</span></a></div></div>');e.put("ui/directive/templateList/templateList.html",'<div class="dropdown temp-panel" dropdown on-toggle="toggled(open)"><div class="dropdown-toggle current-temp-item" ng-disabled="minder.queryCommandState(\'template\') === -1" dropdown-toggle><a href class="temp-item {{ minder.queryCommandValue(\'template\') }}" title="{{ minder.queryCommandValue(\'template\') | lang: \'template\' }}"></a> <span class="caret"></span></div><ul class="dropdown-menu temp-list"><li ng-repeat="(key, templateObj) in templateList" class="temp-item-wrap"><a ng-click="minder.execCommand(\'template\', key);" class="temp-item {{key}}" ng-class="{ \'temp-item-selected\' : key == minder.queryCommandValue(\'template\') }" title="{{ key | lang: \'template\' }}"></a></li></ul></div>');e.put("ui/directive/themeList/themeList.html",'<div class="dropdown theme-panel" dropdown><div class="dropdown-toggle theme-item-selected" dropdown-toggle ng-disabled="minder.queryCommandState(\'theme\') === -1"><a href class="theme-item" ng-style="getThemeThumbStyle(minder.queryCommandValue(\'theme\'))" title="{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}">{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}</a> <span class="caret"></span></div><ul class="dropdown-menu theme-list"><li ng-repeat="key in themeKeyList" class="theme-item-wrap"><a ng-click="minder.execCommand(\'theme\', key);" class="theme-item" ng-style="getThemeThumbStyle(key)" title="{{ key | lang: \'theme\'; }}">{{ key | lang: \'theme\'; }}</a></li></ul></div>');e.put("ui/directive/topTab/topTab.html",'<tabset><tab heading="{{ \'idea\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'idea\')" select="setCurTab(\'idea\')"><undo-redo editor="editor"></undo-redo><append-node minder="minder"></append-node><arrange minder="minder"></arrange><operation minder="minder"></operation><hyper-link minder="minder"></hyper-link><image-btn minder="minder"></image-btn><note-btn minder="minder"></note-btn><priority-editor minder="minder"></priority-editor><progress-editor minder="minder"></progress-editor><resource-editor minder="minder"></resource-editor></tab><tab heading="{{ \'appearence\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'appearance\')" select="setCurTab(\'appearance\')"><template-list minder="minder" class="inline-directive"></template-list><theme-list minder="minder"></theme-list><layout minder="minder" class="inline-directive"></layout><style-operator minder="minder" class="inline-directive"></style-operator><font-operator minder="minder" class="inline-directive"></font-operator></tab><tab heading="{{ \'view\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'view\')" select="setCurTab(\'view\')"><expand-level minder="minder"></expand-level><select-all minder="minder"></select-all><search-btn minder="minder"></search-btn></tab></tabset>');e.put("ui/directive/undoRedo/undoRedo.html",'<div class="km-btn-group do-group"><div class="km-btn-item undo" ng-disabled="editor.history.hasUndo() == false" ng-click="editor.history.hasUndo() == false || editor.history.undo();" title="{{ \'undo\' | lang:\'ui\' }}"><i class="km-btn-icon"></i></div><div class="km-btn-item redo" ng-disabled="editor.history.hasRedo() == false" ng-click="editor.history.hasRedo() == false || editor.history.redo()" title="{{ \'redo\' | lang:\'ui\' }}"><i class="km-btn-icon"></i></div></div>');e.put("ui/dialog/hyperlink/hyperlink.tpl.html",'<div class="modal-header"><h3 class="modal-title">链接</h3></div><div class="modal-body"><form><div class="form-group" id="link-url-wrap" ng-class="{true: \'has-success\', false: \'has-error\'}[urlPassed]"><label for="link-url">链接地址：</label><input type="text" class="form-control" ng-model="url" ng-blur="urlPassed = R_URL.test(url)" ng-focus="this.value = url" ng-keydown="shortCut($event)" id="link-url" placeholder="必填：以 http(s):// 或 ftp:// 开头"></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="link-title">提示文本：</label><input type="text" class="form-control" ng-model="title" ng-blur="titlePassed = true" id="link-title" placeholder="选填：鼠标在链接上悬停时提示的文本"></div></form></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">确定</button> <button class="btn btn-warning" ng-click="cancel()">取消</button></div>');e.put("ui/dialog/imExportNode/imExportNode.tpl.html",'<div class="modal-header"><h3 class="modal-title">{{ title }}</h3></div><div class="modal-body"><textarea type="text" class="form-control single-input" rows="8" ng-keydown="shortCut($event);" ng-model="value" ng-readonly="type === \'export\'">\n'+'    </textarea></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()" ng-disabled="type === \'import\' && value == \'\'">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>');e.put("ui/dialog/image/image.tpl.html",'<div class="modal-header"><h3 class="modal-title">图片</h3></div><div class="modal-body"><tabset><tab heading="图片搜索"><form class="form-inline"><div class="form-group"><label for="search-keyword">关键词：</label><input type="text" class="form-control" ng-model="data.searchKeyword2" id="search-keyword" placeholder="请输入搜索的关键词"></div><button class="btn btn-primary" ng-click="searchImage()">百度一下</button></form><div class="search-result" id="search-result"><ul><li ng-repeat="image in list" id="{{ \'img-item\' + $index }}" ng-class="{\'selected\' : isSelected}" ng-click="selectImage($event)"><img id="{{ \'img-\' + $index }}" ng-src="{{ image.src || \'\' }}" alt="{{ image.title }}" onerror="this.parentNode.removeChild(this)"> <span>{{ image.title }}</span></li></ul></div></tab><tab heading="插入图片" active="true"><form><div class="form-group" ng-class="{true: \'has-success\', false: \'has-error\'}[urlPassed]"><label for="image-url">链接地址：</label><input type="text" class="form-control" ng-model="data.url" ng-blur="urlPassed = data.R_URL.test(data.url)" ng-focus="this.value = data.url" ng-keydown="shortCut($event)" id="image-url" placeholder="必填：以 http(s):// 开头"></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="image-title">提示文本：</label><input type="text" class="form-control" ng-model="data.title" ng-blur="titlePassed = true" id="image-title" placeholder="选填：鼠标在图片上悬停时提示的文本"></div><div class="form-group"><label for="image-preview">图片预览：</label><img class="image-preview" id="image-preview" ng-src="{{ data.url }}" alt="{{ data.title }}"></div></form></tab></tabset></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">确定</button> <button class="btn btn-warning" ng-click="cancel()">取消</button></div>')}]);angular.module("kityminderEditor").service("commandBinder",function(){return{bind:function(e,t,n){e.on("interactchange",function(){n.commandDisabled=e.queryCommandState(t)===-1;n.commandValue=e.queryCommandValue(t);n.$apply()})}}});angular.module("kityminderEditor").service("config",function(){return{_default:{ctrlPanelMin:250,ctrlPanelWidth:parseInt(window.localStorage.__dev_minder_ctrlPanelWidth)||250,dividerWidth:3,defaultLang:"zh-cn",zoom:[10,20,30,50,80,100,120,150,200]},getConfig:function(e){return e==undefined?this._default:this._default[e]||null},setConfig:function(e){this._default=e}}});angular.module("kityminderEditor").service("lang.zh-cn",function(){return{"zh-cn":{template:{default:"思维导图",tianpan:"天盘图",structure:"组织结构图",filetree:"目录组织图",right:"逻辑结构图","fish-bone":"鱼骨头图"},theme:{classic:"脑图经典","classic-compact":"紧凑经典",snow:"温柔冷光","snow-compact":"紧凑冷光",fish:"鱼骨图",wire:"线框","fresh-red":"清新红","fresh-soil":"泥土黄","fresh-green":"文艺绿","fresh-blue":"天空蓝","fresh-purple":"浪漫紫","fresh-pink":"脑残粉","fresh-red-compat":"紧凑红","fresh-soil-compat":"紧凑黄","fresh-green-compat":"紧凑绿","fresh-blue-compat":"紧凑蓝","fresh-purple-compat":"紧凑紫","fresh-pink-compat":"紧凑粉",tianpan:"经典天盘","tianpan-compact":"紧凑天盘"},maintopic:"中心主题",topic:"分支主题",panels:{history:"历史",template:"模板",theme:"皮肤",layout:"布局",style:"样式",font:"文字",color:"颜色",background:"背景",insert:"插入",arrange:"调整",nodeop:"当前",priority:"优先级",progress:"进度",resource:"资源",note:"备注",attachment:"附件",word:"文字"},error_message:{title:"哎呀，脑图出错了",err_load:"加载脑图失败",err_save:"保存脑图失败",err_network:"网络错误",err_doc_resolve:"文档解析失败",err_unknown:"发生了奇怪的错误",err_localfile_read:"文件读取错误",err_download:"文件下载失败",err_remove_share:"取消分享失败",err_create_share:"分享失败",err_mkdir:"目录创建失败",err_ls:"读取目录失败",err_share_data:"加载分享内容出错",err_share_sync_fail:"分享内容同步失败",err_move_file:"文件移动失败",err_rename:"重命名失败",unknownreason:"可能是外星人篡改了代码...",pcs_code:{3:"不支持此接口",4:"没有权限执行此操作",5:"IP未授权",110:"用户会话已过期，请重新登录",31001:"数据库查询错误",31002:"数据库连接错误",31003:"数据库返回空结果",31021:"网络错误",31022:"暂时无法连接服务器",31023:"输入参数错误",31024:"app id为空",31025:"后端存储错误",31041:"用户的cookie不是合法的百度cookie",31042:"用户未登陆",31043:"用户未激活",31044:"用户未授权",31045:"用户不存在",31046:"用户已经存在",31061:"文件已经存在",31062:"文件名非法",31063:"文件父目录不存在",31064:"无权访问此文件",31065:"目录已满",31066:"文件不存在",31067:"文件处理出错",31068:"文件创建失败",31069:"文件拷贝失败",31070:"文件删除失败",31071:"不能读取文件元信息",31072:"文件移动失败",31073:"文件重命名失败",31079:"未找到文件MD5，请使用上传API上传整个文件。",31081:"superfile创建失败",31082:"superfile 块列表为空",31083:"superfile 更新失败",31101:"tag系统内部错误",31102:"tag参数错误",31103:"tag系统错误",31110:"未授权设置此目录配额",31111:"配额管理只支持两级目录",31112:"超出配额",31113:"配额不能超出目录祖先的配额",31114:"配额不能比子目录配额小",31141:"请求缩略图服务失败",31201:"签名错误",31202:"文件不存在",31203:"设置acl失败",31204:"请求acl验证失败",31205:"获取acl失败",31206:"acl不存在",31207:"bucket已存在",31208:"用户请求错误",31209:"服务器错误",31210:"服务器不支持",31211:"禁止访问",31212:"服务不可用",31213:"重试出错",31214:"上传文件data失败",31215:"上传文件meta失败",31216:"下载文件data失败",31217:"下载文件meta失败",31218:"容量超出限额",31219:"请求数超出限额",31220:"流量超出限额",31298:"服务器返回值KEY非法",31299:"服务器返回值KEY不存在"}},ui:{shared_file_title:"[分享的] {0} (只读)",load_share_for_edit:"正在加载分享的文件...",share_sync_success:"分享内容已同步",recycle_clear_confirm:"确认清空回收站么？清空后的文件无法恢复。",fullscreen_exit_hint:"按 Esc 或 F11 退出全屏",error_detail:"详细信息",copy_and_feedback:"复制并反馈",move_file_confirm:'确定把 "{0}" 移动到 "{1}" 吗？',rename:"重命名",rename_success:"{0} 重命名成功",move_success:"{0} 移动成功到 {1}",command:{appendsiblingnode:"插入同级主题",appendparentnode:"插入上级主题",appendchildnode:"插入下级主题",removenode:"删除",editnode:"编辑",arrangeup:"上移",arrangedown:"下移",resetlayout:"整理布局",expandtoleaf:"展开全部节点",expandtolevel1:"展开到一级节点",expandtolevel2:"展开到二级节点",expandtolevel3:"展开到三级节点",expandtolevel4:"展开到四级节点",expandtolevel5:"展开到五级节点",expandtolevel6:"展开到六级节点",fullscreen:"全屏",outline:"大纲"},search:"搜索",expandtoleaf:"展开",back:"返回",undo:"撤销 (Ctrl + Z)",redo:"重做 (Ctrl + Y)",tabs:{idea:"思路",appearence:"外观",view:"视图"},quickvisit:{new:"新建 (Ctrl + Alt + N)",save:"保存 (Ctrl + S)",share:"分享 (Ctrl + Alt + S)",feedback:"反馈问题（F1）",editshare:"编辑"},menu:{mainmenutext:"百度脑图",newtab:"新建",opentab:"打开",savetab:"保存",sharetab:"分享",preferencetab:"设置",helptab:"帮助",feedbacktab:"反馈",recenttab:"最近使用",netdisktab:"百度云存储",localtab:"本地文件",drafttab:"草稿箱",downloadtab:"导出到本地",createsharetab:"当前脑图",managesharetab:"已分享",newheader:"新建脑图",openheader:"打开",saveheader:"保存到",draftheader:"草稿箱",shareheader:"分享我的脑图",downloadheader:"导出到指定格式",preferenceheader:"偏好设置",helpheader:"帮助",feedbackheader:"反馈"},mydocument:"我的文档",emptydir:"目录为空！",pickfile:"选择文件...",acceptfile:"支持的格式：{0}",dropfile:"或将文件拖至此处",unsupportedfile:"不支持的文件格式",untitleddoc:"未命名文档",overrideconfirm:"{0} 已存在，确认覆盖吗？",checklogin:"检查登录状态中...",loggingin:"正在登录...",recent:"最近打开",clearrecent:"清空",clearrecentconfirm:"确认清空最近文档列表？",cleardraft:"清空",cleardraftconfirm:"确认清空草稿箱？",none_share:"不分享",public_share:"公开分享",password_share:"私密分享",email_share:"邮件邀请",url_share:"脑图 URL 地址：",sns_share:"社交网络分享：",sns_share_text:"“{0}” - 我用百度脑图制作的思维导图，快看看吧！（地址：{1}）",none_share_description:"不分享当前脑图",public_share_description:"创建任何人可见的分享",share_button_text:"创建",password_share_description:"创建需要密码才可见的分享",email_share_description:"创建指定人可见的分享，您还可以允许他们编辑",ondev:"敬请期待！",create_share_failed:"分享失败：{0}",remove_share_failed:"删除失败：{1}",copy:"复制",copied:"已复制",shared_tip:"当前脑图被 {0}  分享，你可以修改之后保存到自己的网盘上或再次分享",current_share:"当前脑图",manage_share:"我的分享",share_remove_action:"不分享该脑图",share_view_action:"打开分享地址",share_edit_action:"编辑分享的文件",login:"登录",logout:"注销",switchuser:"切换账户",userinfo:"个人信息",gotonetdisk:"我的网盘",requirelogin:'请 <a class="login-button">登录</a> 后使用',saveas:"保存为",filename:"文件名",fileformat:"保存格式",save:"保存",mkdir:"新建目录",recycle:"回收站",newdir:"未命名目录",bold:"加粗",italic:"斜体",forecolor:"字体颜色",fontfamily:"字体",fontsize:"字号",layoutstyle:"主题",node:"节点操作",saveto:"另存为",hand:"允许拖拽",camera:"定位根节点","zoom-in":"放大（Ctrl+）","zoom-out":"缩小（Ctrl-）",markers:"标签",resource:"资源",help:"帮助",preference:"偏好设置",expandnode:"展开到叶子",collapsenode:"收起到一级节点",template:"模板",theme:"皮肤",clearstyle:"清除样式",copystyle:"复制样式",pastestyle:"粘贴样式",appendsiblingnode:"同级主题",appendchildnode:"下级主题",arrangeup:"前调",arrangedown:"后调",editnode:"编辑",removenode:"移除",priority:"优先级",progress:{p1:"未开始",p2:"完成 1/8",p3:"完成 1/4",p4:"完成 3/8",p5:"完成一半",p6:"完成 5/8",p7:"完成 3/4",p8:"完成 7/8",p9:"已完成",p0:"清除进度"},link:"链接",image:"图片",note:"备注",insertlink:"插入链接",insertimage:"插入图片",insertnote:"插入备注",removelink:"移除已有连接",removeimage:"移除已有图片",removenote:"移除已有备注",resetlayout:"整理",justnow:"刚刚",minutesago:"{0} 分钟前",hoursago:"{0} 小时前",yesterday:"昨天",daysago:"{0} 天前",longago:"很久之前",redirect:"您正在打开连接 {0}，百度脑图不能保证连接的安全性，是否要继续？",navigator:"导航器",unsavedcontent:"当前文件还没有保存到网盘：\n\n{0}\n\n虽然未保存的数据会缓存在草稿箱，但是清除浏览器缓存会导致草稿箱清除。",shortcuts:"快捷键",contact:"联系与反馈",email:"邮件组",qq_group:"QQ 群",github_issue:"Github",baidu_tieba:"贴吧",clipboardunsupported:"您的浏览器不支持剪贴板，请使用快捷键复制",load_success:"{0} 加载成功",save_success:"{0} 已保存于 {1}",autosave_success:"{0} 已自动保存于 {1}",selectall:"全选",selectrevert:"反选",selectsiblings:"选择兄弟节点",selectlevel:"选择同级节点",selectpath:"选择路径",selecttree:"选择子树"},popupcolor:{clearColor:"清空颜色",standardColor:"标准颜色",themeColor:"主题颜色"},dialogs:{markers:{static:{lang_input_text:"文本内容：",lang_input_url:"链接地址：",lang_input_title:"标题：",lang_input_target:"是否在新窗口："},priority:"优先级",none:"无",progress:{title:"进度",notdone:"未完成",done1:"完成 1/8",done2:"完成 1/4",done3:"完成 3/8",done4:"完成 1/2",done5:"完成 5/8",done6:"完成 3/4",done7:"完成 7/8",done:"已完成"}},help:{},hyperlink:{},image:{},resource:{}},hyperlink:{hyperlink:"链接...",unhyperlink:"移除链接"},image:{image:"图片...",removeimage:"移除图片"},marker:{marker:"进度/优先级..."},resource:{resource:"资源..."}}}});angular.module("kityminderEditor").service("memory",function(){function e(e){var t=false;if(e){if(e.code){switch(e.code){case 22:t=true;break;case 1014:if(e.name==="NS_ERROR_DOM_QUOTA_REACHED"){t=true}break}}else if(e.number===-2147024882){t=true}}return t}return{get:function(e){var t=window.localStorage.getItem(e);return null||JSON.parse(t)},set:function(t,n){try{window.localStorage.setItem(t,JSON.stringify(n));return true}catch(t){if(e(t)){return false}}},remove:function(e){var t=window.localStorage.getItem(e);window.localStorage.removeItem(e);return t},clear:function(){window.localStorage.clear()}}});angular.module("kityminderEditor").service("minder.service",function(){var e=[];function t(t){e.push(t)}function n(){e.forEach(function(e){e.apply(this,arguments)})}return{registerEvent:t,executeCallback:n}});angular.module("kityminderEditor").service("resourceService",["$document",function(e){var t=null;this.open=function(i){if(!t){e.bind("click",n);e.bind("keydown",r)}if(t&&t!==i){t.resourceListOpen=false}t=i};this.close=function(i){if(t===i){t=null;e.unbind("click",n);e.unbind("keydown",r)}};var n=function(e){if(!t){return}var n=t.getToggleElement();if(e&&n&&n[0].contains(e.target)){return}t.$apply(function(){console.log("to close the resourcelist");t.resourceListOpen=false})};var r=function(e){if(e.which===27){t.focusToggleElement();n()}}}]);angular.module("kityminderEditor").service("revokeDialog",["$modal","minder.service",function(e,t){t.registerEvent(function(){var t=window.minder;var n=window.editor;var r=n.hotbox.getParentFSM();t.on("importNodeData",function(){r.jump("modal","import-text-modal");var i=e.open({animation:true,templateUrl:"ui/dialog/imExportNode/imExportNode.tpl.html",controller:"imExportNode.ctrl",size:"md",resolve:{title:function(){return"导入节点"},defaultValue:function(){return""},type:function(){return"import"}}});i.result.then(function(e){try{t.Text2Children(t.getSelectedNode(),e)}catch(e){alert(e)}r.jump("normal","import-text-finish");n.receiver.selectAll()},function(){r.jump("normal","import-text-finish");n.receiver.selectAll()})});t.on("exportNodeData",function(){r.jump("modal","export-text-modal");var i=e.open({animation:true,templateUrl:"ui/dialog/imExportNode/imExportNode.tpl.html",controller:"imExportNode.ctrl",size:"md",resolve:{title:function(){return"导出节点"},defaultValue:function(){var e=t.getSelectedNode(),n=window.kityminder.data.getRegisterProtocol("text").Node2Text;return n(e)},type:function(){return"export"}}});i.result.then(function(e){r.jump("normal","export-text-finish");n.receiver.selectAll()},function(){r.jump("normal","export-text-finish");n.receiver.selectAll()})})});return{}}]);angular.module("kityminderEditor").service("valueTransfer",function(){return{}});angular.module("kityminderEditor").filter("commandState",function(){return function(e,t){return e.queryCommandState(t)}}).filter("commandValue",function(){return function(e,t){return e.queryCommandValue(t)}});angular.module("kityminderEditor").filter("lang",["config","lang.zh-cn",function(e,t){return function(n,r){var i=e.getConfig("defaultLang");if(t[i]==undefined){return"未发现对应语言包，请检查 lang.xxx.service.js!"}else{var a=t[i];r.split("/").forEach(function(e,t){a=a[e]});return a[n]||null}}}]);angular.module("kityminderEditor").controller("hyperlink.ctrl",["$scope","$modalInstance","link",function(e,t,n){e.R_URL=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/;e.url=n.url||"";e.title=n.title||"";setTimeout(function(){var t=$("#link-url");t.focus();t[0].setSelectionRange(0,e.url.length)},30);e.shortCut=function(t){t.stopPropagation();if(t.keyCode==13){e.ok()}else if(t.keyCode==27){e.cancel()}};e.ok=function(){if(e.R_URL.test(e.url)){t.close({url:e.url,title:e.title})}else{e.urlPassed=false;var n=$("#link-url");n.focus();n[0].setSelectionRange(0,e.url.length)}editor.receiver.selectAll()};e.cancel=function(){t.dismiss("cancel");editor.receiver.selectAll()}}]);angular.module("kityminderEditor").controller("imExportNode.ctrl",["$scope","$modalInstance","title","defaultValue","type",function(e,t,n,r,i){e.title=n;e.value=r;e.type=i;e.ok=function(){if(e.value==""){return}t.close(e.value);editor.receiver.selectAll()};e.cancel=function(){t.dismiss("cancel");editor.receiver.selectAll()};setTimeout(function(){$(".single-input").focus();$(".single-input")[0].setSelectionRange(0,r.length)},30);e.shortCut=function(t){t.stopPropagation();if(t.keyCode==27){e.cancel()}if(t.keyCode==8&&i=="export"){t.preventDefault()}if(t.keyCode==9){t.preventDefault();var n=t.target;var r=a(n);var l=n.value;n.value=l.substr(0,r)+"\t"+l.substr(r);o(n,r+1)}};function a(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length);t=n.text.length}else if(e.selectionStart||e.selectionStart=="0"){t=e.selectionStart}return t}function o(e,t){if(e.setSelectionRange){e.focus();e.setSelectionRange(t,t)}else if(e.createTextRange){var n=e.createTextRange();n.collapse(true);n.moveEnd("character",t);n.moveStart("character",t);n.select()}}}]);angular.module("kityminderEditor").controller("image.ctrl",["$http","$scope","$modalInstance","image",function(e,t,n,r){t.data={list:[],url:r.url||"",title:r.title||"",R_URL:/^https?\:\/\/(\w+\.)+\w+/};setTimeout(function(){var e=$("#image-url");e.focus();e[0].setSelectionRange(0,t.data.url.length)},300);t.searchImage=function(){t.list=[];i().success(function(e){if(e&&e.data){for(var n=0;n<e.data.length;n++){if(e.data[n].objURL){t.list.push({title:e.data[n].fromPageTitleEnc,src:e.data[n].middleURL,url:e.data[n].middleURL})}}}}).error(function(){})};t.selectImage=function(e){var n=$("#img-item"+this.$index);var r=$("#img-"+this.$index);n.siblings(".selected").removeClass("selected");n.addClass("selected");t.data.url=r.attr("src");t.data.title=r.attr("alt")};t.shortCut=function(e){e.stopPropagation();if(e.keyCode==13){t.ok()}else if(e.keyCode==27){t.cancel()}};t.ok=function(){if(t.data.R_URL.test(t.data.url)){n.close({url:t.data.url,title:t.data.title})}else{t.urlPassed=false;var e=$("#image-url");e.focus();e[0].setSelectionRange(0,t.data.url.length)}editor.receiver.selectAll()};t.cancel=function(){n.dismiss("cancel");editor.receiver.selectAll()};function i(){var n=t.data.searchKeyword2;var r=new Date;var i="http://image.baidu.com/search/acjson?tn=resultjson_com&ipn=rj&ct=201326592&fp=result&queryWord="+n+"&cl=2&lm=-1&ie=utf-8&oe=utf-8&st=-1&ic=0&word="+n+"&face=0&istype=2&nc=1&pn=60&rn=60&gsm=3c&"+r.getTime()+"=&callback=JSON_CALLBACK";return e.jsonp(i)}}]);angular.module("kityminderEditor").directive("appendNode",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/appendNode/appendNode.html",scope:{minder:"="},replace:true,link:function(t){var n=t.minder;e.bind(n,"appendchildnode",t);t.execCommand=function(e){n.execCommand(e,"分支主题");r()};function r(){var e=editor.receiver.element;var t=editor.fsm;var r=editor.receiver;e.innerText=n.queryCommandValue("text");t.jump("input","input-request");r.selectAll()}}}}]);angular.module("kityminderEditor").directive("arrange",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/arrange/arrange.html",scope:{minder:"="},replace:true,link:function(e){var t=e.minder}}}]);angular.module("kityminderEditor").directive("colorPanel",function(){return{restrict:"E",templateUrl:"ui/directive/colorPanel/colorPanel.html",scope:{minder:"="},replace:true,link:function(e){var t=e.minder;var n=t.getThemeItems();e.$on("colorPicked",function(n,r){n.stopPropagation();e.bgColor=r;t.execCommand("background",r)});e.setDefaultBg=function(){var e=t.getSelectedNode();var n=t.getNodeStyle(e,"background");return typeof n==="object"?n.toHEX():n};e.bgColor=e.setDefaultBg()||"#fff"}}});angular.module("kityminderEditor").directive("expandLevel",function(){return{restrict:"E",templateUrl:"ui/directive/expandLevel/expandLevel.html",scope:{minder:"="},replace:true,link:function(e){e.levels=[1,2,3,4,5,6]}}});angular.module("kityminderEditor").directive("fontOperator",function(){return{restrict:"E",templateUrl:"ui/directive/fontOperator/fontOperator.html",scope:{minder:"="},replace:true,link:function(e){var t=e.minder;var n=t.getThemeItems();e.fontSizeList=[10,12,16,18,24,32,48];e.fontFamilyList=[{name:"宋体",val:"宋体,SimSun"},{name:"微软雅黑",val:"微软雅黑,Microsoft YaHei"},{name:"楷体",val:"楷体,楷体_GB2312,SimKai"},{name:"黑体",val:"黑体, SimHei"},{name:"隶书",val:"隶书, SimLi"},{name:"Andale Mono",val:"andale mono"},{name:"Arial",val:"arial,helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"
},{name:"Comic Sans Ms",val:"comic sans ms"},{name:"Impact",val:"impact,chicago"},{name:"Times New Roman",val:"times new roman"},{name:"Sans-Serif",val:"sans-serif"}];e.$on("colorPicked",function(n,r){n.stopPropagation();e.foreColor=r;t.execCommand("forecolor",r)});e.setDefaultColor=function(){var e=t.getSelectedNode();var n=t.getNodeStyle(e,"color");return typeof n==="object"?n.toHEX():n};e.foreColor=e.setDefaultColor()||"#000";e.getFontfamilyName=function(t){var n="";e.fontFamilyList.forEach(function(e,r,i){if(e.val===t){n=e.name;return""}});return n}}}});angular.module("kityminderEditor").directive("hyperLink",["$modal",function(e){return{restrict:"E",templateUrl:"ui/directive/hyperLink/hyperLink.html",scope:{minder:"="},replace:true,link:function(t){var n=t.minder;t.addHyperlink=function(){var t=n.queryCommandValue("HyperLink");var r=e.open({animation:true,templateUrl:"ui/dialog/hyperlink/hyperlink.tpl.html",controller:"hyperlink.ctrl",size:"md",resolve:{link:function(){return t}}});r.result.then(function(e){n.execCommand("HyperLink",e.url,e.title||"")})}}}}]);angular.module("kityminderEditor").directive("imageBtn",["$modal",function(e){return{restrict:"E",templateUrl:"ui/directive/imageBtn/imageBtn.html",scope:{minder:"="},replace:true,link:function(t){var n=t.minder;t.addImage=function(){var t=n.queryCommandValue("image");var r=e.open({animation:true,templateUrl:"ui/dialog/image/image.tpl.html",controller:"image.ctrl",size:"md",resolve:{image:function(){return t}}});r.result.then(function(e){n.execCommand("image",e.url,e.title||"")})}}}}]);angular.module("kityminderEditor").directive("kityminderEditor",["config","minder.service","revokeDialog",function(e,t,n){return{restrict:"EA",templateUrl:"ui/directive/kityminderEditor/kityminderEditor.html",replace:true,scope:{onInit:"&"},link:function(n,r,i){var a=r.children(".minder-editor")[0];function o(e,r){n.onInit({editor:e,minder:r});t.executeCallback()}if(typeof seajs!="undefined"){seajs.config({base:"./src"});define("demo",function(t){var r=t("editor");var i=window.editor=new r(a);if(window.localStorage.__dev_minder_content){i.minder.importJson(JSON.parse(window.localStorage.__dev_minder_content))}i.minder.on("contentchange",function(){window.localStorage.__dev_minder_content=JSON.stringify(i.minder.exportJson())});window.minder=window.km=i.minder;n.editor=i;n.minder=minder;n.config=e.getConfig();n.$apply();o(i,minder)});seajs.use("demo")}else if(window.kityminder&&window.kityminder.Editor){var l=new kityminder.Editor(a);window.editor=n.editor=l;window.minder=n.minder=l.minder;n.config=e.getConfig();o(l,l.minder)}}}}]);angular.module("kityminderEditor").directive("kityminderViewer",["config","minder.service",function(e,t){return{restrict:"EA",templateUrl:"ui/directive/kityminderViewer/kityminderViewer.html",replace:true,scope:{onInit:"&"},link:function(e,n,r){var i=n.children(".minder-viewer")[0];function a(n,r){e.onInit({editor:n,minder:r});t.executeCallback()}if(window.kityminder&&window.kityminder.Editor){var o=new kityminder.Editor(i);window.editor=e.editor=o;window.minder=e.minder=o.minder;a(o,o.minder)}}}}]);angular.module("kityminderEditor").directive("layout",function(){return{restrict:"E",templateUrl:"ui/directive/layout/layout.html",scope:{minder:"="},replace:true,link:function(e){}}});angular.module("kityminderEditor").directive("navigator",["memory","config",function(e,t){return{restrict:"A",templateUrl:"ui/directive/navigator/navigator.html",scope:{minder:"="},link:function(n){minder.setDefaultOptions({zoom:t.getConfig("zoom")});n.isNavOpen=!e.get("navigator-hidden");n.getZoomRadio=function(e){var t=minder.getOption("zoom");var n=t[0];var r=t[t.length-1];var i=r-n;return 1-(e-n)/i};n.getHeight=function(e){var t=$(".zoom-pan").height();return n.getZoomRadio(e)*t};n.zoom=100;minder.on("zoom",function(e){n.zoom=e.zoom});n.toggleNavOpen=function(){n.isNavOpen=!n.isNavOpen;e.set("navigator-hidden",!n.isNavOpen);if(n.isNavOpen){r();g();v()}else{i()}};setTimeout(function(){if(n.isNavOpen){r();g();v()}else{i()}},0);function r(){minder.on("layout layoutallfinish",g);minder.on("viewchange",v)}function i(){minder.off("layout layoutallfinish",g);minder.off("viewchange",v)}var a=$(".nav-previewer");var o=new kity.Paper(a[0]);var l=o.put(new kity.Path);var s=o.put(new kity.Path);var c=o.put(new kity.Rect(100,100).stroke("red","1%"));var d=new kity.Box,u=new kity.Box;var m=p(minder.getTheme());minder.on("themechange",function(e){m=p(e.theme)});function p(e){switch(e){case"tianpan":case"tianpan-compact":return function(e,t,n,r,i){var a=r>>1;e.push("M",t,n+a,"a",a,a,0,1,1,0,.01,"z")};default:{return function(e,t,n,r,i){e.push("M",t,n,"h",r,"v",i,"h",-r,"z")}}}}f();function f(){function e(e,t){var n=u;e.x=-e.x;e.y=-e.y;var r=minder.getPaper().getViewPortMatrix();n=r.transformBox(n);var i=e.offset(n.width/2,n.height/2);minder.getViewDragger().moveTo(i,t)}var t=false;o.on("mousedown",function(n){t=true;e(n.getPosition("top"),200);a.addClass("grab")});o.on("mousemove",function(n){if(t){e(n.getPosition("top"))}});$(window).on("mouseup",function(){t=false;a.removeClass("grab")})}function g(){var e=minder.getRenderContainer().getBoundaryBox();d=e;var t=30;o.setViewBox(e.x-t-.5,e.y-t-.5,e.width+t*2+1,e.height+t*2+1);var n=[];var r=[];minder.getRoot().traverse(function(e){var t=e.getLayoutBox();m(n,t.x,t.y,t.width,t.height);if(e.getConnection()&&e.parent&&e.parent.isExpanded()){r.push(e.getConnection().getPathData())}});o.setStyle("background",minder.getStyle("background"));if(n.length){l.fill(minder.getStyle("root-background")).setPathData(n)}else{l.setPathData(null)}if(r.length){s.stroke(minder.getStyle("connect-color"),"0.5%").setPathData(r)}else{s.setPathData(null)}v()}function v(){u=minder.getViewDragger().getView();c.setBox(u.intersect(d))}}}}]);angular.module("kityminderEditor").directive("noteBtn",["valueTransfer",function(e){return{restrict:"E",templateUrl:"ui/directive/noteBtn/noteBtn.html",scope:{minder:"="},replace:true,link:function(t){var n=t.minder;t.addNote=function(){e.noteEditorOpen=true}}}}]);angular.module("kityminderEditor").directive("noteEditor",["valueTransfer",function(e){return{restrict:"A",templateUrl:"ui/directive/noteEditor/noteEditor.html",scope:{minder:"="},replace:true,controller:["$scope",function(t){var n=t.minder;var r=false;var i;t.codemirrorLoaded=function(e){i=t.cmEditor=e;e.setSize("100%","100%")};function a(){var e=t.noteEnabled=n.queryCommandState("note")!=-1;var i=n.queryCommandValue("note")||"";if(e){t.noteContent=i}r=true;t.$apply();r=false}t.$watch("noteContent",function(e){var t=n.queryCommandState("note")!=-1;if(e&&t&&!r){n.execCommand("note",e)}setTimeout(function(){i.refresh()})});var o=function(){return e.noteEditorOpen};t.$watch(o,function(n,r){if(n){setTimeout(function(){i.refresh();i.focus()})}t.noteEditorOpen=e.noteEditorOpen},true);t.closeNoteEditor=function(){e.noteEditorOpen=false;editor.receiver.selectAll()};n.on("interactchange",a)}]}}]);angular.module("kityminderEditor").directive("notePreviewer",["$sce","valueTransfer",function(e,t){return{restrict:"A",templateUrl:"ui/directive/notePreviewer/notePreviewer.html",link:function(t,n){var r=t.minder;var i=n.parent();var a=n.children();t.showNotePreviewer=false;marked.setOptions({gfm:true,tables:true,breaks:true,pedantic:false,sanitize:true,smartLists:true,smartypants:false});var o;r.on("shownoterequest",function(e){o=setTimeout(function(){s(e.node,e.keyword)},300)});r.on("hidenoterequest",function(){clearTimeout(o);t.showNotePreviewer=false});var l=false;$(document).on("mousedown mousewheel DOMMouseScroll",function(){if(!l)return;t.showNotePreviewer=false;t.$apply()});n.on("mousedown mousewheel DOMMouseScroll",function(e){e.stopPropagation()});function s(n,r){var o=n.getRenderer("NoteIconRenderer").getRenderShape();var s=o.getRenderBox("screen");var c=n.getData("note");a[0].scrollTop=0;var d=marked(c);if(r){d=d.replace(new RegExp("("+r+")","ig"),'<span class="highlight">$1</span>')}t.noteContent=e.trustAsHtml(d);t.$apply();var u=$(i[0]).width();var m=$(i[0]).height();var p=$(a).outerWidth();var f=$(a).outerHeight();var g=s.cx-p/2-i[0].offsetLeft;var v=s.bottom+10-i[0].offsetTop;if(g<0)g=10;if(g+p>u)g=s.left-p-10-i[0].offsetLeft;if(v+f>m)v=s.top-f-10-i[0].offsetTop;t.previewerStyle={left:Math.round(g)+"px",top:Math.round(v)+"px"};t.showNotePreviewer=true;var h=a[0].querySelector(".highlight");if(h){h.scrollIntoView()}l=true;t.$apply()}}}}]);angular.module("kityminderEditor").directive("operation",function(){return{restrict:"E",templateUrl:"ui/directive/operation/operation.html",scope:{minder:"="},replace:true,link:function(e){e.editNode=function(){var e=editor.receiver.element;var t=editor.fsm;var n=editor.receiver;e.innerText=minder.queryCommandValue("text");t.jump("input","input-request");n.selectAll()}}}});angular.module("kityminderEditor").directive("priorityEditor",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/priorityEditor/priorityEditor.html",scope:{minder:"="},replace:true,link:function(t){var n=t.minder;var r=[];for(var i=0;i<10;i++){r.push(i)}e.bind(n,"priority",t);t.priorities=r;t.getPriorityTitle=function(e){switch(e){case 0:return"移除优先级";default:return"优先级"+e}}}}}]);angular.module("kityminderEditor").directive("progressEditor",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/progressEditor/progressEditor.html",scope:{minder:"="},replace:true,link:function(t){var n=t.minder;var r=[];for(var i=0;i<10;i++){r.push(i)}e.bind(n,"progress",t);t.progresses=r;t.getProgressTitle=function(e){switch(e){case 0:return"移除进度";case 1:return"未开始";case 9:return"全部完成";default:return"完成"+(e-1)+"/8"}}}}}]);angular.module("kityminderEditor").directive("resourceEditor",function(){return{restrict:"E",templateUrl:"ui/directive/resourceEditor/resourceEditor.html",scope:{minder:"="},replace:true,controller:["$scope",function(e){var t=e.minder;var n=false;t.on("interactchange",function(){var r=e.enabled=t.queryCommandState("resource")!=-1;var i=r?t.queryCommandValue("resource"):[];var a=t.getUsedResource().map(function(e){return{name:e,selected:i.indexOf(e)>-1}});e.used=a;n=true;e.$apply();n=false});e.$watch("used",function(e){if(t.queryCommandState("resource")!=-1&&e){var r=e.filter(function(e){return e.selected}).map(function(e){return e.name});if(n){return}t.execCommand("resource",r)}},true);e.resourceColor=function(e){return t.getResourceColor(e).toHEX()};e.addResource=function(n){var r=t.queryCommandValue("resource");if(!n||!/\S/.test(n))return;if(r.indexOf(n)==-1){e.used.push({name:n,selected:true})}e.newResourceName=null}}]}}).directive("clickAnywhereButHere",["$document",function(e){return{link:function(t,n,r){var i=function(e){var n=$("#resource-dropdown").has(e.target).length>0;var i=$("#resource-dropdown")==e.target;var a=n||i;if(!a){t.$apply(r.clickAnywhereButHere)}};t.$watch(r.isActive,function(t,n){if(t!==n&&t==true){e.bind("click",i)}else if(t!==n&&t==false){e.unbind("click",i)}})}}}]);angular.module("kityminderEditor").directive("searchBox",function(){return{restrict:"A",templateUrl:"ui/directive/searchBox/searchBox.html",scope:{minder:"="},replace:true,controller:["$scope",function(e){var t=e.minder;var n=window.editor;e.handleKeyDown=r;e.doSearch=d;e.exitSearch=i;e.showTip=false;e.showSearch=false;function r(t){if(t.keyCode==13){var n=t.shiftKey?"prev":"next";d(e.keyword,n)}if(t.keyCode==27){i()}}function i(){$("#search-input").blur();e.showSearch=false;t.fire("hidenoterequest");n.receiver.selectAll()}function a(){e.showSearch=true;setTimeout(function(){$("#search-input").focus()},10);if(e.keyword){$("#search-input")[0].setSelectionRange(0,e.keyword.length)}}$("body").on("keydown",function(t){if(t.keyCode==70&&(t.ctrlKey||t.metaKey)&&!t.shiftKey){a();e.$apply();t.preventDefault()}});t.on("searchNode",function(){a()});var o=[];var l=[];t.on("contentchange",s);s();function s(){o=[];t.getRoot().traverse(function(e){o.push(e)})}function c(e){l=[];for(var t=0;t<o.length;t++){var n=o[t];var r=n.getText().toLowerCase();if(r.indexOf(e)!=-1){l.push({node:n})}var i=n.getData("note");if(i&&i.toLowerCase().indexOf(e)!=-1){l.push({node:n,keyword:e})}}}function d(n,r){e.showTip=false;t.fire("hidenoterequest");if(!n||!/\S/.exec(n)){$("#search-input").focus();return}e.showTip=true;e.curIndex=0;e.resultNum=0;n=n.toLowerCase();var i=d.lastKeyword!=n;d.lastKeyword=n;if(i){c(n)}e.resultNum=l.length;if(l.length){var a=i?0:(r==="next"?d.lastIndex+1:d.lastIndex-1)||0;a=(l.length+a)%l.length;o(l[a].node,l[a].keyword);d.lastIndex=a;e.curIndex=a+1;function o(e,n){t.execCommand("camera",e,50);setTimeout(function(){t.select(e,true);if(!e.isExpanded())t.execCommand("expand",true);if(n){t.fire("shownoterequest",{node:e,keyword:n})}},60)}}}}]}});angular.module("kityminderEditor").directive("searchBtn",function(){return{restrict:"E",templateUrl:"ui/directive/searchBtn/searchBtn.html",scope:{minder:"="},replace:true,link:function(e){e.enterSearch=t;function t(){minder.fire("searchNode")}}}});angular.module("kityminderEditor").directive("selectAll",function(){return{restrict:"E",templateUrl:"ui/directive/selectAll/selectAll.html",scope:{minder:"="},replace:true,link:function(e){var t=e.minder;e.items=["revert","siblings","level","path","tree"];e.select={all:function(){var e=[];t.getRoot().traverse(function(t){e.push(t)});t.select(e,true);t.fire("receiverfocus")},revert:function(){var e=t.getSelectedNodes();var n=[];t.getRoot().traverse(function(t){if(e.indexOf(t)==-1){n.push(t)}});t.select(n,true);t.fire("receiverfocus")},siblings:function(){var e=t.getSelectedNodes();var n=[];e.forEach(function(e){if(!e.parent)return;e.parent.children.forEach(function(e){if(n.indexOf(e)==-1)n.push(e)})});t.select(n,true);t.fire("receiverfocus")},level:function(){var e=t.getSelectedNodes().map(function(e){return e.getLevel()});var n=[];t.getRoot().traverse(function(t){if(e.indexOf(t.getLevel())!=-1){n.push(t)}});t.select(n,true);t.fire("receiverfocus")},path:function(){var e=t.getSelectedNodes();var n=[];e.forEach(function(e){while(e&&n.indexOf(e)==-1){n.push(e);e=e.parent}});t.select(n,true);t.fire("receiverfocus")},tree:function(){var e=t.getSelectedNodes();var n=[];e.forEach(function(e){e.traverse(function(e){if(n.indexOf(e)==-1)n.push(e)})});t.select(n,true);t.fire("receiverfocus")}}}}});angular.module("kityminderEditor").directive("styleOperator",function(){return{restrict:"E",templateUrl:"ui/directive/styleOperator/styleOperator.html",scope:{minder:"="},replace:true}});angular.module("kityminderEditor").directive("templateList",function(){return{restrict:"E",templateUrl:"ui/directive/templateList/templateList.html",scope:{minder:"="},replace:true,link:function(e){e.templateList=kityminder.Minder.getTemplateList()}}});angular.module("kityminderEditor").directive("themeList",function(){return{restrict:"E",templateUrl:"ui/directive/themeList/themeList.html",replace:true,link:function(e){var t=kityminder.Minder.getThemeList();e.getThemeThumbStyle=function(e){var n=t[e];if(!n){return}var r={color:n["root-color"],"border-radius":n["root-radius"]/2};if(n["root-background"]){r["background"]=n["root-background"].toString()}return r};e.themeKeyList=["classic","classic-compact","fresh-blue","fresh-blue-compat","fresh-green","fresh-green-compat","fresh-pink","fresh-pink-compat","fresh-purple","fresh-purple-compat","fresh-red","fresh-red-compat","fresh-soil","fresh-soil-compat","snow","snow-compact","tianpan","tianpan-compact","fish","wire"]}}});angular.module("kityminderEditor").directive("topTab",function(){return{restrict:"A",templateUrl:"ui/directive/topTab/topTab.html",scope:{minder:"=topTab",editor:"="},link:function(e){var t=false;var n=true;var r=true;e.setCurTab=function(e){setTimeout(function(){t=true;if(e!="idea"){n=false}})};e.toggleTopTab=function(){setTimeout(function(){if(!t||n){n=false;r?i():a();r=!r}t=false})};function i(){var e=$(".tab-content");var t=$(".minder-editor");e.animate({height:0,display:"none"});t.animate({top:"32px"})}function a(){var e=$(".tab-content");var t=$(".minder-editor");e.animate({height:"60px",display:"block"});t.animate({top:"92px"})}}}});angular.module("kityminderEditor").directive("undoRedo",function(){return{restrict:"E",templateUrl:"ui/directive/undoRedo/undoRedo.html",scope:{editor:"="},replace:true,link:function(e){}}});n("expose-editor")})();