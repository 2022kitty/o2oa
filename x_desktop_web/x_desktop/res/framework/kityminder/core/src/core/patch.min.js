define(function(e,a,t){var r=e("./kity");var i=e("./minder");function n(e,a,t,r){t=e.createNode(a.data,t,r);a.children.forEach(function(a,r){n(e,a,t,r)});return t}function d(e,a){var t=a.path.split("/");t.shift();var r=t.shift();var i;if(r=="root"){var d=t.indexOf("data");if(d>-1){r="data";var o=t.splice(d+1);a.dataPath=o}else{r="node"}i=e.getRoot();var s,c;while(s=t.shift()){if(s=="children")continue;if(typeof c!="undefined")i=i.getChild(c);c=+s}a.index=c;a.node=i}var l=a.express=[r,a.op].join(".");switch(l){case"theme.replace":e.useTheme(a.value);break;case"template.replace":e.useTemplate(a.value);break;case"node.add":n(e,a.value,a.node,a.index).renderTree();e.layout();break;case"node.remove":e.removeNode(a.node.getChild(a.index));e.layout();break;case"data.add":case"data.replace":case"data.remove":var h=a.node.data;var f;t=a.dataPath.slice();while(h&&t.length>1){f=t.shift();if(f in h){h=h[f]}else if(a.op!="remove"){h=h[f]={}}}if(h){f=t.shift();h[f]=a.value}if(f=="expandState"){i.renderTree()}else{i.render()}e.layout()}e.fire("patch",{patch:a})}r.extendClass(i,{applyPatches:function(e){for(var a=0;a<e.length;a++){d(this,e[a])}this.fire("contentchange");return this}})});