define(function(e,n,t){var a=e("./kity");var r=e("./utils");var i=e("./minder");var o=e("./node");var s=e("./event");var c=0;var u=-1;var m=1;var C=a.createClass("Command",{constructor:function(){this._isContentChange=true;this._isSelectionChange=false},execute:function(e,n){throw new Error("Not Implement: Command.execute()")},setContentChanged:function(e){this._isContentChange=!!e},isContentChanged:function(){return this._isContentChange},setSelectionChanged:function(e){this._isSelectionChange=!!e},isSelectionChanged:function(){return this._isContentChange},queryState:function(e){return c},queryValue:function(e){return 0},isNeedUndo:function(){return true}});C.STATE_NORMAL=c;C.STATE_ACTIVE=m;C.STATE_DISABLED=u;a.extendClass(i,{_getCommand:function(e){return this._commands[e.toLowerCase()]},_queryCommand:function(e,n,t){var a=this._getCommand(e);if(a){var r=a["query"+n];if(r)return r.apply(a,[this].concat(t))}return 0},queryCommandState:function(e){return this._queryCommand(e,"State",[].slice.call(arguments,1))},queryCommandValue:function(e){return this._queryCommand(e,"Value",[].slice.call(arguments,1))},execCommand:function(e){if(!e)return null;e=e.toLowerCase();var n=[].slice.call(arguments,1),t,a,r,i;var o=this;t=this._getCommand(e);i={command:t,commandName:e.toLowerCase(),commandArgs:n};if(!t||!~this.queryCommandState(e)){return false}if(!this._hasEnterExecCommand){this._hasEnterExecCommand=true;a=this._fire(new s("beforeExecCommand",i,true));if(!a){this._fire(new s("preExecCommand",i,false));r=t.execute.apply(t,[o].concat(n));this._fire(new s("execCommand",i,false));if(t.isContentChanged()){this._firePharse(new s("contentchange"))}this._interactChange()}this._hasEnterExecCommand=false}else{r=t.execute.apply(t,[o].concat(n));if(!this._hasEnterExecCommand){this._interactChange()}}return r===undefined?null:r}});t.exports=C});