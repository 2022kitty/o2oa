define(function(e,t,i){var s=e("./kity");var n=e("./utils");var r=e("./minder");var c=e("./node");r.registerInitHook(function(){this._initSelection()});s.extendClass(r,{_initSelection:function(){this._selectedNodes=[]},renderChangedSelection:function(e){var t=this.getSelectedNodes();var i=[];t.forEach(function(t){if(e.indexOf(t)==-1){i.push(t)}});e.forEach(function(e){if(t.indexOf(e)==-1){i.push(e)}});if(i.length){this._interactChange();this.fire("selectionchange")}while(i.length){i.shift().render()}},getSelectedNodes:function(){return this._selectedNodes},getSelectedNode:function(){return this.getSelectedNodes()[0]||null},removeAllSelectedNodes:function(){var e=this;var t=this._selectedNodes.splice(0);this._selectedNodes=[];this.renderChangedSelection(t);return this.fire("selectionclear")},removeSelectedNodes:function(e){var t=this;var i=this._selectedNodes.slice(0);e=n.isArray(e)?e:[e];e.forEach(function(e){var i;if((i=t._selectedNodes.indexOf(e))===-1)return;t._selectedNodes.splice(i,1)});this.renderChangedSelection(i);return this},select:function(e,t){var i=this.getSelectedNodes().slice(0);if(t){this._selectedNodes=[]}var s=this;e=n.isArray(e)?e:[e];e.forEach(function(e){if(s._selectedNodes.indexOf(e)!==-1)return;s._selectedNodes.unshift(e)});this.renderChangedSelection(i);return this},selectById:function(e,t){e=n.isArray(e)?e:[e];var i=this.getNodesById(e);return this.select(i,t)},toggleSelect:function(e){if(n.isArray(e)){e.forEach(this.toggleSelect.bind(this))}else{if(e.isSelected())this.removeSelectedNodes(e);else this.select(e)}return this},isSingleSelect:function(){return this._selectedNodes.length==1},getSelectedAncestors:function(e){var t=this.getSelectedNodes().slice(0),i=[],s;var n=t.indexOf(this.getRoot());if(~n&&!e){t.splice(n,1)}function r(e,t){for(var i=e.length-1;i>=0;--i){if(e[i].isAncestorOf(t))return true}return false}t.sort(function(e,t){return e.getLevel()-t.getLevel()});while(s=t.pop()){if(!r(t,s)){i.push(s)}}return i}});s.extendClass(c,{isSelected:function(){var e=this.getMinder();return e&&e.getSelectedNodes().indexOf(this)!=-1}})});