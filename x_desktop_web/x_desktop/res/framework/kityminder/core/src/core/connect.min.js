define(function(n,e,t){var o=n("./kity");var i=n("./utils");var r=n("./module");var c=n("./minder");var a=n("./node");var u={};function s(n,e){u[n]=e}s("default",function(n,e,t){t.setPathData(["M",e.getLayoutVertexOut(),"L",n.getLayoutVertexIn()])});o.extendClass(a,{getConnect:function(){return this.data.connect||"default"},getConnectProvider:function(){return u[this.getConnect()]||u["default"]},getConnection:function(){return this._connection||null}});o.extendClass(c,{getConnectContainer:function(){return this._connectContainer},createConnect:function(n){if(n.isRoot())return;var e=new o.Path;n._connection=e;this._connectContainer.addShape(e);this.updateConnect(n)},removeConnect:function(n){var e=this;n.traverse(function(n){e._connectContainer.removeShape(n._connection);n._connection=null})},updateConnect:function(n){var e=n._connection;var t=n.parent;if(!t||!e)return;if(t.isCollapsed()){e.setVisible(false);return}e.setVisible(true);var o=n.getConnectProvider();var i=n.getStyle("connect-color")||"white",r=n.getStyle("connect-width")||2;e.stroke(i,r);o(n,t,e,r,i);if(r%2===0){e.setTranslate(.5,.5)}else{e.setTranslate(0,0)}}});r.register("Connect",{init:function(){this._connectContainer=(new o.Group).setId(i.uuid("minder_connect_group"));this.getRenderContainer().prependShape(this._connectContainer)},events:{nodeattach:function(n){this.createConnect(n.node)},nodedetach:function(n){this.removeConnect(n.node)},"layoutapply layoutfinish noderender":function(n){this.updateConnect(n.node)}}});e.register=s});