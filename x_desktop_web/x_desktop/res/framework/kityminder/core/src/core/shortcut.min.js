define(function(t,n,i){var e=t("./kity");var r=t("./utils");var o=t("./keymap");var a=t("./minder");var s=t("./event");function u(t){var n=4096;var i=8192;var e=16384;var r=0;if(typeof t=="string"){t.toLowerCase().split(/\+\s*/).forEach(function(t){switch(t){case"ctrl":case"cmd":r|=n;break;case"alt":r|=i;break;case"shift":r|=e;break;default:r|=o[t]}})}else{if(t.ctrlKey||t.metaKey){r|=n}if(t.altKey){r|=i}if(t.shiftKey){r|=e}r|=t.keyCode}return r}e.extendClass(s,{isShortcutKey:function(t){var n=this.originEvent;if(!n)return false;return u(t)==u(n)}});a.registerInitHook(function(){this._initShortcutKey()});e.extendClass(a,{_initShortcutKey:function(){this._bindShortcutKeys()},_bindShortcutKeys:function(){var t=this._shortcutKeys={};var n="hasOwnProperty";this.on("keydown",function(i){for(var e in t){if(!t[n](e))continue;if(i.isShortcutKey(e)){var r=t[e];if(r.__statusCondition&&r.__statusCondition!=this.getStatus())return;r();i.preventDefault()}}})},addShortcut:function(t,n){var i=this._shortcutKeys;t.split(/\|\s*/).forEach(function(t){var e=t.split("::");var r;if(e.length>1){t=e[1];r=e[0];n.__statusCondition=r}i[t]=n})},addCommandShortcutKeys:function(t,n){var i=this._commandShortcutKeys||(this._commandShortcutKeys={});var e={},o=this;if(n){e[t]=n}else{e=t}var a=this;r.each(e,function(t,n){i[n]=t;a.addShortcut(t,function t(){if(a.queryCommandState(n)!==-1){a.execCommand(n)}})})},getCommandShortcutKey:function(t){var n=this._commandShortcutKeys;return n&&n[t]||null},supportClipboardEvent:function(t){return!!t.ClipboardEvent}(window)})});