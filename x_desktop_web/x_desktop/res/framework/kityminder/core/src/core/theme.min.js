define(function(e,t,n){var r=e("./kity");var i=e("./utils");var u=e("./minder");var s=e("./node");var h=e("./module");var m=e("./command");var o={left:function(e){return 3 in e&&e[3]||1 in e&&e[1]||e[0]},right:function(e){return 1 in e&&e[1]||e[0]},top:function(e){return e[0]},bottom:function(e){return 2 in e&&e[2]||e[0]}};var a={};function f(e,t){a[e]=t}t.register=f;i.extend(u,{getThemeList:function(){return a}});r.extendClass(u,{useTheme:function(e){this.setTheme(e);this.refresh(800);return true},setTheme:function(e){if(e&&!a[e])throw new Error("Theme "+e+" not exists!");var t=this._theme;this._theme=e||null;var n=this.getRenderTarget();if(n){n.classList.remove("km-theme-"+t);if(e){n.classList.add("km-theme-"+e)}n.style.background=this.getStyle("background")}this.fire("themechange",{theme:e});return this},getTheme:function(e){return this._theme||this.getOption("defaultTheme")||"fresh-blue"},getThemeItems:function(e){var t=this.getTheme(e);return a[this.getTheme(e)]},getStyle:function(e,t){var n=this.getThemeItems(t);var r,u,s,h,m;if(e in n)return n[e];r=e.split("-");if(r.length<2)return null;u=r.pop();e=r.join("-");if(e in n){h=n[e];if(i.isArray(h)&&(m=o[u])){return m(h)}if(!isNaN(h))return h}return null},getNodeStyle:function(e,t){var n=this.getStyle(e.getType()+"-"+t,e);return n!==null?n:this.getStyle(t,e)}});r.extendClass(s,{getStyle:function(e){return this.getMinder().getNodeStyle(this,e)}});h.register("Theme",{defaultOptions:{defaultTheme:"fresh-blue"},commands:{theme:r.createClass("ThemeCommand",{base:m,execute:function(e,t){return e.useTheme(t)},queryValue:function(e){return e.getTheme()||"default"}})}});u.registerInitHook(function(){this.setTheme()})});