define(function(e,r,t){var n=e("../core/kity");var a=e("../core/utils");var o=e("../core/minder");var d=e("../core/node");var l=e("../core/command");var c=e("../core/module");var u=e("../core/render");var i=n.createClass("AppendChildCommand",{base:l,execute:function(e,r){var t=e.getSelectedNode();if(!t){return null}var n=e.createNode(r,t);e.select(n,true);if(t.isExpanded()){n.render()}else{t.expand();t.renderTree()}e.layout(600)},queryState:function(e){var r=e.getSelectedNode();return r?0:-1}});var s=n.createClass("AppendSiblingCommand",{base:l,execute:function(e,r){var t=e.getSelectedNode();var n=t.parent;if(!n){return e.execCommand("AppendChildNode",r)}var a=e.createNode(r,n,t.getIndex()+1);a.setGlobalLayoutTransform(t.getGlobalLayoutTransform());e.select(a,true);a.render();e.layout(600)},queryState:function(e){var r=e.getSelectedNode();return r?0:-1}});var m=n.createClass("RemoverNodeCommand",{base:l,execute:function(e){var r=e.getSelectedNodes();var t=d.getCommonAncestor.apply(null,r);var n=r[0].getIndex();r.forEach(function(r){if(!r.isRoot())e.removeNode(r)});if(r.length==1){var a=t.children[n-1]||t.children[n];e.select(a||t||e.getRoot(),true)}else{e.select(t||e.getRoot(),true)}e.layout(600)},queryState:function(e){var r=e.getSelectedNode();return r&&!r.isRoot()?0:-1}});var v=n.createClass("AppendParentCommand",{base:l,execute:function(e,r){var t=e.getSelectedNodes();t.sort(function(e,r){return e.getIndex()-r.getIndex()});var n=t[0].parent;var a=e.createNode(r,n,t[0].getIndex());t.forEach(function(e){a.appendChild(e)});a.setGlobalLayoutTransform(t[t.length>>1].getGlobalLayoutTransform());e.select(a,true);e.layout(600)},queryState:function(e){var r=e.getSelectedNodes();if(!r.length)return-1;var t=r[0].parent;if(!t)return-1;for(var n=1;n<r.length;n++){if(r[n].parent!=t)return-1}return 0}});c.register("NodeModule",function(){return{commands:{AppendChildNode:i,AppendSiblingNode:s,RemoveNode:m,AppendParentNode:v},commandShortcutKeys:{appendsiblingnode:"normal::Enter",appendchildnode:"normal::Insert|Tab",appendparentnode:"normal::Shift+Tab|normal::Shift+Insert",removenode:"normal::Del|Backspace"}}})});