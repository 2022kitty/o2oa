define(function(e,t,r){var n=e("../core/kity");var o=e("../core/utils");var a=e("../core/minder");var i=e("../core/node");var s=e("../core/command");var c=e("../core/module");var u=e("../core/render");c.register("NoteModule",function(){var e="M9,9H3V8h6L9,9L9,9z M9,7H3V6h6V7z M9,5H3V4h6V5z M8.5,11H2V2h8v7.5 M9,12l2-2V1H1v11";var t=n.createClass("NoteCommand",{base:s,execute:function(e,t){var r=e.getSelectedNode();r.setData("note",t);r.render();r.getMinder().layout(300)},queryState:function(e){return e.getSelectedNodes().length===1?0:-1},queryValue:function(e){var t=e.getSelectedNode();return t&&t.getData("note")}});var r=n.createClass("NoteIcon",{base:n.Group,constructor:function(){this.callBase();this.width=16;this.height=17;this.rect=new n.Rect(16,17,.5,-8.5,2).fill("transparent");this.path=(new n.Path).setPathData(e).setTranslate(2.5,-6.5);this.addShapes([this.rect,this.path]);this.on("mouseover",function(){this.rect.fill("rgba(255, 255, 200, .8)")}).on("mouseout",function(){this.rect.fill("transparent")});this.setStyle("cursor","pointer")}});var o=n.createClass("NoteIconRenderer",{base:u,create:function(e){var t=new r;t.on("mousedown",function(t){t.preventDefault();e.getMinder().fire("editnoterequest")});t.on("mouseover",function(){e.getMinder().fire("shownoterequest",{node:e,icon:t})});t.on("mouseout",function(){e.getMinder().fire("hidenoterequest",{node:e,icon:t})});return t},shouldRender:function(e){return e.getData("note")},update:function(e,t,r){var o=r.right+t.getStyle("space-left");var a=r.cy;e.path.fill(t.getStyle("color"));e.setTranslate(o,a);return new n.Box(o,Math.round(a-e.height/2),e.width,e.height)}});return{renderers:{right:o},commands:{note:t}}})});