define(function(e,t,r){var a=e("../core/kity");var i=e("../core/utils");var n=e("../core/minder");var o=e("../core/node");var s=e("../core/command");var d=e("../core/module");var h=e("../core/render");var u=a.createClass("OutlineRenderer",{base:h,create:function(e){var t=(new a.Rect).setId(i.uuid("node_outline"));this.bringToBack=true;return t},update:function(e,t,r){var i=t.getStyle("shape");var n=t.getStyle("padding-left"),o=t.getStyle("padding-right"),s=t.getStyle("padding-top"),d=t.getStyle("padding-bottom");var h={x:r.x-n,y:r.y-s,width:r.width+n+o,height:r.height+s+d};var u=t.getStyle("radius");if(i&&i=="circle"){var c=Math.pow;var l=Math.round;u=l(Math.sqrt(c(h.width,2)+c(h.height,2))/2);h.x=r.cx-u;h.y=r.cy-u;h.width=2*u;h.height=2*u}var g=t.isSelected()?t.getMinder().isFocused()?"selected-":"blur-selected-":"";e.setPosition(h.x,h.y).setSize(h.width,h.height).setRadius(u).fill(t.getData("background")||t.getStyle(g+"background")||t.getStyle("background")).stroke(t.getStyle(g+"stroke"||t.getStyle("stroke")),t.getStyle(g+"stroke-width"));return new a.Box(h)}});var c=a.createClass("ShadowRenderer",{base:h,create:function(e){this.bringToBack=true;return new a.Rect},shouldRender:function(e){return e.getStyle("shadow")},update:function(e,t,r){e.setPosition(r.x+4,r.y+5).fill(t.getStyle("shadow"));var a=t.getStyle("shape");if(!a){e.setSize(r.width,r.height);e.setRadius(t.getStyle("radius"))}else if(a=="circle"){var i=Math.max(r.width,r.height);e.setSize(i,i);e.setRadius(i/2)}}});var l=new a.Marker;l.setWidth(10);l.setHeight(12);l.setRef(0,0);l.setViewBox(-6,-4,8,10);l.addShape((new a.Path).setPathData("M-5-3l5,3,-5,3").stroke("#33ffff"));var g=/wire/.test(window.location.href);var f=a.createClass("WireframeRenderer",{base:h,create:function(){var e=new a.Group;var t=this.oxy=(new a.Path).stroke("#f6f").setPathData("M0,-50L0,50M-50,0L50,0");var r=this.wireframe=(new a.Rect).stroke("lightgreen");var i=this.vectorIn=(new a.Path).stroke("#66ffff");var n=this.vectorOut=(new a.Path).stroke("#66ffff");i.setMarker(l,"end");n.setMarker(l,"end");return e.addShapes([t,r,i,n])},shouldRender:function(){return g},update:function(e,t,r){this.wireframe.setPosition(r.x,r.y).setSize(r.width,r.height);var a=t.getVertexIn();var i=t.getVertexOut();var n=t.getLayoutVectorIn().normalize(30);var o=t.getLayoutVectorOut().normalize(30);this.vectorIn.setPathData(["M",a.offset(n.reverse()),"L",a]);this.vectorOut.setPathData(["M",i,"l",o])}});d.register("OutlineModule",function(){return{events:!g?null:{ready:function(){this.getPaper().addResource(l)},layoutallfinish:function(){this.getRoot().traverse(function(e){e.getRenderer("WireframeRenderer").update(null,e,e.getContentBox())})}},renderers:{outline:u,outside:[c,f]}}})});