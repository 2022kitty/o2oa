define(function(e,t,r){var n=e("../core/kity");var o=e("../core/utils");var c=e("../core/node");var a=e("../core/command");var u=e("../core/module");u.register("ClipboardModule",function(){var e=this,t=[],r=[];function o(t,n){r.push(n);e.appendNode(n,t);n.render();n.setLayoutOffset(null);var c=n.children.map(function(e){return e.clone()});n.clearChildren();for(var a=0,u;u=c[a];a++){o(n,u)}}function u(e){if(!e.length)return;e.sort(function(e,t){return e.getIndex()-t.getIndex()});t=e.map(function(e){return e.clone()})}var s=n.createClass("CopyCommand",{base:a,execute:function(e){u(e.getSelectedAncestors(true));this.setContentChanged(false)}});var i=n.createClass("CutCommand",{base:a,execute:function(e){var t=e.getSelectedAncestors();if(t.length===0)return;u(t);e.select(c.getCommonAncestor(t),true);t.slice().forEach(function(t){e.removeNode(t)});e.layout(300)}});var l=n.createClass("PasteCommand",{base:a,execute:function(e){if(t.length){var n=e.getSelectedNodes();if(!n.length)return;for(var c=0,a;a=t[c];c++){for(var u=0,s;s=n[u];u++){o(s,a.clone())}}e.select(r,true);r=[];e.layout(300)}},queryState:function(e){return e.getSelectedNode()?0:-1}});if(e.supportClipboardEvent&&!n.Browser.gecko){var d=function(e){this.fire("beforeCopy",e)};var f=function(e){this.fire("beforeCut",e)};var m=function(e){this.fire("beforePaste",e)};return{commands:{copy:s,cut:i,paste:l},clipBoardEvents:{copy:d.bind(e),cut:f.bind(e),paste:m.bind(e)},sendToClipboard:u}}else{return{commands:{copy:s,cut:i,paste:l},commandShortcutKeys:{copy:"normal::ctrl+c|",cut:"normal::ctrl+x",paste:"normal::ctrl+v"},sendToClipboard:u}}})});