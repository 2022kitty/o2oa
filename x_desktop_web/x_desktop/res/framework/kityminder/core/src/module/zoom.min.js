define(function(e,t,o){var n=e("../core/kity");var r=e("../core/utils");var a=e("../core/minder");var i=e("../core/node");var u=e("../core/command");var m=e("../core/module");var c=e("../core/render");m.register("Zoom",function(){var e=this;var t;function o(){var t=e._zoomValue>=100?"optimize-speed":"geometricPrecision";e.getRenderContainer().setAttr("text-rendering",t)}function r(e){var t=e.shapeNode;var o=t.getCTM();var r=new n.Matrix(o.a,o.b,o.c,o.d,(o.e|0)+.5,(o.f|0)+.5);t.setAttribute("transform","matrix("+r.toString()+")")}n.extendClass(a,{zoom:function(e){var t=this.getPaper();var o=t.getViewPort();o.zoom=e/100;o.center={x:o.center.x,y:o.center.y};t.setViewPort(o);if(e==100)r(t)},getZoomValue:function(){return this._zoomValue}});function i(e,r){var a=e.getPaper();var i=a.getViewPort();if(!r)return;o();var u=e.getOption("zoomAnimationDuration");if(e.getRoot().getComplex()>200||!u){e._zoomValue=r;e.zoom(r);e.fire("viewchange")}else{var m=new n.Animator({beginValue:e._zoomValue,finishValue:r,setter:function(e,t){e.zoom(t)}});e._zoomValue=r;if(t){t.pause()}t=m.start(e,u,"easeInOutSine");t.on("finish",function(){e.fire("viewchange")})}e.fire("zoom",{zoom:r})}var m=n.createClass("Zoom",{base:u,execute:i,queryValue:function(e){return e._zoomValue}});var c=n.createClass("ZoomInCommand",{base:u,execute:function(e){i(e,this.nextValue(e))},queryState:function(e){return+!this.nextValue(e)},nextValue:function(e){var t=e.getOption("zoom"),o;for(o=0;o<t.length;o++){if(t[o]>e._zoomValue)return t[o]}return 0},enableReadOnly:true});var s=n.createClass("ZoomOutCommand",{base:u,execute:function(e){i(e,this.nextValue(e))},queryState:function(e){return+!this.nextValue(e)},nextValue:function(e){var t=e.getOption("zoom"),o;for(o=t.length-1;o>=0;o--){if(t[o]<e._zoomValue)return t[o]}return 0},enableReadOnly:true});return{init:function(){this._zoomValue=100;this.setDefaultOptions({zoom:[10,20,50,100,200]});o()},commands:{zoomin:c,zoomout:s,zoom:m},events:{"normal.mousewheel readonly.mousewheel":function(e){if(!e.originEvent.ctrlKey&&!e.originEvent.metaKey)return;var t=e.originEvent.wheelDelta;var o=this;if(!n.Browser.mac){t=-t}if(Math.abs(t)>100){clearTimeout(this._wheelZoomTimeout)}else{return}this._wheelZoomTimeout=setTimeout(function(){var e;var n=o.getPaper()._zoom||1;if(t<0){o.execCommand("zoom-in")}else if(t>0){o.execCommand("zoom-out")}},100);e.originEvent.preventDefault()}},commandShortcutKeys:{zoomin:"ctrl+=",zoomout:"ctrl+-"}}})});