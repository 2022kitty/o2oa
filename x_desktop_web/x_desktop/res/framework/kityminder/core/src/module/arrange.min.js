define(function(e,n,r){var t=e("../core/kity");var a=e("../core/node");var o=e("../core/command");var c=e("../core/module");t.extendClass(a,{arrange:function(e){var n=this.parent;if(!n)return;var r=n.children;if(e<0||e>=r.length)return;r.splice(this.getIndex(),1);r.splice(e,0,this);return this}});function u(e,n){return e.getIndex()-n.getIndex()}function d(e,n){return-u(e,n)}function i(e){var n=e.getSelectedNode();return n&&n.parent&&n.parent.children.length>1}var g=t.createClass("ArrangeUpCommand",{base:o,execute:function(e){var n=e.getSelectedNodes();n.sort(u);var r=n.map(function(e){return e.getIndex()});n.forEach(function(e,n){e.arrange(r[n]-1)});e.layout(300)},queryState:function(e){var n=e.getSelectedNode();return n?0:-1}});var l=t.createClass("ArrangeUpCommand",{base:o,execute:function(e){var n=e.getSelectedNodes();n.sort(d);var r=n.map(function(e){return e.getIndex()});n.forEach(function(e,n){e.arrange(r[n]+1)});e.layout(300)},queryState:function(e){var n=e.getSelectedNode();return n?0:-1}});var s=t.createClass("ArrangeCommand",{base:o,execute:function(e,n){var r=e.getSelectedNodes().slice();if(!r.length)return;var t=a.getCommonAncestor(r);if(t!=r[0].parent)return;var o=r.map(function(e){return{index:e.getIndex(),node:e}});var c=Math.min.apply(Math,o.map(function(e){return e.index}))>=n;o.sort(function(e,n){return c?n.index-e.index:e.index-n.index});o.forEach(function(e){e.node.arrange(n)});e.layout(300)},queryState:function(e){var n=e.getSelectedNode();return n?0:-1}});c.register("ArrangeModule",{commands:{arrangeup:g,arrangedown:l,arrange:s},contextmenu:[{command:"arrangeup"},{command:"arrangedown"},{divider:true}],commandShortcutKeys:{arrangeup:"normal::alt+Up",arrangedown:"normal::alt+Down"}})});