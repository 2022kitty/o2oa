define(function(e,t,r){var n=e("../core/data");function i(e,t,r){function n(e,t){var r;try{r=t.getScreenCTM().inverse()}catch(e){throw new Error("Can not inverse source element' ctm.")}return r.multiply(e.getScreenCTM())}function i(e,t){if(!(t instanceof Function)){t=function(){}}var r=[],n=[],i=[];for(var a=0,s=e.length;a<s;a++){switch(e[a]){case"M":case"L":case"T":case"S":case"A":case"C":case"H":case"V":case"Q":{if(i.length){n.push(i.join(""));i=[]}if(n[n.length-1]===","){n.pop()}if(n.length){t(n);r.push(n.join(""));n=[]}n.push(e[a]);break}case"Z":case"z":{n.push(i.join(""),e[a]);t(n);r.push(n.join(""));i=[];n=[];break}case".":case"e":{i.push(e[a]);break}case"-":{if(e[a-1]!=="e"){if(i.length){n.push(i.join(""),",")}i=[]}i.push("-");break}case" ":case",":{if(i.length){n.push(i.join(""),",");i=[]}break}default:{if(/\d/.test(e[a])){i.push(e[a])}else{if(i.length){n.push(i.join(""),e[a]);i=[]}else{if(n[n.length-1]===","){n.pop()}n.push(e[a])}}if(a+1===s){if(i.length){n.push(i.join(""))}t(n);r.push(n.join(""));i=null;n=null}}}}return r.join("")}function a(e,t,r){if(!e){return}if(e.tagName==="defs"){return}if(e.getAttribute("fill")==="transparent"){e.setAttribute("fill","none")}if(e.getAttribute("marker-end")){e.removeAttribute("marker-end")}t=t||0;r=r||0;if(e.getAttribute("transform")){var s=n(e,e.parentElement);t-=s.e;r-=s.f;e.removeAttribute("transform")}switch(e.tagName.toLowerCase()){case"g":break;case"path":{var o=e.getAttribute("d");if(o){o=i(o,function(e){switch(e[0]){case"V":{e[1]=+e[1]-r;break}case"H":{e[1]=+e[1]-t;break}case"M":case"L":case"T":{e[1]=+e[1]-t;e[3]=+e[3]-r;break}case"Q":case"S":{e[1]=+e[1]-t;e[3]=+e[3]-r;e[5]=+e[5]-t;e[7]=+e[7]-r;break}case"A":{e[11]=+e[11]-t;e[13]=+e[13]-r;break}case"C":{e[1]=+e[1]-t;e[3]=+e[3]-r;e[5]=+e[5]-t;e[7]=+e[7]-r;e[9]=+e[9]-t;e[11]=+e[11]-r}}});e.setAttribute("d",o);e.removeAttribute("transform")}return}case"image":case"text":{if(t&&r){var c=+e.getAttribute("x")||0,u=+e.getAttribute("y")||0;e.setAttribute("x",c-t);e.setAttribute("y",u-r)}if(e.getAttribute("dominant-baseline")){e.removeAttribute("dominant-baseline");e.setAttribute("dy",".8em")}e.removeAttribute("transform");return}}if(e.children){for(var f=0,l=e.children.length;f<l;f++){a(e.children[f],t,r)}}}e.style.display="none";a(e,t||0,r||0);e.style.display="inline"}n.registerProtocol("svg",r.exports={fileDescription:"SVG 矢量图",fileExtension:".svg",mineType:"image/svg+xml",dataType:"text",encode:function(e,t){var r=t.getPaper(),n=r.shapeNode.getAttribute("transform"),a,s,o,c=t.getRenderContainer(),u=c.getRenderBox(),f=c.getTransform(),l=u.width,h=u.height,b=20;r.shapeNode.setAttribute("transform","translate(0.5, 0.5)");a=r.container.innerHTML;r.shapeNode.setAttribute("transform",n);s=document.createElement("div");s.innerHTML=a;o=s.querySelector("svg");o.setAttribute("width",l+b*2|0);o.setAttribute("height",h+b*2|0);o.setAttribute("style","background: "+t.getStyle("background"));o.setAttribute("viewBox",[0,0,l+b*2|0,h+b*2|0].join(" "));s=document.createElement("div");i(o,u.x-b|0,u.y-b|0);s.appendChild(o);a=s.innerHTML;a=a.replace(/&nbsp;/g,"&#xa0;");return a}})});