(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],t);else t(CodeMirror)})(function(t){"use strict";t.defineMode("slim",function(e){var n=t.getMode(e,{name:"htmlmixed"});var i=t.getMode(e,"ruby");var r={html:n,ruby:i};var u={ruby:"ruby",javascript:"javascript",css:"text/css",sass:"text/x-sass",scss:"text/x-scss",less:"text/x-less",styl:"text/x-styl",coffee:"coffeescript",asciidoc:"text/x-asciidoc",markdown:"text/x-markdown",textile:"text/x-textile",creole:"text/x-creole",wiki:"text/x-wiki",mediawiki:"text/x-mediawiki",rdoc:"text/x-rdoc",builder:"text/x-builder",nokogiri:"text/x-nokogiri",erb:"application/x-erb"};var a=function(t){var e=[];for(var n in t)e.push(n);return new RegExp("^("+e.join("|")+"):")}(u);var o={commentLine:"comment",slimSwitch:"operator special",slimTag:"tag",slimId:"attribute def",slimClass:"attribute qualifier",slimAttribute:"attribute",slimSubmode:"keyword special",closeAttributeTag:null,slimDoctype:null,lineContinuation:null};var l={"{":"}","[":"]","(":")"};var c="_a-zA-ZÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�";var s=c+"\\-0-9·̀-ͯ‿-⁀";var f=new RegExp("^[:"+c+"](?::["+s+"]|["+s+"]*)");var k=new RegExp("^[:"+c+"][:\\."+s+"]*(?=\\s*=)");var d=new RegExp("^[:"+c+"][:\\."+s+"]*");var m=/^\.-?[_a-zA-Z]+[\w\-]*/;var b=/^#[_a-zA-Z]+[\w\-]*/;function z(t,e,n){var i=function(i,r){r.tokenize=e;if(i.pos<t){i.pos=t;return n}return r.tokenize(i,r)};return function(t,n){n.tokenize=i;return e(t,n)}}function p(t,e,n,i,r){var u=t.current();var a=u.search(n);if(a>-1){e.tokenize=z(t.pos,e.tokenize,r);t.backUp(u.length-a-i)}return r}function h(t,e){t.stack={parent:t.stack,style:"continuation",indented:e,tokenize:t.line};t.line=t.tokenize}function x(t){if(t.line==t.tokenize){t.line=t.stack.tokenize;t.stack=t.stack.parent}}function v(t,e){return function(n,i){x(i);if(n.match(/^\\$/)){h(i,t);return"lineContinuation"}var r=e(n,i);if(n.eol()&&n.current().match(/(?:^|[^\\])(?:\\\\)*\\$/)){n.backUp(1)}return r}}function y(t,e){return function(n,i){x(i);var r=e(n,i);if(n.eol()&&n.current().match(/,$/)){h(i,t)}return r}}function S(t,e){return function(n,i){var r=n.peek();if(r==t&&i.rubyState.tokenize.length==1){n.next();i.tokenize=e;return"closeAttributeTag"}else{return g(n,i)}}}function w(t){var e;var n=function(n,i){if(i.rubyState.tokenize.length==1&&!i.rubyState.context.prev){n.backUp(1);if(n.eatSpace()){i.rubyState=e;i.tokenize=t;return t(n,i)}n.next()}return g(n,i)};return function(t,r){e=r.rubyState;r.rubyState=i.startState();r.tokenize=n;return g(t,r)}}function g(t,e){return i.token(t,e.rubyState)}function M(t,e){if(t.match(/^\\$/)){return"lineContinuation"}return C(t,e)}function C(t,e){if(t.match(/^#\{/)){e.tokenize=S("}",e.tokenize);return null}return p(t,e,/[^\\]#\{/,1,n.token(t,e.htmlState))}function E(t){return function(e,n){var i=M(e,n);if(e.eol())n.tokenize=t;return i}}function A(t,e,n){e.stack={parent:e.stack,style:"html",indented:t.column()+n,tokenize:e.line};e.line=e.tokenize=C;return null}function L(t,e){t.skipToEnd();return e.stack.style}function $(t,e){e.stack={parent:e.stack,style:"comment",indented:e.indented+1,tokenize:e.line};e.line=L;return L(t,e)}function T(t,e){if(t.eat(e.stack.endQuote)){e.line=e.stack.line;e.tokenize=e.stack.tokenize;e.stack=e.stack.parent;return null}if(t.match(d)){e.tokenize=U;return"slimAttribute"}t.next();return null}function U(t,e){if(t.match(/^==?/)){e.tokenize=j;return null}return T(t,e)}function j(t,e){var n=t.peek();if(n=='"'||n=="'"){e.tokenize=N(n,"string",true,false,T);t.next();return e.tokenize(t,e)}if(n=="["){return w(T)(t,e)}if(t.match(/^(true|false|nil)\b/)){e.tokenize=T;return"keyword"}return w(T)(t,e)}function O(t,e,n){t.stack={parent:t.stack,style:"wrapper",indented:t.indented+1,tokenize:n,line:t.line,endQuote:e};t.line=t.tokenize=T;return null}function R(e,n){if(e.match(/^#\{/)){n.tokenize=S("}",n.tokenize);return null}var i=new t.StringStream(e.string.slice(n.stack.indented),e.tabSize);i.pos=e.pos-n.stack.indented;i.start=e.start-n.stack.indented;i.lastColumnPos=e.lastColumnPos-n.stack.indented;i.lastColumnValue=e.lastColumnValue-n.stack.indented;var r=n.subMode.token(i,n.subState);e.pos=i.pos+n.stack.indented;return r}function q(t,e){e.stack.indented=t.column();e.line=e.tokenize=R;return e.tokenize(t,e)}function I(n){var i=u[n];var r=t.mimeModes[i];if(r){return t.getMode(e,r)}var a=t.modes[i];if(a){return a(e,{name:i})}return t.getMode(e,"null")}function P(t){if(!r.hasOwnProperty(t)){return r[t]=I(t)}return r[t]}function Z(t,e){var n=P(t);var i=n.startState&&n.startState();e.subMode=n;e.subState=i;e.stack={parent:e.stack,style:"sub",indented:e.indented+1,tokenize:e.line};e.line=e.tokenize=q;return"slimSubmode"}function _(t,e){t.skipToEnd();return"slimDoctype"}function D(t,e){var n=t.peek();if(n=="<"){return(e.tokenize=E(e.tokenize))(t,e)}if(t.match(/^[|']/)){return A(t,e,1)}if(t.match(/^\/(!|\[\w+])?/)){return $(t,e)}if(t.match(/^(-|==?[<>]?)/)){e.tokenize=v(t.column(),y(t.column(),g));return"slimSwitch"}if(t.match(/^doctype\b/)){e.tokenize=_;return"keyword"}var i=t.match(a);if(i){return Z(i[1],e)}return V(t,e)}function Q(t,e){if(e.startOfLine){return D(t,e)}return V(t,e)}function V(t,e){if(t.eat("*")){e.tokenize=w(B);return null}if(t.match(f)){e.tokenize=B;return"slimTag"}return F(t,e)}function B(t,e){if(t.match(/^(<>?|><?)/)){e.tokenize=F;return null}return F(t,e)}function F(t,e){if(t.match(b)){e.tokenize=F;return"slimId"}if(t.match(m)){e.tokenize=F;return"slimClass"}return G(t,e)}function G(t,e){if(t.match(/^([\[\{\(])/)){return O(e,l[RegExp.$1],G)}if(t.match(k)){e.tokenize=H;return"slimAttribute"}if(t.peek()=="*"){t.next();e.tokenize=w(W);return null}return W(t,e)}function H(t,e){if(t.match(/^==?/)){e.tokenize=J;return null}return G(t,e)}function J(t,e){var n=t.peek();if(n=='"'||n=="'"){e.tokenize=N(n,"string",true,false,G);t.next();return e.tokenize(t,e)}if(n=="["){return w(G)(t,e)}if(n==":"){return w(K)(t,e)}if(t.match(/^(true|false|nil)\b/)){e.tokenize=G;return"keyword"}return w(G)(t,e)}function K(t,e){t.backUp(1);if(t.match(/^[^\s],(?=:)/)){e.tokenize=w(K);return null}t.next();return G(t,e)}function N(t,e,n,i,r){return function(u,a){x(a);var o=u.current().length==0;if(u.match(/^\\$/,o)){if(!o)return e;h(a,a.indented);return"lineContinuation"}if(u.match(/^#\{/,o)){if(!o)return e;a.tokenize=S("}",a.tokenize);return null}var l=false,c;while((c=u.next())!=null){if(c==t&&(i||!l)){a.tokenize=r;break}if(n&&c=="#"&&!l){if(u.eat("{")){u.backUp(2);break}}l=!l&&c=="\\"}if(u.eol()&&l){u.backUp(1)}return e}}function W(t,e){if(t.match(/^==?/)){e.tokenize=g;return"slimSwitch"}if(t.match(/^\/$/)){e.tokenize=Q;return null}if(t.match(/^:/)){e.tokenize=V;return"slimSwitch"}A(t,e,0);return e.tokenize(t,e)}var X={startState:function(){var t=n.startState();var e=i.startState();return{htmlState:t,rubyState:e,stack:null,last:null,tokenize:Q,line:Q,indented:0}},copyState:function(e){return{htmlState:t.copyState(n,e.htmlState),rubyState:t.copyState(i,e.rubyState),subMode:e.subMode,subState:e.subMode&&t.copyState(e.subMode,e.subState),stack:e.stack,last:e.last,tokenize:e.tokenize,line:e.line}},token:function(t,e){if(t.sol()){e.indented=t.indentation();e.startOfLine=true;e.tokenize=e.line;while(e.stack&&e.stack.indented>e.indented&&e.last!="slimSubmode"){e.line=e.tokenize=e.stack.tokenize;e.stack=e.stack.parent;e.subMode=null;e.subState=null}}if(t.eatSpace())return null;var n=e.tokenize(t,e);e.startOfLine=false;if(n)e.last=n;return o.hasOwnProperty(n)?o[n]:n},blankLine:function(t){if(t.subMode&&t.subMode.blankLine){return t.subMode.blankLine(t.subState)}},innerMode:function(t){if(t.subMode)return{state:t.subState,mode:t.subMode};return{state:t,mode:X}}};return X},"htmlmixed","ruby");t.defineMIME("text/x-slim","slim");t.defineMIME("application/x-slim","slim")});