(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],t);else t(CodeMirror)})(function(t){"use strict";t.defineMode("htmlmixed",function(e,a){var l=t.getMode(e,{name:"xml",htmlMode:true,multilineTagIndentFactor:a.multilineTagIndentFactor,multilineTagIndentPastTag:a.multilineTagIndentPastTag});var o=t.getMode(e,"css");var n=[],r=a&&a.scriptTypes;n.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:t.getMode(e,"javascript")});if(r)for(var c=0;c<r.length;++c){var i=r[c];n.push({matches:i.matches,mode:i.mode&&t.getMode(e,i.mode)})}n.push({matches:/./,mode:t.getMode(e,"text/plain")});function s(t,e){var a=e.htmlState.tagName;if(a)a=a.toLowerCase();var r=l.token(t,e.htmlState);if(a=="script"&&/\btag\b/.test(r)&&t.current()==">"){var c=t.string.slice(Math.max(0,t.pos-100),t.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);c=c?c[1]:"";if(c&&/[\"\']/.test(c.charAt(0)))c=c.slice(1,c.length-1);for(var i=0;i<n.length;++i){var s=n[i];if(typeof s.matches=="string"?c==s.matches:s.matches.test(c)){if(s.mode){e.token=d;e.localMode=s.mode;e.localState=s.mode.startState&&s.mode.startState(l.indent(e.htmlState,""))}break}}}else if(a=="style"&&/\btag\b/.test(r)&&t.current()==">"){e.token=u;e.localMode=o;e.localState=o.startState(l.indent(e.htmlState,""))}return r}function m(t,e,a){var l=t.current();var o=l.search(e),n;if(o>-1)t.backUp(l.length-o);else if(n=l.match(/<\/?$/)){t.backUp(l.length);if(!t.match(e,false))t.match(l)}return a}function d(t,e){if(t.match(/^<\/\s*script\s*>/i,false)){e.token=s;e.localState=e.localMode=null;return null}return m(t,/<\/\s*script\s*>/,e.localMode.token(t,e.localState))}function u(t,e){if(t.match(/^<\/\s*style\s*>/i,false)){e.token=s;e.localState=e.localMode=null;return null}return m(t,/<\/\s*style\s*>/,o.token(t,e.localState))}return{startState:function(){var t=l.startState();return{token:s,localMode:null,localState:null,htmlState:t}},copyState:function(e){if(e.localState)var a=t.copyState(e.localMode,e.localState);return{token:e.token,localMode:e.localMode,localState:a,htmlState:t.copyState(l,e.htmlState)}},token:function(t,e){return e.token(t,e)},indent:function(e,a){if(!e.localMode||/^\s*<\//.test(a))return l.indent(e.htmlState,a);else if(e.localMode.indent)return e.localMode.indent(e.localState,a);else return t.Pass},innerMode:function(t){return{state:t.localState||t.htmlState,mode:t.localMode||l}}}},"xml","javascript","css");t.defineMIME("text/html","htmlmixed")});