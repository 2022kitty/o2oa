(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("tiki",function(e){function t(e,t,n){return function(i,u){while(!i.eol()){if(i.match(t)){u.tokenize=r;break}i.next()}if(n)u.tokenize=n;return e}}function n(e){return function(t,n){while(!t.eol()){t.next()}n.tokenize=r;return e}}function r(e,i){function u(t){i.tokenize=t;return t(e,i)}var a=e.sol();var f=e.next();switch(f){case"{":e.eat("/");e.eatSpace();var c="";var s;while(s=e.eat(/[^\s\u00a0=\"\'\/?(}]/))c+=s;i.tokenize=o;return"tag";break;case"_":if(e.eat("_")){return u(t("strong","__",r))}break;case"'":if(e.eat("'")){return u(t("em","''",r))}break;case"(":if(e.eat("(")){return u(t("variable-2","))",r))}break;case"[":return u(t("variable-3","]",r));break;case"|":if(e.eat("|")){return u(t("comment","||"))}break;case"-":if(e.eat("=")){return u(t("header string","=-",r))}else if(e.eat("-")){return u(t("error tw-deleted","--",r))}break;case"=":if(e.match("==")){return u(t("tw-underline","===",r))}break;case":":if(e.eat(":")){return u(t("comment","::"))}break;case"^":return u(t("tw-box","^"));break;case"~":if(e.match("np~")){return u(t("meta","~/np~"))}break}if(a){switch(f){case"!":if(e.match("!!!!!")){return u(n("header string"))}else if(e.match("!!!!")){return u(n("header string"))}else if(e.match("!!!")){return u(n("header string"))}else if(e.match("!!")){return u(n("header string"))}else{return u(n("header string"))}break;case"*":case"#":case"+":return u(n("tw-listitem bracket"));break}}return null}var i=e.indentUnit;var u,a;function o(e,t){var n=e.next();var i=e.peek();if(n=="}"){t.tokenize=r;return"tag"}else if(n=="("||n==")"){return"bracket"}else if(n=="="){a="equals";if(i==">"){n=e.next();i=e.peek()}if(!/[\'\"]/.test(i)){t.tokenize=c()}return"operator"}else if(/[\'\"]/.test(n)){t.tokenize=f(n);return t.tokenize(e,t)}else{e.eatWhile(/[^\s\u00a0=\"\'\/?]/);return"keyword"}}function f(e){return function(t,n){while(!t.eol()){if(t.next()==e){n.tokenize=o;break}}return"string"}}function c(){return function(e,t){while(!e.eol()){var n=e.next();var r=e.peek();if(n==" "||n==","||/[ )}]/.test(r)){t.tokenize=o;break}}return"string"}}var s,l;function k(){for(var e=arguments.length-1;e>=0;e--)s.cc.push(arguments[e])}function d(){k.apply(null,arguments);return true}function b(e,t){var n=s.context&&s.context.noIndent;s.context={prev:s.context,pluginName:e,indent:s.indented,startOfLine:t,noIndent:n}}function g(){if(s.context)s.context=s.context.prev}function p(e){if(e=="openPlugin"){s.pluginName=u;return d(v,h(s.startOfLine))}else if(e=="closePlugin"){var t=false;if(s.context){t=s.context.pluginName!=u;g()}else{t=true}if(t)l="error";return d(m(t))}else if(e=="string"){if(!s.context||s.context.name!="!cdata")b("!cdata");if(s.tokenize==r)g();return d()}else return d()}function h(e){return function(t){if(t=="selfclosePlugin"||t=="endPlugin")return d();if(t=="endPlugin"){b(s.pluginName,e);return d()}return d()}}function m(e){return function(t){if(e)l="error";if(t=="endPlugin")return d();return k()}}function v(e){if(e=="keyword"){l="attribute";return d(v)}if(e=="equals")return d(x,v);return k()}function x(e){if(e=="keyword"){l="string";return d()}if(e=="string")return d(w);return k()}function w(e){if(e=="string")return d(w);else return k()}return{startState:function(){return{tokenize:r,cc:[],indented:0,startOfLine:true,pluginName:null,context:null}},token:function(e,t){if(e.sol()){t.startOfLine=true;t.indented=e.indentation()}if(e.eatSpace())return null;l=a=u=null;var n=t.tokenize(e,t);if((n||a)&&n!="comment"){s=t;while(true){var r=t.cc.pop()||p;if(r(a||n))break}}t.startOfLine=false;return l||n},indent:function(e,t){var n=e.context;if(n&&n.noIndent)return 0;if(n&&/^{\//.test(t))n=n.prev;while(n&&!n.startOfLine)n=n.prev;if(n)return n.indent+i;else return 0},electricChars:"/"}});e.defineMIME("text/tiki","tiki")});