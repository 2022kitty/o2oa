(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("smartymixed",function(t){var l=e.getMode(t,"htmlmixed");var i=e.getMode(t,"smarty");var a={rightDelimiter:"}",leftDelimiter:"{"};if(t.hasOwnProperty("leftDelimiter")){a.leftDelimiter=t.leftDelimiter}if(t.hasOwnProperty("rightDelimiter")){a.rightDelimiter=t.rightDelimiter}function r(e){return e.replace(/[^\s\w]/g,"\\$&")}var n=r(a.leftDelimiter),o=r(a.rightDelimiter);var m={smartyComment:new RegExp("^"+o+"\\*"),literalOpen:new RegExp(n+"literal"+o),literalClose:new RegExp(n+"/literal"+o),hasLeftDelimeter:new RegExp(".*"+n),htmlHasLeftDelimeter:new RegExp("[^<>]*"+n)};var c={chain:function(e,t,l){t.tokenize=l;return l(e,t)},cleanChain:function(e,t,l){t.tokenize=null;t.localState=null;t.localMode=null;return typeof l=="string"?l?l:null:l(e,t)},maybeBackup:function(e,t,l){var i=e.current();var a=i.search(t),r;if(a>-1)e.backUp(i.length-a);else if(r=i.match(/<\/?$/)){e.backUp(i.length);if(!e.match(t,false))e.match(i[0])}return l}};var f={html:function(e,t){var r=t.htmlMixedState.htmlState.context&&t.htmlMixedState.htmlState.context.tagName?t.htmlMixedState.htmlState.context.tagName:null;if(!t.inLiteral&&e.match(m.htmlHasLeftDelimeter,false)&&r===null){t.tokenize=f.smarty;t.localMode=i;t.localState=i.startState(l.indent(t.htmlMixedState,""));return c.maybeBackup(e,a.leftDelimiter,i.token(e,t.localState))}else if(!t.inLiteral&&e.match(a.leftDelimiter,false)){t.tokenize=f.smarty;t.localMode=i;t.localState=i.startState(l.indent(t.htmlMixedState,""));return c.maybeBackup(e,a.leftDelimiter,i.token(e,t.localState))}return l.token(e,t.htmlMixedState)},smarty:function(e,t){if(e.match(a.leftDelimiter,false)){if(e.match(m.smartyComment,false)){return c.chain(e,t,f.inBlock("comment","*"+a.rightDelimiter))}}else if(e.match(a.rightDelimiter,false)){e.eat(a.rightDelimiter);t.tokenize=f.html;t.localMode=l;t.localState=t.htmlMixedState;return"tag"}return c.maybeBackup(e,a.rightDelimiter,i.token(e,t.localState))},inBlock:function(e,t){return function(l,i){while(!l.eol()){if(l.match(t)){c.cleanChain(l,i,"");break}l.next()}return e}}};return{startState:function(){var e=l.startState();return{token:f.html,localMode:null,localState:null,htmlMixedState:e,tokenize:null,inLiteral:false}},copyState:function(t){var a=null,r=t.tokenize||t.token;if(t.localState){a=e.copyState(r!=f.html?i:l,t.localState)}return{token:t.token,tokenize:t.tokenize,localMode:t.localMode,localState:a,htmlMixedState:e.copyState(l,t.htmlMixedState),inLiteral:t.inLiteral}},token:function(e,t){if(e.match(a.leftDelimiter,false)){if(!t.inLiteral&&e.match(m.literalOpen,true)){t.inLiteral=true;return"keyword"}else if(t.inLiteral&&e.match(m.literalClose,true)){t.inLiteral=false;return"keyword"}}if(t.inLiteral&&t.localState!=t.htmlMixedState){t.tokenize=f.html;t.localMode=l;t.localState=t.htmlMixedState}var i=(t.tokenize||t.token)(e,t);return i},indent:function(t,a){if(t.localMode==i||t.inLiteral&&!t.localMode||m.hasLeftDelimeter.test(a)){return e.Pass}return l.indent(t.htmlMixedState,a)},innerMode:function(e){return{state:e.localState||e.htmlMixedState,mode:e.localMode||l}}}},"htmlmixed","smarty");e.defineMIME("text/x-smarty","smartymixed")});