layout=window.layout||{};var href=window.location.href;if(href.indexOf("debugger")!=-1)layout.debugger=true;layout.desktop=layout;COMMON.DOM.addReady(function(){COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Notice.js",null,false);COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Tooltip.js",null,false);COMMON.setContentPath("/x_desktop");COMMON.AjaxModule.load("mwf",function(){MWF.defaultPath="/x_desktop"+MWF.defaultPath;MWF.loadLP("zh-cn");MWF.require("MWF.widget.Mask",null,false);layout.mask=new MWF.widget.Mask({style:"desktop"});layout.mask.load();MWF.require("MWF.xDesktop.Layout",function(){MWF.require("MWF.xDesktop.Authentication",null,false);MWF.xDesktop.requireApp("Common","",null,false);(function(){layout.requireApp=function(t,o,e){var a=t.split(".");var n=a[a.length-1];var i="MWF.xApplication."+t;var s=e||"Main";var l=i+"."+s;var u=i+".lp."+MWF.language;var r=MWF.xApplication;a.each(function(t,o){if(o<a.length-1){r[t]=r[t]||{}}else{r[t]=r[t]||{options:Object.clone(MWF.xApplication.Common.options)}}r=r[t]}.bind(this));if(!r.options)r.options=Object.clone(MWF.xApplication.Common.options);MWF.xDesktop.requireApp(t,"lp."+MWF.language,null,false);MWF.xDesktop.requireApp(t,e,function(){if(o)o(r)})};layout.openApplication=function(t,o,e,a){debugger;if(layout.app){layout.desktop.openBrowserApp=o;layout.desktop.openBrowserStatus=a;layout.desktop.openBrowserOption=e;window.open("app.html","_blank")}else{var n=o.split(".");var i=n[n.length-1];layout.requireApp(o,function(o){this.createNewApplication(t,o,i,e,a)}.bind(this))}};layout.createNewApplication=function(t,o,e,a,n){var i=new o["Main"](this,a);i.desktop=layout;i.inBrowser=true;i.status=n;i.load(true);var s=e;if(a.appId){s=a.appId}else{if(o.options.multitask)s=s+"-"+new MWF.widget.UUID}i.appId=s;layout.app=i};layout.load=function(){this.isAuthentication(function(){layout.apps=[];this.node=$("layout");var t=window.opener;if(t){var o=t.layout.desktop.openBrowserApp;var e=t.layout.desktop.openBrowserStatus;var a=t.layout.desktop.openBrowserOption;layout.openApplication(null,o,a||{},e)}layout.mask.hide()}.bind(this))};layout.getServiceAddress=function(t){var o=layout.config.center.host||window.location.hostname;var e=layout.config.center.port;var a="";if(!e||e=="80"){a="http://"+o+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}else{a="http://"+o+":"+e+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}var n=window.location.hostname;a=a.replace(/{source}/g,n);MWF.restful("get",a,null,function(o){this.serviceAddressList=o.data;if(t)t()}.bind(this))};layout.isAuthentication=function(t){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var o=true;this.authentication.isAuthenticated(function(o){this.user=o.data;this.session={};this.session.user=o.data;if(t)t()}.bind(this),function(){this.authentication.loadLogin(this.node);o=false}.bind(this));return o};MWF.getJSON("res/config/config.json",function(t){layout.config=t;layout.getServiceAddress(function(){layout.load()})})})()})})});