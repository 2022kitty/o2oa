layout=window.layout||{};var href=window.location.href;if(href.indexOf("debugger")!=-1)layout.debugger=true;layout.desktop=layout;COMMON.DOM.addReady(function(){COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Notice.js",null,false);COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Tooltip.js",null,false);COMMON.setContentPath("/x_desktop");COMMON.AjaxModule.load("mwf",function(){MWF.defaultPath="/x_desktop"+MWF.defaultPath;MWF.loadLP("zh-cn");MWF.require("MWF.widget.Mask",null,false);layout.mask=new MWF.widget.Mask({style:"desktop"});layout.mask.load();MWF.require("MWF.xDesktop.Layout",function(){MWF.require("MWF.xDesktop.Authentication",null,false);MWF.xDesktop.requireApp("Common","",null,false);(function(){layout.requireApp=function(t,e,o){var i=t.split(".");var n=i[i.length-1];var a="MWF.xApplication."+t;var s=o||"Main";var r=a+"."+s;var u=a+".lp."+MWF.language;var l=MWF.xApplication;i.each(function(t,e){if(e<i.length-1){l[t]=l[t]||{}}else{l[t]=l[t]||{options:Object.clone(MWF.xApplication.Common.options)}}l=l[t]}.bind(this));if(!l.options)l.options=Object.clone(MWF.xApplication.Common.options);MWF.xDesktop.requireApp(t,"lp."+MWF.language,null,false);MWF.xDesktop.requireApp(t,o,function(){if(e)e(l)})};layout.openApplication=function(t,e,o,i){debugger;if(layout.app){layout.desktop.openBrowserApp=e;layout.desktop.openBrowserStatus=i;layout.desktop.openBrowserOption=o;window.open("app.html","_blank")}else{var n=e.split(".");var a=n[n.length-1];layout.requireApp(e,function(e){this.createNewApplication(t,e,a,o,i)}.bind(this))}};layout.createNewApplication=function(t,e,o,i,n){var a=new e["Main"](this,i);a.desktop=layout;a.inBrowser=true;a.status=n;a.load(true);var s=o;if(i.appId){s=i.appId}else{if(e.options.multitask)s=s+"-"+new MWF.widget.UUID}a.appId=s;layout.app=a};layout.load=function(){this.isAuthentication(function(){layout.apps=[];this.node=$("layout");var t=window.opener;if(t){var e=t.layout.desktop.openBrowserApp;var o=t.layout.desktop.openBrowserStatus;var i=t.layout.desktop.openBrowserOption;layout.openApplication(null,e,i||{},o)}layout.mask.hide()}.bind(this))};layout.getServiceAddress=function(t){if(typeOf(layout.config.center)=="object"){this.getServiceAddressConfigObject(t)}else if(typeOf(layout.config.center)=="array"){this.getServiceAddressConfigArray(t)}};layout.getServiceAddressConfigArray=function(t){var e=[];layout.config.center.each(function(o){e.push(this.getServiceAddressConfigObject(function(){e.each(function(t){if(t.isRunning()){t.cancel()}});if(t)t()}.bind(this),o))}.bind(this))};layout.getServiceAddressConfigObject=function(t,e){var o=e;if(!o)o=layout.config.center;var i=o.host||window.location.hostname;var n=o.port;var a="";if(!n||n=="80"){a="http://"+i+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}else{a="http://"+i+":"+n+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}var s=window.location.hostname;a=a.replace(/{source}/g,s);return MWF.restful("get",a,null,function(o){this.serviceAddressList=o.data;this.centerServer=e;if(t)t()}.bind(this))};layout.isAuthentication=function(t){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var e=true;this.authentication.isAuthenticated(function(e){this.user=e.data;this.session={};this.session.user=e.data;if(t)t()}.bind(this),function(){this.authentication.loadLogin(this.node);e=false}.bind(this));return e};MWF.getJSON("res/config/config.json",function(t){layout.config=t;layout.getServiceAddress(function(){layout.load()})})})()})})});