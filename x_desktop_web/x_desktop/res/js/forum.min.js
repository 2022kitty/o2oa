layout=window.layout||{};layout.desktop=layout;var href=window.location.href;if(href.indexOf("debugger")!=-1)layout.debugger=true;COMMON.DOM.addReady(function(){COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Notice.js",null,false);COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Tooltip.js",null,false);COMMON.setContentPath("/x_desktop");COMMON.AjaxModule.load("mwf",function(){MWF.defaultPath="/x_desktop"+MWF.defaultPath;MWF.loadLP("zh-cn");MWF.require("MWF.widget.Mask",null,false);layout.mask=new MWF.widget.Mask({style:"desktop"});layout.mask.load();MWF.require("MWF.xDesktop.Layout",function(){MWF.require("MWF.xDesktop.Authentication",null,false);MWF.xDesktop.requireApp("Common","",null,false);(function(){layout.requireApp=function(e,t,o){var i=e.split(".");var n=i[i.length-1];var a="MWF.xApplication."+e;var s=o||"Main";var r=a+"."+s;var u=a+".lp."+MWF.language;var l=MWF.xApplication;i.each(function(e,t){if(t<i.length-1){l[e]=l[e]||{}}else{l[e]=l[e]||{options:Object.clone(MWF.xApplication.Common.options)}}l=l[e]}.bind(this));if(!l.options)l.options=Object.clone(MWF.xApplication.Common.options);MWF.xDesktop.requireApp(e,"lp."+MWF.language,null,false);MWF.xDesktop.requireApp(e,o,function(){if(t)t(l)})};layout.openApplication=function(e,t,o,i){var n;if(layout.app){if(!t||t=="Forum"){n=o.id}else if(t=="ForumCategory"){n=o.categoryId}else if(t=="ForumDocument"){n=o.id}else if(t=="ForumPerson"){}else if(t=="ForumSearch"){}else if(t=="ForumSection"){n=o.sectionId}sessionStorage[t+(n?n:"")+"options"]=JSON.stringify(o);sessionStorage[s+(n?n:"")+"status"]=JSON.stringify(i);if(layout.debugger){window.open("forum.html?debugger&app="+t+(n?"&id="+n:""),"_blank")}else{window.open("forum.html?app="+t+(n?"&id="+n:""),"_blank")}}else{var a=t.split(".");var s=a[a.length-1];layout.requireApp(t,function(t){this.createNewApplication(e,t,s,o,i)}.bind(this))}};layout.createNewApplication=function(e,t,o,i,n){var a=new t["Main"](this,i);a.desktop=layout;a.inBrowser=true;a.status=n;a.load(true);var s=o;if(i.appId){s=i.appId}else{if(t.options.multitask)s=s+"-"+new MWF.widget.UUID}a.appId=s;layout.app=a};layout.load=function(){MWF.require("MWF.xDesktop.MessageMobile",function(){layout.message=new MWF.xDesktop.MessageMobile;layout.message.load()}.bind(this));this.isAuthentication(function(){layout.apps=[];this.node=$("layout");var e={};var t;var o=layout.getUrlParam();if(o.app){var i=o.app;var n=o.id;e=sessionStorage[i+(n?n:"")+"options"];if(e){e=JSON.parse(e)}else if(n){if(i=="ForumCategory"){e={categoryId:n}}else if(i=="ForumSection"){e={sectionId:n}}else if(i=="ForumDocument"){e={isNew:false,isEdited:false,id:n}}else{e={id:n}}}t=sessionStorage[i+(n?n:"")+"status"];if(t){t=JSON.parse(e)}}else{var i="Forum"}layout.openApplication(null,i,e,t);layout.mask.hide()}.bind(this))};layout.getUrlParam=function(){var e=window.location.href;var t=e.substr(e.indexOf("?")+1,e.length);var o=t.split("&");var i={};o.each(function(e){var t=e.split("=");i[t[0]]=t[1]});return i};layout.getServiceAddress=function(e){if(typeOf(layout.config.center)=="object"){this.getServiceAddressConfigObject(e)}else if(typeOf(layout.config.center)=="array"){this.getServiceAddressConfigArray(e)}};layout.getServiceAddressConfigArray=function(e){var t=[];layout.config.center.each(function(o){t.push(this.getServiceAddressConfigObject(function(){t.each(function(e){if(e.isRunning()){e.cancel()}});if(e)e()}.bind(this),o))}.bind(this))};layout.getServiceAddressConfigObject=function(e,t){var o=t;if(!o)o=layout.config.center;var i=o.host||window.location.hostname;var n=o.port;var a="";if(!n||n=="80"){a="http://"+i+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}else{a="http://"+i+":"+n+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}var s=window.location.hostname;a=a.replace(/{source}/g,s);return MWF.restful("get",a,null,function(o){this.serviceAddressList=o.data;this.centerServer=t;if(e)e()}.bind(this))};layout.isAuthentication=function(e){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var t=true;this.authentication.isAuthenticated(function(t){this.user=t.data;this.session={};this.session.user=t.data;if(e)e()}.bind(this),function(){this.user="anonymous";this.session={};this.session.user={name:this.user,roleList:[]};if(e)e();t=false}.bind(this));return t};MWF.getJSON("res/config/config.json",function(e){layout.config=e;layout.getServiceAddress(function(){layout.load()})})})()})})});