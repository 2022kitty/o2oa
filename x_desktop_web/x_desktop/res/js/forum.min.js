layout=window.layout||{};layout.desktop=layout;var href=window.location.href;if(href.indexOf("debugger")!=-1)layout.debugger=true;COMMON.DOM.addReady(function(){COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Notice.js",null,false);COMMON.AjaxModule.load("/x_desktop/res/framework/mootools/plugin/mBox.Tooltip.js",null,false);COMMON.setContentPath("/x_desktop");COMMON.AjaxModule.load("mwf",function(){MWF.defaultPath="/x_desktop"+MWF.defaultPath;MWF.loadLP("zh-cn");MWF.require("MWF.widget.Mask",null,false);layout.mask=new MWF.widget.Mask({style:"desktop"});layout.mask.load();MWF.require("MWF.xDesktop.Layout",function(){MWF.require("MWF.xDesktop.Authentication",null,false);MWF.xDesktop.requireApp("Common","",null,false);(function(){layout.requireApp=function(e,t,o){var i=e.split(".");var a=i[i.length-1];var s="MWF.xApplication."+e;var n=o||"Main";var r=s+"."+n;var l=s+".lp."+MWF.language;var u=MWF.xApplication;i.each(function(e,t){if(t<i.length-1){u[e]=u[e]||{}}else{u[e]=u[e]||{options:Object.clone(MWF.xApplication.Common.options)}}u=u[e]}.bind(this));if(!u.options)u.options=Object.clone(MWF.xApplication.Common.options);MWF.xDesktop.requireApp(e,"lp."+MWF.language,null,false);MWF.xDesktop.requireApp(e,o,function(){if(t)t(u)})};layout.openApplication=function(e,t,o,i){var a;if(layout.app){if(!t||t=="Forum"){a=o.id}else if(t=="ForumCategory"){a=o.categoryId}else if(t=="ForumDocument"){a=o.id}else if(t=="ForumPerson"){}else if(t=="ForumSearch"){}else if(t=="ForumSection"){a=o.sectionId}sessionStorage[t+(a?a:"")+"options"]=JSON.stringify(o);sessionStorage[n+(a?a:"")+"status"]=JSON.stringify(i);if(layout.debugger){window.open("forum.html?debugger&app="+t+(a?"&id="+a:""),"_blank")}else{window.open("forum.html?app="+t+(a?"&id="+a:""),"_blank")}}else{var s=t.split(".");var n=s[s.length-1];layout.requireApp(t,function(t){this.createNewApplication(e,t,n,o,i)}.bind(this))}};layout.createNewApplication=function(e,t,o,i,a){var s=new t["Main"](this,i);s.desktop=layout;s.inBrowser=true;s.status=a;s.load(true);var n=o;if(i.appId){n=i.appId}else{if(t.options.multitask)n=n+"-"+new MWF.widget.UUID}s.appId=n;layout.app=s};layout.load=function(){MWF.require("MWF.xDesktop.MessageMobile",function(){layout.message=new MWF.xDesktop.MessageMobile;layout.message.load()}.bind(this));this.isAuthentication(function(){layout.apps=[];this.node=$("layout");var e={};var t;var o=layout.getUrlParam();if(o.app){var i=o.app;var a=o.id;e=sessionStorage[i+(a?a:"")+"options"];if(e){e=JSON.parse(e)}else if(a){if(i=="ForumCategory"){e={categoryId:a}}else if(i=="ForumSection"){e={sectionId:a}}else if(i=="ForumDocument"){e={isNew:false,isEdited:false,id:a}}else{e={id:a}}}t=sessionStorage[i+(a?a:"")+"status"];if(t){t=JSON.parse(e)}}else{var i="Forum"}layout.openApplication(null,i,e,t);layout.mask.hide()}.bind(this))};layout.getUrlParam=function(){var e=window.location.href;var t=e.substr(e.indexOf("?")+1,e.length);var o=t.split("&");var i={};o.each(function(e){var t=e.split("=");i[t[0]]=t[1]});return i};layout.getServiceAddress=function(e){var t=layout.config.center.host||window.location.hostname;var o=layout.config.center.port;var i="";if(!o||o=="80"){i="http://"+t+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}else{i="http://"+t+":"+o+"/x_program_center/jaxrs/distribute/assemble/source/{source}"}var a=window.location.hostname;i=i.replace(/{source}/g,a);MWF.restful("get",i,null,function(t){this.serviceAddressList=t.data;if(e)e()}.bind(this))};layout.isAuthentication=function(e){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var t=true;this.authentication.isAuthenticated(function(t){this.user=t.data;this.session={};this.session.user=t.data;if(e)e()}.bind(this),function(){this.user="anonymous";this.session={};this.session.user={name:this.user,roleList:[]};if(e)e();t=false}.bind(this));return t};MWF.getJSON("res/config/config.json",function(e){layout.config=e;layout.getServiceAddress(function(){layout.load()})})})()})})});