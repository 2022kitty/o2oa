MWF.widget=MWF.widget||{};MWF.require("MWF.widget.Common",null,false);MWF.widget.ScrollBar=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{distance:10,style:"default",isShow:false,where:"before",indent:true,offset:{V:{x:0,y:0},H:{x:0,y:0}}},initialize:function(t,e){if(COMMON.Browser.Platform.isMobile){t.setStyle("overflow","auto");t.addEvent("scroll",function(){var e=t.scrollTop.toFloat();var o=t.scrollLeft.toFloat();this.fireEvent("scroll",[e,o])}.bind(this));return true}this.node=$(t);this.setOptions(e);this.path=MWF.defaultPath+"/widget/$ScrollBar/";this.cssPath=MWF.defaultPath+"/widget/$ScrollBar/"+this.options.style+"/css.wcss";this._loadCss();document.body.onresize=function(t){this.checkScroll()}.bind(this);this.node.onresize=function(t){this.checkScroll()}.bind(this);this.node.addEvent("mouseover",function(t){this.checkScroll();t.stopPropagation()}.bind(this));this.node.addEvent("mouseout",function(t){this.checkScroll();t.stopPropagation()}.bind(this));document.body.addEvent("mousemove",function(t){this.checkScrollShow(t)}.bind(this))},checkScrollShow:function(t){if(!this.node.isPointIn)return false;if(this.node.isPointIn(t.event.clientX,t.event.clientY,this.scrollVWidth)){if(this.scrollVAreaNode){var e=this.scrollVAreaNode.getStyle("opacity");if(e==0){if(!this.scrollAreaOverLock&&!this.scrollAreaOutLock){this.scrollAreaOverLock=true;var o=this.node.getStyle("margin-right").toFloat();if(this.options.indent){var i=new Fx.Tween(this.node,{property:"margin-right",duration:"100"});i.start(o+this.scrollVWidth).chain(function(){this.scrollVAreaNode.setStyle("display","block");var t=new Fx.Tween(this.scrollVAreaNode,{property:"opacity",duration:"100"});t.start(0,1).chain(function(){this.scrollAreaOverLock=false}.bind(this))}.bind(this))}else{this.scrollVAreaNode.setStyle("display","block");var s=new Fx.Tween(this.scrollVAreaNode,{property:"opacity",duration:"100"});s.start(0,1).chain(function(){this.scrollAreaOverLock=false}.bind(this))}}}}}else{if(this.scrollVAreaNode){var e=this.scrollVAreaNode.getStyle("opacity");if(e==1){if(!this.scrollAreaOutLock&&!this.scrollAreaOverLock){if(!this.showScrollBar){this.scrollAreaOutLock=true;var s=new Fx.Tween(this.scrollVAreaNode,{property:"opacity",duration:"100"});s.start(0).chain(function(){var t=this.node.getStyle("margin-right").toFloat();this.scrollVAreaNode.setStyle("display","none");if(this.options.indent){var e=new Fx.Tween(this.node,{property:"margin-right",duration:"100"});e.start(t-this.scrollVWidth).chain(function(){this.scrollAreaOutLock=false}.bind(this))}else{this.scrollAreaOutLock=false}}.bind(this))}}}}}},setScrollNodePosition:function(){this.node.scrollTo(0,0);if(this.scrollVNode){this.scrollVNode.setStyle("margin-top","0px");this.setScrollVNodeMoveLimit()}if(this.scrollHNode){var t=this.scrollHNode.getSize().y;t=0-t+this.options.offset.H.y;var e=0+this.options.offset.H.x;this.scrollHNode.setStyle("margin-left",""+e+"px");this.scrollHNode.setStyle("margin-top",""+t+"px")}},setScrollVNodeMove:function(){this.scrollVAreaNode.addEvent("click",function(t){t.stopPropagation()});this.scrollVNodeMove=new Drag(this.scrollVNode,{onStart:function(t,e){this.fireEvent("scrollStart");var o=e.event.clientX;var i=e.event.clientY;t.store("position",{x:o,y:i});t.store("margin",t.getStyle("margin-top"));this.showScrollBar=true}.bind(this),onComplete:function(t){this.showScrollBar=false;this.fireEvent("scrollComplete")}.bind(this),onDrag:function(t,e){var o=t.retrieve("position");var i=t.retrieve("margin").toFloat();var s=e.event.clientY.toFloat()-o.y.toFloat();var l=i+s;var r=this.node.getScrollSize();var n=this.node.getSize();var a=this.scrollVNode.getSize();var h=n.y.toFloat()-a.y.toFloat();var c=0;if(l<c)l=c;if(l>h)l=h;this.scrollVNode.setStyle("margin-top",""+l+"px");this.scroll(null,l)}.bind(this)})},setScrollVNodeMoveLimit:function(){var t=this.nodePosition.x.toFloat()+this.clientSize.x.toFloat();var e=this.nodePosition.y.toFloat();var o=e+this.clientSize.y.toFloat()-this.scrollVNodeSize.y.toFloat();this.scrollVNodeMove.detach();this.scrollVNodeMove.setOptions({limit:{x:[t,t],y:[e,o]}});this.scrollVNodeMove.attach()},scroll:function(t,e){var o=this.node.getScrollSize();var i=this.node.getSize();var s=this.scrollVNode.getSize();var l=o.y-i.y;var r=i.y.toFloat()-s.y.toFloat();var n=0;if(t){var a=this.node.getScroll();var h=a.y.toFloat()+t.toFloat();if(h<0)h=0;if(h>l)h=l;this.fireEvent("scroll",[h]);this.node.tweenScroll(h,1);var c=h/l.toFloat()*r.toFloat();if(c<n)c=n;if(c>r)c=r;this.scrollVNode.set("tween",{duration:"100",transition:Fx.Transitions.Expo.easeOut});this.scrollVNode.tween("margin-top",""+c+"px")}if(e){if(e>r)e=r;var c=e/r*l;var a=this.node.getScroll();this.node.tweenScroll(c,1);this.fireEvent("scroll",[c])}},checkScroll:function(){var t=this.node.getScrollSize();var e=this.node.getSize();var o=this.node.getPosition(this.node.getOffsetParent());this.mousewheel=function(t){var o=1-t.event.wheelDelta;var i=this.options.distance.toFloat()/100*e.y.toFloat();o=o/e.y.toFloat()*i;this.scroll(o,null);t.stopPropagation()}.bind(this);this.domMousewheel=function(t){var o=t.detail;var i=this.options.distance.toFloat()/100*e.y.toFloat();o=o/6*i;this.scroll(o,null);t.stopPropagation()}.bind(this);if(t.y>e.y){if(!this.scrollVNode){this.scrollVAreaNode=new Element("div",{styles:this.css.scrollVAreaNode}).inject(this.node,this.options.where);this.scrollVNode=new Element("div",{styles:this.css.scrollVNode}).inject(this.scrollVAreaNode);var i=this.node.getStyle("margin-right").toFloat();var s=this.node.getStyle("margin-top").toFloat();var l=this.node.getStyle("margin-bottom").toFloat();var r=this.scrollVAreaNode.getSize();if(this.options.indent)this.scrollVAreaNode.setStyle("margin-right",i);this.scrollVAreaNode.setStyle("margin-top",s);this.scrollVAreaNode.setStyle("display","none");this.scrollVWidth=this.scrollVAreaNode.getStyle("width").toFloat();this.setScrollVNodeMove();this.node.addEvent("mousewheel",this.mousewheel);if(Browser.name=="firefox"){this.node.addEventListener("DOMMouseScroll",this.domMousewheel,false)}}if(this.scrollVAreaNode.getStyle("position")=="absolute"){this.scrollVAreaNode.position({relativeTo:this.node,position:"topright",edge:"topleft"})}this.scrollVAreaNode.setStyle("height",e.y)}else{if(this.scrollVNode){if(!this.scrollAreaOutLock&&!this.scrollAreaOverLock){if(!this.showScrollBar){this.scrollAreaOutLock=true;var n=new Fx.Tween(this.scrollVAreaNode,{property:"opacity",duration:"100"});n.start(0).chain(function(){var t=this.node.getStyle("margin-right").toFloat();this.scrollVAreaNode.setStyle("display","none");if(this.options.indent){var e=new Fx.Tween(this.node,{property:"margin-right",duration:"100"});e.start(t-this.scrollVWidth).chain(function(){this.scrollAreaOutLock=false;this.scrollVAreaNode.destroy();this.scrollVNode=null;this.scrollVAreaNode=null}.bind(this))}else{this.scrollAreaOutLock=false;this.scrollVAreaNode.destroy();this.scrollVNode=null;this.scrollVAreaNode=null}}.bind(this))}}}this.node.removeEvents("mousewheel",this.mousewheel);if(Browser.name=="firefox"){this.node.addEventListener("DOMMouseScroll",this.domMousewheel,false)}}}});