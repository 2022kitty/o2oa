MWF.xScript=MWF.xScript||{};MWF.xScript.Environment=function(t){var e=t.data;var n=t.form;var i=t.forms;this.library=COMMON;this.library.version="4.0";var a=function(t){return new MWF.xScript.JSONData(t,function(t,e,n){var a={getKey:function(){return e},getParent:function(){return n}};while(a&&!i[a.getKey()])a=a.getParent();if(a)if(a.getKey())if(i[a.getKey()])i[a.getKey()].resetData()})};this.setData=function(t){this.data=a(t);this.data.save=function(t){form.workAction.saveData(function(e){if(t)t()}.bind(this),null,work.id,jData)}};this.setData(e);this.workContext={getTask:function(){return t.task},getWork:function(){return t.work||t.workCompleted},getActivity:function(){return t.activity},getTaskList:function(){return t.taskList},getControl:function(){return t.control},getWorkLogList:function(){return t.workLogList},getAttachmentList:function(){return t.attachmentList},getRouteList:function(){return t.task?t.task.routeNameList:null},getInquiredRouteList:function(){return null},setTitle:function(e){if(!this.workAction){MWF.require("MWF.xScript.Actions.WorkActions",null,false);this.workAction=new MWF.xScript.Actions.WorkActions}this.workAction.setTitle(t.work.id,{title:e})}};this.Dict=MWF.xScript.createDict(n.json.application);var r=null;var o=function(){if(!r){MWF.require("MWF.xScript.Actions.OrgActions",null,false);r=new MWF.xScript.Actions.OrgActions}};this.org={getDepartmentDuty:function(t){o();var e;r.getDepartmentDutyBydepartmentName(t.name,t.departmentName,function(t){if(t.data)e=t.data.identityList},null,false);return e},getPersonInfo:function(t){o();var e,n;r.getPersonInfo(t.name,function(i){if(i.data){e=i.data;n=e[t.attribute]}},null,false);return n},getPersonAttribute:function(t){o();var e;r.getPersonAttribute(t.name,t.personName,function(t){if(t.data)e=t.data.attributeList},null,false);return e},getDepartmentByIdentity:function(t){o();var e;r.getDepartmentByIdentity(t.personIdentity,function(t){e=t.data.name},null,false);return e},updatePersonAttribute:function(t){o();var e={attributeList:t.attributeList};r.updatePersonAttribute(t.name,e,function(t){if(success)success(t.data)},function(t,e,n){if(failure)failure(t,e,n)},false)},setPersonAttribute:function(t){o();var e={attributeList:t.attributeList};r.setPersonAttribute(t.name,t.personName,e,function(t){if(success)success(t.data)},function(t,e,n){if(failure)failure(t,e,n)},false)},listSupDepartmentNested:function(t){o();var e;r.listSupDepartmentNested(t.departmentName,function(t){e=t.data},null,false);return e},listPersonAttribute:function(t){o();var e;r.listPersonAttribute(t.personName,function(t){e=t.data},null,false);return e},listCompanyByPerson:function(t){o();var e;r.listCompanyByPerson(t.personName,function(t){debugger;e=t.data},null,false);return e},getCompanyByIdentity:function(t){o();var e;r.getCompanyByIdentity(t.personIdentity,function(t){e=t.data.name},null,false);return e},listCompanyAttribute:function(t){o();var e;r.listCompanyAttribute(t.compName,function(t){e=t.data},null,false);return e},getCompanyAttribute:function(t){o();var e;r.getCompanyAttribute(t.name,t.compName,function(t){if(t.data)e=t.data.attributeList},null,false);return e},listCompanyDuty:function(t){o();var e;r.listCompanyDuty(t.compName,function(t){e=t.data},null,false);return e},getCompanyDuty:function(t){o();var e;r.getCompanyDuty(t.name,t.compName,function(t){if(t.data)e=t.data.identityList},null,false);return e},listDepartmentAttribute:function(t){o();var e;r.listDepartmentAttribute(t.deptName,function(t){e=t.data},null,false);return e},getDepartmentAttribute:function(t){o();var e;r.getDepartmentAttribute(t.name,t.deptName,function(t){if(t.data)e=t.data.attributeList},null,false);return e},listDepartmentDuty:function(t){o();var e;r.listDepartmentDuty(t.deptName,function(t){e=t.data},null,false);return e},listIdentity:function(t){o();var e;r.listIdentity(t.deptName,function(t){e=t.data},null,false);return e},listIdentityNested:function(t){o();var e;r.listIdentityNested(t.deptName,function(t){e=t.data},null,false);return e},getSupDepartmentDirect:function(t){o();var e;r.getSupDepartmentDirect(t.deptName,function(t){if(t.data)e=t.data.name},null,false);return e},listDepartmentByPerson:function(t){o();var e;r.listDepartmentByPerson(t.personName,function(t){e=t.data},null,false);return e}};this.service={jaxwsClient:{},jaxrsClient:{}};var s=null;var u=function(t){if(!s){MWF.require("MWF.xDesktop.Actions.RestActions",function(){s=new MWF.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface","");s.getActions=function(t){this.actions={lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}};if(t)t()};if(t)t()})}else{if(t)t()}};this.view={lookup:function(t,e){u(function(){s.invoke({name:"lookup",async:true,parameter:{view:t.view,application:t.applcation},success:function(t){var n={grid:t.data.grid,groupGrid:t.data.groupGrid};if(e)e(n)}.bind(this)})}.bind(this))},select:function(t,e,i){if(t.view){var a={application:t.application||"",viewName:t.view||"",isTitle:t.isTitle||"yes",select:t.select||"multi"};if(!i)i={};var r=i.width||"700";var o=i.height||"400";if(layout.mobile){var s=document.body.getSize();r=s.x;o=s.y;i.style="viewmobile"}r=r.toInt();o=o.toInt();var s=n.app.content.getSize();var u=(s.x-r)/2;var c=(s.y-o)/2;if(u<0)u=0;if(c<0)c=0;if(layout.mobile){u=20;c=0}var f=this;MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:i.title||"select view",style:i.style||"view",top:c,left:u-20,fromTop:c,fromLeft:u-20,width:r,height:o,html:"<div></div>",maskNode:n.app.content,container:n.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){if(e)e(f.view.getData());this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});t.show();if(layout.mobile){var s=t.node.getElement(".MWF_dialod_Action_back");var l=t.node.getElement(".MWF_dialod_Action_ok");if(s)s.addEvent("click",function(e){t.close()}.bind(this));if(l)l.addEvent("click",function(n){if(e)e(this.view.getData());t.close()}.bind(this))}MWF.xDesktop.requireApp("process.Xform","widget.View",function(){this.view=new MWF.xApplication.process.Xform.widget.View(t.content.getFirst(),a,{style:"select"})}.bind(this))}.bind(this))}}};var c=[];this.include=function(t,e){if(c.indexOf(t)==-1){if(!this.scriptAction){MWF.require("MWF.xScript.Actions.ScriptActions",null,false);this.scriptAction=new MWF.xScript.Actions.ScriptActions}this.scriptAction.getScriptByName(n.json.application,t,c,function(t){if(t.data){c=c.concat(t.data.importedList);MWF.Macro.exec(t.data.text,this);if(e)e.apply(this)}else{if(e)e.apply(this)}}.bind(this),null,false)}else{if(e)e.apply(this)}}.bind(this);this.define=function(t,e,n){var i=true;if(n===false)i=false;var a={};a[t]={value:e,configurable:i};MWF.defineProperties(this,a)}.bind(this);this.form={readonly:n.options.readonly,get:function(t){return n.all[t]},getField:function(t){return i[t]},getAction:function(){return n.workAction},getDesktop:function(){return n.app.desktop},getData:function(){return new MWF.xScript.JSONData(n.getData())},save:function(t){n.saveWork(t)},close:function(){n.closeWork()},process:function(t){if(t){n.submitWork(t.routeName,t.opinion,t.callback)}else{n.processWork()}},reset:function(t){if(!t){if(n.businessData.control["allowReset"])n.resetWork()}else{n.resetWorkToPeson(t.names,t.opinion,opinion.success,opinion.failure)}},retract:function(t){if(!t){if(n.businessData.control["allowRetract"])n.retractWork()}else{n.doRetractWork(opinion.success,opinion.failure)}},print:function(t,e){n.printWork(t,e)},deleteWork:function(t){if(!t){if(n.businessData.control["allowDeleteWork"])n.deleteWork()}else{n.doDeleteWork(opinion.success,opinion.failure)}},confirm:function(t,e,i,a,r,o,s,u,c){n.confirm(t,e,i,a,r,o,s,u,c)},notice:function(t,e,i,a){n.notice(t,e,i,a)},addEvent:function(t,e){n.addEvent(t,e)}};this.form.currentRouteName=n.json.currentRouteName;this.form.opinion=n.json.opinion;this.target=t.target;this.event=t.event;this.status=t.status;this.session=layout.desktop.session};MWF.xScript.JSONData=function(t,e,n,i){var a=function(t,e,n,i){return function(){return["array","object"].indexOf(typeOf(t[n]))==-1?t[n]:new MWF.xScript.JSONData(t[n],e,n,i)}};var r=function(t,e,n,i){return function(a){t[n]=a;if(e)e(t,n,i)}};var o=function(){var o={};for(var s in t)o[s]={configurable:true,enumerable:true,get:a.apply(this,[t,e,s,this]),set:r.apply(this,[t,e,s,this])};o["length"]={get:function(){return Object.keys(t).length}};MWF.defineProperties(this,o);var u={getKey:{value:function(){return n}},getParent:{value:function(){return i}},toString:{value:function(){return t.toString()}},add:{value:function(n,i,o){var s=true;var u=typeOf(t);if(u=="array"){if(arguments.length<2){t.push(n);i=n;n=t.length-1}else{debugger;if(!n&&n!=0){t.push(i);n=t.length-1}else{s=false}}if(s){var c={};c[n]={configurable:true,enumerable:true,get:a.apply(this,[t,e,n,this]),set:r.apply(this,[t,e,n,this])};MWF.defineProperties(this,c)}this[n]=i}else if(u=="object"){if(!this.hasOwnProperty(n)){t[n]=i;if(s){var c={};c[n]={configurable:true,enumerable:true,get:a.apply(this,[t,e,n,this]),set:r.apply(this,[t,e,n,this])};MWF.defineProperties(this,c)}this[n]=i}else{if(o)this[n]=i}}return this[n]}},del:{value:function(e){if(!this.hasOwnProperty(e))return null;delete t[newKey];delete this[newKey];return this}}};MWF.defineProperties(this,u)};var s=typeOf(t);if(s=="object"||s=="array")o.apply(this)};MWF.xScript.createDict=function(t){return function(e){var n=t;this.name=e;MWF.require("MWF.xScript.Actions.DictActions",null,false);var i=new MWF.xScript.Actions.DictActions;this.get=function(t,e,a){var r=t.replace(/\./g,"/");var o=null;i.getDict(n,encodeURIComponent(this.name),r,function(t){o=t.data;if(e)e(t.data)},function(t,e,n){if(a)a(t,e,n)},false);return o};this.set=function(t,e,a,r){var o=t.replace(/\./g,"/");i.setDict(n,encodeURIComponent(this.name),o,e,function(t){if(a)a(t.data)},function(t,e,n){if(r)r(t,e,n)})};this.add=function(t,e,a,r){var o=t.replace(/\./g,"/");i.addDict(n,encodeURIComponent(this.name),o,e,function(t){if(a)a(t.data)},function(t,e,n){if(r)r(t,e,n)})};this.delete=function(t,e,a){var r=t.replace(/\./g,"/");i.deleteDict(n,encodeURIComponent(this.name),r,function(t){if(e)e(t.data)},function(t,e,n){if(a)a(t,e,n)})}}};