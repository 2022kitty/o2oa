MWF.xScript=MWF.xScript||{};MWF.xScript.CMSEnvironment=function(t){var e=t.data;var n=t.form;var i=t.forms;this.library=COMMON;this.library.version="4.0";var a=function(t){return new MWF.xScript.CMSJSONData(t,function(t,e,n){var a={getKey:function(){return e},getParent:function(){return n}};while(a&&!i[a.getKey()])a=a.getParent();if(a)if(a.getKey())if(i[a.getKey()])i[a.getKey()].resetData()})};this.setData=function(t){this.data=a(t);this.data.save=function(t){form.documentAction.saveData(function(e){if(t)t()}.bind(this),null,document.id,jData)}};this.setData(e);this.documentContext={getDocument:function(){return t.document},getControl:function(){return t.control},getAttachmentList:function(){return t.attachmentList}};this.Dict=MWF.xScript.createCMSDict(n.json.application);var r=null;var o=function(){if(!r){MWF.require("MWF.xScript.Actions.OrgActions",null,false);r=new MWF.xScript.Actions.OrgActions}};this.org={getDepartmentDuty:function(t){o();var e;r.getDepartmentDutyBydepartmentName(t.name,t.departmentName,function(t){if(t.data)e=t.data.identityList},null,false);return e},getPersonInfo:function(t){o();var e,n;r.getPersonInfo(t.name,function(i){if(i.data){e=i.data;n=e[t.attribute]}},null,false);return n},getPersonAttribute:function(t){o();var e;r.getPersonAttribute(t.name,t.personName,function(t){if(t.data)e=t.data.attributeList},null,false);return e},getDepartmentByIdentity:function(t){o();var e;r.getDepartmentByIdentity(t.personIdentity,function(t){e=t.data.name},null,false);return e},updatePersonAttribute:function(t){o();var e={attributeList:t.attributeList};r.updatePersonAttribute(t.name,e,function(t){if(success)success(t.data)},function(t,e,n){if(failure)failure(t,e,n)},false)},setPersonAttribute:function(t){o();var e={attributeList:t.attributeList};r.setPersonAttribute(t.name,t.personName,e,function(t){if(success)success(t.data)},function(t,e,n){if(failure)failure(t,e,n)},false)},listSupDepartmentNested:function(t){o();var e;r.listSupDepartmentNested(t.departmentName,function(t){e=t.data},null,false);return e},listPersonAttribute:function(t){o();var e;r.listPersonAttribute(t.personName,function(t){e=t.data},null,false);return e},listCompanyByPerson:function(t){o();var e;r.listCompanyByPerson(t.personName,function(t){debugger;e=t.data},null,false);return e},getCompanyByIdentity:function(t){o();var e;r.getCompanyByIdentity(t.personIdentity,function(t){e=t.data.name},null,false);return e},listCompanyAttribute:function(t){o();var e;r.listCompanyAttribute(t.compName,function(t){e=t.data},null,false);return e},getCompanyAttribute:function(t){o();var e;r.getCompanyAttribute(t.name,t.compName,function(t){if(t.data)e=t.data.attributeList},null,false);return e},listCompanyDuty:function(t){o();var e;r.listCompanyDuty(t.compName,function(t){e=t.data},null,false);return e},getCompanyDuty:function(t){o();var e;r.getCompanyDuty(t.name,t.compName,function(t){if(t.data)e=t.data.identityList},null,false);return e},listDepartmentAttribute:function(t){o();var e;r.listDepartmentAttribute(t.deptName,function(t){e=t.data},null,false);return e},getDepartmentAttribute:function(t){o();var e;r.getDepartmentAttribute(t.name,t.deptName,function(t){if(t.data)e=t.data.attributeList},null,false);return e},listDepartmentDuty:function(t){o();var e;r.listDepartmentDuty(t.deptName,function(t){e=t.data},null,false);return e},listIdentity:function(t){o();var e;r.listIdentity(t.deptName,function(t){e=t.data},null,false);return e},listIdentityNested:function(t){o();var e;r.listIdentityNested(t.deptName,function(t){e=t.data},null,false);return e},getSupDepartmentDirect:function(t){o();var e;r.getSupDepartmentDirect(t.deptName,function(t){if(t.data)e=t.data.name},null,false);return e},listDepartmentByPerson:function(t){o();var e;r.listDepartmentByPerson(t.personName,function(t){e=t.data},null,false);return e}};this.service={jaxwsClient:{},jaxrsClient:{}};var u=null;var s=function(t){if(!u){MWF.require("MWF.xDesktop.Actions.RestActions",function(){u=new MWF.xDesktop.Actions.RestActions("","x_cms_assemble_control","");u.getActions=function(t){this.actions={lookup:{uri:"/jaxrs/queryview/flag/{queryview}/application/flag/{CMSApplication}/execute",method:"PUT"},getQueryView:{uri:"/jaxrs/queryview/flag/{queryview}/application/flag/{CMSApplication}"}};if(t)t()};if(t)t()}.bind(this))}else{if(t)t()}};this.queryView={lookup:function(t,e){s(function(){u.invoke({name:"lookup",async:true,parameter:{queryview:t.queryView,CMSApplication:t.CMSApplication},success:function(t){var n={grid:t.data.grid,groupGrid:t.data.groupGrid};if(e)e(n)}.bind(this)})}.bind(this))},select:function(t,e,i){if(t.queryView){var a={application:t.CMSApplication||"",queryviewName:t.queryView||"",isTitle:t.isTitle||"yes",select:t.select||"multi"};if(!i)i={};var r=i.width||"700";var o=i.height||"400";if(layout.mobile){var u=document.body.getSize();r=u.x;o=u.y;i.style="viewmobile"}r=r.toInt();o=o.toInt();var u=n.app.content.getSize();var s=(u.x-r)/2;var c=(u.y-o)/2;if(s<0)s=0;if(c<0)c=0;if(layout.mobile){s=20;c=0}var f=this;MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:i.title||"select queryView",style:i.style||"view",top:c,left:s-20,fromTop:c,fromLeft:s-20,width:r,height:o,html:"<div></div>",maskNode:n.app.content,container:n.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){if(e)e(f.queryView.getData());this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});t.show();if(layout.mobile){var u=t.node.getElement(".MWF_dialod_Action_back");var l=t.node.getElement(".MWF_dialod_Action_ok");if(u)u.addEvent("click",function(e){t.close()}.bind(this));if(l)l.addEvent("click",function(n){if(e)e(this.queryView.getData());t.close()}.bind(this))}MWF.xDesktop.requireApp("cms.Xform","widget.QueryView",function(){this.queryView=new MWF.xApplication.cms.Xform.widget.QueryView(t.content.getFirst(),a,{style:"select"})}.bind(this))}.bind(this))}}};var c=[];this.include=function(t,e){if(c.indexOf(t)==-1){if(!this.scriptAction){MWF.require("MWF.xScript.Actions.CMSScriptActions",null,false);this.scriptAction=new MWF.xScript.Actions.CMSScriptActions}this.scriptAction.getScriptByName(n.json.application,t,c,function(t){c=c.concat(t.data.importedList);MWF.Macro.exec(t.data.text,this);if(e)e.apply(this)}.bind(this),null,false)}else{if(e)e.apply(this)}}.bind(this);this.define=function(t,e,n){var i=true;if(n===false)i=false;var a={};a[t]={value:e,configurable:i};MWF.defineProperties(this,a)}.bind(this);this.form={get:function(t){return n.all[t]},getField:function(t){return i[t]},getData:function(){return new MWF.xScript.CMSJSONData(n.getData())},save:function(t){n.saveDocument(t)},close:function(){n.closeDocument()},publish:function(t){n.publishDocument()},confirm:function(t,e,i,a,r,o,u,s,c){n.confirm(t,e,i,a,r,o,u,s,c)},notice:function(t,e,i,a){n.notice(t,e,i,a)},addEvent:function(t,e){n.addEvent(t,e)}};this.target=t.target;this.event=t.event;this.status=t.status;this.session=layout.desktop.session};MWF.xScript.CMSJSONData=function(t,e,n,i){var a=function(t,e,n,i){return function(){return["array","object"].indexOf(typeOf(t[n]))==-1?t[n]:new MWF.xScript.CMSJSONData(t[n],e,n,i)}};var r=function(t,e,n,i){return function(a){t[n]=a;if(e)e(t,n,i)}};var o=function(){var o={};for(var u in t)o[u]={configurable:true,get:a.apply(this,[t,e,u,this]),set:r.apply(this,[t,e,u,this])};o["length"]={get:function(){return Object.keys(t).length}};MWF.defineProperties(this,o);this.getKey=function(){return n};this.getParent=function(){return i};this.toString=function(){return t.toString()};this.add=function(n,i){var o=typeOf(t);if(!this.hasOwnProperty(n)){if(o=="array"){t.push(i||{});n=t.length-1}else{t[n]=i||{}}var u={};u[n]={configurable:true,get:a.apply(this,[t,e,n,this]),set:r.apply(this,[t,e,n,this])};MWF.defineProperties(this,u)}this[n]=i;return this};this.del=function(e){if(!this.hasOwnProperty(e))return null;delete t[newKey];delete this[newKey];return this}};var u=typeOf(t);if(u=="object"||u=="array")o.apply(this)};MWF.xScript.createCMSDict=function(t){return function(e){var n=t;this.name=e;MWF.require("MWF.xScript.Actions.CMSDictActions",null,false);var i=new MWF.xScript.Actions.CMSDictActions;this.get=function(t,e,a){var r=t.replace(/\./g,"/");var o=null;i.getDict(n,encodeURIComponent(this.name),r,function(t){o=t.data;if(e)e(t.data)},function(t,e,n){if(a)a(t,e,n)},false);return o};this.set=function(t,e,a,r){var o=t.replace(/\./g,"/");i.setDict(n,encodeURIComponent(this.name),o,e,function(t){if(a)a(t.data)},function(t,e,n){if(r)r(t,e,n)})};this.add=function(t,e,a,r){var o=t.replace(/\./g,"/");i.addDict(n,encodeURIComponent(this.name),o,e,function(t){if(a)a(t.data)},function(t,e,n){if(r)r(t,e,n)})};this.delete=function(t,e,a){var r=t.replace(/\./g,"/");i.deleteDict(n,encodeURIComponent(this.name),r,function(t){if(e)e(t.data)},function(t,e,n){if(a)a(t,e,n)})}}};