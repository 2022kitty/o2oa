MWF.require("MWF.widget.Dialog",null,false);MWF.xDesktop.Window=new Class({Extends:MWF.widget.Dialog,Implements:[Options,Events],options:{style:"default",title:"window",width:"800",height:"600",top:"10",left:"10",fromTop:"0",fromLeft:"0",mark:false,html:"",text:"",url:"",content:null,isMax:true,isClose:true,isResize:true,isMove:true,buttons:null,buttonList:null},initialize:function(t,s){var i=layout.desktop.desktopNode.getPosition();this.options.top=parseFloat(this.options.top)+i.y;this.options.fromTop=parseFloat(this.options.fromTop)+i.y;this.app=t;this.parent(s);this.isHide=false;this.isMax=false},changeStyle:function(){var t=this.getNodeStyleStatus();this.cssPath=MWF.defaultPath+"/widget/$Dialog/"+this.options.style+"/css.wcss";this._loadCss();this.setNodeStyleStatus(t);this.node.setStyles(this.css.to);this.spacer.setStyles(this.css.spacerTo);if(this.app==this.app.desktop.currentApp){this.node.setStyles(this.css.current);this.spacer.setStyles(this.css.spacerCurrent)}else{this.node.setStyles(this.css.uncurrent);this.spacer.setStyles(this.css.spacerUncurrent)}},setNodeStyleStatus:function(t){this.css.to.height=t.nodeTo.height;this.css.to.width=t.nodeTo.width;this.css.to.top=t.nodeTo.top;this.css.to.left=t.nodeTo.left;this.css.to["z-index"]=t.nodeTo["z-index"];this.css.from.top=t.nodeFrom.top;this.css.from.left=t.nodeFrom.left;this.css.from["z-index"]=t.nodeFrom["z-index"];this.css.spacerTo.height=t.spacerTo.height;this.css.spacerTo.width=t.spacerTo.width;this.css.spacerTo.top=t.spacerTo.top;this.css.spacerTo.left=t.spacerTo.left;this.css.spacerTo["z-index"]=t.spacerTo["z-index"];this.css.spacerFrom.top=t.spacerFrom.top;this.css.spacerFrom.left=t.spacerFrom.left;this.css.spacerFrom["z-index"]=t.spacerFrom["z-index"]},getNodeStyleStatus:function(){return{nodeTo:{height:this.css.to.height,width:this.css.to.width,top:this.css.to.top,left:this.css.to.left,"z-index":this.css.to["z-index"]},nodeFrom:{top:this.css.from.top,left:this.css.from.left,"z-index":this.css.from["z-index"]},spacerTo:{height:this.css.spacerTo.height,width:this.css.spacerTo.width,top:this.css.spacerTo.top,left:this.css.spacerTo.left,"z-index":this.css.spacerTo["z-index"]},spacerFrom:{top:this.css.spacerFrom.top,left:this.css.spacerFrom.left,"z-index":this.css.spacerFrom["z-index"]}}},reStyle:function(t){if(t)this.setOptions(t);var s=null;if(MWF.xDesktop.zIndexPool)s=MWF.xDesktop.zIndexPool.applyZindex();this.css.to.height=this.options.height+"px";this.css.to.width=this.options.width+"px";this.css.to.top=this.options.top+"px";this.css.to.left=this.options.left+"px";this.css.from.top=this.options.fromTop+"px";this.css.from.left=this.options.fromLeft+"px";if(s){this.css.from["z-index"]=s+1;this.css.to["z-index"]=s+1}if(this.node)this.node.set("styles",this.css.from);this.css.spacerTo.height=this.options.height+"px";this.css.spacerTo.width=this.options.width+"px";this.css.spacerTo.top=this.options.top+"px";this.css.spacerTo.left=this.options.left+"px";this.css.spacerFrom.top=this.options.fromTop+"px";this.css.spacerFrom.left=this.options.fromLeft+"px";if(s){this.css.spacerFrom["z-index"]=s;this.css.spacerTo["z-index"]=s}if(this.spacer)this.spacer.set("styles",this.css.spacerFrom)},setCurrent:function(){if(MWF.xDesktop.zIndexPool){var t=this.node.getStyle("z-index").toFloat()+1;if(t<MWF.xDesktop.zIndexPool.zIndex){var s=MWF.xDesktop.zIndexPool.applyZindex();this.css.spacerTo["z-index"]=s;this.css.spacerFrom["z-index"]=s;if(this.spacer)this.spacer.setStyle("z-index",s);this.css.to["z-index"]=s+1;this.css.from["z-index"]=s+1;this.node.setStyle("z-index",s+1)}}this.node.setStyles(this.css.current);if(this.spacer)this.spacer.setStyles(this.css.spacerCurrent)},setUncurrent:function(){this.node.setStyles(this.css.uncurrent);if(this.spacer)this.spacer.setStyles(this.css.spacerUncurrent)},setTitleEvent:function(){this.node.addEvent("mousedown",function(){this.app.setCurrent()}.bind(this));this.containerDrag=new Drag(this.title,{handle:this.title,onStart:function(t,s){this.containerDrag.stop();var i=this.node.clone(false).inject($(document.body));var e=this.node.getSize();i.setStyles({opacity:.7,border:"2px dashed #999","z-index":this.node.getStyle("z-index"),width:e.x,height:e.y,"background-color":"#CCC",position:"absolute"});i.position({relativeTo:this.node,position:"upperLeft",edge:"upperLeft"});var o=new Drag.Move(i,{onStart:function(){this.node.fade("out");this.spacer.fade("out")}.bind(this),onDrop:function(t,s,i){debugger;this.node.fade("in");this.spacer.fade(this.css.spacerTo.opacity);this.node.position({relativeTo:t,position:"upperLeft",edge:"upperLeft"});var e=this.node.getPosition();this.spacer.setStyles({top:e.y,left:e.x});this.css.spacerTo.left=e.x;this.css.spacerTo.top=e.y;this.css.to.left=e.x;this.css.to.top=e.y;t.destroy();this.fireEvent("moveDrop",[i])}.bind(this),onCancel:function(t){t.destroy();o=null}});o.start(s)}.bind(this)});if(this.options.isResize){this.node.makeResizable({handle:this.bottom,limit:{x:[200,null],y:[200,null]},onDrag:function(){var t=this.node.getComputedSize();if(this.spacer){this.spacer.setStyles({width:t.width,height:t.height});this.css.spacerTo.width=t.width;this.css.spacerTo.height=t.height}this.css.to.width=t.width;this.css.to.height=t.height;this.setContentSize(t.height,t.width);this.fireEvent("resize")}.bind(this),onComplete:function(){this.fireEvent("resizeCompleted")}.bind(this)})}},getContentUrl:function(){this.contentUrl=MWF.defaultPath+"/xDesktop/$Window/"+this.options.style+"/dialog.html"},_loadCss:function(){this.path=MWF.defaultPath+"/xDesktop/$Window/";this.cssPath=MWF.defaultPath+"/xDesktop/$Window/"+this.options.style+"/css.wcss";var t=new Request.JSON({url:this.cssPath,secure:false,async:false,method:"get",noCache:true,onSuccess:function(t,s){this.css=t}.bind(this),onError:function(t,s){alert(t)}});t.send()},getSpacer:function(){if(!this.spacer){this.spacer=new Element("div",{styles:this.css.spacerFrom}).inject(this.options.container||$(document.body))}},showNoAnimation:function(t,s){if(t){this.showMaxIm()}else if(s){this.showIm();this.hideIm()}else{this.showIm()}},showMaxIm:function(t){this.getSpacer();this.spacer.setStyle("display","block");this.node.setStyle("display","block");var s=this.getMaxSize();var i=Object.clone(this.css.spacerTo);var e=Object.clone(this.css.to);var o={};i.top=s.position.y;i.left=s.position.x;i.width=s.spacer.x;i.height=s.spacer.y;e.top=s.position.y;e.left=s.position.x;e.width=s.node.x;e.height=s.node.y;o=s.contentSize;if(this.fireEvent("queryShow")){this.node.setStyles(e);this.spacer.setStyles(i);this.content.setStyles(o);if(this.titleText)this.getTitle();this.isMax=true;this.isHide=false;if(this.containerDrag)this.containerDrag.detach();if(t)t();this.fireEvent("postShow");if(this.maxActionNode)this.maxActionNode.setStyles(this.css.restoreActionNode)}},showIm:function(){if(this.options.mark)this._markShow();this.getSpacer();this.spacer.setStyle("display","block");this.node.setStyle("display","block");var t=this.getContentSize(this.css.to.height.toFloat(),this.css.to.width.toFloat());if(this.fireEvent("queryShow")){this.spacer.setStyles(this.css.spacerTo);if(this.app.desktop.currentApp!=this.app)this.spacer.setStyles(this.css.spacerUncurrent);this.content.setStyles(t);this.node.setStyles(this.css.to);if(this.titleText)this.getTitle();this.isHide=false;if(this.containerDrag)this.containerDrag.attach();this.fireEvent("postShow")}},show:function(){if(this.options.mark)this._markShow();if(!this.morph){this.morph=new Fx.Morph(this.node,{duration:100,link:"chain"})}this.morph.setOptions({duration:50});this.getSpacer();if(!this.spacerMorph){this.spacerMorph=new Fx.Morph(this.spacer,{duration:100,link:"chain"})}this.spacerMorph.setOptions({duration:50});if(!this.contentMorph){this.contentMorph=new Fx.Morph(this.content,{duration:50,link:"chain"})}this.contentMorph.setOptions({duration:50});this.spacer.setStyle("display","block");this.node.setStyle("display","block");var t=this.getContentSize(this.css.to.height.toFloat(),this.css.to.width.toFloat());if(this.fireEvent("queryShow")){var s=false;var i=false;var e=false;this.spacerMorph.start(this.css.spacerTo).chain(function(){if(this.app.desktop.currentApp!=this.app)this.spacer.setStyles(this.css.spacerUncurrent);i=true;o()}.bind(this));this.contentMorph.start(t).chain(function(){e=true;o()}.bind(this));this.morph.start(this.css.to).chain(function(){s=true;o()}.bind(this));var o=function(){if(s&&i&&e){if(this.titleText)this.getTitle();this.isHide=false;if(this.containerDrag)this.containerDrag.attach();this.fireEvent("postShow")}}.bind(this)}},restore:function(t){if(this.options.mark)this._markShow();if(!this.morph){this.morph=new Fx.Morph(this.node,{duration:100,link:"chain"})}this.morph.setOptions({duration:50});this.getSpacer();if(!this.spacerMorph){this.spacerMorph=new Fx.Morph(this.spacer,{duration:100,link:"chain"})}this.spacerMorph.setOptions({duration:50});if(!this.contentMorph){this.contentMorph=new Fx.Morph(this.content,{duration:50,link:"chain"})}this.contentMorph.setOptions({duration:50});this.spacer.setStyle("display","block");this.node.setStyle("display","block");var s=this.getContentSize(this.css.to.height.toFloat(),this.css.to.width.toFloat());if(this.fireEvent("queryRestore")){var i=false;var e=false;var o=false;this.spacerMorph.start(this.css.spacerTo).chain(function(){if(this.app.desktop.currentApp!=this.app)this.spacer.setStyles(this.css.spacerUncurrent);e=true;n()}.bind(this));this.contentMorph.start(s).chain(function(){o=true;n()}.bind(this));this.morph.start(this.css.to).chain(function(){if(this.app.desktop.currentApp!=this.app)this.node.setStyles(this.css.uncurrent);i=true;n()}.bind(this));var n=function(){if(i&&e&&o){if(this.titleText)this.getTitle();this.isHide=false;this.isMax=false;if(this.containerDrag)this.containerDrag.attach();if(t)t();this.fireEvent("resize");this.fireEvent("postRestore")}}.bind(this);if(this.maxActionNode)this.maxActionNode.setStyles(this.css.maxActionNode)}},restoreIm:function(t){this.getSpacer();this.spacer.setStyle("display","block");this.node.setStyle("display","block");var s=this.getContentSize(this.css.to.height.toFloat(),this.css.to.width.toFloat());if(this.fireEvent("queryRestore")){this.node.setStyles(this.css.to);this.spacer.setStyles(this.css.spacerTo);this.content.setStyles(s);if(this.titleText)this.getTitle();this.isHide=false;this.isMax=false;if(this.containerDrag)this.containerDrag.attach();if(t)t();this.fireEvent("resize");this.fireEvent("postRestore");if(this.maxActionNode)this.maxActionNode.setStyles(this.css.maxActionNode)}},hideIm:function(t,s,i){this.getSpacer();if(t){this.css.from.left=t;this.css.spacerFrom.left=t}if(s){this.css.from.top=s;this.css.spacerFrom.top=s}if(this.fireEvent("queryHide")){if(this.titleText)this.titleText.set("text","");if(this.button)this.button.set("html","");this.spacer.setStyles(this.css.spacerFrom);this.node.setStyles(this.css.from);this._markHide();this.isHide=true;this.node.setStyle("display","none");this.spacer.setStyle("display","none");if(i)i();this.fireEvent("postHide")}},hide:function(t,s,i){if(!this.morph){this.morph=new Fx.Morph(this.node,{duration:100,link:"chain"})}this.morph.setOptions({duration:100});this.getSpacer();if(!this.spacerMorph){this.spacerMorph=new Fx.Morph(this.spacer,{duration:100,link:"chain"})}this.spacerMorph.setOptions({duration:100});if(t){this.css.from.left=t;this.css.spacerFrom.left=t}if(s){this.css.from.top=s;this.css.spacerFrom.top=s}if(this.fireEvent("queryHide")){if(this.titleText)this.titleText.set("text","");if(this.button)this.button.set("html","");var e=false;var o=false;this.spacerMorph.start(this.css.spacerFrom).chain(function(){o=true;n()}.bind(this));this.morph.start(this.css.from).chain(function(){e=true;n()}.bind(this));var n=function(){if(e&&o){this._markHide();this.isHide=true;this.node.setStyle("display","none");this.spacer.setStyle("display","none");if(i)i();this.fireEvent("postHide")}}.bind(this)}},_hideIm:function(){this.node.setStyle("display","none");this.spacer.setStyle("display","none")},_showIm:function(){this.node.setStyle("display","block");this.spacer.setStyle("display","block")},_fadeOut:function(){this.node.fade("out");this.spacer.fade("out")},_fadeIn:function(){this.node.fade("in");this.spacer.fade("in")},close:function(t){if(!this.morph){this.morph=new Fx.Morph(this.node,{duration:100,link:"chain"})}this.morph.setOptions({duration:100});this.getSpacer();if(!this.spacerMorph){this.spacerMorph=new Fx.Morph(this.spacer,{duration:100,link:"chain"})}this.spacerMorph.setOptions({duration:100});if(this.fireEvent("queryClose")){this.spacer.destroy();this.spacer=null;this._markHide();this.node.destroy();this.node=null;if(t)t();this.fireEvent("postClose")}},getAction:function(){this.titleAction.setStyles(this.css.titleAction);var t=this;this.closeActionNode=new Element("div",{styles:this.css.closeActionNode,events:{mouseover:function(s){this.setStyles(t.css.titleActionOver);s.stopPropagation()},mouseout:function(s){this.setStyles(t.css.titleActionOut);s.stopPropagation()},mousedown:function(s){this.setStyles(t.css.titleActionDown);s.stopPropagation()},mouseup:function(s){this.setStyles(t.css.titleActionOver);s.stopPropagation()},click:function(t){this.app.close();t.stopPropagation()}.bind(this)}}).inject(this.titleAction);if(this.options.isMax!=false){this.maxActionNode=new Element("div",{styles:this.css.maxActionNode,events:{mouseover:function(){this.setStyles(t.css.titleActionOver)},mouseout:function(){this.setStyles(t.css.titleActionOut)},mousedown:function(){this.setStyles(t.css.titleActionDown)},mouseup:function(){this.setStyles(t.css.titleActionOver)},click:function(){this.app.maxOrRestoreSize()}.bind(this)}}).inject(this.titleAction)}this.title.addEvent("dblclick",this.app.maxOrRestoreSize.bind(this.app));this.minActionNode=new Element("div",{styles:this.css.minActionNode,events:{mouseover:function(){this.setStyles(t.css.titleActionOver)},mouseout:function(){this.setStyles(t.css.titleActionOut)},mousedown:function(){this.setStyles(t.css.titleActionDown)},mouseup:function(){this.setStyles(t.css.titleActionOver)},click:function(){this.app.minSize()}.bind(this)}}).inject(this.titleAction);if(this.options.isRefresh!=false){this.titleRefresh.addEvents({mouseover:function(){this.setStyles(t.css.titleActionOver)},mouseout:function(){this.setStyles(t.css.titleActionOut)},mousedown:function(){this.setStyles(t.css.titleActionDown)},mouseup:function(){this.setStyles(t.css.titleActionOver)},click:function(t){this.app.refresh()}.bind(this),dblclick:function(t){t.stopPropagation()}.bind(this)})}},maxOrRestoreSize:function(t){if(this.isMax){this.restoreSize(t)}else{this.maxSize(t)}},restoreSize:function(t){this.restore(t)},maxSize:function(t){if(!this.morph){this.morph=new Fx.Morph(this.node,{duration:50,link:"chain"})}this.morph.setOptions({duration:50});this.getSpacer();if(!this.spacerMorph){this.spacerMorph=new Fx.Morph(this.spacer,{duration:50,link:"chain"})}this.spacerMorph.setOptions({duration:50});if(!this.contentMorph){this.contentMorph=new Fx.Morph(this.content,{duration:50,link:"chain"})}this.contentMorph.setOptions({duration:50});this.spacer.setStyle("display","block");this.node.setStyle("display","block");var s=this.getMaxSize();var i=Object.clone(this.css.spacerTo);var e=Object.clone(this.css.to);var o={};i.top=s.position.y;i.left=s.position.x;i.width=s.spacer.x;i.height=s.spacer.y;e.top=s.position.y;e.left=s.position.x;e.width=s.node.x;e.height=s.node.y;o=s.contentSize;if(this.fireEvent("queryMax")){var n=false;var h=false;var r=false;this.spacerMorph.start(i).chain(function(){if(this.app.desktop.currentApp!=this.app)this.spacer.setStyles(this.css.spacerUncurrent);h=true;c()}.bind(this));this.contentMorph.start(o).chain(function(){r=true;c()}.bind(this));this.morph.start(e).chain(function(){if(this.app.desktop.currentApp!=this.app)this.node.setStyles(this.css.uncurrent);n=true;c()}.bind(this));var c=function(){if(n&&h&&r){if(this.titleText)this.getTitle();this.isMax=true;this.isHide=false;if(this.containerDrag)this.containerDrag.detach();if(t)t();this.fireEvent("resize");this.fireEvent("postMax")}}.bind(this);if(this.maxActionNode)this.maxActionNode.setStyles(this.css.restoreActionNode)}},maxSizeIm:function(t){this.getSpacer();this.spacer.setStyle("display","block");this.node.setStyle("display","block");var s=this.getMaxSize();var i=Object.clone(this.css.spacerTo);var e=Object.clone(this.css.to);var o={};i.top=s.position.y;i.left=s.position.x;i.width=s.spacer.x;i.height=s.spacer.y;e.top=s.position.y;e.left=s.position.x;e.width=s.node.x;e.height=s.node.y;o=s.contentSize;if(this.fireEvent("queryMax")){this.node.setStyles(e);this.spacer.setStyles(i);this.content.setStyles(o);if(this.titleText)this.getTitle();this.isMax=true;this.isHide=false;if(this.containerDrag)this.containerDrag.detach();if(t)t();this.fireEvent("resize");this.fireEvent("postMax");if(this.maxActionNode)this.maxActionNode.setStyles(this.css.restoreActionNode)}},getMaxSize:function(){var t=layout.desktop.desktopNode.getSize();var s=layout.desktop.desktopNode.getPosition();var i=this.spacer.getStyle("padding-top").toFloat();var e=this.spacer.getStyle("padding-bottom").toFloat();var o=this.spacer.getStyle("padding-left").toFloat();var n=this.spacer.getStyle("padding-right").toFloat();spacerHeight=t.y-i-e;spacerWidth=t.x-o-n;i=this.node.getStyle("padding-top").toFloat();e=this.node.getStyle("padding-bottom").toFloat();o=this.node.getStyle("padding-left").toFloat();n=this.node.getStyle("padding-right").toFloat();nodeHeight=t.y-i-e;nodeWidth=t.x-o-n;var h=this.getContentSize(nodeHeight,nodeWidth);return{node:{x:nodeWidth,y:nodeHeight},spacer:{x:spacerWidth,y:spacerHeight},position:{x:s.x,y:s.y},contentSize:h}}});MWF.xDesktop.WindowTransparent=new Class({Implements:[Options,Events],options:{style:"default"},initialize:function(t){var s=layout.desktop.desktopNode.getPosition();this.app=t;this.fireEvent("queryLoad");this.isMax=false;this.isHide=false;this.css={to:{width:"0",height:"0",left:"0",top:"0"}};var i=null;if(MWF.xDesktop.zIndexPool)i=MWF.xDesktop.zIndexPool.applyZindex();this.node=new Element("div",{styles:{width:"0px",height:"0px",top:"0px",left:"0px",position:"absolute","z-index":i?i:100}}).inject($(document.body));this.content=new Element("div",{styles:{width:"100%",height:"100%"}}).inject(this.node);this.fireEvent("postLoad")},show:function(){this.fireEvent("queryShow");this.node.setStyle("display","block");this.isHide=false;this.fireEvent("postShow")},hide:function(){this.fireEvent("queryHide");this.node.setStyle("display","none");this.isHide=true;this.fireEvent("postHide")},restore:function(t){this.fireEvent("queryRestore");this.node.setStyle("display","block");this.isHide=false;this.fireEvent("postRestore");if(t)t()},restoreSize:function(t){this.restore(t)},close:function(t){this.fireEvent("queryClose");this.node.destroy();this.node=null;this.content=null;delete this;if(t)t();this.fireEvent("postClose")},maxOrRestoreSize:function(t){if(this.isMax){this.restoreSize(t)}else{this.maxSize(t)}},maxSize:function(t){this.fireEvent("queryMax");this.node.setStyle("display","block");this.isHide=false;this.fireEvent("resize");this.fireEvent("postMax");if(t)t()},restoreIm:function(){this.restore()},maxSizeIm:function(){this.maxSize()},setCurrent:function(){if(MWF.xDesktop.zIndexPool){var t=this.node.getStyle("z-index").toFloat()+1;if(t<MWF.xDesktop.zIndexPool.zIndex){var s=MWF.xDesktop.zIndexPool.applyZindex();this.node.setStyle("z-index",s)}}},_fadeOut:function(){this.node.fade("out");if(this.spacer)this.spacer.fade("out")},_fadeIn:function(){this.node.fade("in");if(this.spacer)this.spacer.fade("in")},setUncurrent:function(){},reStyle:function(){},changeStyle:function(){}});