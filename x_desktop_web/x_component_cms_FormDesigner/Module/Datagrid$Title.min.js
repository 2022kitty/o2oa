MWF.xApplication.cms.FormDesigner.Module=MWF.xApplication.cms.FormDesigner.Module||{};MWF.xDesktop.requireApp("cms.FormDesigner","Module.$Container",null,false);MWF.xApplication.cms.FormDesigner.Module.Datagrid$Title=MWF.CMSFCDatagrid$Title=new Class({Extends:MWF.CMSFC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"/x_component_cms_FormDesigner/Module/Datagrid$Title/datagrid$Title.html",actions:[{name:"insertCol",icon:"insertCol1.png",event:"click",action:"insertCol",title:MWF.xApplication.cms.FormDesigner.LP.formAction.insertCol},{name:"deleteCol",icon:"deleteCol1.png",event:"click",action:"deleteCol",title:MWF.xApplication.cms.FormDesigner.LP.formAction.deleteCol}]},initialize:function(e,t){this.setOptions(t);this.path="/x_component_cms_FormDesigner/Module/Datagrid$Title/";this.cssPath="/x_component_cms_FormDesigner/Module/Datagrid$Title/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="element";this.moduleName="datagrid$Title";this.Node=null;this.form=e},_dragIn:function(e){this.parentContainer._dragIn(e)},over:function(){if(this.form.selectedModules.indexOf(this)==-1){if(!this.form.moveModule)if(this.form.currentSelectedModule!=this)this.node.setStyles({"border-width":"1px","border-color":"#0072ff"})}},unOver:function(){if(this.form.selectedModules.indexOf(this)==-1){if(!this.form.moveModule)if(this.form.currentSelectedModule!=this)this.node.setStyles({"border-width":"1px","border-color":"#999"})}},unSelected:function(){this.node.setStyles({"border-width":"1px","border-color":"#999"});this._hideActions();this.form.currentSelectedModule=null;this.hideProperty()},load:function(e,t,i){this.json=e;this.node=t;this.node.store("module",this);this.node.setStyles(this.css.moduleNode);this.node.set("text",this.json.name||"DataTitle");if(!this.json.id){var o=this._getNewId(i.json.id);this.json.id=o}t.set({MWFType:"datagrid$Title",id:this.json.id});if(!this.form.json.moduleList[this.json.id]){this.form.json.moduleList[this.json.id]=this.json}this._initModule();this._loadTreeNode(i);this.parentContainer=this.treeNode.parentNode.module;this._setEditStyle_custom("id")},_createMoveNode:function(){return false},_setEditStyle_custom:function(e){},_dragInLikeElement:function(e){return false},insertCol:function(){var e=this;var t=this.path+"insertCol.html";MWF.require("MWF.widget.Dialog",function(){var i=$(document.body).getSize();var o=i.x/2-150;var n=i.y/2-90;var s=new MWF.DL({title:"Insert Col",style:"property",top:n,left:o-40,fromTop:i.y/2-45,fromLeft:i.x/2,width:300,height:180,url:t,buttonList:[{text:MWF.CMSFD.LP.button.ok,action:function(){e._insertCol();this.close()}},{text:MWF.CMSFD.LP.button.cancel,action:function(){this.close()}}]});s.show()}.bind(this))},_insertCol:function(){var e=$("MWFInsertColNumber").get("value");var t=document.getElementsByName("MWFInsertColPosition");var i="before";for(var o=0;o<t.length;o++){if(t[o].checked){i=t[o].value;break}}var n=this.node.getParent("tr");var s=n.getParent("table");var r=this.node.cellIndex;var l=s.rows[0];var a=s.rows[1];var d=l.cells[r];for(var c=1;c<=e;c++){var h=new Element("th").inject(d,i);this.form.getTemplateData("Datagrid$Title",function(e){var t=Object.clone(e);var i=new MWF.CMSFCDatagrid$Title(this.form);i.load(t,h,this.parentContainer);this.parentContainer.elements.push(i)}.bind(this))}var m=a.cells[r];for(var u=1;u<=e;u++){var f=new Element("td").inject(m,i);this.form.getTemplateData("Datagrid$Data",function(e){var t=Object.clone(e);var i=new MWF.CMSFCDatagrid$Data(this.form);i.load(t,f,this.parentContainer);this.parentContainer.containers.push(i)}.bind(this))}this.unSelected();this.selected()},deleteCol:function(e){var t=this;this.form.designer.confirm("warn",e,MWF.LP.cms.notice.deleteColTitle,MWF.LP.cms.notice.deleteCol,300,120,function(){t._deleteCol();this.close()},function(){this.close()},null)},_deleteCol:function(){var e=this.node.getParent("tr");var t=e.getParent("table");var i=this.node.cellIndex;var o=t.rows[0];var n=t.rows[1];if(e.cells.length<=1){this.parentContainer.destroy()}else{var s=o.cells[i];var r=n.cells[i];var l=s.retrieve("module");if(l){l.parentContainer.elements.erase(l);l.destroy()}var a=r.retrieve("module");if(a){a.parentContainer.containers.erase(a);a.destroy()}}},_setEditStyle_custom:function(e){if(e=="name"){if(!this.json.name){this.node.set("text","DataTitle")}else{this.node.set("text",this.json.name)}}}});