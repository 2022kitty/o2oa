MWF.xApplication.cms.FormDesigner.Module=MWF.xApplication.cms.FormDesigner.Module||{};MWF.xDesktop.requireApp("cms.FormDesigner","Module.$Container",null,false);MWF.xApplication.cms.FormDesigner.Module.Datagrid$Data=MWF.CMSFCDatagrid$Data=new Class({Extends:MWF.CMSFCTable$Td,Implements:[Options,Events],options:{propertyPath:"/x_component_cms_FormDesigner/Module/Datagrid$Data/datagrid$Data.html",actions:[{name:"insertCol",icon:"insertCol1.png",event:"click",action:"insertCol",title:MWF.xApplication.cms.FormDesigner.LP.formAction.insertCol},{name:"deleteCol",icon:"deleteCol1.png",event:"click",action:"deleteCol",title:MWF.xApplication.cms.FormDesigner.LP.formAction.deleteCol}],allowModules:["textfield","personfield","calendar","textarea","select","radio","checkbox","html","image","label","htmleditor","button"]},initialize:function(e,t){this.setOptions(t);this.path="/x_component_cms_FormDesigner/Module/Datagrid$Data/";this.cssPath="/x_component_cms_FormDesigner/Module/Datagrid$Data/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="container";this.moduleName="datagrid$Data";this.Node=null;this.form=e},load:function(e,t,i){this.json=e;this.node=t;this.node.store("module",this);this.node.setStyles(this.css.moduleNode);if(!this.json.id){var n=this._getNewId(i.json.id);this.json.id=n}t.set({MWFType:"datagrid$Data",id:this.json.id});if(!this.form.json.moduleList[this.json.id]){this.form.json.moduleList[this.json.id]=this.json}this._initModule();this._loadTreeNode(i);this.form.parseModules(this,this.node);this.parentContainer=this.treeNode.parentNode.module;this._setEditStyle_custom("id");this.checkSequence()},_setEditStyle_custom:function(e,t,i){if(e=="cellType")this.checkSequence(t,i)},checkSequence:function(e,t){if(this.json.cellType=="sequence"&&t!="sequence"){if(this.treeNode.firstChild){var i=this;var n=this.treeNode.firstChild.module;this.form.designer.confirm("warn",n.node,MWF.CMSFD.LP.notice.changeToSequenceTitle,MWF.CMSFD.LP.notice.changeToSequence,300,120,function(){n.destroy();this.close();if(!i.sequenceNode){i.sequenceNode=new Element("div",{styles:i.css.sequenceNode,text:"(N)",MWFType:"MWFTemp"}).inject(i.node)}},function(){i.json.cellType=="content";e.checked=false;this.close()},null)}else{if(!this.sequenceNode){this.sequenceNode=new Element("div",{styles:this.css.sequenceNode,text:"(N)",MWFType:"MWFTemp"}).inject(this.node)}}}else{if(this.sequenceNode){this.sequenceNode.destroy();this.sequenceNode=null}}},_dragIn:function(e){if(this.treeNode.firstChild||this.json.cellType=="sequence"){this.parentContainer._dragIn(e)}else{if(this.options.allowModules.indexOf(e.moduleName)!=-1){if(!this.Component)e.inContainer=this;e.parentContainer=this;e.nextModule=null;this.node.setStyles({border:"1px solid #ffa200"});var t=e._getCopyNode();t.inject(this.node)}else{this.parentContainer._dragIn(e)}}},_showActions:function(){if(this.actionArea){this._setActionAreaPosition();this.actionArea.setStyle("display","block")}},_insertCol:function(){var e=$("MWFInsertColNumber").get("value");var t=document.getElementsByName("MWFInsertColPosition");var i="before";for(var n=0;n<t.length;n++){if(t[n].checked){i=t[n].value;break}}var s=this.node.getParent("tr");var o=s.getParent("table");var a=this.node.cellIndex;var r=o.rows[0];var l=o.rows[1];var d=r.cells[a];for(var c=1;c<=e;c++){var h=new Element("th").inject(d,i);this.form.getTemplateData("Datagrid$Title",function(e){var t=Object.clone(e);var i=new MWF.CMSFCDatagrid$Title(this.form);i.load(t,h,this.parentContainer);this.parentContainer.elements.push(i)}.bind(this))}var m=l.cells[a];for(var u=1;u<=e;u++){var p=new Element("td").inject(m,i);this.form.getTemplateData("Datagrid$Data",function(e){var t=Object.clone(e);var i=new MWF.CMSFCDatagrid$Data(this.form);i.load(t,p,this.parentContainer);this.parentContainer.containers.push(i)}.bind(this))}this.unSelected();this.selected()},_deleteCol:function(){var e=this.node.getParent("tr");var t=e.getParent("table");var i=this.node.cellIndex;var n=t.rows[0];var s=t.rows[1];if(e.cells.length<=1){this.parentContainer.destroy()}else{var o=n.cells[i];var a=s.cells[i];var r=o.retrieve("module");if(r){r.parentContainer.elements.erase(r);r.destroy()}var l=a.retrieve("module");if(l){l.parentContainer.containers.erase(l);l.destroy()}}}});