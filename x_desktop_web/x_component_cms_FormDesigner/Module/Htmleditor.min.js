MWF.xApplication.cms.FormDesigner.Module=MWF.xApplication.cms.FormDesigner.Module||{};MWF.xDesktop.requireApp("cms.FormDesigner","Module.$Element",null,false);MWF.xApplication.cms.FormDesigner.Module.Htmleditor=MWF.CMSFCHtmleditor=new Class({Extends:MWF.CMSFC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"/x_component_cms_FormDesigner/Module/Htmleditor/htmleditor.html"},initialize:function(t,e){this.setOptions(e);this.path="/x_component_cms_FormDesigner/Module/Htmleditor/";this.cssPath="/x_component_cms_FormDesigner/Module/Htmleditor/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="element";this.moduleName="htmleditor";this.form=t;this.container=null;this.containerNode=null},_createMoveNode:function(){this.moveNode=new Element("div",{MWFType:"itmleditor",id:this.json.id,styles:this.css.moduleNodeMove,events:{selectstart:function(){return false}}}).inject(this.form.container)},_createNode:function(){this.node=this.moveNode.clone(true,true);this.node.setStyles(this.css.moduleNode);this.node.set("id",this.json.id);this.node.addEvent("selectstart",function(t){t.preventDefault()})},_setEditStyle_custom:function(t){if(t=="editorProperties"){if(this.editor){Object.each(this.json.editorProperties,function(t,e){if(t=="true")this.json.editorProperties[e]=true;if(t=="false")this.json.editorProperties[e]=false}.bind(this));this.distroyCkeditor();var e=Object.clone(this.json.editorProperties);if(this.json.config){if(this.json.config.code){var i=MWF.CMSMacro.exec(this.json.config.code,this);Object.each(i,function(t,i){e[i]=t})}}this.loadCkeditor(e)}}if(t=="templateCode"){if(this.editor)this.editor.setData(this.json.templateCode)}},_initModule:function(){this.node.empty();var t=Object.clone(this.json.editorProperties);if(this.json.config){if(this.json.config.code){var e=MWF.CMSMacro.exec(this.json.config.code,this);Object.each(e,function(e,i){t[i]=e})}}this.loadCkeditor(t);this._setNodeProperty();this._createIconAction();this._setNodeEvent()},loadCkeditor:function(t){COMMON.AjaxModule.load("ckeditor",function(){var e=new Element("div").inject(this.node);if(this.json.templateCode)e.set("html",this.json.templateCode);var i=this.node.getSize().y;var o=t||{};if(this.form.options.mode=="Mobile"){o.toolbar=[{name:"paragraph",items:["Bold","Italic","-","TextColor","BGColor","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","Undo","Redo"]},{name:"basicstyles",items:["Styles","FontSize"]}]}this.editor=CKEDITOR.replace(e,o);this.editor.on("dataReady",function(){this.editor.setReadOnly(true)},this)}.bind(this))},distroyCkeditor:function(){if(this.editor)this.editor.destroy();this.editor=null}});