MWF.xApplication.cms.FormDesigner.Module=MWF.xApplication.cms.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.Form",null,false);MWF.xDesktop.requireApp("cms.FormDesigner","Property",null,false);MWF.xApplication.cms.FormDesigner.Module.Form=MWF.CMSFCForm=new Class({Extends:MWF.FCForm,options:{style:"default",propertyPath:"/x_component_cms_FormDesigner/Module/Form/form.html",mode:"PC"},initialize:function(e,t,s){this.setOptions(s);this.path="/x_component_process_FormDesigner/Module/Form/";this.cssPath="/x_component_process_FormDesigner/Module/Form/"+this.options.style+"/css.wcss";this._loadCss();this.container=null;this.form=this;this.moduleType="form";this.moduleList=[];this.moduleNodeList=[];this.moduleContainerNodeList=[];this.moduleElementNodeList=[];this.moduleComponentNodeList=[];this.dataTemplate={};this.designer=e;this.container=t;this.selectedModules=[]},loadStylesList:function(e){var t="/x_component_cms_FormDesigner/Module/Form/template/"+(this.options.mode=="Mobile"?"styles":"styles")+".json";MWF.getJSON(t,{onSuccess:function(t){this.stylesList=t;if(e)e(this.stylesList)}.bind(this),onRequestFailure:function(){this.stylesList={};if(e)e(this.stylesList)}.bind(this),onError:function(){this.stylesList={};if(e)e(this.stylesList)}.bind(this)})},loadModule:function(e,t,s){var i="CMSFC";var o=new MWF[i+e.type](this);o.load(e,t,s);return o},createModule:function(e,t){var s="CMSFC";this.getTemplateData(e,function(i){var o=Object.clone(i);var n=new MWF[s+e](this);n.create(o,t)}.bind(this))},getTemplateData:function(e,t){if(this.dataTemplate[e]){if(t)t(this.dataTemplate[e])}else{var s=MWF.CMSFD.ResetTemplateModules.indexOf(e.toLowerCase())!=-1?"x_component_cms_FormDesigner":"x_component_process_FormDesigner";var i="/"+s+"/Module/"+e+"/template.json";MWF.getJSON(i,function(s,i){this.dataTemplate[e]=s;if(t)t(s)}.bind(this))}},showProperty:function(){if(!this.property){this.property=new MWF.xApplication.cms.FormDesigner.Property(this,this.designer.propertyContentArea,this.designer,{path:this.options.propertyPath,onPostLoad:function(){this.property.show()}.bind(this)});this.property.load()}else{this.property.show()}},save:function(e){this.designer.saveForm()},preview:function(){MWF.xDesktop.requireApp("cms.FormDesigner","Preview",function(){if(this.options.mode=="Mobile"){this.previewBox=new MWF.xApplication.cms.FormDesigner.Preview(this,{size:{x:"340",y:580}})}else{this.previewBox=new MWF.xApplication.cms.FormDesigner.Preview(this)}this.previewBox.load()}.bind(this))}});