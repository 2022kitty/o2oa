MWF.xApplication.Forum=MWF.xApplication.Forum||{};MWF.xApplication.ForumSection=MWF.xApplication.ForumSection||{};MWF.require("MWF.widget.Identity",null,false);MWF.xDesktop.requireApp("Forum","Actions.RestActions",null,false);MWF.xDesktop.requireApp("Forum","lp."+MWF.language,null,false);MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xDesktop.requireApp("Forum","Access",null,false);MWF.xApplication.ForumSection.options={multitask:true,executable:true};MWF.xApplication.ForumSection.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"ForumSection",icon:"icon.png",width:"1210",height:"700",isResize:false,isMax:true,title:MWF.xApplication.ForumSection.LP.title,sectionId:""},onQueryLoad:function(){this.lp=MWF.xApplication.Forum.LP},onQueryClose:function(){this.clearContent()},loadApplication:function(t){this.userName=layout.desktop.session.user.name;this.restActions=new MWF.xApplication.Forum.Actions.RestActions;this.path="/x_component_ForumSection/$Main/"+this.options.style+"/";this.createNode();this.loadApplicationContent()},loadController:function(t){this.access=new MWF.xApplication.Forum.Access(this.restActions,this.lp);if(t)t()},createNode:function(){this.content.setStyle("overflow","hidden");this.node=new Element("div",{styles:this.css.node}).inject(this.content)},loadApplicationContent:function(){if(!this.options.sectionId&&this.status&&this.status.sectionId){this.options.sectionId=this.status.sectionId}this.loadController(function(){this.access.login(function(){this.loadApplicationLayout()}.bind(this))}.bind(this))},reloadAllParents:function(){var t="Forum";if(this.desktop.apps[t]){this.desktop.apps[t].reload()}t="ForumCategory"+this.sectionData.forumId;if(this.desktop.apps[t]){this.desktop.apps[t].reload()}},reload:function(){this.status={sectionId:this.options.sectionId,viewPageNum:this.explorer.view.getCurrentPageNum(),noteHidden:this.noteNodeHidden};this.clearContent();this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.node);this.createTopNode();this.createMiddleNode()},loadApplicationLayout:function(){this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.node);if(this.options.sectionId){this.restActions.listSectionPermission(this.options.sectionId,function(t){this.sectionPermission=t.data;this.isAdmin=this.sectionPermission.subjectManageAble;this.restActions.getSection(this.options.sectionId,function(t){this.sectionData=t.data;this.setTitle(this.sectionData.sectionName);this.createTopNode();this.createMiddleNode()}.bind(this))}.bind(this))}else{this.close()}},createTopNode:function(){var t=MWF.xApplication.Forum.ForumSetting[this.sectionData.forumId].forumColor;var e=this.topNode=new Element("div.topNode",{styles:this.css.topNode}).inject(this.contentContainerNode);e.setStyle("border-bottom","1px solid "+t);var i=new Element("div.topTitleLeftNode",{styles:this.css.topTitleLeftNode}).inject(e);i.setStyle("background-color",t);var s=new Element("div.topTitleMiddleNode",{styles:this.css.topTitleMiddleNode}).inject(e);s.setStyle("background-color",t);var n=new Element("div.topTitleRightNode",{styles:this.css.topTitleRightNode}).inject(e);n.setStyle("background-color",t);var o=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.lp.title}).inject(s);o.addEvent("click",function(){var t="Forum";if(this.desktop.apps[t]){this.desktop.apps[t].setCurrent()}else{this.desktop.openApplication(null,"Forum",{appId:t})}this.close()}.bind(this));var a=new Element("div.topItemSepNode",{styles:this.css.topItemSepNode}).inject(s);var o=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.sectionData.forumName}).inject(s);o.addEvent("click",function(){var t="ForumCategory"+this.forumId;if(this.obj.desktop.apps[t]){this.obj.desktop.apps[t].setCurrent()}else{this.obj.desktop.openApplication(null,"ForumCategory",{categoryId:this.forumId,appId:t})}if(!this.obj.inBrowser){this.obj.close()}}.bind({obj:this,forumId:this.sectionData.forumId}));var a=new Element("div.topItemSepNode",{styles:this.css.topItemSepNode}).inject(s);var o=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.sectionData.sectionName}).inject(s);if(this.sectionData.sectionNotice){var r=new Element("div",{styles:this.css.topRightNode}).inject(e);r.addEvents({click:function(){if(!this.noteNodeHidden){this.noteNode.setStyle("display","none");this.topRightIconNode.setStyles(this.css.topRightIconDownNode);this.noteNodeHidden=true}else{this.noteNode.setStyle("display","");this.topRightIconNode.setStyles(this.css.topRightIconNode);this.noteNodeHidden=false}}.bind(this)});var c=this.topRightIconNode=new Element("div",{styles:this.css.topRightIconNode}).inject(r);if(this.status&&this.status.noteHidden){this.topRightIconNode.setStyles(this.css.topRightIconDownNode);this.noteNodeHidden=true}}this.searchDiv=new Element("div.searchDiv",{styles:this.css.searchDiv}).inject(this.topNode);this.searchInput=new Element("input.searchInput",{styles:this.css.searchInput,value:this.lp.searchKey,title:this.lp.searchTitle}).inject(this.searchDiv);this.searchInput.setStyles({"border-left":"1px solid "+t,"border-top":"1px solid "+t,"border-bottom":"1px solid "+t,"border-right":"0px"});var p=this;this.searchInput.addEvents({focus:function(){if(this.value==p.lp.searchKey)this.set("value","")},blur:function(){if(!this.value)this.set("value",p.lp.searchKey)},keydown:function(t){if(t.code==13){this.search();t.preventDefault()}}.bind(this)});this.searchAction=new Element("div.searchAction",{styles:this.css.searchAction}).inject(this.searchDiv);this.searchAction.setStyles({"border-right":"1px solid "+t,"border-top":"1px solid "+t,"border-bottom":"1px solid  "+t,"border-left":"0px"});this.searchAction.addEvents({click:function(){this.search()}.bind(this),mouseover:function(t){this.searchAction.setStyles(this.css.searchAction_over2);t.stopPropagation()}.bind(this),mouseout:function(){this.searchAction.setStyles(this.css.searchAction)}.bind(this)});this.searchDiv.addEvents({mouseover:function(){this.searchInput.setStyles(this.css.searchInput_over);this.searchAction.setStyles(this.css.searchAction_over)}.bind(this),mouseout:function(){this.searchInput.setStyles(this.css.searchInput);this.searchAction.setStyles(this.css.searchAction)}.bind(this)})},search:function(){var t=this.searchInput.get("value");if(t==""||t==this.lp.searchKey){this.notice(this.lp.noSearchContentNotice,"error");return}var e="ForumSearch";if(this.desktop.apps[e]){this.desktop.apps[e].close()}this.desktop.openApplication(null,"ForumSearch",{appId:e,searchContent:t})},createMiddleNode:function(){this.middleNode=new Element("div.middleNode",{styles:this.css.middleNode}).inject(this.contentContainerNode);this.createSectionNode();this.createNoteNode();this._createMiddleNode();this.addEvent("resize",function(){this.setContentSize()}.bind(this));this.setContentSize()},createSectionNode:function(){var t=new Element("div.sectionNode",{styles:this.css.sectionNode}).inject(this.middleNode);var e=new Element("div.sectionLeftNode",{styles:this.css.sectionLeftNode}).inject(t);var i=new Element("div.sectionLeftIconNode",{styles:this.css.sectionLeftIconNode}).inject(e);var s=new Element("img",{styles:this.css.sectionLeftIcon,src:this.sectionData.icon?"data:image/png;base64,"+this.sectionData.icon:"/x_component_Forum/$Setting/default/sectionIcon/forum_icon.png"}).inject(i);var n=new Element("div.sectionLeftContent",{styles:this.css.sectionLeftContent}).inject(e);var o=new Element("div.sectionTopDiv",{styles:this.css.sectionTopDiv}).inject(n);var a=new Element("div.sectionTopInfor",{styles:this.css.sectionTopInfor,text:this.lp.subject+"："+this.sectionData.subjectTotal+"，"+this.lp.replyCount+"："+this.sectionData.replyTotal}).inject(o);var r=new Element("div.sectionLeftDiv",{styles:this.css.sectionLeftDiv}).inject(n);var c=new Element("div.sectionLeftMemo",{styles:this.css.sectionLeftMemo,text:this.sectionData.sectionDescription}).inject(r);var o=new Element("div.sectionTopDiv",{styles:this.css.sectionTopDiv}).inject(n);var a=new Element("div.sectionTopInfor",{styles:this.css.sectionTopInfor,text:this.lp.moderatorNames+"："}).inject(o);var a=new Element("div.sectionTopInfor",{styles:this.css.sectionTopInfor}).inject(o);this.createPersonNode(a,this.sectionData.moderatorNames)},createNoteNode:function(){if(!this.sectionData.sectionNotice||this.sectionData.sectionNotice.trim()==""){return}var t=this.noteNode=new Element("div.noteNode",{styles:this.css.noteNode}).inject(this.middleNode);var e=new Element("div.noteTopNode",{styles:this.css.noteTopNode}).inject(t);var i=new Element("div.noteTopContent",{styles:this.css.noteTopContent}).inject(e);var s=new Element("div.noteIcon",{styles:this.css.noteIcon}).inject(i);var n=new Element("div.noteTopText",{styles:this.css.noteTopText,text:this.lp.sectionNotice}).inject(i);var o=new Element("div.noteContent",{styles:this.css.noteContent,html:this.sectionData.sectionNotice}).inject(t);if(this.status&&this.status.noteHidden){t.setStyle("display","none")}},_createMiddleNode:function(){this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.middleNode);if(this.contentDiv)this.contentDiv.empty();if(this.explorer){this.explorer.destroy();delete this.explorer}this.explorer=new MWF.xApplication.ForumSection.Explorer(this.contentDiv,this,this,{style:this.options.style,viewPageNum:this.status&&this.status.viewPageNum?this.status.viewPageNum:1});this.explorer.load()},setContentSize:function(){var t={x:0,y:0};var e=this.node.getSize();var i=this.contentContainerNode.getStyle("padding-top").toFloat();var s=this.contentContainerNode.getStyle("padding-bottom").toFloat();var n=e.y-t.y-i-s;this.contentContainerNode.setStyle("height",""+n+"px")},openLoginForm:function(){MWF.require("MWF.xDesktop.Authentication",null,false);var t=new MWF.xDesktop.Authentication({style:"application",onPostOk:function(){window.location.reload()}},this);t.openLoginForm()},openSignUpForm:function(){MWF.require("MWF.xDesktop.Authentication",null,false);var t=new MWF.xDesktop.Authentication({style:"application",onPostOk:function(){}},this);t.openSignUpForm()},recordStatus:function(){return{sectionId:this.options.sectionId,viewPageNum:this.explorer.view.getCurrentPageNum(),noteHidden:this.noteNodeHidden}},getDateDiff:function(t){var e=Date.parse(t.replace(/-/gi,"/"));var i=1e3*60;var s=i*60;var n=s*24;var o=n*15;var a=n*30;var r=a*12;var c=(new Date).getTime();var p=c-e;if(p<0){}var l=(new Date).decrement("day",1);var d=(new Date).decrement("day",2);var h=p/r;var u=p/a;var m=p/(7*n);var f=p/n;var v=p/s;var w=p/i;if(l.getFullYear()==e.getFullYear()&&l.getMonth()==e.getMonth()&&l.getDate()==e.getDate()){result="昨天 "+e.getHours()+":"+e.getMinutes()}else if(d.getFullYear()==e.getFullYear()&&d.getMonth()==e.getMonth()&&d.getDate()==e.getDate()){result="前天 "+e.getHours()+":"+e.getMinutes()}else if(h>1){result=e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日"}else if(u>=1){result=e.getMonth()+1+"月"+e.getDate()+"日"}else if(m>=1){result=parseInt(m)+"周前"}else if(f>=1){result=parseInt(f)+"天前"}else if(v>=1){result=parseInt(v)+"小时前"}else if(w>=1){result=parseInt(w)+"分钟前"}else result="刚刚发表";return result},openPerson:function(t){if(!t||t==""){}else{var e="ForumPerson"+t;if(this.desktop.apps[t]){this.desktop.apps[t].setCurrent()}else{this.desktop.openApplication(null,"ForumPerson",{personName:t,appId:e})}}},createPersonNode:function(t,e){var i=e.split(",");i.each(function(e,s){var n=new Element("span",{text:e,styles:this.css.person}).inject(t);n.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.person_over)}.bind({node:n,obj:this}),mouseout:function(){this.node.setStyles(this.obj.css.person)}.bind({node:n,obj:this}),click:function(){this.obj.openPerson(this.userName)}.bind({userName:e,obj:this})});if(s!=i.length-1){new Element("span",{text:","}).inject(t)}}.bind(this))},clearContent:function(){if(this.explorer)this.explorer.destroy();if(this.setContentSizeFun)this.removeEvent("resize",this.setContentSizeFun);if(this.scrollBar&&this.scrollBar.scrollVAreaNode)this.scrollBar.scrollVAreaNode.destroy();if(this.scrollBar)delete this.scrollBar;if(this.contentContainerNode){this.contentContainerNode.destroy()}}});MWF.xApplication.ForumSection.Explorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",viewPageNum:1},initialize:function(t,e,i,s){this.setOptions(s);this.container=t;this.parent=i;this.app=e;this.css=this.parent.css;this.lp=this.app.lp},load:function(){this.container.empty();this.loadToolbar();this.viewContainerTop=Element("div",{styles:this.css.viewContainerTop}).inject(this.container);this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.container);this.viewContainerPrime=Element("div",{styles:this.css.viewContainer}).inject(this.container);this.loadToolbar();this.loadView()},destroy:function(){if(this.resizeWindowFun)this.app.removeEvent("resize",this.resizeWindowFun);this.view.destroy();if(this.view.refreshInterval){clearInterval(this.view.refreshInterval)}},loadToolbar:function(){var t=new Element("div",{styles:this.css.toolbar}).inject(this.container);if(this.toolbarTop){this.toolbarBottom=t}else{this.toolbarTop=t}if(this.app.sectionPermission.subjectPublishAble){var e=new Element("div",{styles:this.css.toolbarActionNode,text:this.lp.createSubject}).inject(t);e.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.toolbarActionNode_over)}.bind({obj:this,node:e}),mouseout:function(){this.node.setStyles(this.obj.css.toolbarActionNode)}.bind({obj:this,node:e}),click:function(){if(this.app.access.isAnonymousDynamic()){this.app.openLoginForm(function(){this.createSubject()}.bind(this))}else{this.createSubject()}}.bind(this)})}var i=new Element("div",{styles:this.css.fileterNode}).inject(t);var s=new Element("div",{styles:this.css.fileterNode}).inject(t);if(this.pagingBarTop){this.pagingBarBottom=s}else{this.pagingBarTop=s}},loadTopView:function(){this.viewTop=new MWF.xApplication.ForumSection.TopView(this.viewContainerTop,this.app,this,{templateUrl:this.parent.path+"listItemTop.json"});this.viewTop.load()},loadView:function(){this.view=new MWF.xApplication.ForumSection.View(this.viewContainer,this.app,this,{templateUrl:this.parent.path+"listItem.json",pagingEnable:true,pagingPar:{currentPage:this.options.viewPageNum,countPerPage:30,onPostLoad:function(t){if(t.nextPageNode){t.nextPageNode.inject(this.toolbarBottom,"before")}}.bind(this),onPageReturn:function(t){var e="Forum";if(this.app.desktop.apps[e]){this.app.desktop.apps[e].setCurrent()}else{this.app.desktop.openApplication(null,"Forum",{appId:e})}this.app.close()}.bind(this)}});this.view.filterData={sectionId:this.app.sectionData.id,withTopSubject:true};this.view.pagingContainerTop=this.pagingBarTop;this.view.pagingContainerBottom=this.pagingBarBottom;this.view.load()},reloadView:function(){if(this.viewPrime)this.viewPrime.destroy();this.viewContainer.setStyle("display","");this.viewContainerTop.setStyle("display","");this.viewContainerPrime.setStyle("display","none");this.loadTopView();this.loadView()},loadPrimeView:function(){if(this.view)this.view.destroy();if(this.viewTop)this.viewTop.destroy();this.viewContainer.setStyle("display","none");this.viewContainerTop.setStyle("display","none");this.viewContainerPrime.setStyle("display","");this.viewPrime=new MWF.xApplication.ForumSection.PrimeView(this.viewContainerPrime,this.app,this,{templateUrl:this.parent.path+"listItemPrime.json",pagingEnable:true,pagingPar:{currentPage:1,countPerPage:30,onPostLoad:function(t){if(t.nextPageNode){t.nextPageNode.inject(this.toolbarBottom,"before")}}.bind(this),onPageReturn:function(t){var e="Forum";if(this.app.desktop.apps[e]){this.app.desktop.apps[e].setCurrent()}else{this.app.desktop.openApplication(null,"Forum",{appId:e})}this.app.close()}.bind(this)}});this.viewPrime.filterData={sectionId:this.app.sectionData.id};this.viewPrime.pagingContainerTop=this.pagingBarTop;this.viewPrime.pagingContainerBottom=this.pagingBarBottom;this.viewPrime.load()},resizeWindow:function(){var t=this.app.content.getSize();this.viewContainer.setStyles({height:t.y-121+"px"})},createSubject:function(){var t=this;var e="ForumDocument";if(t.app.desktop.apps[e]){t.app.desktop.apps[e].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.app.sectionData.id,appId:e,onPostPublish:function(){}.bind(this)})}}});MWF.xApplication.ForumSection.TopView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){return new MWF.xApplication.ForumSection.TopDocument(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e){if(!e)e=30;var i=this.filterData||{};if(!this.page){this.page=1}else{this.page++}this.actions.listTopSubject(this.app.sectionData.id,function(e){if(!e.data)e.data=[];if(t)t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteSubject(t.id,function(t){this.reload();this.app.reloadAllParents();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t,e){var i="ForumDocument"+t.id;if(this.app.desktop.apps[i]){this.app.desktop.apps[i].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{sectionId:t.sectionId,id:t.id,appId:i,isEdited:false,isNew:false,index:e})}},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){var e=t.getElements("[lable='prime']")[0];e.addEvent("click",function(){this.explorer.loadPrimeView()}.bind(this))}});MWF.xApplication.ForumSection.TopDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){},open:function(t){this.view._openDocument(this.data,this.index)},edit:function(){var t="ForumDocument"+this.data.id;if(this.app.desktop.apps[t]){this.app.desktop.apps[t].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.data.sectionId,id:this.data.id,appId:t,isEdited:true,isNew:false,index:this.index})}}});MWF.xApplication.ForumSection.View=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,refreshNewSubject:function(){if(this.refreshTr)this.refreshTr.destroy();if(this.refreshInterval){clearInterval(this.refreshInterval)}this.refreshInterval=setInterval(function(){this.actions.listSubjectFilterPage(1,1,this.filterData||{},function(t){if(!t.count)t.count=0;var e=this.laterRefreshCount||this.dataCount;if(t.count>e){this.laterRefreshCount=t.count;this.createRefreshTr(t.count)}}.bind(this))}.bind(this),10*60*1e3)},createRefreshTr:function(t){if(this.refreshTr)this.refreshTr.destroy();var e=this.refreshTr=new Element("tr.refreshTrNode",{styles:this.css.refreshTrNode}).inject(this.headNode,"after");var i=this.refreshTd=new Element("td.refreshTdNode",{width:"60%",styles:this.css.refreshTdNode}).inject(e);var s=new Element("div",{styles:this.css.refreshNode,text:this.lp.newSubjectPublishedText.replace("{count}",t-this.dataCount)}).inject(i);s.addEvent("click",function(){this.gotoPage(1)}.bind(this));var i=new Element("td.refreshTdNode",{styles:this.css.refreshTdNode,width:"12%"}).inject(e);var i=new Element("td.refreshTdNode",{styles:this.css.refreshTdNode,width:"7%"}).inject(e);var i=new Element("td.refreshTdNode",{styles:this.css.refreshTdNode,width:"7%"}).inject(e);var i=new Element("td.refreshTdNode",{styles:this.css.refreshTdNode,width:"14%"}).inject(e)},_createDocument:function(t,e){return new MWF.xApplication.ForumSection.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e,i){this.clearBody();if(!e)e=30;if(!i)i=1;if(this.topSepTr)this.topSepTr.destroy();var s=this.filterData||{};this.actions.listSubjectFilterPage(i,e,s,function(e){if(!e.data)e.data=[];if(!e.count)e.count=0;this.refreshNewSubject();if(t)t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteSubject(t.id,function(t){this.reload();this.app.reloadAllParents();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t,e){var i="ForumDocument"+t.id;if(this.app.desktop.apps[i]){this.app.desktop.apps[i].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{sectionId:t.sectionId,id:t.id,appId:i,isEdited:false,isNew:false,index:e})}},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){var e=t.getElements("[lable='prime']")[0];e.addEvent("click",function(){this.explorer.loadPrimeView()}.bind(this))}});MWF.xApplication.ForumSection.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){if(this.index!=1&&!e.isTopSubject){var i=this.view.items[this.index-1];if(i&&i.data.isTopSubject){var s=this.view.topSepTr=new Element("tr").inject(t,"before");new Element("td",{colspan:5}).inject(s)}}},open:function(t){this.view._openDocument(this.data,this.index)},edit:function(){var t="ForumDocument"+this.data.id;if(this.app.desktop.apps[t]){this.app.desktop.apps[t].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.data.sectionId,id:this.data.id,appId:t,isEdited:true,isNew:false,index:this.index})}}});MWF.xApplication.ForumSection.PrimeView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){return new MWF.xApplication.ForumSection.PrimeDocument(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e,i){this.clearBody();if(!e)e=30;if(!i)i=1;var s=this.filterData||{};this.actions.listCreamSubjectFilterPage(i,e,s,function(e){if(!e.data)e.data=[];if(!e.count)e.count=0;if(t)t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteSubject(t.id,function(t){this.reload();this.app.reloadAllParents();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t,e){var i="ForumDocument"+t.id;if(this.app.desktop.apps[i]){this.app.desktop.apps[i].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{sectionId:t.sectionId,id:t.id,appId:i,isEdited:false,isNew:false,index:e})}},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){var e=t.getElements("[lable='allSubject']")[0];e.addEvent("click",function(){this.explorer.reloadView()}.bind(this))}});MWF.xApplication.ForumSection.PrimeDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){},open:function(t){this.view._openDocument(this.data,this.index)},edit:function(){var t="ForumDocument"+this.data.id;if(this.app.desktop.apps[t]){this.app.desktop.apps[t].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.data.sectionId,id:this.data.id,appId:t,isEdited:true,isNew:false,index:this.index})}}});