MWF.xApplication.Forum=MWF.xApplication.Forum||{};MWF.xApplication.ForumDocument=MWF.xApplication.ForumDocument||{};MWF.require("MWF.widget.Identity",null,false);MWF.xDesktop.requireApp("Forum","Actions.RestActions",null,false);MWF.xDesktop.requireApp("Forum","Attachment",null,false);MWF.xDesktop.requireApp("Forum","lp."+MWF.language,null,false);MWF.xDesktop.requireApp("Forum","Access",null,false);MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.require("MWF.widget.ImageClipper",null,false);MWF.xApplication.ForumDocument.options={multitask:true,executable:true};MWF.xApplication.ForumDocument.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"ForumDocument",icon:"icon.png",width:"1210",height:"700",isResize:false,isMax:true,isNew:true,isEdited:true,index:1,replyIndex:null,viewPageNum:1,title:MWF.xApplication.ForumDocument.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Forum.LP},onQueryClose:function(){if(this.clipper){this.clipper.close()}},loadApplication:function(t){this.userData=layout.desktop.session.user;this.userName=this.userData.name;this.restActions=this.actions=new MWF.xApplication.Forum.Actions.RestActions;this.path="/x_component_ForumDocument/$Main/"+this.options.style+"/";this.createNode();this.loadApplicationContent()},loadController:function(t){this.access=new MWF.xApplication.Forum.Access(this.restActions,this.lp);if(t)t()},createNode:function(){this.content.setStyle("overflow","hidden");this.node=new Element("div",{styles:this.css.node}).inject(this.content)},loadApplicationContent:function(){if(this.status){this.setOptions(this.status)}this.loadController(function(){this.access.login(function(){this.loadApplicationLayout()}.bind(this))}.bind(this))},reload:function(t,e){this.node.empty();this.pagingBarTop=null;this.pagingContainerTop=null;delete this.pagingBarTop;delete this.pagingContainerTop;this.loadApplicationLayout();if(t&&e&&t!=e){delete this.desktop.apps[t];this.appId=e;this.desktop.apps[e]=this}},loadApplicationLayout:function(){this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.node);if(this.options.id){this.restActions.listSubjectPermission(this.options.id,function(t){this.permission=t.data;if(this.options.isEdited){this.restActions.getSubject(this.options.id,function(t){this.data=t.data;this._loadApplicationLayout(this.data.sectionId,this.data.title)}.bind(this))}else{this.restActions.getSubjectView(this.options.id,function(t){this.data=t.data.currentSubject;this.nextSubject=t.data.nextSubject;this.lastSubject=t.data.lastSubject;this._loadApplicationLayout(this.data.sectionId,this.data.title)}.bind(this))}}.bind(this))}else{this._loadApplicationLayout(this.options.sectionId,this.lp.createSubject)}},_loadApplicationLayout:function(t,e){this.options.sectionId=t;this.restActions.listSectionPermission(t,function(i){this.sectionPermission=i.data;this.restActions.getSection(t,function(t){this.sectionData=t.data;this.restActions.getCategory(this.sectionData.forumId,function(t){this.formData=t.data;this.setTitle(e);this.createTopNode();this.createMiddleNode()}.bind(this))}.bind(this))}.bind(this))},createTopNode:function(){var t=MWF.xApplication.Forum.ForumSetting[this.sectionData.forumId].forumColor;var e=this.topNode=new Element("div.topNode",{styles:this.css.topNode}).inject(this.contentContainerNode);e.setStyle("border-bottom","1px solid "+t);var i=new Element("div.topTitleLeftNode",{styles:this.css.topTitleLeftNode}).inject(e);i.setStyle("background-color",t);var s=new Element("div.topTitleMiddleNode",{styles:this.css.topTitleMiddleNode}).inject(e);s.setStyle("background-color",t);var o=new Element("div.topTitleRightNode",{styles:this.css.topTitleRightNode}).inject(e);o.setStyle("background-color",t);var n=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.lp.title}).inject(s);n.addEvent("click",function(){var t="Forum";if(this.desktop.apps[t]){this.desktop.apps[t].setCurrent()}else{this.desktop.openApplication(null,"Forum",{appId:t})}if(!this.inBrowser){this.close()}}.bind(this));var a=new Element("div.topItemSepNode",{styles:this.css.topItemSepNode}).inject(s);var n=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.sectionData.forumName}).inject(s);n.addEvent("click",function(){var t="ForumCategory"+this.forumId;if(this.obj.desktop.apps[t]){this.obj.desktop.apps[t].setCurrent()}else{this.obj.desktop.openApplication(null,"ForumCategory",{categoryId:this.forumId,appId:t})}if(!this.obj.inBrowser){this.obj.close()}}.bind({obj:this,forumId:this.sectionData.forumId}));var a=new Element("div.topItemSepNode",{styles:this.css.topItemSepNode}).inject(s);var n=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.sectionData.sectionName}).inject(s);n.addEvent("click",function(){var t="ForumSection"+this.sectionData.id;if(this.desktop.apps[t]){this.desktop.apps[t].setCurrent()}else{this.desktop.openApplication(null,"ForumSection",{sectionId:this.sectionData.id,appId:t})}if(!this.inBrowser){this.close()}}.bind(this));var a=new Element("div.topItemSepNode",{styles:this.css.topItemSepNode}).inject(s);var n=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.options.isNew?this.lp.createSubject:"["+this.data.type+"]"+this.data.title}).inject(s)},createMiddleNode:function(){this.middleNode=new Element("div.middleNode",{styles:this.css.middleNode}).inject(this.contentContainerNode);this.addEvent("resize",function(){this.setContentSize()}.bind(this));this.setContentSize();this.middleNode.addEvent("selectstart",function(t){t.stopPropagation()});if(this.options.isNew||this.options.isEdited){this._createMiddleNode_eidt()}else{this._createMiddleNode_read()}},_createMiddleNode_eidt:function(){this.data=this.data||{};var t=this;this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.middleNode);var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr>"+"   <td styles='formTableTitle' lable='title' width='10%'></td>"+"   <td styles='formTableValue' item='type'width='10%'></td>"+"   <td styles='formTableValue' item='title'width='80%'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='summary'></td>"+"   <td styles='formTableValue' item='summary' colspan='2'></td>"+"</tr><tr item='portalImageTr' style='display:none'>"+"   <td styles='formTableTitle' lable='portalImage'></td>"+"   <td styles='formTableValue' colspan='2'><div item='portalImageAre' styles='portalImageAre' ></div></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='content'></td>"+"   <td styles='formTableValue' item='content' colspan='2'></td>"+"</tr><tr>"+"   <td styles='formTableTitle'>"+this.lp.attachment+"</td>"+"   <td item='attachment' colspan='2'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable=''></td>"+"   <td item='action' colspan='2'></td>"+"</tr>";"</table>";this.contentDiv.set("html",e);if(this.formData.indexListStyle==this.lp.indexListStyleImage){this.contentDiv.getElements("[item='portalImageTr']")[0].setStyle("display","")}var i;if(this.sectionData.subjectType){i=this.sectionData.subjectType.split("|")}else if(this.formData.subjectType){i=this.formData.subjectType.split("|")}else{i=this.lp.subjectTypeDefaultValue.split("|")}MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.contentDiv,this.data,{style:"forum",isEdited:true||this.isEdited||this.isNew,itemTemplate:{title:{text:this.lp.subject,notEmpty:true},type:{text:this.lp.type,type:"select",selectValue:i,notEmpty:true},summary:{text:this.lp.summary,type:"text",event:{keyup:function(t,e){if(t.getValue().length>70){t.setValue(t.getValue().substr(0,70))}}}},portalImage:{text:this.lp.portalImage},content:{text:this.lp.content,type:"rtf",notEmpty:true,RTFConfig:{isSetImageMaxWidth:true,skin:"bootstrapck"}}}},this,this.css);this.form.load()}.bind(this),true);this.createIconNode();var s=this.contentDiv.getElements("[item='action']")[0];this.saveAction=new Element("div",{styles:this.css.actionNode,text:this.lp.saveSubject}).inject(s);this.saveAction.addEvent("click",function(){this.saveSubject()}.bind(this));var o=this.contentDiv.getElements("[item='attachment']")[0];this.loadAttachment(o)},selectCloudImage:function(t,e){var i=this;MWF.xDesktop.requireApp("File","FileSelector",function(){i.selector_cloud=new MWF.xApplication.File.FileSelector(document.body,{style:"default",title:"选择云文件图片",listStyle:"preview",toBase64:true,base64Width:e||800,selectType:"images",onPostSelectAttachment:function(e,i){if(t)t(e,i)}});i.selector_cloud.load()},true)},createIconNode:function(){var t=this.contentDiv.getElements("[item='portalImageAre']")[0];var e=this.data&&this.data.pictureBase64?this.data.pictureBase64:null;this.clipper=new MWF.xApplication.ForumDocument.ImageClipper(t,{aspectRatio:1,editorSize:300,previewerSize:230,resultMaxSize:500,resetEnable:true},this,this.data?this.data.id:"");this.clipper.load(e)},reloadAllParents:function(){var t="Forum";if(this.desktop.apps[t]){this.desktop.apps[t].reload()}t="ForumCategory"+this.sectionData.forumId;if(this.desktop.apps[t]){this.desktop.apps[t].reload()}t="ForumSection"+this.sectionData.id;if(this.desktop.apps[t]){this.desktop.apps[t].reload()}},saveSubject:function(){var t=this.form.getResult(true,",",true,false,true);t.attachmentList=this.attachment.getAttachmentIds();if(t){t.sectionId=this.sectionData.id;t.pictureBase64=this.clipper.getBase64Image()||"";this.restActions.saveSubject(t,function(t){this.notice(this.options.isNew?this.lp.createSuccess:this.lp.updateSuccess,"success");this.fireEvent("postPublish");this.reloadAllParents();var e="ForumDocument"+(this.options.isNew?"":this.data.id);var i="ForumDocument"+t.data.id;this.setOptions({id:t.data.id,appId:i,isEdited:false,isNew:false});this.reload(e,i)}.bind(this))}},_createMiddleNode_read:function(){this.isReplyPublisher=this.permission.replyPublishAble;this.createPagingBar();this.createToolbar_read();this.subjectConainer=new Element("div.subjectConainer",{styles:this.css.subjectConainer}).inject(this.middleNode);this.replyViewConainer=new Element("div.replyViewConainer",{styles:this.css.replyViewConainer}).inject(this.middleNode);this.createPagingBar();this.createSubject();this.createReplyView();if(!this.data.stopReply&&this.isReplyPublisher){if(this.access.isAnonymous()){this.createReplyEditor_Anonymous()}else{this.createReplyEditor()}}this.createTurnSubjectNode()},createPagingBar:function(){var t=new Element("div",{styles:this.css.pagingArea}).inject(this.middleNode);if(this.pagingBarTop){this.pagingBarBottom=t}else{this.pagingBarTop=t}if(this.sectionPermission.subjectPublishAble){var e=new Element("div",{styles:this.css.pagingActionNode,text:this.lp.createSubject}).inject(t);e.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.pagingActionNode_over)}.bind({obj:this,node:e}),mouseout:function(){this.node.setStyles(this.obj.css.pagingActionNode)}.bind({obj:this,node:e}),click:function(){if(this.access.isAnonymousDynamic()){this.openLoginForm(function(){this.createNewDocument()}.bind(this))}else{this.createNewDocument()}}.bind(this)})}var i=new Element("div").inject(t);if(this.pagingContainerTop){this.pagingContainerBottom=i}else{this.pagingContainerTop=i}},setContentSize:function(){var t={x:0,y:0};var e=this.node.getSize();var i=this.contentContainerNode.getStyle("padding-top").toFloat();var s=this.contentContainerNode.getStyle("padding-bottom").toFloat();var o=e.y-t.y-i-s;this.contentContainerNode.setStyle("height",""+o+"px")},recordStatus:function(){return{sectionId:this.options.sectionId,id:this.data.id,appId:this.data.id?"ForumDocument"+this.data.id:undefined,isEdited:this.options.isEdited,isNew:this.options.isEdited,viewPageNum:this.replyView?this.replyView.getCurrentPageNum():1}},loadAttachment:function(t){this.attachment=new MWF.xApplication.Forum.Attachment(t,this,this.restActions,this.lp,{documentId:this.data?this.data.id:"",isNew:this.options.isNew,isEdited:this.options.isEdited,size:"min",onQueryUploadAttachment:function(){this.attachment.isQueryUploadSuccess=true}.bind(this),onDelete:function(t){}.bind(this)});this.attachment.load()},createToolbar_read:function(){this.toolBarRead=new Element("div.toolBarRead",{styles:this.css.toolBarRead}).inject(this.middleNode);this.toolbarLeft=new Element("div.toolbarLeft",{styles:this.css.toolbarLeft}).inject(this.toolBarRead);new Element("div.toolbarLeftItem",{styles:this.css.toolbarLeftItem,text:this.data.viewTotal+this.lp.readed}).inject(this.toolbarLeft);this.replyTotal=new Element("div.toolbarLeftItem",{styles:this.css.toolbarLeftItem,text:this.data.replyTotal+this.lp.reply}).inject(this.toolbarLeft);this.toolbarRight=new Element("div.toolbarRight",{styles:this.css.toolbarRight}).inject(this.toolBarRead);this.createActionBar();this.toolbarRightTools=new Element("div.toolbarRightTools",{styles:this.css.toolbarRightTools}).inject(this.toolbarRight);if(this.nextSubject){this.toolbarNext=new Element("div.toolbarNext",{styles:this.css.toolbarNext,title:this.lp.nextSubject+"："+this.nextSubject.title}).inject(this.toolbarRightTools);this.toolbarNext.addEvent("click",function(){this.gotoDocument(1)}.bind(this))}if(this.lastSubject){this.toolbarPrev=new Element("div.toolbarRightTools",{styles:this.css.toolbarPrev,title:this.lp.prevSubject+"："+this.lastSubject.title}).inject(this.toolbarRightTools);this.toolbarPrev.addEvent("click",function(){this.gotoDocument(-1)}.bind(this))}},adjustReplyCount:function(t){this.data.replyTotal=this.data.replyTotal+t;this.replyTotal.set("text",this.data.replyTotal+this.lp.reply)},createNewDocument:function(){var t=this;var e="ForumDocument";if(t.desktop.apps[e]){t.desktop.apps[e].setCurrent()}else{this.desktop.openApplication(null,"ForumDocument",{sectionId:this.sectionData.id,appId:e,onPostPublish:function(){}.bind(this)})}},edit:function(){var t="ForumDocument"+this.data.id;this.options.isEdited=true;this.reload(t,t)},delete:function(t){var e=this;this.confirm("warn",t,this.lp.deleteDocumentTitle,this.lp.deleteDocument,350,120,function(){e.restActions.deleteSubject(e.data.id,function(){e.notice(e.lp.deleteDocumentOK,"ok");e.reloadAllParents();e.close()}.bind(this));this.close()},function(){this.close()})},postCreateReply:function(t){this.restActions.getReply(t,function(t){var e=this.replyView._createDocument(t.data);this.adjustReplyCount(1);var i=e.node.getTop();this.contentContainerNode.scrollTo(0,i)}.bind(this))},createReply:function(){var t=new MWF.xApplication.ForumDocument.ReplyForm(this,{},{toMain:true,onPostOk:function(t){this.postCreateReply(t)}.bind(this)},{app:this,lp:this.lp,css:this.css,actions:this.restActions});t.mainData=this.data;t.create()},createActionBar:function(){this.actionBar=new Element("div",{styles:this.css.actionBar,html:"&nbsp;"}).inject(this.toolbarRight);if(this.permission.manageAble||this.data.creatorName==this.userName){action=new Element("div",{styles:this.css.actionItem,text:this.lp.edit}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_edit.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.edit()}.bind(this)})}if(this.permission.manageAble||this.data.creatorName==this.userName){action=new Element("div",{styles:this.css.actionItem,text:this.lp.delete}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_delete.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(t){this.delete(t)}.bind(this)})}if(!this.data.stopReply){if(this.isReplyPublisher){action=new Element("div",{styles:this.css.actionItem,text:this.lp.reply}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_quote.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){if(this.access.isAnonymousDynamic()){this.openLoginForm(function(){this.reload()}.bind(this))}else{this.createReply()}}.bind(this)})}}if(this.permission.manageAble){action=new Element("div",{styles:this.css.actionItem,text:this.lp.setTop}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+(this.data.isTopSubject?"icon/action_canceltop.png":"icon/action_top.png")+")");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.setTop()}.bind(this)});if(this.data.isCreamSubject){action=new Element("div",{styles:this.css.actionItem,text:this.lp.cancelPrime}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_cancelprime.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.cancelPrime()}.bind(this)})}else{action=new Element("div",{styles:this.css.actionItem,text:this.lp.setPrime}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_prime.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.setPrime()}.bind(this)})}action=new Element("div",{styles:this.css.actionItem,text:this.lp.setHot}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_popular.png"+")");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.setHotPicture()}.bind(this)});if(this.data.stopReply){action=new Element("div",{styles:this.css.actionItem,text:this.lp.unlock}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_unlock.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.unlock()}.bind(this)})}else{action=new Element("div",{styles:this.css.actionItem,text:this.lp.lock}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_lock.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.lock()}.bind(this)})}}if(this.permission.recommendAble){if(this.data.recommendToBBSIndex){action=new Element("div",{styles:this.css.actionItem,text:this.lp.cancelRecommend}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_cancelrecommend.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.cancelRecommend()}.bind(this)})}else if(this.sectionData.sectionVisiable==this.lp.allPerson&&this.sectionData.indexRecommendable==true){action=new Element("div",{styles:this.css.actionItem,text:this.lp.setRecommend}).inject(this.actionBar);action.setStyle("background-image","url("+this.path+"icon/action_recommend.png)");action.addEvents({mouseover:function(){this.itemNode.setStyles(this.obj.css.actionItem_over)}.bind({obj:this,itemNode:action}),mouseout:function(){this.itemNode.setStyles(this.obj.css.actionItem)}.bind({obj:this,itemNode:action}),click:function(){this.setRecommend()}.bind(this)})}}},lock:function(){this.restActions.lock(this.data.id,function(){this.notice(this.lp.lockSuccess);this.reload()}.bind(this))},unlock:function(){this.restActions.unlock(this.data.id,function(){this.notice(this.lp.unlockSuccess);this.reload()}.bind(this))},setRecommend:function(){this.restActions.setRecommend(this.data.id,function(){this.notice(this.lp.setRecommendSuccess);this.reload()}.bind(this))},cancelRecommend:function(){this.restActions.cancelRecommend(this.data.id,function(){this.notice(this.lp.cancelRecommendSuccess);this.reload()}.bind(this))},setHotPicture:function(){MWF.xDesktop.requireApp("ForumDocument","HotLinkForm",null,false);var t=new MWF.xApplication.ForumDocument.HotLinkForm(this,this.data,{documentId:this.data.id,onPostOk:function(t){}.bind(this)},{app:this,lp:this.lp,css:this.css,actions:this.restActions});t.create()},setTop:function(){var t=new MWF.xApplication.ForumDocument.TopSettingForm(this,this.data,{onPostOk:function(t){this.reload()}.bind(this)},{app:this,lp:this.lp,css:this.css,actions:this.restActions});t.create()},cancelTop:function(){this.restActions.cancelTopToSection(this.data.id,function(){this.notice(this.lp.cancelTopSuccess);this.reload()}.bind(this))},setPrime:function(){this.restActions.setCream(this.data.id,function(){this.notice(this.lp.setPrimeSuccess);this.reload()}.bind(this))},cancelPrime:function(){this.restActions.cancelCream(this.data.id,function(){this.notice(this.lp.cancelPrimeSuccess);this.reload()}.bind(this))},createSubject:function(){this.subjectView=new MWF.xApplication.ForumDocument.SubjectView(this.subjectConainer,this,this,{templateUrl:this.path+"listItemSubject.json",scrollEnable:false});this.subjectView.data=this.data;this.subjectView.load()},openLoginForm:function(t){MWF.require("MWF.xDesktop.Authentication",null,false);var e=new MWF.xDesktop.Authentication({style:"application",onPostOk:function(){if(t)t()}},this);e.openLoginForm()},openSignUpForm:function(t){MWF.require("MWF.xDesktop.Authentication",null,false);var e=new MWF.xDesktop.Authentication({style:"application",onPostOk:function(){if(t)t()}},this);e.openSignUpForm()},gotoReply:function(t){this.replyView.paging.gotoItem(t)},createReplyView:function(){this.replyView=new MWF.xApplication.ForumDocument.ReplyView(this.replyViewConainer,this,this,{templateUrl:this.path+"listItemReply.json",scrollEnable:false,pagingEnable:true,documentKeyWord:"orderNumber",pagingPar:{currentPage:this.options.viewPageNum||1,currentItem:this.options.replyIndex,returnText:this.lp.returnToList,countPerPage:10,onPostLoad:function(t){if(t.nextPageNode){t.nextPageNode.inject(this.pagingBarBottom,"before")}}.bind(this),onPageReturn:function(t){var e="ForumSection"+this.sectionData.id;if(this.desktop.apps[e]){this.desktop.apps[e].setCurrent()}else{this.desktop.openApplication(null,"ForumSection",{sectionId:this.sectionData.id,appId:e})}this.close()}.bind(this)},onGotoItem:function(t){var e=t-this.content.getTop();this.contentContainerNode.scrollTo(0,e)}.bind(this)});this.replyView.pagingContainerTop=this.pagingContainerTop;this.replyView.pagingContainerBottom=this.pagingContainerBottom;this.replyView.data=this.data;this.replyView.filterData={subjectId:this.data.id};this.replyView.load()},createReplyEditor_Anonymous:function(){this.replyArea=new Element("div.replyArea",{styles:this.css.replyArea}).inject(this.middleNode);new Element("div.replyLeft",{styles:this.css.replyLeft}).inject(this.replyArea);var t=new Element("div.replyPicture",{styles:this.css.replyPicture}).inject(this.replyArea);var e=new Element("div.replyNeedLogin",{styles:this.css.replyNeedLogin}).inject(t);new Element("div.replyNeedLogin",{styles:this.css.replyNeedLoginText,text:this.lp.replyNeedLoginText}).inject(e);var i=new Element("div.replyLoginAction",{styles:this.css.replyLoginAction,text:this.lp.login}).inject(e);i.addEvent("click",function(){this.openLoginForm(function(){this.reload()}.bind(this))}.bind(this));if(this.access.signUpMode!="disable"){new Element("div.replyNeedLogin",{styles:this.css.replyNeedLoginText,text:"|"}).inject(e);var s=new Element("div.replyLoginAction",{styles:this.css.replyLoginAction,text:this.lp.signUp}).inject(e);s.addEvent("click",function(){this.openSignUpForm()}.bind(this))}},createReplyEditor:function(){this.replyArea=new Element("div.replyArea",{styles:this.css.replyArea}).inject(this.middleNode);this.replyEditor=new MWF.xApplication.ForumDocument.ReplyEditor(this.replyArea,this,{style:this.options.style,isNew:true,onPostOk:function(t){this.postCreateReply(t)}.bind(this)});this.replyEditor.mainData=this.data;this.replyEditor.load()},createTurnSubjectNode:function(){if(!this.lastSubject&&!this.nextSubject)return;var t=new Element("div.turnSubjectNode",{styles:this.css.turnSubjectNode}).inject(this.middleNode);if(this.lastSubject){var e=new Element("div.lastSubjectNode",{styles:this.css.lastSubjectNode,text:this.lp.prevSubject+"："+this.lastSubject.title}).inject(t);e.addEvents({click:function(){this.gotoDocument(-1)}.bind(this),mouseover:function(){this.node.setStyles(this.obj.css.lastSubjectNode_over)}.bind({obj:this,node:e}),mouseout:function(){this.node.setStyles(this.obj.css.lastSubjectNode)}.bind({obj:this,node:e})})}else{var e=new Element("div.lastSubjectNode",{styles:this.css.lastSubjectNoneNode}).inject(t)}if(this.nextSubject){var i=new Element("div.nextSubjectNode",{styles:this.css.nextSubjectNode,text:this.lp.nextSubject+"："+this.nextSubject.title}).inject(t);i.addEvents({click:function(){this.gotoDocument(1)}.bind(this),mouseover:function(){this.node.setStyles(this.obj.css.nextSubjectNode_over)}.bind({obj:this,node:i}),mouseout:function(){this.node.setStyles(this.obj.css.nextSubjectNode)}.bind({obj:this,node:i})})}else{var i=new Element("div.nextSubjectNode",{styles:this.css.nextSubjectNoneNode}).inject(t)}},gotoDocument:function(t){if(t==1){var e=this.nextSubject}else{var e=this.lastSubject}var i="ForumDocument"+this.data.id;var s="ForumDocument"+e.id;if(this.desktop.apps[s]){this.desktop.apps[s].setCurrent()}else{this.setOptions({sectionId:null,id:e.id,appId:s,isEdited:false,isNew:false});this.reload(i,s)}},getDateDiff:function(t){var e=Date.parse(t.replace(/-/gi,"/"));var i=1e3*60;var s=i*60;var o=s*24;var n=o*15;var a=o*30;var c=a*12;var l=(new Date).getTime();var r=l-e;if(r<0){}var d=(new Date).decrement("day",1);var h=(new Date).decrement("day",2);var p=r/c;var u=r/a;var m=r/(7*o);var f=r/o;var b=r/s;var y=r/i;if(d.getFullYear()==e.getFullYear()&&d.getMonth()==e.getMonth()&&d.getDate()==e.getDate()){result="昨天 "+e.getHours()+":"+e.getMinutes()}else if(h.getFullYear()==e.getFullYear()&&h.getMonth()==e.getMonth()&&h.getDate()==e.getDate()){result="前天 "+e.getHours()+":"+e.getMinutes()}else if(p>1){result=e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日"}else if(u>=1){result=e.getMonth()+1+"月"+e.getDate()+"日"}else if(m>=1){result=parseInt(m)+"周前"}else if(f>=1){result=parseInt(f)+"天前"}else if(b>=1){result=parseInt(b)+"小时前"}else if(y>=1){result=parseInt(y)+"分钟前"}else result="刚才";return result},openPerson:function(t){var e="ForumPerson"+t;if(this.desktop.apps[t]){this.desktop.apps[t].setCurrent()}else{this.desktop.openApplication(null,"ForumPerson",{personName:t,appId:e})}},createPersonNode:function(t,e){var i=e.split(",");i.each(function(e,s){var o=new Element("span",{text:e,styles:this.css.person}).inject(t);o.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.person_over)}.bind({node:o,obj:this}),mouseout:function(){this.node.setStyles(this.obj.css.person)}.bind({node:o,obj:this}),click:function(){this.obj.openPerson(this.userName)}.bind({userName:e,obj:this})});if(s!=i.length-1){new Element("span",{text:","}).inject(t)}}.bind(this))}});MWF.xApplication.ForumDocument.SubjectView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){t.index=e;this.getUserData(t.creatorName,function(e){t.userIcon=e.data.icon;t.signature=e.data.signature;this.actions.getUserInfor({userName:t.creatorName},function(e){t.subject=e.data.subjectCount;t.reply=e.data.replyCount;t.todaySubject=e.data.subjectCountToday;t.todayReply=e.data.replyCountToday;t.prime=e.data.creamCount;t.accessed=e.data.popularity;return new MWF.xApplication.ForumDocument.SubjectDocument(this.viewNode,t,this.explorer,this,null,t.index)}.bind(this))}.bind(this))},getUserData:function(t,e){if(this.app.access.isAnonymous()){this.actions.getPersonIcon(t,function(t){if(e)e({data:{icon:t}})},function(){if(e)e({data:{icon:"/x_component_ForumDocument/$Main/"+this.options.style+"/icon/noavatar_big.gif"}})}.bind(this))}else{this.actions.getPerson(function(t){if(!t.data)t.data={};if(t.data.icon){t.data.icon="data:image/png;base64,"+t.data.icon}else{t.data.icon="/x_component_ForumDocument/$Main/"+this.options.style+"/icon/noavatar_big.gif"}if(e)e(t)}.bind(this),null,t,true)}},_getCurrentPageData:function(t,e){var i={type:"success",count:1,size:1,data:[this.data]};if(t)t(i)},_removeDocument:function(t,e){this.actions.deleteSection(t.id,function(t){this.reload();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}});MWF.xApplication.ForumDocument.SubjectDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverSubject:function(t,e){},mouseoutSubject:function(t,e){},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){if(this.data.attachmentList&&this.data.attachmentList.length>0){var i=t.getElements("[item='attachment']")[0];this.app.loadAttachment(i)}},sendMessage:function(t,e){var i=this;if(layout.desktop.widgets["IMIMWidget"]){var s=layout.desktop.widgets["IMIMWidget"];s.getOwner(function(){this.openChat(e,{from:i.data.creatorName})}.bind(s))}},createReply:function(t,e){if(this.app.access.isAnonymousDynamic()){this.app.openLoginForm(function(){this.app.reload()}.bind(this))}else{var i=new MWF.xApplication.ForumDocument.ReplyForm(this,{},{toMain:true,onPostOk:function(t){this.app.postCreateReply(t)}.bind(this)});i.mainData=this.data;i.create()}}});MWF.xApplication.ForumDocument.ReplyEditor=new Class({Implements:[Options,Events],options:{style:"default",isNew:true},initialize:function(t,e,i){this.setOptions(i);this.node=t;this.app=e},load:function(){var t="<div styles='itemNode'>"+" <div styles='itemLeftNode'>"+"   <div styles='itemUserFace'>"+"     <div styles='itemUserIcon' item='userIcon'>"+"     </div>"+"   </div>"+"   <div styles='replyUserName' item='creatorName'>"+"   </div>"+" </div>"+" <div styles='replyRightNode'>"+"   <div styles='itemRightMidle'>"+"     <div styles='itemBody' item='content'></div>"+"     <div styles='itemBody' item='action'></div>"+"   </div>"+" </div>"+"</div>";this.node.set("html",t);var e=this.node.getElements("[item='action']")[0];this.saveReplyAction=new Element("div",{styles:this.app.css.actionNode,text:this.app.lp.saveReply}).inject(e);this.saveReplyAction.addEvent("click",function(){this.saveReply()}.bind(this));MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.node,this.data||{},{style:"forum",isEdited:this.options.isEdited||this.options.isNew,itemTemplate:{userIcon:{className:"itemUserIcon2",type:"img",value:function(){if(this.app.userData.icon){return"data:image/png;base64,"+this.app.userData.icon;
}else{return"/x_component_ForumDocument/$Main/"+this.options.style+"/icon/noavatar_big.gif"}}.bind(this)},creatorName:{type:"innerText",value:this.app.userName},content:{type:"rtf",RTFConfig:{skin:"bootstrapck",resize_enabled:false,isSetImageMaxWidth:true,toolbar:[{name:"document",items:["Preview"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]},{name:"styles",items:["Styles","Format","Font","FontSize"]},{name:"colors",items:["TextColor","BGColor"]},{name:"links",items:["Link","Unlink"]},{name:"insert",items:["Image"]},{name:"tools",items:["Maximize","-","About"]}]}}}},this,this.app.css);this.form.load()}.bind(this),true)},saveReply:function(){var t=this.form.getResult(true,",",true,false,true);if(t){t.subjectId=this.mainData.id;this.app.restActions.saveReply(t,function(t){if(t.type=="error"){this.app.notice(t.message,"error")}else{this.app.notice(this.app.lp.saveReplySuccess,"ok");this.form.getItem("content").setValue("");this.fireEvent("postOk",t.data.id)}}.bind(this))}}});MWF.xApplication.ForumDocument.ReplyForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"820",height:"470",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:true,title:MWF.xApplication.Forum.LP.replyFormTitle,draggable:true,closeAction:true,toMain:true},_createTableContent:function(){var t="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr>"+"   <td styles='formTableValue14' item='mainSubject'></td>"+"</tr><tr>"+"   <td styles='formTableValue' item='mainContent'></td>"+"</tr><tr>"+"   <td styles='formTableValue' item='content'></td>"+"</tr>";"</table>";this.formTableArea.set("html",t);if(!this.options.toMain&&this.parentData){var e=this.formTableArea.getElements("[item='mainContent']")[0];var i=new Element("div",{styles:this.css.quoteTop}).inject(e);new Element("div",{styles:this.css.quoteLeft}).inject(i);new Element("div",{styles:this.css.quoteInfor,text:this.parentData.creatorName+this.lp.publishAt+this.parentData.createTime}).inject(i);var s=new Element("div",{styles:this.css.quoteBottom}).inject(e);var o=this.parentData.contentText;new Element("div",{styles:this.css.quoteText,text:o.length>50?o.substr(0,50)+"...":o}).inject(s);new Element("div",{styles:this.css.quoteRight}).inject(s)}MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{mainSubject:{type:"innertext",defaultValue:"RE:"+this.mainData.title},content:{type:"rtf",RTFConfig:{skin:"bootstrapck",resize_enabled:false,isSetImageMaxWidth:true,toolbar:[{name:"document",items:["Preview"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]},{name:"styles",items:["Styles","Format","Font","FontSize"]},{name:"colors",items:["TextColor","BGColor"]},{name:"links",items:["Link","Unlink"]},{name:"insert",items:["Image"]},{name:"tools",items:["Maximize","-","About"]}]}}}},this.app,this.css);this.form.load()}.bind(this),true)},_createBottomContent:function(){if(this.isNew||this.isEdited){this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.saveReply}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))}this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.app.lp.close}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(t){this.cancel(t)}.bind(this))},ok:function(t){this.fireEvent("queryOk");var e=this.form.getResult(true,",",true,false,true);if(e){this._ok(e,function(t){if(t.type=="error"){this.app.notice(t.message,"error")}else{this.formMarkNode.destroy();this.formAreaNode.destroy();this.app.notice(this.isNew?this.app.lp.createSuccess:this.app.lp.updateSuccess,"success");this.fireEvent("postOk",t.data.id)}}.bind(this))}},_ok:function(t,e){t.subjectId=this.mainData.id;if(!this.options.toMain){t.parentId=this.parentData.id}this.app.restActions.saveReply(t,function(t){if(e)e(t)}.bind(this))}});MWF.xApplication.ForumDocument.ReplyView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){t.index=e;return new MWF.xApplication.ForumDocument.ReplyDocument(this.viewNode,t,this.explorer,this,null,t.index)},_getCurrentPageData:function(t,e,i){this.clearBody();if(!e)e=10;if(!i)i=1;if(i==1){this.app.subjectConainer.setStyle("display","block")}else{this.app.subjectConainer.setStyle("display","none")}var s=this.filterData||{};this.actions.listReplyFilterPage(i,e,s,function(e){if(!e.data)e.data=[];if(!e.count)e.count=0;if(t)t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteReply(t.id,function(){this.reload();this.app.notice(this.lp.deleteReplySuccess,"ok")}.bind(this))},_create:function(){},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}});MWF.xApplication.ForumDocument.ReplyDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverSubject:function(t,e){},mouseoutSubject:function(t,e){},getUserData:function(t,e){if(this.app.access.isAnonymous()){this.actions.getPersonIcon(t,function(t){if(e)e({data:{icon:t}})},function(){if(e)e({data:{icon:"/x_component_ForumDocument/$Main/"+this.view.options.style+"/icon/noavatar_big.gif"}})}.bind(this))}else{this.actions.getPerson(function(t){if(!t.data)t.data={};if(t.data.icon){t.data.icon="data:image/png;base64,"+t.data.icon}else{t.data.icon="/x_component_ForumDocument/$Main/"+this.view.options.style+"/icon/noavatar_big.gif"}if(e)e(t)}.bind(this),null,t,true)}},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){var i=t.getElements("[item='userIcon']")[0];var s=t.getElements("[item='signatureContainer']")[0];this.getUserData(e.creatorName,function(t){i.src=t.data.icon;if(t.data.signature&&t.data.signature!=""){var e=s.getElements("[item='signature']")[0];e.set("text",t.data.signature)}else{s.destroy()}}.bind(this));this.actions.getUserInfor({userName:e.creatorName},function(e){var i=e.data;t.getElements("[item='subject']")[0].set("text",i.subjectCount);t.getElements("[item='reply']")[0].set("text",i.replyCount);t.getElements("[item='prime']")[0].set("text",i.creamCount);t.getElements("[item='todaySubject']")[0].set("text",i.subjectCountToday);t.getElements("[item='todayReply']")[0].set("text",i.replyCountToday)}.bind(this));if(e.parentId&&e.parentId!=""){var o=t.getElements("[item='quoteContent']")[0];this.actions.getReply(e.parentId,function(t){var e=this.parentData=t.data;var i=new Element("div",{styles:this.css.itemQuote}).inject(o);var s=i.set("html",e.content).get("text");i.empty();e.contentText=s;new Element("div",{styles:this.css.quoteLeftBig}).inject(i);var n=new Element("div",{styles:this.css.quoteAreaBig}).inject(i);var a=new Element("div",{styles:this.css.quoteInforBig,text:e.orderNumber+this.lp.floor+"："+e.creatorName+this.lp.publishAt+e.createTime}).inject(n);a.addEvent("click",function(){this.obj.app.gotoReply(this.index)}.bind({obj:this,index:e.orderNumber||e.index+2}));new Element("div",{styles:this.css.quoteTextBig,text:s.length>100?s.substr(0,100)+"...":s}).inject(n);new Element("div",{styles:this.css.quoteRightBig}).inject(i)}.bind(this),function(t){new Element("div",{styles:this.css.replyBeinngDelete,text:this.lp.quoteReplyBeingDeleted}).inject(o)}.bind(this))}},sendMessage:function(t,e){var i=this;if(layout.desktop.widgets["IMIMWidget"]){var s=layout.desktop.widgets["IMIMWidget"];s.getOwner(function(){this.openChat(e,{from:i.data.creatorName})}.bind(s))}},createReply:function(t,e){if(this.app.access.isAnonymousDynamic()){this.app.openLoginForm(function(){this.app.reload()}.bind(this))}else{var i=new MWF.xApplication.ForumDocument.ReplyForm(this,{},{toMain:false,onPostOk:function(t){this.app.postCreateReply(t)}.bind(this)});this.data.contentText=this.node.getElements("[item='content']")[0].get("text");i.mainData=this.app.data;i.parentData=this.data;i.create()}},editReply:function(t,e){var i=new MWF.xApplication.ForumDocument.ReplyForm(this,this.data,{toMain:this.data.parentId&&this.data.parentId!=""?false:true,onPostOk:function(t){this.actions.getReply(t,function(t){var e=this.node.getElements("[item='content']")[0];e.set("html",t.data.content)}.bind(this))}.bind(this)});i.mainData=this.app.data;i.parentData=this.parentData;i.edit()},deleteReply:function(t,e){var i=this;this.app.confirm("warn",e,this.lp.deleteReplyTitle,this.lp.deleteReplyText,350,120,function(){i.actions.deleteReply(i.data.id,function(){i.destroy();i.app.adjustReplyCount(-1);i.app.notice(i.lp.deleteReplySuccess,"ok")}.bind(this));this.close()},function(){this.close()})}});MWF.xApplication.ForumDocument.TopSettingForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"420",height:"250",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:true,title:MWF.xApplication.Forum.LP.topFormTitle,draggable:true,closeAction:true},createTopNode:function(){if(!this.formTopNode){this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode);if(this.options.hasTopIcon){this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNodeDocument}).inject(this.formTopNode)}this.formTopTextNode=new Element("div",{styles:this.css.formTopTextNodeTopSetting,text:this.options.title}).inject(this.formTopNode);if(this.options.closeAction){this.formTopCloseActionNode=new Element("div",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode);this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))}}},_createTableContent:function(){var t="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr>"+"   <td styles='formTableValue' style='font-size:14px;' lable='topType'></td>"+"</tr><tr>"+"   <td styles='formTableValue' item='topToForum'></td>"+"</tr><tr>"+"   <td styles='formTableValue' item='topToSection'></td>"+"</tr>";"</table>";this.formTableArea.set("html",t);this.topToBBS=this.data.topToBBS;this.topToForum=this.data.topToForum;this.topToSection=this.data.topToSection;MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{topType:{text:this.lp.topType},topToForum:{type:"checkbox",selectValue:["true"],selectText:[this.lp.topToForum]},topToSection:{type:"checkbox",selectValue:["true"],selectText:[this.lp.topToSection]}}},this.app,this.css);this.form.load()}.bind(this),true)},_createBottomContent:function(){if(this.isNew||this.isEdited){this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.ok}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))}this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.app.lp.close}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(t){this.cancel(t)}.bind(this))},ok:function(t){this.fireEvent("queryOk");var e=this.form.getResult(true,",",true,false,true);if(e){var i=true;if(e.topToForum===true||e.topToForum==="true"){this.actions.topToForum(this.app.data.id,function(t){if(t.type=="error"){this.app.notice(t.message,"error");i=false}},function(){i=false},false)}else if(this.topToForum===true||this.topToForum==="true"){this.actions.cancelTopToForum(this.app.data.id,function(t){if(t.type=="error"){this.app.notice(t.message,"error");i=false}},function(){i=false},false)}if(e.topToSection===true||e.topToSection==="true"){this.actions.topToSection(this.app.data.id,function(t){if(t.type=="error"){this.app.notice(t.message,"error");i=false}},function(){i=false},false)}else if(this.topToSection===true||this.topToSection==="true"){this.actions.cancelTopToSection(this.app.data.id,function(t){if(t.type=="error"){this.app.notice(t.message,"error");i=false}},function(){i=false},false)}if(i){this.formMarkNode.destroy();this.formAreaNode.destroy();this.app.notice(this.app.lp.setTopSuccess);this.fireEvent("postOk")}else{this.app.notice(this.app.lp.setToFail,"error")}}}});MWF.xApplication.ForumDocument.ImageClipper=new Class({Extends:MWF.widget.ImageClipper,initialize:function(t,e,i,s){this.node=t;this.setOptions(e);this.parent=i;this.docId=s;this.path=MWF.defaultPath+"/widget/$ImageClipper/";this.cssPath=MWF.defaultPath+"/widget/$ImageClipper/"+this.options.style+"/css.wcss";this._loadCss();this.fireEvent("init")}});