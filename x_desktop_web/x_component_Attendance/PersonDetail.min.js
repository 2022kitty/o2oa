MWF.xDesktop.requireApp("Attendance","Explorer",null,false);MWF.xDesktop.requireApp("Organization","Selector.package",null,false);MWF.xDesktop.requireApp("Template","MForm",null,false);MWF.xApplication.Attendance.PersonDetail=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(e,t,i,a){this.setOptions(a);this.app=t;this.path="/x_component_Attendance/$PersonDetail/";this.cssPath="/x_component_Attendance/$PersonDetail/"+this.options.style+"/css.wcss";this._loadCss();this.actions=i;this.node=$(e)},load:function(){this.loadTab()},loadTab:function(){this.tabNode=new Element("div",{styles:this.css.tabNode}).inject(this.node);this.detailArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode);this.detailStaticArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode);MWF.require("MWF.widget.Tab",function(){this.tabs=new MWF.widget.Tab(this.tabNode,{style:"attendance"});this.tabs.load();this.detailPage=this.tabs.addTab(this.detailArea,"我的出勤明细",false);this.detailPage.contentNodeArea.set("class","detailPage");this.detailPage.addEvent("show",function(){if(!this.detailExplorer){this.detailExplorer=new MWF.xApplication.Attendance.PersonDetail.Explorer(this.detailArea,this);this.detailExplorer.load()}}.bind(this));this.detailStaticPage=this.tabs.addTab(this.detailStaticArea,"我的出勤率统计",false);this.detailStaticPage.contentNodeArea.set("class","detailStaticPage");this.detailStaticPage.addEvent("show",function(){if(!this.detailStaticExplorer){this.detailStaticExplorer=new MWF.xApplication.Attendance.PersonDetail.DetailStaticExplorer(this.detailStaticArea,this);this.detailStaticExplorer.load()}}.bind(this));this.tabs.pages[0].showTab()}.bind(this))}});MWF.xApplication.Attendance.PersonDetail.Explorer=new Class({Extends:MWF.xApplication.Attendance.Explorer,Implements:[Options,Events],initialize:function(e,t,i){this.setOptions(i);this.parent=t;this.app=t.app;this.css=t.css;this.path=t.path;this.actions=t.actions;this.node=$(e);this.preMonthDate=new Date;this.initData();if(!this.peopleActions)this.peopleActions=new MWF.xAction.org.express.RestActions},initData:function(){this.toolItemNodes=[]},reload:function(){this.node.empty();this.load()},load:function(){this.loadConfig();this.loadFilter();this.loadContentNode();this.setNodeScroll();var e=(this.preMonthDate.getMonth()+1).toString();if(e.length==1)e="0"+e;var t={cycleYear:this.preMonthDate.getFullYear().toString(),cycleMonth:e};this.loadView(t)},loadConfig:function(){this.config={};var e;this.actions.getSettingCode("APPEALABLE",function(t){e=t.data?t.data.configValue:null},null,false);if(!e){this.config.APPEALABLE=true}else{this.config.APPEALABLE=e!="false"}},loadFilter:function(){this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);var e=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.filterTable,class:"filterTable"}).inject(this.fileterNode);var t=new Element("tr").inject(e);var i=new Element("td",{styles:this.css.filterTableTitle,text:this.preMonthDate.format(this.app.lp.dateFormatMonth)}).inject(t);this.createDateSelectTd(t);this.createIsAbsent(t);this.createIsLate(t);this.createLackOfTimeCount(t);this.createActionTd(t)},createYearSelectTd:function(e){var t=this;var i=new Element("td",{styles:this.css.filterTableTitle,text:"年度"}).inject(e);var i=new Element("td",{styles:this.css.filterTableValue}).inject(e);this.cycleYear=new MDomItem(i,{name:"cycleYear",type:"select",selectValue:function(){var e=[];var t=(new Date).getFullYear();for(var i=0;i<6;i++){e.push(t--)}return e},event:{change:function(){if(t.dateSelecterTd)t.createDateSelectTd()}}},true,this.app);this.cycleYear.load()},createMonthSelectTd:function(e){var t=this;var i=new Element("td",{styles:this.css.filterTableTitle,text:"月份"}).inject(e);var i=new Element("td",{styles:this.css.filterTableValue}).inject(e);this.cycleMonth=new MDomItem(i,{name:"cycleMonth",type:"select",defaultValue:function(){var e=((new Date).getMonth()+1).toString();return e.length==1?"0"+e:e},selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"],event:{change:function(){if(t.dateSelecterTd)t.createDateSelectTd()}}},true,this.app);this.cycleMonth.load()},createDateSelectTd:function(e){var t=this;if(e){var i=new Element("td",{styles:this.css.filterTableTitle,text:"日期"}).inject(e);this.dateSelecterTd=new Element("td",{styles:this.css.filterTableValue}).inject(e)}if(this.q_date){this.dateSelecterTd.empty()}this.q_date=new MDomItem(this.dateSelecterTd,{name:"q_date",type:"select",selectValue:function(){var e=t.cycleYear?parseInt(t.cycleYear.getValue()):t.preMonthDate.getFullYear();var i=t.cycleMonth?parseInt(t.cycleMonth.getValue())-1:t.preMonthDate.getMonth();var a=new Date(e,i,1);var s=[];s.push("");while(a.getMonth()===i){var n=a.getDate().toString();if(n.length==1)n="0"+n;s.push(n);a.setDate(a.getDate()+1)}return s}},true,this.app);this.q_date.load()},createIsAbsent:function(e){var t=new Element("td",{styles:this.css.filterTableTitle,text:"缺勤"}).inject(e);var t=new Element("td",{styles:this.css.filterTableValue}).inject(e);this.isAbsent=new MDomItem(t,{name:"isAbsent",type:"select",selectValue:["","true","false"],selectText:["","缺勤","未缺勤"]},true,this.app);this.isAbsent.load()},createLackOfTimeCount:function(e){var t=new Element("td",{styles:this.css.filterTableTitle,text:"工时不足"}).inject(e);var t=new Element("td",{styles:this.css.filterTableValue}).inject(e);this.isLackOfTime=new MDomItem(t,{name:"isLackOfTime",type:"select",selectValue:["","true","false"],selectText:["","是","否"]},true,this.app);this.isLackOfTime.load()},createIsLate:function(e){var t=new Element("td",{styles:this.css.filterTableTitle,text:"迟到"}).inject(e);var t=new Element("td",{styles:this.css.filterTableValue}).inject(e);this.isLate=new MDomItem(t,{name:"isLate",type:"select",selectValue:["","true","false"],selectText:["","迟到","未迟到"]},true,this.app);this.isLate.load()},createActionTd:function(e){var t=new Element("td",{styles:this.css.filterTableValue}).inject(e);var i=new Element("button",{text:"查询",styles:this.css.filterButton}).inject(t);i.addEvent("click",function(){var e=this.preMonthDate.getFullYear().toString();var t=(this.preMonthDate.getMonth()+1).toString();if(t.length==1)t="0"+t;var i={cycleYear:e,cycleMonth:t};if(this.isAbsent&&this.isAbsent.getValue()!=""){i.isAbsent=this.getBoolean(this.isAbsent.getValue())}if(this.isLeaveEarlier&&this.isLeaveEarlier.getValue()!=""){i.isLeaveEarlier=this.getBoolean(this.isLeaveEarlier.getValue())}if(this.isLate&&this.isLate.getValue()!=""){i.isLate=this.getBoolean(this.isLate.getValue())}if(this.isLackOfTime&&this.isLackOfTime.getValue()!=""){i.isLackOfTime=this.getBoolean(this.isLackOfTime.getValue())}if(this.q_date&&this.q_date.getValue()!=""){i.q_date=e+"-"+t+"-"+this.q_date.getValue()}this.loadView(i)}.bind(this))},getBoolean:function(e){if(e==="true")return true;if(e==="false")return false;return e},selecePerson:function(){var e={type:"person",title:"选择人员",count:"1",onComplete:function(e){var t=[];e.each(function(e){t.push(e.data.name)}.bind(this));this.q_empName.setValue(t.join(","))}.bind(this)};var t=new MWF.OrgSelector(this.app.content,e)},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node);this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},loadView:function(e){this.elementContentNode.empty();if(this.view)delete this.view;this.view=new MWF.xApplication.Attendance.PersonDetail.View(this.elementContentNode,this.app,this);this.view.filterData=e;this.view.load();this.setContentSize()},setContentSize:function(){var e=this.parent.tabs?this.parent.tabs.tabNodeContainer.getSize():{x:0,y:0};var t=this.fileterNode?this.fileterNode.getSize():{x:0,y:0};var i=this.parent.node.getSize();var a=this.elementContentNode.getStyle("padding-top").toFloat();var s=this.elementContentNode.getStyle("padding-bottom").toFloat();var n=i.y-e.y-a-s-t.y-20;this.elementContentNode.setStyle("height",""+n+"px");this.pageCount=(n/40).toInt()+5;if(this.view&&this.view.items.length<this.pageCount){this.view.loadElementList(this.pageCount-this.view.items.length)}}});MWF.xApplication.Attendance.PersonDetail.SelfHolidayExplorer=new Class({Extends:MWF.xApplication.Attendance.PersonDetail.Explorer,loadView:function(e){this.elementContentNode.empty();if(this.view)delete this.view;this.view=new MWF.xApplication.Attendance.PersonDetail.SelfHolidayView(this.elementContentNode,this.app,this);this.view.filterData=e;this.view.load();this.setContentSize()}});MWF.xApplication.Attendance.PersonDetail.DetailStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.PersonDetail.Explorer,load:function(){this.loadContentNode();this.setNodeScroll();var e={cycleYear:this.preMonthDate.getFullYear().toString(),cycleMonth:this.preMonthDate.format(this.app.lp.dateFormatOnlyMonth)};this.loadView(e)},loadFilter:function(){this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);var e=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.filterTable,class:"filterTable"}).inject(this.fileterNode);e.setStyle("width","360px");var t=new Element("tr").inject(e);this.createYearSelectTd(t);this.createMonthSelectTd(t);this.createActionTd(t)},createMonthSelectTd:function(e){var t=this;var i=new Element("td",{styles:this.css.filterTableTitle,text:"月份"}).inject(e);var i=new Element("td",{styles:this.css.filterTableValue}).inject(e);this.cycleMonth=new MDomItem(i,{name:"cycleMonth",type:"select",selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"],event:{change:function(){if(t.dateSelecterTd)t.createDateSelectTd()}}},true,this.app);this.cycleMonth.load()},createActionTd:function(e){var t=new Element("td",{styles:this.css.filterTableValue}).inject(e);var i=new Element("button",{text:"查询",styles:this.css.filterButton}).inject(t);i.addEvent("click",function(){var e=this.preMonthDate.getFullYear().toString();var t=(this.preMonthDate.getMonth()+1).toString();if(t.length==1)t="0"+t;var i={cycleYear:e,cycleMonth:t};if(this.isAbsent&&this.isAbsent.getValue()!=""){i.isAbsent=this.isAbsent.getValue()}if(this.isLeaveEarlier&&this.isLeaveEarlier.getValue()!=""){i.isLeaveEarlier=this.isLeaveEarlier.getValue()}if(this.isLate&&this.isLate.getValue()!=""){i.isLate=this.isLate.getValue()}if(this.q_date&&this.q_date.getValue()!=""){i.q_date=e+"-"+t+"-"+this.q_date.getValue()}this.loadView(i)}.bind(this))},loadView:function(e){this.elementContentNode.empty();if(this.view)delete this.view;this.view=new MWF.xApplication.Attendance.PersonDetail.DetailStaticView(this.elementContentNode,this.app,this);this.view.filterData=e;this.view.listItemUrl=this.path+"listItem_detailStatic.json";this.view.load();this.setContentSize()}});MWF.xApplication.Attendance.PersonDetail.SelfHolidayStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.PersonDetail.Explorer,loadView:function(e){this.elementContentNode.empty();if(this.view)delete this.view;this.view=new MWF.xApplication.Attendance.PersonDetail.SelfHolidayStaticView(this.elementContentNode,this.app,this);this.view.filterData=e;this.view.load();this.setContentSize()}});MWF.xApplication.Attendance.PersonDetail.View=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(e){return new MWF.xApplication.Attendance.PersonDetail.Document(this.table,e,this.explorer,this)},_getCurrentPageData:function(e,t){if(!t)t=100;var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";var a=this.filterData||{};a.key=this.sortField||this.sortFieldDefault||"";a.order=this.sortType||this.sortTypeDefault||"";a.q_empName=layout.desktop.session.user.name;this.actions.listDetailFilterNext(i,t,a,function(t){var i=t.data;i.each(function(e){e.APPEALABLE=this.explorer.config.APPEALABLE}.bind(this));t.data=i;if(e)e(t)}.bind(this))},_removeDocument:function(e,t){},_createDocument:function(){},_openDocument:function(e){}});MWF.xApplication.Attendance.PersonDetail.SelfHolidayView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(e){return new MWF.xApplication.Attendance.PersonDetail.SelfHolidayDocument(this.table,e,this.explorer,this)},_getCurrentPageData:function(e,t){var i=this.filterData||{};i.q_empName=layout.desktop.session.user.name;this.actions.listDetailFilterUser(i,function(t){if(e)e(t)}.bind(this))},_removeDocument:function(e,t){},_createDocument:function(){},_openDocument:function(e){}});MWF.xApplication.Attendance.PersonDetail.DetailStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(e){return new MWF.xApplication.Attendance.PersonDetail.DetailStaticDocument(this.table,e,this.explorer,this)},_getCurrentPageData:function(e,t){var i=this.filterData||{};i.key=this.sortField||this.sortFieldDefault||"";i.order=this.sortType||this.sortTypeDefault||"";i.q_empName=layout.desktop.session.user.name;var a=((new Date).getMonth()+1).toString();if(a.length==1)a="0"+a;i.cycleMonth=a;this.actions.listStaticMonthPerson(i.q_empName,i.cycleYear,i.cycleMonth,function(t){if(e)e(t)}.bind(this))},_removeDocument:function(e,t){},_createDocument:function(){},_openDocument:function(e){}});MWF.xApplication.Attendance.PersonDetail.SelfHolidayStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(e){return new MWF.xApplication.Attendance.PersonDetail.SelfHolidayStaticDocument(this.table,e,this.explorer,this)},_getCurrentPageData:function(e,t){var i=this.filterData||{};this.actions.listDetailFilterUser(i,function(t){if(e)e(t)}.bind(this))},_removeDocument:function(e,t){},_createDocument:function(){},_openDocument:function(e){}});MWF.xApplication.Attendance.PersonDetail.Document=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document,appeal:function(){var e=new MWF.xApplication.Attendance.PersonDetail.Appeal(this.explorer,this.data);e.create()},seeAppeal:function(){var e=new MWF.xApplication.Attendance.PersonDetail.Appeal(this.explorer,this.data);e.open()}});MWF.xApplication.Attendance.PersonDetail.SelfHolidayDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document});MWF.xApplication.Attendance.PersonDetail.DetailStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document});MWF.xApplication.Attendance.PersonDetail.SelfHolidayStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document});MWF.xApplication.Attendance.PersonDetail.Appeal=new Class({Extends:MWF.widget.Common,initialize:function(e,t){this.explorer=e;this.app=e.app;this.detailData=t;this.css=this.explorer.css;this.load()},load:function(){},open:function(e){this.isNew=false;this.isEdited=false;this.app.restActions.getAppeal(this.detailData.id,function(e){this.data=e.data;this.data.onDutyTime=this.detailData.onDutyTime;this.data.offDutyTime=this.detailData.offDutyTime}.bind(this),null,false);if(!this.data)this.data=this.detailData||{};this._open()},create:function(){this.isNew=true;this.data=this.detailData||{};this._open()},edit:function(){this.isEdited=true;this.app.restActions.getAppeal(this.detailData.id,function(e){this.data=e.data;this.data.onDutyTime=this.detailData.onDutyTime;this.data.offDutyTime=this.detailData.offDutyTime}.bind(this),null,false);if(!this.data)this.data=this.detailData||{};this._open()},_open:function(){this.createMarkNode=new Element("div",{styles:this.css.createMarkNode,events:{mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()}}}).inject(this.app.content,"after");this.createAreaNode=new Element("div",{styles:this.css.createAreaNode});this.createNode();this.createAreaNode.inject(this.createMarkNode,"after");this.createAreaNode.fade("in");this.setCreateNodeSize();this.setCreateNodeSizeFun=this.setCreateNodeSize.bind(this);this.addEvent("resize",this.setCreateNodeSizeFun)},createNode:function(){var e=this;this.createNode=new Element("div",{styles:this.css.createNode}).inject(this.createAreaNode);this.createContainerNode=new Element("div",{styles:this.css.createContainerNode}).inject(this.createNode);this.setScrollBar(this.createContainerNode);this.createIconNode=new Element("div",{styles:this.isNew?this.css.createNewNode:this.css.createIconNode}).inject(this.createContainerNode);this.createFormNode=new Element("div",{styles:this.css.createFormNode}).inject(this.createContainerNode);this.createTableContainer=new Element("div",{styles:this.css.createTableContainer}).inject(this.createFormNode);this.createTableArea=new Element("div",{styles:this.css.createTableArea}).inject(this.createTableContainer);var t=this.data;var i=[];if(t.isGetSelfHolidays&&t.selfHolidayDayTime=="全天"){i.push("请假或外出报备")}else if(t.isAbnormalDuty&&t.abnormalDutyDayTime=="全天"){i.push("异常打卡")}else if(t.isLackOfTime){i.push("工时不足")}else{if(t.isGetSelfHolidays&&t.selfHolidayDayTime=="上午"){i.push("请假或外出报备")}else if(t.isLate){i.push("迟到")}else if(t.isAbsent&&(t.absentDayTime=="上午"||t.absentDayTime=="全天")){i.push("缺勤")}else if(t.isAbnormalDuty&&(t.abnormalDutyDayTime=="全天"||t.abnormalDutyDayTime=="上午")){i.push("异常打卡")}if(t.isGetSelfHolidays&&t.selfHolidayDayTime=="下午"){i.push("请假或外出报备")}else if(t.isAbsent&&t.absentDayTime=="下午"){i.push("缺勤")}else if(t.isAbnormalDuty&&t.abnormalDutyDayTime=="下午"){i.push("异常打卡")}}this.data.statusShow=i.unique().join();var a="发起";if(t.status==0){a="待处理"}else if(t.status==1){a="审批通过"}else if(t.status==-1){a="审批未通过"}this.data.appealStatusShow=a;var s="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr><td colspan='4' styles='formTableHead'>申诉申请单</td></tr>"+"<tr><td styles='formTableTitle' lable='empName'></td>"+"    <td styles='formTableValue' item='empName'></td>"+"    <td styles='formTableTitle' lable='recordDateString'></td>"+"    <td styles='formTableValue' item='recordDateString'></td></tr>"+"<tr><td styles='formTableTitle' lable='onDutyTime'></td>"+"    <td styles='formTableValue' item='onDutyTime'></td>"+"    <td styles='formTableTitle' lable='offDutyTime'></td>"+"    <td styles='formTableValue' item='offDutyTime'></td></tr>"+(this.isNew?"<tr><td styles='formTableTitle' lable='statusShow'></td>"+"    <td styles='formTableValue' item='statusShow'></td>"+"    <td styles='formTableTitle' lable='appealStatusShow'></td>"+"    <td styles='formTableValue' item='appealStatusShow'></td></tr>":"<tr><td styles='formTableTitle' lable='appealStatusShow'></td>"+"    <td styles='formTableValue' item='appealStatusShow'  colspan='3'></td></tr>")+"<tr><td styles='formTableTitle' lable='appealReason'></td>"+"    <td styles='formTableValue' item='appealReason' colspan='3'></td></tr>"+"<tr contain='selfHolidayType'><td styles='formTableTitle' lable='selfHolidayType'></td>"+"    <td styles='formTableValue' item='selfHolidayType' colspan='3'></td></tr>"+"<tr contain='address'><td styles='formTableTitle' lable='address'></td>"+"    <td styles='formTableValue' item='address' colspan='3'></td></tr>"+"<tr contain='startTime'><td styles='formTableTitle' lable='startTime'></td>"+"    <td styles='formTableValue' item='startTime' colspan='3'></td></tr>"+"<tr contain='endTime'><td styles='formTableTitle' lable='endTime'></td>"+"    <td styles='formTableValue' item='endTime' colspan='3'></td></tr>"+"<tr contain='appealDescription'><td styles='formTableTitle' lable='appealDescription'></td>"+"    <td styles='formTableValue' item='appealDescription' colspan='3'></td></tr>"+"</table>";this.createTableArea.set("html",s);this.document=new MForm(this.createTableArea,this.data,{style:"popup",isEdited:this.isEdited||this.isNew,itemTemplate:{empName:{text:"员工姓名",type:"innertext"},recordDateString:{text:"考勤日期",type:"innertext"},onDutyTime:{text:"上班打卡时间",type:"innertext"},offDutyTime:{text:"下班打卡时间",type:"innertext"},statusShow:{text:"考勤状态",type:"innertext"},appealStatusShow:{text:"审批状态",type:"innertext"},appealReason:{notEmpty:true,text:"申述原因",type:"select",selectValue:["","临时请假","出差","因公外出","其他"],event:{change:function(t){e.switchFieldByAppealReason(t.getValue())}}},address:{text:"地点"},selfHolidayType:{text:"请假类型",type:"select",selectValue:["","带薪年休假","带薪病假","带薪福利假","扣薪事假","其他"]},startTime:{text:"开始日期",tType:"datetime"},endTime:{text:"结束日期",tType:"datetime"},appealDescription:{text:"事由"}}},this.app,this.css);this.document.load();e.switchFieldByAppealReason(this.data.appealReason);this.cancelActionNode=new Element("div",{styles:this.css.createCancelActionNode,text:this.app.lp.cancel}).inject(this.createFormNode);this.cancelActionNode.addEvent("click",function(e){this.cancelCreate(e)}.bind(this));if(this.isNew||this.isEdited){this.createOkActionNode=new Element("div",{styles:this.css.createOkActionNode,text:this.app.lp.ok}).inject(this.createFormNode);this.createOkActionNode.addEvent("click",function(e){this.okCreate(e)}.bind(this))}},switchFieldByAppealReason:function(e){var t=["selfHolidayType","startTime","endTime","address","appealDescription"];var i=[];if(e=="临时请假"){i=["selfHolidayType","startTime","endTime"]}else if(e=="出差"){i=["address","startTime","endTime"]}else if(e=="因公外出"){i=["address","startTime","endTime","appealDescription"]}else if(e=="其他"){i=["appealDescription"]}t.each(function(e){this.createTableArea.getElement("[contain='"+e+"']").setStyle("display",i.contains(e)?"":"none");if(this.isNew||this.isEdited)this.document.items[e].options.notEmpty=i.contains(e)?true:false}.bind(this))},setCreateNodeSize:function(){var e=this.app.node.getSize();var t=this.app.content.getSize();var i="550";var a="800";this.createAreaNode.setStyles({width:""+e.x+"px",height:""+e.y+"px"});var s=i;var n=(e.y-i)/2;this.createNode.setStyles({height:""+s+"px","margin-top":""+n+"px",width:""+a+"px"});this.createContainerNode.setStyles({height:""+s+"px"});var l=this.createIconNode?this.createIconNode.getSize():{x:0,y:0};var o=s-l.y-20;this.createFormNode.setStyles({height:""+o+"px","margin-top":""+20+"px"})},cancelCreate:function(e){this.createMarkNode.destroy();this.createAreaNode.destroy();delete this},okCreate:function(e){var t=this.document.getResult(true,",",true,false,true);if(t){var i=t.startTime;var a=t.endTime;if(i!=""&&a!=""){var s=new Date(i.replace(/-/g,"/"));var n=new Date(a.replace(/-/g,"/"));if(s>=n){this.app.notice("开始日期不能晚于结束日期","error");return}}var l={};this.app.restActions.listSetting(function(e){e.data.each(function(e){l[e.configCode]=e}.bind(this))}.bind(this),null,false);if(l.APPEAL_AUDITOR_TYPE&&l.APPEAL_AUDITOR_TYPE.configValue!=""&&l.APPEAL_AUDITOR_VALUE&&l.APPEAL_AUDITOR_VALUE.configValue!=""){if(l.APPEAL_AUDITOR_TYPE.configValue=="所属部门职位"){this.getDepartmentByPerson(function(e){this.app.restActions.getDepartmentDuty(l.APPEAL_AUDITOR_VALUE.configValue,e.name,function(i){var a=false;if(i.data){var s=i.data.identityList;if(s&&s.length>0&&s[0]!=""){a=true;this._ok(s[0],t)}}if(!a){this.app.notice("系统中没有配置"+e.name+"的"+l.APPEAL_AUDITOR_VALUE.configValue+"职位，请联系管理员","error")}}.bind(this))}.bind(this))}else if(l.APPEAL_AUDITOR_TYPE.configValue=="人员属性"){this.app.restActions.getPersonAttribute(l.APPEAL_AUDITOR_VALUE.configValue,layout.desktop.session.user.name,function(e){var i=false;if(e.data){var a=e.data.attributeList;if(a&&a.length>0&&a[0]!=""){i=true;this._ok(a[0],t)}}if(!i){this.app.notice("系统中还没有配置您的"+l.APPEAL_AUDITOR_VALUE.configValue+"，请联系管理员","error")}}.bind(this))}else if(l.APPEAL_AUDITOR_TYPE.configValue=="指定人"){this._ok(l.APPEAL_AUDITOR_VALUE.configValue,t,true)}}else{this.app.restActions.getPersonAttribute("直接主管",layout.desktop.session.user.name,function(e){var i=false;if(e.data){var a=e.data.attributeList;if(a&&a.length>0&&a[0]!=""){i=true;this._ok(a[0],t)}}if(!i){this.app.notice("系统中还没有配置您的直接主管，请联系管理员","error")}}.bind(this))}}},_ok:function(e,t,i){if(i){t.processPerson1=e;this.app.restActions.createAppeal(this.data.id,t,function(e){if(e.type=="ERROR"){this.app.notice(e.userMessage,"error")}else{this.createMarkNode.destroy();this.createAreaNode.destroy();if(this.explorer.view)this.explorer.view.reload();this.app.notice("申诉已提交至"+t.processPerson1,"success")}}.bind(this))}else{this.app.restActions.getPersonByIdentity(e,function(e){t.processPerson1=e.data.name;this.app.restActions.createAppeal(this.data.id,t,function(e){if(e.type=="ERROR"){this.app.notice(e.userMessage,"error")}else{this.createMarkNode.destroy();this.createAreaNode.destroy();if(this.explorer.view)this.explorer.view.reload();this.app.notice("申诉已提交至"+t.processPerson1,"success")}}.bind(this))}.bind(this))}},selectDateTime:function(e,t,i,a){var s={style:"xform",timeOnly:t,isTime:i,target:this.app.content};if(a)s.baseDate=a;MWF.require("MWF.widget.Calendar",function(){var t=new MWF.widget.Calendar(e,s);t.show()}.bind(this))},getDepartmentByPerson:function(e){this.app.restActions.listDepartmentByPerson(function(t){if(t.data.length>0){if(e)e(t.data[0])}else{this.app.notice("未找到您所在的部门，请联系管理员！","error")}}.bind(this),function(){this.app.notice("未找到您所在的部门，请联系管理员！","error")},layout.desktop.session.user.name,false)}});