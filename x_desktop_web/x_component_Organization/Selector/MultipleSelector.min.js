MWF.xApplication.Organization=MWF.xApplication.Organization||{};MWF.xApplication.Organization.Selector=MWF.xApplication.Organization.Selector||{};MWF.xDesktop.requireApp("Organization","lp.zh-cn",null,false);MWF.xDesktop.requireApp("Organization","Actions.RestActions",null,false);MWF.xApplication.Organization.Selector.MultipleSelector=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",types:[],count:0,title:"Select",groups:[],roles:[],companys:[],departments:[],multipleValues:{},groupValues:[],companyValues:[],departmentValues:[],identityValues:[],personValues:[],multipleNames:{},groupNames:[],companyNames:[],departmentNames:[],identityNames:[],personNames:[],zIndex:1e3,expand:true},initialize:function(t,e){this.setOptions(e);this.path="/x_component_Organization/Selector/$Selector/";this.cssPath="/x_component_Organization/Selector/$Selector/"+this.options.style+"/css.wcss";this._loadCss();this.container=$(t);this.action=new MWF.xApplication.Organization.Actions.RestActions;this.lp=MWF.xApplication.Organization.LP;this.lastPeople="";this.pageCount="13";this.selectedItems=[];this.selectedItemsObject={};this.items=[];this.selectors={}},load:function(){if(layout.mobile){this.loadMobile()}else{this.loadPc()}this.fireEvent("load")},loadMobile:function(){this.container.mask({destroyOnHide:true,style:this.css.maskNode});this.node=new Element("div",{styles:this.css.containerNodeMobile});this.node.setStyle("z-index",this.options.zIndex.toInt()+1);this.titleNode=new Element("div",{styles:this.css.titleNodeMobile}).inject(this.node);this.titleCancelActionNode=new Element("div",{styles:this.css.titleCancelActionNodeMobile,text:MWF.xApplication.Organization.LP.back}).inject(this.titleNode);this.titleOkActionNode=new Element("div",{styles:this.css.titleOkActionNodeMobile,text:MWF.xApplication.Organization.LP.ok}).inject(this.titleNode);this.titleTextNode=new Element("div",{styles:this.css.titleTextNodeMobile,text:this.options.title}).inject(this.titleNode);this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node);var t=this.container.getSize();var e=t.y-40;this.contentNode.setStyle("height",""+e+"px");this.loadContent();this.node.inject(this.container);this.node.setStyles({top:"0px",left:"0px"});this.setEvent()},loadPc:function(){this.css.maskNode["z-index"]=this.options.zIndex;this.container.mask({destroyOnHide:true,style:this.css.maskNode});this.node=new Element("div",{styles:this.options.count.toInt()==1?this.css.containerNodeSingle_multiple:this.css.containerNode_multiple});this.node.setStyle("z-index",this.options.zIndex.toInt()+1);this.titleNode=new Element("div",{styles:this.css.titleNode}).inject(this.node);this.titleActionNode=new Element("div",{styles:this.css.titleActionNode}).inject(this.titleNode);this.titleTextNode=new Element("div",{styles:this.css.titleTextNode,text:this.options.title}).inject(this.titleNode);this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node);this.loadContent();this.actionNode=new Element("div",{styles:this.css.actionNode}).inject(this.node);if(this.options.count.toInt()==1)this.actionNode.setStyle("text-align","center");this.loadAction();this.node.inject(this.container);this.node.position({relativeTo:this.container,position:"center",edge:"center"});var t=this.container.getSize();var e=this.node.getSize();this.node.makeDraggable({handle:this.titleNode,limit:{x:[0,t.x-e.x],y:[0,t.y-e.y]}});this.setEvent()},setEvent:function(){if(this.titleActionNode){this.titleActionNode.addEvent("click",function(){this.close()}.bind(this))}if(this.titleCancelActionNode){this.titleCancelActionNode.addEvent("click",function(){this.close()}.bind(this))}if(this.titleOkActionNode){this.titleOkActionNode.addEvent("click",function(){this.fireEvent("complete",[this.getSelectedItems(),this.getSelectedItemsObject()]);this.close()}.bind(this))}},close:function(){this.fireEvent("close");this.node.destroy();this.container.unmask();MWF.release(this);delete this},loadAction:function(){this.okActionNode=new Element("button",{styles:this.css.okActionNode,text:"确　定"}).inject(this.actionNode);this.cancelActionNode=new Element("button",{styles:this.css.cancelActionNode,text:"取 消"}).inject(this.actionNode);this.okActionNode.addEvent("click",function(){this.fireEvent("complete",[this.getSelectedItems(),this.getSelectedItemsObject()]);this.close()}.bind(this));this.cancelActionNode.addEvent("click",function(){this.fireEvent("cancel");this.close()}.bind(this))},loadContent:function(){if(layout.mobile){var t="mobileForm"}else{var t="default"}MWF.require("MWF.widget.Tab",function(){this.tab=new MWF.widget.Tab(this.contentNode,{style:t});this.tab.load()}.bind(this),false);this.options.types.each(function(t,e){var i=new Element("div").inject(this.contentNode);var s=this.tab.addTab(i,this.lp[t],false);var n=t.capitalize();MWF.xDesktop.requireApp("Organization","Selector."+n,function(){var o=Object.clone(this.options);o.values=[];if(o.multipleValues[t]){o.values=o.multipleValues[t]}if(o[t+"Values"]&&o[t+"Values"].length){o.values=o.values.concat(o[t+"Values"])}o.names=[];if(o.multipleNames[t]){o.names=o.multipleNames[t]}if(o[t+"Names"]&&o[t+"Names"].length){o.names=o.names.concat(o[t+"Names"])}this.selectors[n]=new MWF.xApplication.Organization.Selector[n](this.container,o);this.selectors[n].loadContent(i);if(e==0)s.showIm()}.bind(this))}.bind(this))},getSelectedItems:function(){this.selectedItems=[];for(var t in this.selectors){var e=this.selectors[t];if(e.selectedItems&&e.selectedItems.length>0){this.selectedItems=this.selectedItems.concat(e.selectedItems)}}return this.selectedItems},getSelectedItemsObject:function(){this.selectedItemsObject={};for(var t in this.selectors){var e=this.selectors[t];if(e.selectedItems&&e.selectedItems.length>0){this.selectedItemsObject[t.toLowerCase()]=e.selectedItems}}return this.selectedItemsObject}});