MWF.xApplication.Execution=MWF.xApplication.Execution||{};MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.require("MWF.widget.Identity",null,false);MWF.xApplication.Execution.WorkTask=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",workNavi1:"",workNavi2:""},initialize:function(t,i,e,s){this.setOptions(s);this.app=i;this.lp=i.lp;this.path="/x_component_Execution/$WorkTask/";this.loadCss();this.actions=e;this.node=$(t)},loadCss:function(){this.cssPath="/x_component_Execution/$WorkTask/"+this.options.style+"/css.wcss";this._loadCss()},load:function(){if(!this.reportSwitch){var t={};t.configCode="REPORT_USERCREATE";this.actions.getProfileByCode(t,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.reportSwitch=t.data.configValue}}}.bind(this),null,false)}if(!this.appointSwitch){var t={};t.configCode="WORK_AUTHORIZE";this.actions.getProfileByCode(t,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.appointSwitch=t.data.configValue}}}.bind(this),null,false)}if(!this.splitSwitch){var t={};t.configCode="WORK_DISMANTLING";this.actions.getProfileByCode(t,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.splitSwitch=t.data.configValue}}}.bind(this),null,false)}this.tabLocation="";this.middleContent=this.app.middleContent;this.middleContent.setStyles({"margin-top":"0px",border:"0px solid #f00"});this.createNaviContent();this.createContentDiv();this.resizeWindow();this.app.addEvent("resize",function(){this.resizeWindow()}.bind(this))},resizeWindow:function(){var t=this.app.middleContent.getSize();this.naviDiv.setStyles({height:t.y-60+"px"});this.naviContentDiv.setStyles({height:t.y-180+"px"});this.contentDiv.setStyles({height:t.y-60+"px"});this.rightContentDiv.setStyles({height:t.y-40-140+"px"})},createNaviContent:function(){this.naviDiv=new Element("div.naviDiv",{styles:this.css.naviDiv}).inject(this.middleContent);this.naviTitleDiv=new Element("div.naviTitleDiv",{styles:this.css.naviTitleDiv,text:MWF.xApplication.Execution.LP.workTask.naviTitle}).inject(this.naviDiv);this.naviContentDiv=new Element("div.naviContentDiv",{styles:this.css.naviContentDiv}).inject(this.naviDiv);this.naviBottomDiv=new Element("div.naviBottomDiv",{styles:this.css.naviBottomDiv}).inject(this.naviDiv);var t=new Element("li.naviContentLi",{styles:this.css.naviContentLi}).inject(this.naviContentDiv).addEvents({click:function(){this.app.openWorkReport()}.bind(this)});var i=new Element("img.naviContentImg",{styles:this.css.naviContentImg,src:"/x_component_Execution/$WorkReportList/default/icon/Prototype-100.png"}).inject(t);var e=new Element("span.naviContentSpan",{styles:this.css.naviContentSpan,text:this.lp.workTask.naviItem.workReport}).inject(t)},createContentDiv:function(){this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.middleContent);this.createCategoryItemDiv();this.clickWorkTaskNavi(this.options.workNavi1||"base",this.options.workNavi2||"")},createCategoryItemDiv:function(){this.rightCategoryDiv=new Element("div.rightCategoryDiv",{styles:this.css.rightCategoryDiv}).inject(this.contentDiv);var t=false;var i={};i.configCode="COMPANY_WORK_ADMIN";this.actions.getProfileByCode(i,function(i){if(i.data){if(i.data.configValue==""||i.data.configValue.indexOf(this.app.identity)>-1){t=true}}}.bind(this),null,false);if(t){this.rightCategoryNewDiv=new Element("div.rightCategoryNewDiv",{styles:this.css.rightCategoryNewDiv,text:MWF.xApplication.Execution.LP.workTask.newTask}).inject(this.rightCategoryDiv).addEvents({click:function(){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){this.explorer=new MWF.xApplication.Execution.WorkDeploy(this,this.actions,{},{isEdited:true,onReloadView:function(t){this.centerWorkLi.click()}.bind(this)});this.explorer.load()}.bind(this))}.bind(this)})}this.rightCategoryItemDiv=new Element("div.rightCategoryItemDiv",{styles:this.css.rightCategoryItemDiv}).inject(this.rightCategoryDiv);var e;var s=this.path+"categoryNavi.json";this.centerWorkLi=new Element("li.centerWorkLi",{styles:this.css.rightCategoryItemCurrentLi,text:MWF.xApplication.Execution.LP.workTask.centerWork}).inject(this.rightCategoryItemDiv).addEvents({click:function(){this.clickWorkTaskNavi("center")}.bind(this)});this.baseWorkLi=new Element("li.baseWorkLi",{styles:this.css.rightCategoryItemLi,text:MWF.xApplication.Execution.LP.workTask.baseWork}).inject(this.rightCategoryItemDiv).addEvents({click:function(){this.clickWorkTaskNavi("base")}.bind(this)});this.rightSearchDiv=new Element("div.rightSearchDiv",{styles:this.css.rightSearchDiv}).inject(this.contentDiv)},clickWorkTaskNavi:function(t,i){this.workNavi1=t||"base";if(this.rightSearchDiv)this.rightSearchDiv.empty();if(this.rightContentDiv)this.rightContentDiv.destroy();if(t=="base"){if(this.centerWorkLi)this.centerWorkLi.setStyles({"border-bottom":""});if(this.baseWorkLi)this.baseWorkLi.setStyles({"border-bottom":"2px solid #124c93"});this.createBaseWorkSearchDiv();this.createRightContentDiv("base",i||"")}else{if(this.centerWorkLi)this.centerWorkLi.setStyles({"border-bottom":"2px solid #124c93"});if(this.baseWorkLi)this.baseWorkLi.setStyles({"border-bottom":""});this.createCenterWorkSearchDiv();this.createRightContentDiv("center",i||"")}},createCenterWorkSearchDiv:function(){this.rightDrafterTabLi=new Element("li.rightDrafterTabLi",{styles:this.css.rightDrafterTabLi,text:MWF.xApplication.Execution.LP.workTask.centerWorkDrafter}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickCenterWorkTaskNavi("drafter")}.bind(this)});this.rightDeployTabLi=new Element("li.rightDeployTabLi",{styles:this.css.rightDeployTabLi,text:MWF.xApplication.Execution.LP.workTask.centerWorkDeploy}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickCenterWorkTaskNavi("deploy")}.bind(this)});this.rightArchiveTabLi=new Element("li.rightArchiveTabLi",{styles:this.css.rightArchiveTabLi,text:MWF.xApplication.Execution.LP.workTask.centerWorkArchive}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickCenterWorkTaskNavi("archive")}.bind(this)});rightSearchBarSpan=new Element("span.rightSearchBarSpan",{styles:this.css.rightSearchBarSpan}).inject(this.rightSearchDiv);this.rightSearchBarInput=new Element("input",{styles:this.css.rightSearchBarInput,type:"text"}).inject(rightSearchBarSpan).addEvents({keyup:function(t){if(t.code==13){this.searchAction()}}.bind(this)});this.rightSearchBarSearch=new Element("div.rightSearchBarSearch",{styles:this.css.rightSearchBarSearch,text:MWF.xApplication.Execution.LP.workTask.search}).inject(rightSearchBarSpan).addEvents({click:function(){this.searchAction()}.bind(this)})},clickCenterWorkTaskNavi:function(t){this.workNavi2=t||"deploy";if(t=="drafter"){this.rightContentDiv.empty();if(this.rightDrafterTabLi)this.rightDrafterTabLi.setStyles({"border-bottom":"2px solid #124c93"});if(this.rightDeployTabLi)this.rightDeployTabLi.setStyles({"border-bottom":""});if(this.rightArchiveTabLi)this.rightArchiveTabLi.setStyles({"border-bottom":""});this.loadCenterWorkList("drafter")}else if(t=="archive"){this.rightContentDiv.empty();if(this.rightArchiveTabLi)this.rightArchiveTabLi.setStyles({"border-bottom":"2px solid #124c93"});if(this.rightDeployTabLi)this.rightDeployTabLi.setStyles({"border-bottom":""});if(this.rightDrafterTabLi)this.rightDrafterTabLi.setStyles({"border-bottom":""});this.loadCenterWorkList("archive")}else{this.rightContentDiv.empty();if(this.rightDrafterTabLi)this.rightDrafterTabLi.setStyles({"border-bottom":""});if(this.rightArchiveTabLi)this.rightArchiveTabLi.setStyles({"border-bottom":""});if(this.rightDeployTabLi)this.rightDeployTabLi.setStyles({"border-bottom":"2px solid #124c93"});this.loadCenterWorkList("deploy")}},createBaseWorkSearchDiv:function(){this.baseDrafterTabLi=new Element("li.baseDrafterTabLi",{styles:this.css.baseTabLi,text:MWF.xApplication.Execution.LP.workTask.baseWorkCategory.myDrafter}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myDrafter")}.bind(this)});this.baseDeployTabLi=new Element("li.baseDeployTabLi",{styles:this.css.baseTabLi,text:MWF.xApplication.Execution.LP.workTask.baseWorkCategory.myDeploy}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myDeploy")}.bind(this)});this.baseDoTabLi=new Element("li.baseDoTabLi",{styles:this.css.baseTabLi,text:MWF.xApplication.Execution.LP.workTask.baseWorkCategory.myDo}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myDo")}.bind(this)});this.baseAssistTabLi=new Element("li.baseAssistTabLi",{styles:this.css.baseTabLi,text:MWF.xApplication.Execution.LP.workTask.baseWorkCategory.myAssist}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myAssist")}.bind(this)});this.baseReadTabLi=new Element("li.baseReadTabLi",{styles:this.css.baseTabLi,text:MWF.xApplication.Execution.LP.workTask.baseWorkCategory.myRead}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myRead")}.bind(this)});if(this.appointSwitch&&this.appointSwitch.toUpperCase()=="OPEN"){this.baseAppointTabLi=new Element("li.baseAppointTabLi",{styles:this.css.baseTabLi,text:MWF.xApplication.Execution.LP.workTask.baseWorkCategory.myAppoint}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myAppoint")}.bind(this)})}this.baseArchiveTabLi=new Element("li.baseArchiveTabLi",{styles:this.css.baseTabLi,text:MWF.xApplication.Execution.LP.workTask.baseWorkCategory.myArchive}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myArchive")}.bind(this)});rightSearchBarSpan=new Element("span.rightSearchBarSpan",{styles:this.css.rightSearchBarSpan}).inject(this.rightSearchDiv);this.rightSearchBarInput=new Element("input",{styles:this.css.rightSearchBarInput,type:"text"}).inject(rightSearchBarSpan).addEvents({keyup:function(t){if(t.code==13){this.searchAction()}}.bind(this)});this.rightSearchBarSearch=new Element("div.rightSearchBarSearch",{styles:this.css.rightSearchBarSearch,text:MWF.xApplication.Execution.LP.workTask.search}).inject(rightSearchBarSpan).addEvents({click:function(){this.searchAction()}.bind(this)})},clickBaseWorkTaskNavi:function(t){this.workNavi2=t||"myDo";if(t=="myDrafter"){this.changeBaseWork(this.baseDrafterTabLi);this.loadBaseWorkList("myDrafter")}else if(t=="myDeploy"){this.changeBaseWork(this.baseDeployTabLi);this.loadBaseWorkList("myDeploy")}else if(t=="myDo"){this.changeBaseWork(this.baseDoTabLi);this.loadBaseWorkList("myDo")}else if(t=="myAssist"){this.changeBaseWork(this.baseAssistTabLi);this.loadBaseWorkList("myAssist")}else if(t=="myRead"){this.changeBaseWork(this.baseReadTabLi);this.loadBaseWorkList("myRead")}else if(t=="myAppoint"){this.changeBaseWork(this.baseAppointTabLi);this.loadBaseWorkList("myAppoint")}else if(t=="myArchive"){this.changeBaseWork(this.baseArchiveTabLi);this.loadBaseWorkList("myArchive")}else{this.changeBaseWork(this.baseDoTabLi);this.loadBaseWorkList("myDo")}},reloadRightContentDiv:function(){if(this.rightContentDiv)this.rightContentDiv.destroy();this.rightContentDiv=new Element("div.rightContentDiv",{styles:this.css.rightContentDiv}).inject(this.contentDiv)},createRightContentDiv:function(t,i){if(this.rightContentDiv)this.rightContentDiv.destroy();this.rightContentDiv=new Element("div.rightContentDiv",{styles:this.css.rightContentDiv}).inject(this.contentDiv);if(t=="base"){this.clickBaseWorkTaskNavi(i)}else{this.clickCenterWorkTaskNavi(i)}},createTableContent:function(t,i){var e="<tr>";e+="<td>fffff</td>";e+="</tr>";this.taskTable.set("html",this.taskTable.get("html")+e)},loadCenterWorkList:function(t,i){if(this.baseView)delete this.baseView;this.reloadRightContentDiv();this.rightContentDiv.setStyles({height:this.app.middleContent.getSize().y-40-140+"px"});if(this.scrollBar&&this.scrollBar.scrollVAreaNode){this.scrollBar.scrollVAreaNode.destroy()}MWF.require("MWF.widget.ScrollBar",function(){this.scrollBar=new MWF.widget.ScrollBar(this.rightContentDiv,{indent:false,style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(t){var i=this.rightContentDiv.getScrollSize();var e=this.rightContentDiv.getSize();var s=i.y-e.y;var o=this.baseView||this.centerView;if(t+200>s&&o&&o.loadElementList){if(!o.isItemsLoaded)o.loadElementList()}}.bind(this)})}.bind(this),false);templateUrl=this.path+"listItem.json";if(t=="drafter"){templateUrl=this.path+"listItemDrafter.json"}else if(t=="archive"){templateUrl=this.path+"listItemArchive.json"}this.centerView=new MWF.xApplication.Execution.WorkTask.CenterWorkView(this.rightContentDiv,this.app,{explorer:this,lp:this.lp.centerWorkView,css:this.css,actions:this.actions},{templateUrl:templateUrl,category:t,filterData:i});this.centerView.load()},loadBaseWorkList:function(t,i){if(this.centerView)delete this.centerView;this.reloadRightContentDiv();this.rightContentDiv.setStyles({height:this.app.middleContent.getSize().y-40-140+"px"});templateUrl=this.path+"listItemBase.json";if(t=="myDrafter"){templateUrl=this.path+"listItemBaseDrafter.json"}else if(t=="myDeploy"){templateUrl=this.path+"listItemBaseDeploy.json"}else if(t=="myDo"){templateUrl=this.path+"listItemBaseDo.json"}else if(t=="myAppoint"){templateUrl=this.path+"listItemBaseAppoint.json"}else if(t=="myArchive"){templateUrl=this.path+"listItemBaseArchive.json"}if(this.scrollBar&&this.scrollBar.scrollVAreaNode){this.scrollBar.scrollVAreaNode.destroy()}MWF.require("MWF.widget.ScrollBar",function(){if(this.scrollBar)delete this.scrollBar;this.scrollBar=new MWF.widget.ScrollBar(this.rightContentDiv,{indent:false,style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(t){var i=this.rightContentDiv.getScrollSize();var e=this.rightContentDiv.getSize();var s=i.y-e.y;var o=this.baseView||this.centerView;if(t+200>s&&o&&o.loadElementList){if(!o.isItemsLoaded)o.loadElementList()}}.bind(this)})}.bind(this),false);this.baseView=new MWF.xApplication.Execution.WorkTask.BaseWorkView(this.rightContentDiv,this.app,{lp:this.lp.baseWorkView,css:this.css,actions:this.actions},{templateUrl:templateUrl,category:t,filterData:i});this.baseView.load()},changeBaseWork:function(t){var i=this.rightSearchDiv.getElements("li");i.setStyle("border-bottom","");t.setStyle("border-bottom","2px solid #124c93")},searchAction:function(){var t={};t.workTitle=this.rightSearchBarInput.get("value");if(this.tabLocation=="centerDrafter"){this.app.workTask.loadCenterWorkList("drafter");this.loadCenterWorkList("drafter",t)}else if(this.tabLocation=="centerDeploy"){this.loadCenterWorkList("deploy",t)}else if(this.tabLocation=="centerArchive"){this.loadCenterWorkList("archive",t)}if(this.tabLocation=="baseDrafter"){this.loadBaseWorkList("myDrafter",t)}else if(this.tabLocation=="baseDeploy"){this.loadBaseWorkList("myDeploy",t)}else if(this.tabLocation=="baseDo"){this.loadBaseWorkList("myDo",t)}else if(this.tabLocation=="baseAssist"){this.loadBaseWorkList("myAssist",t)}else if(this.tabLocation=="baseRead"){this.loadBaseWorkList("myRead",t)}else if(this.tabLocation=="baseAppoint"){this.loadBaseWorkList("myAppoint",t)}else if(this.tabLocation=="baseArchive"){this.loadBaseWorkList("myArchive",t)}}});MWF.xApplication.Execution.WorkTask.WorkForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,createTopNode:function(){if(!this.formTopNode){this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode);this.formTopImg=new Element("img.formTopImg",{styles:this.css.formTopImg,src:"/x_component_Execution/$Main/default/icon/Document-104.png"}).inject(this.formTopNode);this.formTopSpan=new Element("span.formTopSpan",{styles:this.css.formTopSpan,text:this.options.title}).inject(this.formTopNode);if(this.options.closeAction){this.formTopCloseActionNode=new Element("div.formTopCloseActionNode",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode);this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))}}},_createTableContent:function(){this.createNewTaskDiv=new Element("div.createNewTaskDiv",{styles:this.css.createNewTaskDiv,text:MWF.xApplication.Execution.LP.workTask.popUp.createNewTask.title}).inject(this.formTableArea).addEvents({click:function(){this.close();MWF.xDesktop.requireApp("Execution","CreateMainTask",function(){this.explorer=new MWF.xApplication.Execution.CreateMainTask(this,this.explorer.app.restActions,{},{});this.explorer.load()}.bind(this))}.bind(this)});this.createAddTaskDiv=new Element("div.createAddTaskDiv",{styles:this.css.createAddTaskDiv,text:MWF.xApplication.Execution.LP.workTask.popUp.createAddTask.title}).inject(this.formTableArea).addEvents({click:function(){}})},_createBottomContent:function(){var t="<span style='color:#f59353'>"+MWF.xApplication.Execution.LP.workTask.popUp.createNewTask.title+"</span>："+MWF.xApplication.Execution.LP.workTask.popUp.createNewTask.explain;t+="<br><span style='color:#f59353'>"+MWF.xApplication.Execution.LP.workTask.popUp.createAddTask.title+"</span>："+MWF.xApplication.Execution.LP.workTask.popUp.createAddTask.explain;this.createExplainDiv=new Element("div.createExplainDiv",{styles:this.css.createExplainDiv,html:t}).inject(this.formBottomNode)}});MWF.xApplication.Execution.WorkTask.CenterWorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkTask.CenterWorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,i){var e=this.options.category;if(!i)i=15;var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";var o=this.options.filterData||{};if(e=="deploy"){this.tabLocation="centerDeploy";this.actions.getCenterWorkDeployListNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="drafter"){this.tabLocation="centerDrafter";this.actions.getCenterWorkDrafterListNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="archive"){this.tabLocation="centerArchive";this.actions.getCenterWorkArchiveListNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else{this.tabLocation="centerDeploy";this.actions.getCenterWorkDeployListNext(s,i,o,function(i){if(t)t(i)}.bind(this))}this.app.workTask.tabLocation=this.tabLocation},_removeDocument:function(t,i){this.actions.deleteCenterWork(t.id,function(t){if(this.tabLocation=="centerDrafter"){this.app.workTask.loadCenterWorkList("drafter")}else if(this.tabLocation=="centerDeploy"){this.app.workTask.loadCenterWorkList("deploy")}this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){var i=this.tabLocation=="centerDrafter"||this.tabLocation=="baseDrafter"?true:false;this.workDeploy=new MWF.xApplication.Execution.WorkDeploy(this,this.actions,{id:t.id},{isEdited:i,centerWorkId:t.id,onReloadView:function(t){tab="deploy";if(t&&t.tab&&t.tab=="drafter")tab="drafter";this.explorer.explorer.createRightContentDiv("center",tab)}.bind(this)});this.workDeploy.load()}.bind(this))},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}});MWF.xApplication.Execution.WorkTask.CenterWorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,action_open:function(){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){var t=this.view.tabLocation=="centerDrafter"||this.view.tabLocation=="baseDrafter"?true:false;this.workDeploy=new MWF.xApplication.Execution.WorkDeploy(this.view,this.view.app.restActions,{id:this.data.id},{isEdited:t,centerWorkId:this.data.id});this.workDeploy.load()}.bind(this))},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,i){},removeCenterWork:function(t){if(t.processStatus&&t.processStatus==this.view.app.lp.workTask.drafter){return true}else{return false}}});MWF.xApplication.Execution.WorkTask.BaseWorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkTask.BaseWorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,i){var e=this.category=this.options.category;if(!i)i=15;var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";var o=this.options.filterData||{};if(e=="myDrafter"){this.tabLocation="baseDrafter";this.actions.getBaseWorkListMyDrafterNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="myDeploy"){this.tabLocation="baseDeploy";this.actions.getBaseWorkListMyDeployNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="myDo"){this.tabLocation="baseDo";this.actions.getBaseWorkListMyDoNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="myAssist"){this.tabLocation="baseAssist";this.actions.getBaseWorkListMyAssistNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="myRead"){this.tabLocation="baseRead";this.actions.getBaseWorkListMyReadNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="myAppoint"){this.tabLocation="baseAppoint";this.actions.getBaseWorkListMyAppointNext(s,i,o,function(i){if(t)t(i)}.bind(this))}else if(e=="myArchive"){this.tabLocation="baseArchive";this.actions.getBaseWorkListMyArchiveNext(s,i,o,function(i){if(t)t(i)}.bind(this))}this.app.workTask.tabLocation=this.tabLocation},_removeDocument:function(t,i){this.actions.deleteBaseWork(t.id,function(t){if(t.type&&t.type=="success"){if(this.tabLocation=="baseDrafter"){this.app.workTask.loadBaseWorkList("myDrafter")}else if(this.tabLocation=="baseDeploy"){this.app.workTask.loadBaseWorkList("myDeploy")}this.app.notice(this.app.lp.deleteDocumentOK,"success")}}.bind(this),function(t,i,e){var s=e;if(t)errorMessage=t.responseText;var o=JSON.parse(errorMessage);if(o.message){this.app.notice(o.message,"error")}else{this.app.notice(s,"error")}}.bind(this))},_create:function(){},_openDocument:function(t){if(this.tabLocation=="baseDrafter"){MWF.xDesktop.requireApp("Execution","WorkForm",function(){var i=this.tabLocation=="centerDrafter"||this.tabLocation=="baseDrafter"?true:false;var e=new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,t,{isNew:false,isEdited:i,tabLocation:this.category});e.load()}.bind(this))}else{MWF.xDesktop.requireApp("Execution","WorkDetail",function(){var i=new MWF.xApplication.Execution.WorkDetail(this,this.app.restActions,t,{isNew:false,isEdited:false,tabLocation:this.category});i.load()}.bind(this))}},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}});MWF.xApplication.Execution.WorkTask.BaseWorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,action_edit:function(){MWF.xDesktop.requireApp("Execution","WorkForm",function(){var t=this.view.tabLocation=="centerDrafter"||this.view.tabLocation=="baseDrafter"?true:false;var i=new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,this.data,{isNew:false,isEdited:t,tabLocation:this.view.category});i.load()}.bind(this))},appointActionReturn:function(t){if(this.view.app.workTask.appointSwitch&&this.view.app.workTask.appointSwitch.toUpperCase()=="OPEN"){return true}return false},reportActionReturn:function(t){if(this.view.app.workTask.reportSwitch&&this.view.app.workTask.reportSwitch=="OPEN"){return true}return false},splitActionReturn:function(t){if(this.view.app.workTask.splitSwitch&&this.view.app.workTask.splitSwitch=="OPEN"){return true}return false},editActionReturn:function(t){if(t.workProcessStatus==this.lp.statusDraft){return true}return false},action_report:function(){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var t={workId:this.data.id};var i=new MWF.xApplication.Execution.WorkReport(this,this.app.restActions,t,{isNew:false,isEdited:false,tabLocation:this.view.category,from:"drafter"});i.load()}.bind(this))},action_split:function(){MWF.xDesktop.requireApp("Execution","WorkForm",function(){var t={title:this.data.title,centerId:this.data.centerId,parentWorkId:this.data.id,workType:this.data.workType,workLevel:this.data.workLevel,completeDateLimitStr:this.data.completeDateLimitStr,completeDateLimit:this.data.completeDateLimit,reportCycle:this.data.reportCycle,reportDayInCycle:this.data.reportDayInCycle};if(this.data.id){this.actions.getBaseWorkDetails(this.data.id,function(i){t.workSplitAndDescription=i.data.workDetail;t.specificActionInitiatives=i.data.progressAction;t.cityCompanyDuty=i.data.dutyDescription;t.milestoneMark=i.data.landmarkDescription;t.importantMatters=i.data.majorIssuesDescription}.bind(this),null,false)}var i=new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,t,{isNew:false,isEdited:true,tabLocation:this.view.category});i.load()}.bind(this))},action_appoint:function(){data={workId:this.data.id};var t=new MWF.xApplication.Execution.WorkTask.Appoint(this.view.app,this.view.app.restActions,data,this.view.css,{ieEdited:true,onReloadView:function(t){this.view.app.workTask.createRightContentDiv("base","myAppoint")}.bind(this)});t.load()},action_unAppoint:function(t){var i=this;i.view.app.confirm("warn",t,i.view.app.lp.workTask.submitWarn.warnTitle,i.view.app.lp.workTask.submitWarn.warnContent,300,120,function(){data={workId:i.data.id};i.actions.unAppointBaseWork(data,function(t){this.app.notice(i.view.app.lp.workTask.prompt.tackbackBaseWork,"success")}.bind(i),function(t,i,e){var s=e;if(t)errorMessage=t.responseText;var o=JSON.parse(errorMessage);if(o.message){this.app.notice(o.message,"error")}else{this.app.notice(s,"error")}}.bind(i),false);i.view.app.workTask.createRightContentDiv("base","myAppoint");this.close(0)},function(){this.close()})},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,i){if(t.getElements("div[name='appointDiv']")){if(i.okrWorkAuthorizeRecord){t.getElements("div[name='appointDiv']").setStyle("display","")}}if(t.getElements("div[styles='documentSubject']")){t.getElements("div[styles='documentSubject']").set("title",i.shortWorkDetail)}}});MWF.xApplication.Execution.WorkTask.Appoint=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"500",height:"300",hasTop:true,hasIcon:false,hasBottom:true,title:"",draggable:false,closeAction:true,closeText:"",needLogout:false,isNew:true},initialize:function(t,i,e,s,o){this.setOptions(o);this.app=t;this.actions=this.app.restActions;this.css=s;this.data=e||{};this.actions=i},load:function(){this.create()},createTopNode:function(){if(!this.formTopNode){this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode);this.formTopIconNode=new Element("div.formTopIconNode",{styles:this.css.formTopIconNode}).inject(this.formTopNode);this.formTopTextNode=new Element("div.formTopTextNode",{styles:this.css.formTopTextNode,text:this.app.lp.workTask.appoint.appointTitle}).inject(this.formTopNode);if(this.options.closeAction){this.formTopCloseActionNode=new Element("div.formTopCloseActionNode",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode);this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))}this.formTopContentNode=new Element("div.formTopContentNode",{styles:this.css.formTopContentNode}).inject(this.formTopNode)}},_createTableContent:function(){var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0"}).inject(this.formTableArea);t.setStyles({"margin-top":"40px"});var i=new Element("tr").inject(t);var e=new Element("td",{text:this.app.lp.workTask.appoint.appointFor,valign:"middle",width:"20%"}).inject(i);e=new Element("td",{width:"80%"}).inject(i);this.appointPerson=new Element("input",{readonly:true}).inject(e);this.appointPerson.setStyles({width:"90%",height:"20px"});this.appointPerson.addEvents({click:function(){this.selectPerson(this.appointPerson,"identity",1)}.bind(this)});i=new Element("tr").inject(t);e=new Element("td",{text:this.app.lp.workTask.appoint.appointOpinion,valign:"middle"}).inject(i);e=new Element("td").inject(i);this.appointOpinion=new Element("textarea").inject(e);this.appointOpinion.setStyles({width:"90%",height:"50px"})},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.app.lp.workTask.appoint.appointCancel}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(t){this.close()}.bind(this));this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.workTask.appoint.appointOK}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))},ok:function(){if(this.appointPerson.get("value")==""){this.app.notice(this.app.lp.workTask.appoint.personEmpty,"error");return false}if(this.appointOpinion.get("value")==""){this.app.notice(this.app.lp.workTask.appoint.opinionEmpty,"error");return false}var t={workId:this.data.workId,undertakerIdentity:this.appointPerson.get("value"),authorizeOpinion:this.appointOpinion.get("value")};this.actions.appointBaseWork(t,function(t){this.close();this.fireEvent("reloadView")}.bind(this),function(t,i,e){var s=e;if(t)errorMessage=t.responseText;var o=JSON.parse(errorMessage);if(o.message){this.app.notice(o.message,"error")}else{this.app.notice(s,"error")}}.bind(this),false)},selectPerson:function(t,i,e){MWF.xDesktop.requireApp("Organization","Selector.package",null,false);this.fireEvent("querySelect",this);var s=t.get("value").split(this.valSeparator);var o={type:i,title:this.app.lp.workTask.appoint.appointTitle,count:e,names:s||[],onComplete:function(i){var e=[];i.each(function(t){e.push(t.data.name)}.bind(this));t.set("value",e.join(","))}.bind(this)};var a=new MWF.OrgSelector(this.app.content,o)}});