MWF.xApplication.Execution=MWF.xApplication.Execution||{};MWF.require("MWF.widget.Identity",null,false);MWF.xDesktop.requireApp("Execution","Actions.RestActions",null,false);MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xApplication.Execution.options={multitask:false,executable:true};MWF.xApplication.Execution.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"Execution",icon:"icon.png",width:"1270",height:"700",isResize:false,isMax:true,title:MWF.xApplication.Execution.LP.title},onQueryClose:function(){this.logout()},onQueryLoad:function(){this.lp=MWF.xApplication.Execution.LP},loadApplication:function(t){this.user=layout.desktop.session.user.name;this.loginUser=layout.desktop.session.user.name;this.userGender=layout.desktop.session.user.genderType;this.department="";this.trueUserName=this.user;this.restActions=new MWF.xApplication.Execution.Actions.RestActions;this.okrSystemAdmin=false;if(!this.workTabSwitch){var i={};i.configCode="INDEX_WORK_STATUSLIST";this.restActions.getProfileByCode(i,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.workTabSwitch=t.data.configValue}}}.bind(this),null,false)}if(!this.statSwitch){var i={};i.configCode="INDEX_STATISTIC_TYPE";this.restActions.getProfileByCode(i,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.statSwitch=t.data.configValue}}}.bind(this),null,false)}if(!this.companyAdmin){var i={};i.configCode="COMPANY_WORK_ADMIN";this.restActions.getProfileByCode(i,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.companyAdmin=t.data.configValue}}}.bind(this),null,false)}this.identites=this.getIdentityies();if(this.status&&this.status.identity){this.restActions.login({loginIdentity:this.status.identity},function(t){if(t.data&&t.data.okrSystemAdmin)this.okrSystemAdmin=t.data.okrSystemAdmin;this._loadApplication(null,this.status.identity)}.bind(this),null,false)}else{if(this.identites.length>1){var e=new MWF.xApplication.Execution.IdenitySelector(this,this.restActions,this.identites,this.css,{closeText:this.lp.close,onPostSelectorClose:function(){this.close()}.bind(this),onPostSelectorOk:function(t){this._loadApplication(null,t)}.bind(this)});e.load()}else if(this.identites.length=1){this.restActions.login({loginIdentity:this.identites[0]},function(t){if(t.data)this.okrSystemAdmin=t.data.okrSystemAdmin;this._loadApplication(null,this.identites[0])}.bind(this),null,false)}else{this.notice(this.app.lp.noIdentityNotice,"error");this.close()}}},_loadApplication:function(t,i){this.identity=i;this.getOrgAction(function(){this.orgAction.getDepartmentByIdentity(function(t){if(t.data&&t.data.name){this.department=t.data.name}}.bind(this),null,this.identity,false);this.orgAction.getPersonByIdentity(function(t){if(t.data&&t.data.name){this.trueUserName=t.data.name;this.user=t.data.name}}.bind(this),null,this.identity,false)}.bind(this));this.createContainer();this.createTopBarVersion();this.createMiddleContent();if(this.status&&this.status.navi1=="work"){if(this.status.navi2=="task"){this.openTask(this.status.navi3,this.status.navi4)}else if(this.status.navi2=="report"){this.openWorkReport(this.status.navi3)}else{this.createLayout()}}else if(this.status&&this.status.navi1=="xmind"){this.openContent("xmind")}else if(this.status&&this.status.navi1=="setting"){this.openContent("setting")}else{this.createLayout()}this.addEvent("resize",function(){var t=this.middleContent.getSize();var i=t.y-300;var e=t.x-450;if(this.todoList)this.todoList.setStyles({height:i+"px"});if(this.workConditionContentDiv)this.workConditionContentDiv.setStyles({height:i+"px"});if(this.leftContent)this.leftContent.setStyles({width:e+"px"})}.bind(this))},logout:function(t){var i={};this.restActions.logout(i,function(t){}.bind(this),function(t,i,e){}.bind(this),false)},getIdentityies:function(){var t=[];this.getOrgAction(function(){this.orgAction.listIdentityByPerson(function(i){i.data.each(function(i){t.push(i.name)})}.bind(this),null,this.user,false)}.bind(this));this.restActions.listMyRelief(function(i){if(i.data){i.data.each(function(i){t.push(i.leaderIdentity)})}}.bind(this),null,false);return t},resizeContent:function(){var t=this.middleContent.getSize();var i=t.y-300;var e=t.x-450;if(this.todoList)this.todoList.setStyles({height:i+"px"});if(this.workConditionContentDiv)this.workConditionContentDiv.setStyles({height:i+"px"});if(this.leftContent)this.leftContent.setStyles({width:e+"px"})},getOrgAction:function(t){if(!this.orgAction){MWF.require("MWF.xAction.org.express.RestActions",function(){this.orgAction=new MWF.xAction.org.express.RestActions;if(t)t()}.bind(this),false)}else{if(t)t()}},changeIdentity:function(){this.identitySelector=new MWF.xApplication.Execution.IdenitySelector(this,this.restActions,this.identites,this.css,{closeText:this.lp.cancel,needLogout:true,onPostSelectorClose:function(){this.identitySelector.close()}.bind(this),onPostSelectorOk:function(t){this.status=null;this._loadApplication(null,t)}.bind(this)});this.identitySelector.load()},recordStatus:function(){var t={identity:this.identity,navi1:this.currentTopBarTab,navi2:this.navi2};if(t.navi1=="work"){if(t.navi2=="task"){t.navi3=this.workTask?this.workTask.workNavi1:"";t.navi4=this.workTask?this.workTask.workNavi2:""}else if(t.navi2=="report"){t.navi3=this.workReportList.workNavi1;t.navi4=""}else{t.navi3="";t.navi4=""}}return t},openContent:function(t){if(t=="xmind"){this.currentTopBarTab="xmind";this.loadTopBarTab(this.currentTopBarTab);this.middleContent.empty();MWF.xDesktop.requireApp("Execution","MinderExplorer",null,false);var i=new MWF.xApplication.Execution.MinderExplorer(this.middleContent,this,this.restActions,{});i.load()}else if(t=="setting"){this.currentTopBarTab="setting";this.loadTopBarTab(this.currentTopBarTab);this.middleContent.empty();MWF.xDesktop.requireApp("Execution","SettingExplorer",function(){var t=new MWF.xApplication.Execution.SettingExplorer(this.middleContent,this,this.restActions,{});t.load()}.bind(this),false)}else{this.currentTopBarTab="work";this.loadTopBarTab(this.currentTopBarTab);this.middleContent.empty();this.createLayout()}},openTask:function(t,i){this.navi2="task";this.middleContent.empty();MWF.xDesktop.requireApp("Execution","WorkList",function(){this.workList=new MWF.xApplication.Execution.WorkList(this.middleContent,this,this.restActions,{workNavi1:t||"",workNavi2:i||""});this.workList.load()}.bind(this))},openWorkReport:function(t){this.navi2="report";this.middleContent.empty();MWF.xDesktop.requireApp("Execution","WorkReportList",function(){this.workReportList=new MWF.xApplication.Execution.WorkReportList(this.middleContent,this,this.restActions,{workNavi1:t||""});this.workReportList.load()}.bind(this))},openStat:function(){this.navi2="stat";this.middleContent.empty();MWF.xDesktop.requireApp("Execution","WorkStat",function(){this.workStat=new MWF.xApplication.Execution.WorkStat(this.middleContent,this,this.restActions,{});this.workStat.load()}.bind(this))},createContainer:function(){if(!this.container){this.content.setStyle("overflow","hidden");this.container=new Element("div",{styles:this.css.container}).inject(this.content)}},createMiddleContent:function(){if(!this.middleContent){this.middleContent=new Element("div.middleContent",{styles:this.css.middleContent}).inject(this.container)}},createLayout:function(){this.navi2="main";if(this.middleContent)this.middleContent.empty();this.leftContent=new Element("div.leftContent",{styles:this.css.leftContent}).inject(this.middleContent);this.leftTopContent=new Element("div",{styles:this.css.leftTopContent}).inject(this.leftContent);this.clearDiv=new Element("div",{styles:this.css.clearDiv}).inject(this.leftContent);this.createCategoryIconsVersion();this.leftBottomContent=new Element("div",{styles:this.css.leftBottomContent}).inject(this.leftContent);this.createTodoContentVersion();this.rightContent=new Element("div.rightContent",{styles:this.css.rightContent}).inject(this.middleContent);this.createMyStatVersion();this.rightBottomContent=new Element("div.rightBottomContent",{styles:this.css.rightBottomContent}).inject(this.rightContent);this.rightBottomContent.setStyle("display","");this.createRightBottomVersion();this.resizeContent()},createTopBarVersion:function(){this.createTopBar()},createTopBar:function(){this.currentTopBarTab="work";if(this.topBar){this.topBar.empty()}else{this.topBar=new Element("div.topBar",{styles:this.css.topBar}).inject(this.container)}this.topBarContent=new Element("div",{styles:this.css.topBarContent}).inject(this.topBar);this.topBarTitleLi=new Element("li",{styles:this.css.topBarTitleLi}).inject(this.topBarContent);this.topBarLog=new Element("img",{styles:this.css.topBarLog,src:this.path+"default/icon/okr.png"}).inject(this.topBarTitleLi);this.topBarTitleSpan=new Element("span",{styles:this.css.topBarTitleSpan,text:MWF.xApplication.Execution.LP.topBar.title}).inject(this.topBarTitleLi);this.topBarWorkLi=new Element("li.topBarWorkLi",{styles:this.css.topBarCurrentLi}).inject(this.topBarContent);this.topBarWorkLi.addEvents({mouseover:function(){if(this.currentTopBarTab!="work")this.topBarWorkLi.setStyles({"background-color":"#124c93"})}.bind(this),mouseout:function(){if(this.currentTopBarTab!="work")this.topBarWorkLi.setStyles({"background-color":"#5c97e1"})}.bind(this),click:function(){this.openContent("work")}.bind(this)});this.topBarWorkImg=new Element("img",{styles:this.css.topBarWorkImg,src:this.path+"default/icon/Outline-104.png"}).inject(this.topBarWorkLi);this.topBarWorkSpan=new Element("span",{styles:this.css.topBarWorkSpan,text:MWF.xApplication.Execution.LP.topBar.work}).inject(this.topBarWorkLi);this.topBarXmindLi=new Element("li.topBarXmindLi",{styles:this.css.topBarLi}).inject(this.topBarContent);this.topBarXmindImg=new Element("img",{styles:this.css.topBarXmindImg,src:this.path+"default/icon/MindMapFilled-100.png"}).inject(this.topBarXmindLi);this.topBarXmindSpan=new Element("span",{styles:this.css.topBarXmindSpan,text:MWF.xApplication.Execution.LP.topBar.xmind}).inject(this.topBarXmindLi);this.topBarXmindLi.addEvents({mouseover:function(){if(this.currentTopBarTab!="xmind")this.topBarXmindLi.setStyles({"background-color":"#124c93"})}.bind(this),mouseout:function(){if(this.currentTopBarTab!="xmind")this.topBarXmindLi.setStyles({"background-color":"#5c97e1"})}.bind(this),click:function(){this.openContent("xmind")}.bind(this)});this.topBarSettingLi=new Element("li.topBarSettingLi",{styles:this.css.topBarLi}).inject(this.topBarContent);this.topBarSettingImg=new Element("img",{styles:this.css.topBarXmindImg,src:this.path+"default/icon/Maintenance-96.png"}).inject(this.topBarSettingLi);this.topBarSettingSpan=new Element("span",{styles:this.css.topBarXmindSpan,text:MWF.xApplication.Execution.LP.topBar.setting}).inject(this.topBarSettingLi);this.topBarSettingLi.addEvents({mouseover:function(){if(this.currentTopBarTab!="setting")this.topBarSettingLi.setStyles({"background-color":"#124c93"})}.bind(this),mouseout:function(){if(this.currentTopBarTab!="setting")this.topBarSettingLi.setStyles({"background-color":"#5c97e1"})}.bind(this),click:function(){this.openContent("setting")}.bind(this)});if(!this.okrSystemAdmin)this.topBarSettingLi.setStyle("display","none");this.topBarRight=new Element("div.toBarRight",{styles:this.css.topBarRight}).inject(this.topBar);this.topBarRightDeptLi=new Element("li",{styles:this.css.topBarRightDeptLi}).inject(this.topBarRight);this.topBarRightDeptImg=new Element("img",{styles:this.css.topBarRightDeptImg,src:this.path+"default/icon/Home-96.png"}).inject(this.topBarRightDeptLi);this.topBarRightDeptSpan=new Element("span",{styles:this.css.topBarRightDeptSpan,text:this.department}).inject(this.topBarRightDeptLi);if(this.userGender=="f")this.userFace=this.path+"default/icon/UserFemale-104.png";else this.userFace=this.path+"default/icon/UserMale-104.png";this.topBarRightPersonLi=new Element("li",{styles:this.css.topBarRightPersonLi}).inject(this.topBarRight);this.topBarRightPersonImg=new Element("img",{styles:this.css.topBarRightPersonImg,src:this.userFace}).inject(this.topBarRightPersonLi);this.topBarRightPersonSpan=new Element("span",{styles:this.css.topBarRightPersonSpan,text:this.trueUserName}).inject(this.topBarRightPersonLi);if(this.identites.length>1){this.topBarRightChangeUserLi=new Element("li",{styles:this.css.topBarRightOutLi}).inject(this.topBarRight).addEvents({click:function(){this.changeIdentity()}.bind(this)});this.topBarRightChangeUserImg=new Element("img",{styles:this.css.topBarRightOutImg,src:this.path+"default/icon/ChangeUser.png"}).inject(this.topBarRightChangeUserLi);this.topBarRightChangeUserSpan=new Element("span",{styles:this.css.topBarRightOutSpan,text:MWF.xApplication.Execution.LP.changeUser}).inject(this.topBarRightChangeUserLi)}this.topBarRightLastLi=new Element("li",{styles:this.css.topBarRightLastLi}).inject(this.topBarRight);this.topBarRightLastImg=new Element("img",{styles:this.css.topBarRightLastImg,src:this.path+"default/icon/BulletedListFilled-100.png"}).inject(this.topBarRightLastLi)},createCategoryIconsVersion:function(){this.createCategoryIcons()},createCategoryIcons:function(){this.categoryIconsUl=new Element("ul",{styles:this.css.categoryIconsUl}).inject(this.leftTopContent);this.createCategoryNode(this.path+"default/icon/Checklist-100.png",MWF.xApplication.Execution.LP.categoryIcon.span1,"categoryIconsLi");this.createCategoryNode(this.path+"default/icon/ConferenceCall-104.png",MWF.xApplication.Execution.LP.categoryIcon.span2,"categoryIconsLi");if(this.okrSystemAdmin||this.companyAdmin.indexOf(this.identity)>-1){this.createCategoryNode(this.path+"default/icon/AreaChart Filled-100.png",MWF.xApplication.Execution.LP.categoryIcon.span5,"categoryIconsLiRight")}},createTodoContentVersion:function(){this.createTodoContent2()},createTodoContent2:function(){this.todoMenuDiv=new Element("div",{styles:this.css.todoMenuDiv}).inject(this.leftBottomContent);this.todoMenuLeftDiv=new Element("div",{styles:this.css.todoMenuLeftDiv}).inject(this.todoMenuDiv);this.todoMenuLeftImg=new Element("img",{styles:this.css.todoMenuLeftImg,src:this.path+"default/icon/Outline-104.png"}).inject(this.todoMenuLeftDiv);this.todoMenuLeftSpan=new Element("span",{styles:this.css.todoMenuLeftSpan,text:MWF.xApplication.Execution.LP.todoMenu.title}).inject(this.todoMenuLeftDiv);this.todoMenuRightDiv=new Element("div.todoMenuRightDiv",{styles:this.css.todoMenuRightDiv}).inject(this.todoMenuDiv);this.todoMenuDo=new Element("li.todoMenuDo",{styles:this.css.todoMenuDo,text:this.lp.main.todoMenuDo}).inject(this.todoMenuRightDiv);this.todoMenuDoCount=new Element("span.todoMenuDoCount",{styles:this.css.todoMenuDoCount}).inject(this.todoMenuDo);if(this.workTabSwitch&&this.workTabSwitch=="OPEN"){this.todoMenuWork=new Element("li.todoMenuWork",{styles:this.css.todoMenuWork,text:this.lp.main.todoMenuWork}).inject(this.todoMenuRightDiv);this.todoMenuWorkCount=new Element("span.todoMenuWorkCount",{styles:this.css.todoMenuWorkCount}).inject(this.todoMenuWork)}this.todoList=new Element("div.todoList",{styles:this.css.todoList}).inject(this.leftBottomContent);this.todoListDiv=new Element("div.todoListDiv",{styles:this.css.todoListDiv}).inject(this.todoList);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.todoListDiv,{indent:false,style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(t){var i=this.todoListDiv.getScrollSize();var e=this.todoListDiv.getSize();var o=i.y-e.y;var n=this.todoView||this.workView;if(t+200>o&&n&&n.loadElementList){if(!n.isItemsLoaded)n.loadElementList()}}.bind(this)})}.bind(this));_selfToDo=this;this.todoMenuRightDiv.getElements("li").addEvents({click:function(t){_selfToDo.changeTodoTab(this)}});this.getTodoCount();this.createTodoList()},createTodoContent:function(){this.todoMenuDiv=new Element("div",{styles:this.css.todoMenuDiv}).inject(this.leftBottomContent);this.todoMenuLeftDiv=new Element("div",{styles:this.css.todoMenuLeftDiv}).inject(this.todoMenuDiv);this.todoMenuLeftImg=new Element("img",{styles:this.css.todoMenuLeftImg,src:this.path+"default/icon/Outline-104.png"}).inject(this.todoMenuLeftDiv);this.todoMenuLeftSpan=new Element("span",{styles:this.css.todoMenuLeftSpan,text:MWF.xApplication.Execution.LP.todoMenu.title}).inject(this.todoMenuLeftDiv);this.todoMenuRightDiv=new Element("div.todoMenuRightDiv",{styles:this.css.todoMenuRightDiv}).inject(this.todoMenuDiv);this.todoMenuRightDiv.setStyle("display","none");this.todoMenuRightLi=new Element("li",{styles:this.css.todoMenuRightCurrentLi,text:MWF.xApplication.Execution.LP.todoMenu.all}).inject(this.todoMenuRightDiv);this.todoMenuRightLi=new Element("li",{styles:this.css.todoMenuRightLi,text:MWF.xApplication.Execution.LP.todoMenu.workTask}).inject(this.todoMenuRightDiv);this.todoMenuRightLi=new Element("li",{styles:this.css.todoMenuRightLi,text:MWF.xApplication.Execution.LP.todoMenu.workReport}).inject(this.todoMenuRightDiv);this.todoMenuRightLi=new Element("li",{styles:this.css.todoMenuRightLiLast,text:MWF.xApplication.Execution.LP.todoMenu.workProblem}).inject(this.todoMenuRightDiv);this.todoList=new Element("div.todoList",{styles:this.css.todoList}).inject(this.leftBottomContent);this.todoListDiv=new Element("div.todoListDiv",{styles:this.css.todoListDiv}).inject(this.todoList);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.todoListDiv,{indent:false,style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(t){var i=this.todoListDiv.getScrollSize();var e=this.todoListDiv.getSize();var o=i.y-e.y;var n=this.todoView;if(t+200>o&&n&&n.loadElementList){if(!n.isItemsLoaded)n.loadElementList()}}.bind(this)})}.bind(this));this.createTodoList()},createMyStatVersion:function(){this.rightTopContent=new Element("div.rightTopContent",{styles:this.css.rightTopContent}).inject(this.rightContent);if(this.statSwitch&&this.statSwitch=="PROMPTNESSRATE"){this.createMyStat()}},createMyStat:function(){var t=0;var i=0;var e=0;var o="100%";this.restActions.getMyStat(function(n){if(n.data&&n.data.responProcessingWorkCount)t=n.data.responProcessingWorkCount;if(n.data&&n.data.overtimeResponWorkCount)i=n.data.overtimeResponWorkCount;if(n.data&&n.data.responCompletedWorkCount)e=n.data.responCompletedWorkCount;if(n.data&&n.data.percent)o=parseInt(n.data.percent)*100}.bind(this),null,false);this.rightTopTable=new Element("table.rightTopTable",{styles:this.css.rightTopTable,border:"0"}).inject(this.rightTopContent);var n=new Element("tr").inject(this.rightTopTable);var s=new Element("td",{colspan:"4"}).inject(n);this.rightTopTdImg=new Element("img",{styles:this.css.rightTopTdImg,src:this.path+"default/icon/PieChart-104.png"}).inject(s);this.rightTopTdSpan=new Element("span",{styles:this.css.rightTopTdSpan,text:MWF.xApplication.Execution.LP.rightTop.title}).inject(s);n=new Element("tr").inject(this.rightTopTable);rightTopNumTd=new Element("td",{styles:this.css.rightTopNumTd}).inject(n);this.rightTopFlowSpan=new Element("span",{styles:this.css.rightTopFlowSpan,text:t}).inject(rightTopNumTd);rightTopNumTd=new Element("td",{styles:this.css.rightTopNumTd}).inject(n);this.rightTopCompletedSpan=new Element("span",{styles:this.css.rightTopCompletedSpan,text:i}).inject(rightTopNumTd);rightTopNumTd=new Element("td",{styles:this.css.rightTopNumTd}).inject(n);this.rightTopOverTimeSpan=new Element("span",{styles:this.css.rightTopOverTimeSpan,text:e}).inject(rightTopNumTd);this.rightTopRateTd=new Element("td",{width:"80",align:"right"}).inject(n);this.rightTopRateSpan=new Element("span",{styles:this.css.rightTopRateSpan,text:o}).inject(this.rightTopRateTd);n=new Element("tr").inject(this.rightTopTable);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.flow}).inject(n);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.overTime}).inject(n);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.completed}).inject(n);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"right",text:MWF.xApplication.Execution.LP.rightTop.rate}).inject(n)},createContentDiv:function(){this.rightTopTable=new Element("table.rightTopTable",{styles:this.css.rightTopTable,border:"0"}).inject(this.rightTopContent);this.rightTopTable.setStyle("display","none");var t=new Element("tr").inject(this.rightTopTable);var i=new Element("td",{colspan:"4"}).inject(t);this.rightTopTdImg=new Element("img",{styles:this.css.rightTopTdImg,src:this.path+"default/icon/PieChart-104.png"}).inject(i);this.rightTopTdSpan=new Element("span",{styles:this.css.rightTopTdSpan,text:MWF.xApplication.Execution.LP.rightTop.title}).inject(i);t=new Element("tr").inject(this.rightTopTable);rightTopNumTd=new Element("td",{styles:this.css.rightTopNumTd}).inject(t);this.rightTopFlowSpan=new Element("span",{styles:this.css.rightTopFlowSpan,text:"11"}).inject(rightTopNumTd);rightTopNumTd=new Element("td",{styles:this.css.rightTopNumTd}).inject(t);this.rightTopCompletedSpan=new Element("span",{styles:this.css.rightTopCompletedSpan,text:"9"}).inject(rightTopNumTd);rightTopNumTd=new Element("td",{styles:this.css.rightTopNumTd}).inject(t);this.rightTopOverTimeSpan=new Element("span",{styles:this.css.rightTopOverTimeSpan,text:"16"}).inject(rightTopNumTd);this.rightTopRateTd=new Element("td",{width:"80",align:"right"}).inject(t);this.rightTopRateSpan=new Element("span",{styles:this.css.rightTopRateSpan,text:"71.75"}).inject(this.rightTopRateTd);t=new Element("tr").inject(this.rightTopTable);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.flow}).inject(t);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.overTime}).inject(t);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.completed}).inject(t);rightTopTextTd=new Element("td",{styles:this.css.rightTopTextTd,width:"80",align:"right",text:MWF.xApplication.Execution.LP.rightTop.rate}).inject(t)},createRightBottomVersion:function(){this.workConditionMenuDiv=new Element("div.createRightBottom",{styles:this.css.workConditionMenuDiv}).inject(this.rightBottomContent);this.createRightBottom()},createRightBottom:function(){this.workConditionMenuTitleDiv=new Element("div.workConditionMenuTitleDiv",{styles:this.css.workConditionMenuTitleDiv}).inject(this.workConditionMenuDiv);this.workConditionMenuTitleImg=new Element("img",{styles:this.css.workConditionMenuTitleImg,src:this.path+"default/icon/AppointmentReminders-96.png"}).inject(this.workConditionMenuTitleDiv);this.workConditionMenuTitleSpan=new Element("span",{styles:this.css.workConditionMenuTitleSpan,text:MWF.xApplication.Execution.LP.workConditionMenuTitle}).inject(this.workConditionMenuTitleDiv);this.workConditionMenuMoreDiv=new Element("div",{styles:this.css.workConditionMenuMoreDiv}).inject(this.workConditionMenuDiv);this.workConditionMenuMoreLi=new Element("li",{styles:this.css.workConditionMenuMoreLi}).inject(this.workConditionMenuMoreDiv);this.createWorkConditionContentDiv()},loadTopBarTab:function(t){if(t=="work"){this.topBarWorkLi.setStyles({"background-color":"#124c93"});this.topBarXmindLi.setStyles({"background-color":"#5c97e1"});this.topBarSettingLi.setStyles({"background-color":"#5c97e1"})}else if(t=="xmind"){this.topBarWorkLi.setStyles({"background-color":"#5c97e1"});this.topBarXmindLi.setStyles({"background-color":"#124c93"});this.topBarSettingLi.setStyles({"background-color":"#5c97e1"})}else if(t=="setting"){this.topBarWorkLi.setStyles({"background-color":"#5c97e1"});this.topBarXmindLi.setStyles({"background-color":"#5c97e1"});this.topBarSettingLi.setStyles({"background-color":"#124c93"})}},createCategoryNode:function(t,i,e){var o=new Element("li.categoryIcons",{styles:this.css[e]}).inject(this.categoryIconsUl);o.addEvents({mouseover:function(){this.setStyles({"background-color":"#124c93"})},mouseout:function(){this.setStyles({"background-color":"#407ac1"})},click:function(){if(i==MWF.xApplication.Execution.LP.categoryIcon.span1){this.openTask()}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span2){this.openWorkReport()}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span3){}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span4){}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span5){this.openStat()}}.bind(this)});var n=new Element("img.categoryIconsImg",{styles:this.css.categoryIconsImg,src:t}).inject(o);var s=new Element("span.categoryIconsSpan",{styles:this.css.categoryIconsSpan,text:i}).inject(o)},getTodoCount:function(){this.restActions.getBaseWorkListMyDoNext("(0)",10,null,function(t){if(this.todoMenuWorkCount&&t.count)this.todoMenuWorkCount.set("text","("+t.count+")")}.bind(this))},changeTodoTab:function(t){if(t.className=="todoMenuDo"){t.setStyles({"background-color":"#0f72c2"});if(this.todoMenuWork)this.todoMenuWork.setStyles({"background-color":""});this.createTodoList()}if(t.className=="todoMenuWork"){t.setStyles({"background-color":"#0f72c2"});if(this.todoMenuDo)this.todoMenuDo.setStyles({"background-color":""});this.createWorkList()}},createTodoList:function(t){if(this.workView)delete this.workView;if(this.todoListDiv){this.todoListDiv.empty();var i={};this.todoView=new MWF.xApplication.Execution.TodoView(this.todoListDiv,this,this,{templateUrl:this.path+"todoList.json",category:t,filterData:i});this.todoView.load()}},createWorkList:function(t){if(this.todoView)delete this.todoView;if(this.todoListDiv){this.todoListDiv.empty();var i={};this.workView=new MWF.xApplication.Execution.WorkView(this.todoListDiv,this,this,{templateUrl:this.path+"workList.json",category:t,filterData:i});this.workView.load()}},createWorkConditionContentDiv:function(){if(this.workConditionContentDiv)this.workConditionContentDiv.destroy();this.workConditionContentDiv=new Element("div",{styles:this.css.workConditionContentDiv}).inject(this.rightBottomContent);this.workConditionListDiv=new Element("div.workConditionListDiv",{styles:this.css.workConditionListDiv}).inject(this.workConditionContentDiv);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.workConditionListDiv,{indent:false,style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(t){var i=this.workConditionListDiv.getScrollSize();var e=this.workConditionListDiv.getSize();var o=i.y-e.y;var n=this.workConditionView;if(t+200>o&&n&&n.loadElementList){if(!n.isItemsLoaded){n.loadElementList()}}}.bind(this)})}.bind(this));if(this.workConditionListDiv)this.workConditionListDiv.empty();this.workConditionView=new MWF.xApplication.Execution.WorkConditionView(this.workConditionListDiv,this,this,{templateUrl:this.path+"workConditionList.json"});this.workConditionView.load()}});MWF.xApplication.Execution.IdenitySelector=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"500",height:"300",hasTop:true,hasIcon:false,hasBottom:true,title:"",draggable:false,closeAction:false,closeText:"",needLogout:false,isNew:true},initialize:function(t,i,e,o,n){this.setOptions(n);this.app=t;this.actions=this.app.restActions;this.css=o;this.options.title=this.app.lp.idenitySelectTitle;this.identities=e;this.actions=i},load:function(){this.create()},createTopNode:function(){if(!this.formTopNode){this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode);this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNode}).inject(this.formTopNode);this.formTopTextNode=new Element("div",{styles:this.css.formTopTextNode,text:this.options.title}).inject(this.formTopNode);if(this.options.closeAction){this.formTopCloseActionNode=new Element("div",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode);this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))}this.formTopContentNode=new Element("div",{styles:this.css.formTopContentNode}).inject(this.formTopNode);this._createTopContent()}},_createTableContent:function(){var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0"}).inject(this.formTableArea);var i=new Element("tr").inject(t);var e=new Element("td",{valign:"middle"}).inject(i);this.identities.each(function(t){var i=new Element("div",{styles:this.css.identitySelNode,text:t}).inject(e);i.store("id",t);i.addEvents({mouseover:function(t){if(this.selectedNode!=t.target)t.target.setStyles(this.css.identitySelNode_over)}.bind(this),mouseout:function(t){if(this.selectedNode!=t.target)t.target.setStyles(this.css.identitySelNode_out)}.bind(this),click:function(t){this.selected(t.target)}.bind(this),dblclick:function(t){this.selectedNode=t.target;this.ok()}.bind(this)})}.bind(this))},selected:function(t){if(this.selectedNode)this.selectedNode.setStyles(this.css.identitySelNode);this.selectedNode=t;t.setStyles(this.css.identitySelNode_selected)},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.options.closeText}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(t){this.cancel(t)}.bind(this));this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.comfirm}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))},cancel:function(){this.fireEvent("postSelectorClose")},ok:function(t,i){if(!this.selectedNode){this.app.notice(this.app.lp.idenitySelecNotice,"error")}else{var e={};e.loginIdentity=this.selectedNode.retrieve("id");if(this.options.needLogout){this.actions.logout({},function(t){if(t.type&&t.type=="success"){this.actions.login(e,function(t){if(t.data&&t.data.okrSystemAdmin){this.app.okrSystemAdmin=t.data.okrSystemAdmin}this.fireEvent("postSelectorOk",e.loginIdentity);this.close()}.bind(this),function(t,i,e){}.bind(this),false)}}.bind(this),null,false)}else{this.actions.login(e,function(t){if(t.data&&t.data.okrSystemAdmin){this.app.okrSystemAdmin=t.data.okrSystemAdmin}this.fireEvent("postSelectorOk",e.loginIdentity);this.close()}.bind(this),null,false)}}}});MWF.xApplication.Execution.TodoView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.TodoDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,i){var e=this.options.category;if(!i)i=20;var o=this.items.length?this.items[this.items.length-1].data.id:"(0)";var n=this.options.filterData||{};this.actions.getTaskListNext(o,i,n,function(i){if(this.explorer.todoMenuDoCount&&i.count)this.explorer.todoMenuDoCount.set("text","("+i.count+")");if(t)t(i)}.bind(this),function(t,i,e){}.bind(this))},_openDocument:function(t){if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.report){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var i={workReportId:t.dynamicObjectId,workId:t.workId};this.workReport=new MWF.xApplication.Execution.WorkReport(this,this.actions,i,{isEdited:false,onReloadView:function(t){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workReport.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.deploy){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){this.workDeploy=new MWF.xApplication.Execution.WorkDeploy(this,this.actions,{id:t.dynamicObjectId},{isEdited:false,centerWorkId:t.dynamicObjectId,
onReloadView:function(t){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workDeploy.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.gather){MWF.xDesktop.requireApp("Execution","WorkGather",function(){var i={gatherId:t.id,title:t.dynamicObjectTitle};this.workGather=new MWF.xApplication.Execution.WorkGather(this,this.actions,i,{onReloadView:function(t){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workGather.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.readReport){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var i={todoId:t.id,workReportId:t.dynamicObjectId,workId:t.workId};this.workReport=new MWF.xApplication.Execution.WorkReport(this,this.actions,i,{isEdited:false,isRead:true,onReloadView:function(t){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workReport.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.reportDrafter){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var i={todoId:t.id,workReportId:t.dynamicObjectId,workId:t.workId};this.workReport=new MWF.xApplication.Execution.WorkReport(this,this.actions,i,{isEdited:false,onReloadView:function(t){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workReport.load()}.bind(this))}}});MWF.xApplication.Execution.TodoDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument});MWF.xApplication.Execution.WorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,i){var e=this.options.category;if(!i)i=20;var o=this.items.length?this.items[this.items.length-1].data.id:"(0)";var n=this.options.filterData||{};this.actions.getBaseWorkListMyDoNext(o,i,n,function(i){if(this.explorer.todoMenuWorkCount&&i.count)this.explorer.todoMenuWorkCount.set("text","("+i.count+")");if(t)t(i)}.bind(this))},_openDocument:function(t){MWF.xDesktop.requireApp("Execution","WorkDetail",function(){var i=new MWF.xApplication.Execution.WorkDetail(this,this.app.restActions,t,{isNew:false,isEdited:false});i.load()}.bind(this))}});MWF.xApplication.Execution.WorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_postCreateDocumentNode:function(t,i){var e=t.getElement("div[class='barPercentDiv']");if(e){if(i.overallProgress){var o=parseFloat(i.overallProgress)*100;o=o.toFixed(2);var n="#0099ff";if(i.isOverTime)n="#f00";e.setStyles({width:o+"%","background-color":n});t.set("title",o+"%")}}}});MWF.xApplication.Execution.WorkConditionView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkConditionDocument(this.viewNode,t,this.explorer,this)},loadElementList:function(t){if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(t){var i=t.count;if(i<=this.items.length){this.isItemsLoaded=true}t.data.each(function(t){if(!this.documents[t.id]){var i=this._createDocument(t);this.items.push(i);this.documents[t.id]=i}}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.loadElementList()}}.bind(this),t)}else{this.loadItemQueue++}}},parseEmotion:function(t){t.content=t.content.replace(/\[emotion=(.*?)\]/g,function(t,i){var e=MWF.defaultPath+"/widget/$SimpleEditor/default/img/emotion/";return"<img imagename='"+i+"' style='cursor:pointer;border:0;padding:2px;' "+" class='MWF_editor_emotion' src='"+e+i+".gif"+"'>"}.bind(this))},_getCurrentPageData:function(t,i){var e=this.options.category;if(!i)i=15;var o=this.items.length?this.items[this.items.length-1].data.id:"(0)";var n=this.options.filterData||{};this.actions.getWorkConditionListNext(o,i,n,function(i){i.data.each(function(t){this.parseEmotion(t)}.bind(this));if(t)t(i)}.bind(this))}});MWF.xApplication.Execution.WorkConditionDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument});