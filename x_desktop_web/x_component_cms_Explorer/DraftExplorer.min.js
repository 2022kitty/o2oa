MWF.xDesktop.requireApp("cms.Explorer","Explorer",null,false);MWF.xApplication.cms.Explorer.DraftExplorer=new Class({Extends:MWF.xApplication.cms.Explorer.Explorer,Implements:[Options,Events],options:{style:"default",status:"draft",tooltip:{}},initialize:function(t,e,s){this.setOptions(s);this.setTooltip();this.path="/x_component_cms_Explorer/$DraftExplorer/";this.cssPath="/x_component_cms_Explorer/$DraftExplorer/"+this.options.style+"/css.wcss";this._loadCss();this.actions=e;this.node=$(t);this.initData();if(!this.personActions)this.personActions=new MWF.xAction.org.express.RestActions},load:function(){this.toolbarNode=new Element("div",{styles:this.css.toolbarNode});this.toolbarNode.inject(this.node);this.loadToolbar();this.filterConditionNode=new Element("div",{styles:this.css.filterConditionNode}).inject(this.node);this.loadContentNode();this.setNodeScroll();this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.node);this.loadElementList()},_createItem:function(t){return new MWF.xApplication.cms.Explorer.DraftExplorer.Document(t,this)},_getCurrentPageData:function(t,e){var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";if(this.filter&&this.filter.filter){this.actions.listDraftNext(s,e||this.pageCount,this.filter.getFilterResult(),function(e){if(t)t(e)})}else{this.actions.listDraftNext(s,e||this.pageCount,{},function(e){if(t)t(e)})}},createDocument:function(t){if(!this.startDocumentAreaNode){this.createStartDocumentArea()}this.startDocumentAreaNode.fade("0.9")},closeStartDocumentArea:function(){if(this.startDocumentAreaNode)this.startDocumentAreaNode.fade("out")},createStartDocumentArea:function(){this.createStartDocumentAreaNode();this.createStartDocumentCloseNode();this.createStartDocumentScrollNode();this.listColumns();this.setResizeStartDocumentAreaHeight();this.app.addEvent("resize",this.setResizeStartDocumentAreaHeight.bind(this))},createStartDocumentAreaNode:function(){this.startDocumentAreaNode=new Element("div",{styles:this.css.startDocumentAreaNode}).inject(this.app.content);this.startDocumentAreaNode.addEvent("click",function(t){this.closeStartDocumentArea()}.bind(this))},createStartDocumentCloseNode:function(){this.startDocumentTopNode=new Element("div",{styles:this.css.startDocumentTopNode}).inject(this.startDocumentAreaNode);this.startDocumentCloseNode=new Element("div",{styles:this.css.startDocumentCloseNode}).inject(this.startDocumentTopNode);this.startDocumentCloseNode.addEvent("click",function(t){this.closeStartDocumentArea()}.bind(this))},createStartDocumentScrollNode:function(){this.startDocumentScrollNode=new Element("div",{styles:this.css.startDocumentScrollNode}).inject(this.startDocumentAreaNode);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.startDocumentScrollNode,{style:"xApp_taskcenter",where:"after",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));this.startDocumentContentNode=new Element("div",{styles:this.css.startDocumentContentNode}).inject(this.startDocumentScrollNode)},listColumns:function(){this.getAction(function(){this.action.listColumn(function(t){t.data.each(function(t){if(!t.name)t.name=t.appName;new MWF.xApplication.cms.Explorer.DraftExplorer.Column(t,this.app,this,this.startDocumentContentNode)}.bind(this))}.bind(this))}.bind(this))},getAction:function(t){if(!this.action){MWF.xDesktop.requireApp("cms.Explorer","Actions.RestActions",function(){this.action=new MWF.xApplication.cms.Explorer.Actions.RestActions;if(t)t()}.bind(this))}else{if(t)t()}},setResizeStartDocumentAreaHeight:function(){var t=this.app.content.getSize();if(this.startDocumentAreaNode){var e=this.startDocumentCloseNode.getSize();var s=t.y-e.y-80;var i=t.x-110;var o=t.y-60;var n=t.x-90;this.startDocumentScrollNode.setStyle("height",""+s+"px");this.startDocumentScrollNode.setStyle("width",""+i+"px");this.startDocumentAreaNode.setStyle("height",""+o+"px");this.startDocumentAreaNode.setStyle("width",""+n+"px")}}});MWF.xApplication.cms.Explorer.DraftExplorer.Document=new Class({Extends:MWF.xApplication.cms.Explorer.Explorer.Document,setActions:function(){this.openNode=new Element("div",{styles:this.css.actionOpenNode,title:this.explorer.app.lp.open}).inject(this.actionAreaNode);this.deleteNode=new Element("div",{styles:this.css.actionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode)}});MWF.xApplication.cms.Explorer.DraftExplorer.Column=new Class({initialize:function(t,e,s,i){this.bgColors=["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"];this.data=t;this.app=e;this.explorer=s;this.container=i;this.css=this.explorer.css;this.load()},load:function(){this.node=new Element("div",{styles:this.css.columnNode}).inject(this.container);this.topNode=new Element("div",{styles:this.css.columnTopNode}).inject(this.node);this.iconNode=new Element("div",{styles:this.css.columnIconNode}).inject(this.topNode);if(this.data.appIcon){this.iconNode.setStyle("background-image","url(data:image/png;base64,"+this.data.appIcon+")")}else{this.iconNode.setStyle("background-image","url("+"/x_component_cms_Column/$Main/"+this.app.options.style+"/icon/column.png)")}this.textNode=new Element("div",{styles:this.css.columnTextNode}).inject(this.topNode);this.textNode.set("text",this.data.name);this.childNode=new Element("div",{styles:this.css.columnChildNode}).inject(this.node);this.loadChild()},loadChild:function(){this.explorer.action.listCategory(this.data.id,function(t){if(t.data.length){t.data.each(function(t){new MWF.xApplication.cms.Explorer.DraftExplorer.Category(t,this,this.childNode)}.bind(this))}else{this.node.setStyle("display","none")}}.bind(this),null,this.data.id)}});MWF.xApplication.cms.Explorer.DraftExplorer.Category=new Class({initialize:function(t,e,s){this.data=t;this.column=e;this.app=this.column.app;this.explorer=this.column.explorer;this.container=s;this.css=this.explorer.css;this.load()},load:function(){this.node=new Element("div.categoryItem",{styles:this.css.startCategoryNode}).inject(this.container);this.iconNode=new Element("div",{styles:this.css.categoryIconNode}).inject(this.node);this.textNode=new Element("div",{styles:this.css.categoryTextNode}).inject(this.node);this.textNode.set({text:this.data.name,title:this.data.name+"-"+this.data.description});var t=this;this.node.addEvents({mouseover:function(t){this.node.setStyles(this.css.startCategoryNode_over)}.bind(this),mouseout:function(t){this.node.setStyles(this.css.startCategoryNode_out)}.bind(this),click:function(t){this.startCategory(t)}.bind(this)})},startCategory:function(t){this.explorer.closeStartDocumentArea();MWF.xDesktop.requireApp("cms.Explorer","Starter",function(){var t=new MWF.xApplication.cms.Explorer.Starter(this.column.data,this.data,this.app,{onStarted:function(t,e,s){this.afterStart(t,e,s)}.bind(this)});t.load()}.bind(this))},afterStart:function(t,e,s){var i={documentId:t.id};this.app.desktop.openApplication(null,"cms.Document",i)}});