MWF.xDesktop.requireApp("Setting","servers.DataServers",null,false);MWF.xApplication.Setting.servers=MWF.xApplication.Setting.servers||{};MWF.xApplication.Setting.servers.StorageServers=new Class({Extends:MWF.xApplication.Setting.servers.DataServers,Implements:[Options,Events],initialize:function(t){this.explorer=t;this.app=this.explorer.app;this.actions=this.app.actions;this.css=this.app.css;this.servers=[];this.content=this.explorer.storageServerContent;this.page=this.app.serverPage;this.load()},load:function(){this.actions.listStorageServer(function(t){t.data.each(function(t){this.servers.push(new MWF.xApplication.Setting.servers.StorageServer(this,t))}.bind(this));this.createAddAction();this.setServerAreaWidthFun=this.setServerAreaWidth.bind(this);this.addEvent("resize",this.setServerAreaWidthFun);this.addEvent("resize",function(){this.setStorageServerAreaWidth()}.bind(this))}.bind(this))},createServer:function(){var t={list:this,app:this.app,json:{contextList:[],planList:[]},node:this.createServerAction,name:"",reload:function(){this.list.servers.push(new MWF.xApplication.Setting.servers.StorageServer(this.list,this.json))}};var e=new MWF.xApplication.Setting.servers.StorageServer.Document(t)}});MWF.xApplication.Setting.servers.StorageServer=new Class({Extends:MWF.xApplication.Setting.servers.DataServer,Implements:[Events],initialize:function(t,e){this.list=t;this.app=this.list.app;this.json=e;this.container=this.list.content;this.css=this.app.css;this.name=this.json.name;this.load()},setServerText:function(){this.nameNode.set("text",this.json.name||"");this.hostNode.set("text",(this.json.host||"")+" : "+(this.json.port||""));this.adminNode.set("text",this.json.username||"");this.messageNode.set("text",this.json.message||"")},open:function(){new MWF.xApplication.Setting.servers.StorageServer.Document(this)},reload:function(){this.app.actions.getStorageServer(this.json.name,function(t){this.name=this.json.name;this.json=t.data;this.nameNode.set("text",this.json.name);this.hostNode.set("text",this.json.host+" : "+this.json.port);this.adminNode.set("text",this.json.username);this.messageNode.set("text",this.json.message)}.bind(this))}});MWF.xApplication.Setting.servers.StorageServer.Document=new Class({Extends:MWF.xApplication.Setting.servers.DataServer.Document,Implements:[Events],createBaseInfo:function(){this.inforAreaNode=new Element("div",{styles:this.css.applicationServerDocumentInforAreaNode}).inject(this.node);this.inforNode=new Element("div",{styles:this.css.dataServerDocumentInforNode}).inject(this.inforAreaNode);var t="<table cellSpacing='8px' width='90%' align='center'>"+"<tr><td width='160px'>name</td><td><input value='"+(this.json.name||"")+"'/></td></tr>"+"<tr><td>order</td><td><input value='"+(this.json.order||"0")+"'/></td></tr>"+"<tr><td>storageServiceType</td><td><select>"+"<option value='ftp' "+(this.json.storageServiceType=="ftp"?"selected":"")+">ftp</option>"+"</select></td></tr>"+"<tr><td>host</td><td><input value='"+(this.json.host||"")+"'/></td></tr>"+"<tr><td>port</td><td><input value='"+(this.json.port||"")+"'/></td></tr>"+"<tr><td>path</td><td><input value='"+(this.json.path||"")+"'/></td></tr>"+"<tr><td>username</td><td><input value='"+(this.json.username||"")+"'/></td></tr>"+"<tr><td>password</td><td><input type='password' value='"+(this.json.password||"")+"'/></td></tr>"+"</table>";this.inforNode.set("html",t);var e=this.inforNode.getElements("td");var s=this.inforNode.getElements("input");e.setStyles(this.css.applicationServerDocumentTdNode);s.setStyles(this.css.applicationServerDocumentInputNode)},saveDocument:function(){var t=this.inforNode.getElements("input");this.json.name=t[0].get("value");this.json.order=t[1].get("value");this.json.host=t[2].get("value");this.json.port=t[3].get("value");this.json.path=t[4].get("value");this.json.username=t[5].get("value");this.json.password=t[6].get("value");var e=this.inforNode.getElement("select");this.json.storageServiceType=e.options[e.selectedIndex].value;if(this.server.name){this.app.actions.updateStorageServer(this.server.name,this.json,function(){this.closeDocument();this.server.reload()}.bind(this))}else{this.app.actions.addStorageServer(this.json,function(){this.closeDocument();this.server.reload()}.bind(this))}},deleteDocument:function(t){var e=this;this.app.confirm("warn",t,this.app.lp.deleteStorageServer_title,this.app.lp.deleteStorageServer,"350","120",function(){e.app.actions.removeStorageServer(e.server.name,function(){this.closeDocument();this.server.destroy()}.bind(e));this.close()},function(){this.close()})}});