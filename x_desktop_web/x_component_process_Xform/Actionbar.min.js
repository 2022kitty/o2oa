MWF.xDesktop.requireApp("process.Xform","$Module",null,false);MWF.require("MWF.widget.Tree",null,false);MWF.xApplication.process.Xform.Actionbar=MWF.APPActionbar=new Class({Extends:MWF.APP$Module,_loadUserInterface:function(){if(this.form.json.mode=="Mobile"){this.node.empty()}else if(COMMON.Browser.Platform.isMobile){this.node.empty()}else{this.toolbarNode=this.node.getFirst("div");this.toolbarNode.empty();MWF.require("MWF.widget.Toolbar",function(){this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this);if(this.json.hideSystemTools){his.setCustomToolbars(this.json.tools,this.toolbarNode);this.toolbarWidget.load()}else{MWF.getJSON(this.form.path+"toolbars.json",function(t){this.setToolbars(t,this.toolbarNode,this.readonly);this.setCustomToolbars(this.json.tools,this.toolbarNode);this.toolbarWidget.load()}.bind(this),false)}}.bind(this))}},setCustomToolbars:function(t,o){t.each(function(t){var i=true;if(this.readonly){i=t.readShow}else{i=t.editShow}if(i){i=true;if(t.control){i=this.form.businessData.control[t.control]}if(t.condition){var e=this.form.Macro.exec(t.condition,this);i=!e}if(i){var s=new Element("div",{id:t.id,MWFnodetype:t.type,MWFButtonImage:this.form.path+""+this.form.options.style+"/actionbar/"+t.img,title:t.title,MWFButtonAction:"runCustomAction",MWFButtonText:t.text}).inject(o);if(t.actionScript){s.store("script",t.actionScript)}if(t.sub){var r=o.getLast();this.setCustomToolbars(t.sub,r)}}}}.bind(this))},setToolbars:function(t,o,i){debugger;t.each(function(t){var e=true;if(t.control){e=this.form.businessData.control[t.control]}if(t.id=="action_processWork"){if(!this.form.businessData.task){e=false}}if(i)if(!t.read)e=false;if(e){var s=new Element("div",{id:t.id,MWFnodetype:t.type,MWFButtonImage:this.form.path+""+this.form.options.style+"/actionbar/"+t.img,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(o);if(t.sub){var r=o.getLast();this.setToolbars(t.sub,r)}}}.bind(this))},runCustomAction:function(t){var o=t.node.retrieve("script");this.form.Macro.exec(o,this)},saveWork:function(){this.form.saveWork()},closeWork:function(){this.form.closeWork()},processWork:function(){this.form.processWork()},resetWork:function(){this.form.resetWork()},retractWork:function(t,o){this.form.retractWork(t,o)},rerouteWork:function(t,o){this.form.rerouteWork(t,o)},deleteWork:function(){this.form.deleteWork()},printWork:function(){this.form.printWork()}});