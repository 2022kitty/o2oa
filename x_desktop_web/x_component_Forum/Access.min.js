MWF.xApplication.Forum.IS_LOGIN=false;MWF.xApplication.Forum.ForumSetting=null;MWF.xApplication.Forum.RoleInfoList=[];MWF.xApplication.Forum.PermissionInfoList=[];MWF.xApplication.Forum.isBBSSystemAdmin=false;MWF.xApplication.Forum.Access=new Class({initialize:function(i,t,n){this.actions=i;this.lp=t;this.userName=n||layout.desktop.session.user.name;this.anonymous=this.userName=="anonymous";if(this.anonymous){this.actions.getRegisterMode(function(i){this.signUpMode=i.data.value}.bind(this),null,false)}if(!MWF.xApplication.Forum.ForumSetting){MWF.xApplication.Forum.ForumSetting={};this.actions.listCategoryAll(function(i){if(!i.data)i.data=[];i.data.each(function(i){MWF.xApplication.Forum.ForumSetting[i.id]=i}.bind(this))}.bind(this))}},login:function(i){if(!MWF.xApplication.Forum.IS_LOGIN){this.actions.login({},function(t){MWF.xApplication.Forum.RoleInfoList=t.data?t.data.roleInfoList:[];MWF.xApplication.Forum.PermissionInfoList=t.data?t.data.permissionInfoList:[];MWF.xApplication.Forum.IS_LOGIN=true;MWF.xApplication.Forum.isBBSSystemAdmin=t.data?t.data.isBBSSystemAdmin:false;if(i)i()}.bind(this))}else{if(i)i()}},isAnonymous:function(){return this.anonymous},isAnonymousDynamic:function(){var i=true;this.actions.authentication(function(t){if(t.data.tokenType=="anonymous"){this.userName=layout.desktop.session.user.name="anonymous";i=true}else{this.userName=layout.desktop.session.user.name=t.data.name;i=false}}.bind(this),null,false);return i},isAdmin:function(){return MWF.AC.isAdministrator()||MWF.xApplication.Forum.isBBSSystemAdmin},inArray:function(i,t,n){var e=false;if(typeOf(i)=="string")i=i.split(",");if(i.indexOf(n||this.userName)!=-1)e=true;if(t)t(e);return e},isForumViewer:function(i){var t=true;if(this.hasForumAdminAuthority(i,null,null,false)){return true}this.getCategoryData(i,function(i){if(i.forumVisiable!=this.lp.allPerson){if(MWF.xApplication.Forum.RoleInfoList.indexOf("FORUM_GUEST_"+i.id)==-1){t=false}}});return t},isSectionViewer:function(i){var t=true;if(this.hasSectionAdminAuthority(i,null,null,false)){return true}if(typeOf(i)=="string"){this.actions.getSection(i,function(i){var n=i.data;if(n.sectionVisiable!=this.lp.allPerson){if(MWF.xApplication.Forum.PermissionInfoList.indexOf("SECTION_VIEW_"+n.id)==-1){t=false}}}.bind(this),null,async)}else{var n=i;if(n.sectionVisiable!=this.lp.allPerson){if(MWF.xApplication.Forum.PermissionInfoList.indexOf("SECTION_VIEW_"+n.id)==-1){t=false}}}return t},isRecommender:function(i){var t=false;if(typeOf(i)=="string"){this.actions.getSection(i,function(i){var n=i.data;if(MWF.xApplication.Forum.RoleInfoList.indexOf("SECTION_RECOMMENDER_"+n.id)!=-1){t=true}else if(this.hasSectionAdminAuthority(n,null,null,false)){t=true}}.bind(this),null,async)}else{var n=i;if(MWF.xApplication.Forum.RoleInfoList.indexOf("SECTION_RECOMMENDER_"+n.id)!=-1){t=true}else if(this.hasSectionAdminAuthority(n,null,null,false)){t=true}}return t},isSubjectPublisher:function(i){var t=true;if(this.hasSectionAdminAuthority(i,null,null,false)){return true}if(typeOf(i)=="string"){this.actions.getSection(i,function(i){var n=i.data;if(n.subjectPublishAble!=this.lp.allPerson){if(MWF.xApplication.Forum.RoleInfoList.indexOf("SECTION_SUBJECT_PUBLISHER_"+n.id)==-1){t=false}}}.bind(this),null,async)}else{var n=i;if(n.subjectPublishAble!=this.lp.allPerson){if(MWF.xApplication.Forum.RoleInfoList.indexOf("SECTION_SUBJECT_PUBLISHER_"+n.id)==-1){t=false}}}return t},isReplyPublisher:function(i){var t=true;if(this.hasSectionAdminAuthority(i,null,null,false)){return true}if(typeOf(i)=="string"){this.actions.getSection(i,function(i){var n=i.data;if(n.replyPublishAble!=this.lp.allPerson){if(MWF.xApplication.Forum.RoleInfoList.indexOf("SECTION_REPLY_PUBLISHER_"+n.id)==-1){t=false}}}.bind(this),null,false)}else{var n=i;if(n.replyPublishAble!=this.lp.allPerson){if(MWF.xApplication.Forum.RoleInfoList.indexOf("SECTION_REPLY_PUBLISHER_"+n.id)==-1){t=false}}}return t},getCategoryData:function(i,t){if(typeOf(i)=="string"){if(MWF.xApplication.Forum.ForumSetting[i]){if(t)t(MWF.xApplication.Forum.ForumSetting[i])}else{this.actions.getCategory(i,function(n){MWF.xApplication.Forum.ForumSetting[i]=n.data;if(t)t(n.data)}.bind(this),null,false)}}else{if(!MWF.xApplication.Forum.ForumSetting[i.id]){MWF.xApplication.Forum.ForumSetting[i]=i}if(t)t(i)}},isForumManager:function(i,t,n,e){var s=false;this.getCategoryData(i,function(i){s=this.inArray(i.forumManagerName,t,n)}.bind(this));return s},isSectionManager:function(i,t,n,e){var s=false;if(typeOf(i)=="string"){this.actions.getSection(i,function(i){s=this.inArray(i.data.moderatorNames,t,n)}.bind(this),null,e)}else{s=this.inArray(i.moderatorNames,t,n)}return s},hasForumAdminAuthority:function(i,t,n,e){if(!n&&this.isAdmin()){if(t)t(true);return true}var s=false;s=this.isForumManager(i,function(i){if(t)t(i)}.bind(this),n,e);return s},hasSectionAdminAuthority:function(i,t,n,e){if(!n&&this.isAdmin()){if(t)t(true);return true}var s=false;var o=function(i){var o=i.moderatorNames;if(typeOf(o)=="string")o=o.split(",");if(o.indexOf(n||this.userName)!=-1)s=true;if(s){if(t)t(s)}else{s=this.isForumManager(i.forumId,function(i){if(t)t(i)}.bind(this),n,e)}}.bind(this);if(typeOf(i)=="string"){this.actions.getSection(i,function(i){o(i.data)}.bind(this),null,e)}else{o(i)}return s}});