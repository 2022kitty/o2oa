MWF.xApplication.Forum=MWF.xApplication.Forum||{};MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.require("MWF.widget.Identity",null,false);MWF.xApplication.Forum.Setting=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",index:0},initialize:function(e,t,i,s){this.setOptions(s);this.app=t;this.lp=t.lp;this.path="/x_component_Forum/$Setting/";this.loadCss();this.actions=i;this.node=$(e)},loadCss:function(){this.cssPath="/x_component_Forum/$Setting/"+this.options.style+"/css.wcss";this._loadCss()},load:function(){this.createNaviContent();this.createContentDiv();this.resizeWindowFun=this.resizeWindow.bind(this);this.resizeWindow();this.app.addEvent("resize",this.resizeWindowFun)},destroy:function(){if(this.contentDiv)this.contentDiv.empty();if(this.explorer){this.explorer.destroy();delete this.explorer}if(this.resizeWindowFun)this.app.removeEvent("resize",this.resizeWindowFun);this.node.empty();delete this},resizeWindow:function(){var e=this.app.node.getSize();var t=this.app.topNode?this.app.topNode.getSize():{x:0,y:0};var i=e.y-t.y;this.naviDiv.setStyles({height:i+"px"});this.naviContentDiv.setStyles({height:i-120+"px"});this.contentDiv.setStyles({height:i+"px"})},createNaviContent:function(){this.naviDiv=new Element("div.naviDiv",{styles:this.css.naviDiv}).inject(this.node);this.naviTitleDiv=new Element("div.naviTitleDiv",{styles:this.css.naviTitleDiv,text:this.lp.setting}).inject(this.naviDiv);this.naviContentDiv=new Element("div.naviContentDiv",{styles:this.css.naviContentDiv}).inject(this.naviDiv);this.naviBottomDiv=new Element("div.naviBottomDiv",{styles:this.css.naviBottomDiv}).inject(this.naviDiv);var e=this.path+"navi.json";MWF.getJSON(e,function(e){e.each(function(e,t){var i=new Element("li.naviContentLi",{styles:this.css.naviContentLi}).inject(this.naviContentDiv);i.addEvents({mouseover:function(e){if(this.bindObj.currentNaviItem!=this.node)this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi_over,node:i,bindObj:this}),mouseout:function(e){if(this.bindObj.currentNaviItem!=this.node)this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi,node:i,bindObj:this}),click:function(e){if(this.bindObj.currentNaviItem)this.bindObj.currentNaviItem.setStyles(this.bindObj.css.naviContentLi);this.node.setStyles(this.styles);this.bindObj.currentNaviItem=this.node;this.node.store("index",t);if(this.action&&this.bindObj[this.action])this.bindObj[this.action]()}.bind({styles:this.css.naviContentLi_current,node:i,bindObj:this,action:e.action})});var s=new Element("img.naviContentImg",{styles:this.css.naviContentImg,src:this.path+this.options.style+"/icon/"+e.icon}).inject(i);var o=new Element("span.naviContentSpan",{styles:this.css.naviContentSpan,text:e.title}).inject(i);if(t==this.options.index)i.click()}.bind(this))}.bind(this))},createContentDiv:function(){this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.node)},openCategorySetting:function(){if(this.contentDiv)this.contentDiv.empty();if(this.explorer){this.explorer.destroy();delete this.explorer}this.explorer=new MWF.xApplication.Forum.Setting.CategorySettingExplorer(this.contentDiv,this.app,this,{style:this.options.style});this.explorer.load()},openSectionSetting:function(){if(this.contentDiv)this.contentDiv.empty();if(this.explorer){this.explorer.destroy();delete this.explorer}this.explorer=new MWF.xApplication.Forum.Setting.SectionSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style});this.explorer.load()},openSystemSetting:function(){if(this.contentDiv)this.contentDiv.empty();if(this.explorer){this.explorer.destroy();delete this.explorer}this.explorer=new MWF.xApplication.Forum.Setting.SystemSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style});this.explorer.load()},openRoleSetting:function(){if(this.contentDiv)this.contentDiv.empty();if(this.explorer){this.explorer.destroy();delete this.explorer}this.explorer=new MWF.xApplication.Forum.Setting.RoleSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style});this.explorer.load()},openPermissionSetting:function(){if(this.contentDiv)this.contentDiv.empty();if(this.explorer){this.explorer.destroy();delete this.explorer}this.explorer=new MWF.xApplication.Forum.Setting.PermissionSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style});this.explorer.load()},selectPerson:function(e,t,i){if(t=="person"){var s=this.lp.selectPerson}else if(t=="department"){s=this.lp.selectDepartment}else if(t=="company"){s=this.lp.selectCompany}MWF.xDesktop.requireApp("Organization","Selector.package",null,false);var o=e.get("text").split(",");var n={type:t,title:s,count:i,names:o||[],onComplete:function(t){var i=[];t.each(function(e){i.push(e.data.name)}.bind(this));e.set("text",i.join(","))}.bind(this)};var l=new MWF.OrgSelector(this.app.content,n)}});MWF.xApplication.Forum.Setting.CategorySettingExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(e,t,i,s){this.container=e;this.parent=i;this.app=t;this.css=this.parent.css;this.lp=this.app.lp},load:function(){this.container.empty();if(this.app.access.isAdmin()){this.loadToolbar()}this.loadView()},destroy:function(){if(this.resizeWindowFun)this.app.removeEvent("resize",this.resizeWindowFun);this.view.destroy()},loadToolbar:function(){this.toolbar=new Element("div",{styles:this.css.toolbar}).inject(this.container);this.createActionNode=new Element("div",{styles:this.css.toolbarActionNode,text:this.lp.createCategory}).inject(this.toolbar);this.createActionNode.addEvent("click",function(){var e=new MWF.xApplication.Forum.Setting.CategorySettingForm(this,{},{onPostOk:function(){this.view.reload()}.bind(this)});e.create()}.bind(this));this.fileterNode=new Element("div",{styles:this.css.fileterNode}).inject(this.toolbar)},loadView:function(){this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.container);this.resizeWindow();this.resizeWindowFun=this.resizeWindow.bind(this);this.app.addEvent("resize",this.resizeWindowFun);this.view=new MWF.xApplication.Forum.Setting.CategorySettingView(this.viewContainer,this.app,this,{templateUrl:this.parent.path+"listItemCategory.json",scrollEnable:true});this.view.load()},resizeWindow:function(){var e=this.container.getSize();if(this.toolbar){this.viewContainer.setStyles({height:e.y-121+"px"})}else{this.viewContainer.setStyles({height:e.y-56+"px"})}}});MWF.xApplication.Forum.Setting.CategorySettingView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(e){return new MWF.xApplication.Forum.Setting.CategorySettingDocument(this.viewNode,e,this.explorer,this)},_getCurrentPageData:function(e,t){if(!t)t=20;this.actions.listCategoryAllByAdmin(function(t){if(e)e(t)}.bind(this))},_removeDocument:function(e,t){this.actions.deleteCategory(e.id,function(e){this.reload();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(e){var t=new MWF.xApplication.Forum.Setting.CategorySettingForm(this,e,{onPostOk:function(){this.reload()}.bind(this)});if(this.app.access.hasForumAdminAuthority(e)){t.edit()}else{t.open()}},_queryCreateViewNode:function(){},_postCreateViewNode:function(e){},_queryCreateViewHead:function(){},_postCreateViewHead:function(e){}});MWF.xApplication.Forum.Setting.CategorySettingDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(e,t){}});MWF.xApplication.Forum.Setting.CategorySettingForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"1011",height:"90%",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:true,title:MWF.xApplication.Forum.LP.categoryFormTitle,draggable:true,closeAction:true},createContent:function(){this.formContentNode=new Element("div.formContentNode",{styles:this.css.formContentNode}).inject(this.formNode);this.formTableContainer=new Element("div.formTableContainer",{styles:this.css.formTableContainer}).inject(this.formContentNode);this.formTableArea=new Element("div.formTableArea",{styles:this.css.formTableArea}).inject(this.formTableContainer);this._createTableContent()},_createTableContent:function(){var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr>"+"   <td styles='formTableTitle' lable='forumName' width='10%'></td>"+"   <td styles='formTableValue' item='forumName' width='40%'></td>"+"   <td styles='formTableTitle' lable='indexListStyle' width='10%'></td>"+"   <td styles='formTableValue' item='indexListStyle' width='40%'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='forumStatus'></td>"+"   <td styles='formTableValue' item='forumStatus'></td>"+"   <td styles='formTableTitle' lable='creatorName'></td>"+"   <td styles='formTableValue' item='creatorName'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='forumManagerName'></td>"+"   <td styles='formTableValue' item='forumManagerName'></td>"+"   <td styles='formTableTitle' lable='orderNumber'></td>"+"   <td styles='formTableValue' item='orderNumber'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='forumVisiable'></td>"+"   <td styles='formTableValue' item='forumVisiable'></td>"+"   <td styles='formTableValue' colspan='2'>"+"       <span item='forumVisiableCompanyButton'></span>"+"       <span item='forumVisiableDepartmentButton'></span>"+"       <span item='forumVisiablePersonButton'></span>"+"   </td>"+"</tr><tr>"+"   <td></td>"+"   <td colspan='3'>"+"       <div item='forumVisiableCompany'></div>"+"       <div item='forumVisiableDepartment'></div>"+"       <div item='forumVisiablePerson'></div>"+"   </td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='forumColorArea'></td>"+"   <td styles='formTableValue'>"+"       <div item='forumColorArea' style='float:left;'></div>"+"       <div item='forumColorButton' style='float:left;'></div>"+"   </td>"+"   <td styles='formTableTitle' lable='subjectType'></td>"+"   <td styles='formTableValue' item='subjectType'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='forumNotice'></td>"+"   <td styles='formTableValue' item='forumNotice' colspan='3'></td>"+"</tr>";"</table>";this.formTableArea.set("html",e);var t=!this.isEdited&&!this.isNew||!this.data.forumVisiable||this.data.forumVisiable==this.lp.allPerson?{display:"none"}:{display:""};var i=!this.data.forumVisiable||this.data.forumVisiable==this.lp.allPerson?{display:"none"}:{display:""};var s=!this.isEdited&&!this.isNew?{display:"none"}:{};MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{forumName:{text:this.lp.forumName,notEmpty:true},forumManagerName:{text:this.lp.forumManagerName,tType:"person",defaultValue:this.app.userName,count:0},forumVisiable:{text:this.lp.forumVisiable,type:"select",selectValue:this.lp.forumVisiableValue.split(","),event:{change:function(e,t){var i=e.getValue()==this.lp.allPerson?{display:"none"}:{display:""};e.form.getItem("forumVisiablePersonButton").setStyles(i);e.form.getItem("forumVisiableDepartmentButton").setStyles(i);e.form.getItem("forumVisiableCompanyButton").setStyles(i);e.form.getItem("forumVisiablePerson").setStyles(i);e.form.getItem("forumVisiableDepartment").setStyles(i);e.form.getItem("forumVisiableCompany").setStyles(i)}.bind(this)}},forumVisiablePersonButton:{value:this.lp.selectPerson,type:"button",style:t,event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("forumVisiablePerson").getElements()[0],"person",0)}.bind(this)}},forumVisiableDepartmentButton:{value:this.lp.selectDepartment,type:"button",style:t,event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("forumVisiableDepartment").getElements()[0],"department",0)}.bind(this)}},forumVisiableCompanyButton:{value:this.lp.selectCompany,type:"button",style:t,event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("forumVisiableCompany").getElements()[0],"company",0)}.bind(this)}},forumVisiableCompany:{type:"innerText",value:function(){return this.getRoleMemberByCode("FORUM_GUEST_")["company"].join(",")}.bind(this),style:i},forumVisiableDepartment:{type:"innerText",value:function(){return this.getRoleMemberByCode("FORUM_GUEST_")["department"].join(",")}.bind(this),style:i},forumVisiablePerson:{type:"innerText",value:function(){return this.getRoleMemberByCode("FORUM_GUEST_")["person"].join(",")}.bind(this),style:i},indexListStyle:{text:this.lp.indexListStyle,type:"select",selectValue:this.lp.indexListStyleValue.split(",")},forumIndexStyle:{text:this.lp.forumIndexStyle,type:"select",selectValue:this.lp.forumIndexStyleValue.split(",")},indexRecommendable:{text:this.lp.indexRecommendable,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(",")},subjectNeedAudit:{text:this.lp.subjectNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false"},replyNeedAudit:{text:this.lp.replyNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false"},creatorName:{text:this.lp.creatorName,type:"innerText",defaultValue:this.app.userName},forumStatus:{text:this.lp.forumStatus,type:"select",selectValue:this.lp.forumStatusValue.split(",")},orderNumber:{text:this.lp.orderNumber,tType:"number"},forumColorArea:{text:this.lp.forumColor,type:"innerText"},forumColorButton:{value:this.lp.selectColor,type:"button",style:s,event:{click:function(e,t){this.selectColor()}.bind(this)}},subjectType:{text:this.lp.subjectType,type:"text",defaultValue:this.lp.subjectTypeDefaultValue},forumNotice:{text:this.lp.forumNotice,type:"rtf",RTFConfig:{skin:"bootstrapck"}}}},this.app);this.form.load();var e=this.formTableArea.getElements("[item='forumColorArea']")[0];this.forumColorNode=new Element("div",{styles:{"font-size":"12px",height:"24px","line-height":"24px",width:"70px","margin-right":"20px",color:"#fff","text-align":"center","background-color":this.data.forumColor||this.lp.defaultForumColor},text:"效果"}).inject(e)}.bind(this),true)},selectColor:function(){var e=new MWF.xApplication.Forum.Setting.ForumColorForm(this,{},{onPostOk:function(e){this.forumColorNode.setStyle("background-color",e);this.data.forumColor=e}.bind(this)});e.edit()},_ok:function(e,t){this.app.restActions.saveCategory(e,function(e){this.saveRole(e.data.id,function(){if(t)t(e);this.fireEvent("postOk")}.bind(this))}.bind(this))},saveRole:function(e,t){var i=this.form.getResult(true,",",true,false,true);if(this.isNew)i.id=e;this.saveRoleMember(true,"forumManagerName","FORUM_SUPER_MANAGER_",i,true);var s=i.forumVisiable!=this.lp.allPerson;this.saveRoleMember(s,"forumVisiable","FORUM_GUEST_",i);if(t)t()},saveRoleMember:function(e,t,i,s,o,n){var l=[];if(e){if(o){if(s[t]){s[t].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"人员"})})}}else{if(s[t+"Person"]){s[t+"Person"].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"人员"})})}if(s[t+"Department"]){s[t+"Department"].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"部门"})})}if(s[t+"Company"]){s[t+"Company"].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"公司"})})}}}var r={bindObjectArray:l,bindRoleCode:i+this.data.id};this.app.restActions.bindRole(r,function(e){if(n)n(json)}.bind(this))},getRoleMemberByCode:function(e){if(!this.RoleMember)this.RoleMember={};if(this.RoleMember[e]){return this.RoleMember[e]}var t=this.RoleMember[e]={company:[],department:[],person:[]};this.actions.listRoleMemberByCode({bindRoleCode:e+this.data.id},function(e){e.data=e.data||[];e.data.each(function(e){if(e.objectType=="公司"){t.company.push(e.objectName)}else if(e.objectType=="部门"){t.department.push(e.objectName)}else{t.person.push(e.objectName)}}.bind(this))},null,false);return t}});MWF.xApplication.Forum.Setting.ForumColorForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"820",height:"280",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:false,title:MWF.xApplication.Forum.LP.forumColorFormTitle,draggable:true,closeAction:true},_createTableContent:function(){var e=new Element("div",{styles:this.css.sectionFormContent}).inject(this.formTableArea);e.setStyle("margin-top","10px");this.lp.optionsForumColors.each(function(t,i){t.each(function(t,i){var s=new Element("div",{styles:this.css.iconAreaNode}).inject(e);var o=new Element("div",{styles:{height:"20px",width:"40px",margin:"5px 5px 5px 5px","background-color":t,cursor:"pointer"}}).inject(s);s.store("color",t);s.addEvents({click:function(){this.obj.fireEvent("postOk",this.node.retrieve("color"));this.obj.close()}.bind({obj:this,node:s})})}.bind(this))}.bind(this))}});MWF.xApplication.Forum.Setting.SectionSettingExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(e,t,i,s){this.container=e;this.parent=i;this.app=t;this.css=this.parent.css;this.lp=this.app.lp},load:function(){this.container.empty();this.loadToolbar()},destroy:function(){if(this.resizeWindowFun)this.app.removeEvent("resize",this.resizeWindowFun);this.view.destroy()},loadToolbar:function(){this.toolbar=new Element("div",{styles:this.css.toolbar}).inject(this.container);this.createActionNode=new Element("div",{styles:this.css.toolbarActionNode,text:this.lp.createSection}).inject(this.toolbar);this.createActionNode.addEvent("click",function(){var e=new MWF.xApplication.Forum.Setting.SectionSettingForm(this,{},{onPostOk:function(){this.view.reload()}.bind(this)});e.create()}.bind(this));this.loadCategoryBar()},loadCategoryBar:function(){var e=this;this.allCategoryNode=new Element("li.allCategoryNode",{styles:this.css.categoryNode,text:"全部"}).inject(this.toolbar);this.allCategoryNode.addEvents({mouseover:function(){if(this.currentCategoryNode!=this.allCategoryNode)this.allCategoryNode.setStyles(this.css.categoryNode_over)}.bind(this),mouseout:function(){if(this.currentCategoryNode!=this.allCategoryNode)this.allCategoryNode.setStyles(this.css.categoryNode)}.bind(this),click:function(){if(this.currentCategoryNode)this.currentCategoryNode.setStyles(this.css.categoryNode);this.currentCategoryNode=this.allCategoryNode;this.allCategoryNode.setStyles(this.css.categoryNode_current);this.loadView()}.bind(this)});var t=false;this.forumAdminObj={};this.app.restActions.listCategoryAllByAdmin(function(i){i.data.each(function(i){var s=this.app.access.hasForumAdminAuthority(i);this.forumAdminObj[i.id]=s;if(!t){t=s}var o=new Element("li.categoryNode",{styles:this.css.categoryNode,text:i.forumName}).inject(this.toolbar);o.store("categoryId",i.id);o.addEvents({mouseover:function(){if(e.currentCategoryNode!=this.node)this.node.setStyles(e.css.categoryNode_over)}.bind({node:o}),mouseout:function(){if(e.currentCategoryNode!=this.node)this.node.setStyles(e.css.categoryNode)}.bind({node:o}),click:function(){if(e.currentCategoryNode)e.currentCategoryNode.setStyles(e.css.categoryNode);e.currentCategoryNode=this.node;this.node.setStyles(e.css.categoryNode_current);e.loadView()}.bind({name:i.id,node:o})})}.bind(this))}.bind(this),null,false);if(!t)this.createActionNode.destroy();this.allCategoryNode.click()},loadView:function(){var e;if(this.currentCategoryNode){e=this.currentCategoryNode.retrieve("categoryId")}e=e||"all";if(this.viewContainer)this.viewContainer.destroy();this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.container);this.resizeWindow();this.resizeWindowFun=this.resizeWindow.bind(this);this.app.addEvent("resize",this.resizeWindowFun);this.view=new MWF.xApplication.Forum.Setting.SectionSettingView(this.viewContainer,this.app,this,{templateUrl:this.parent.path+"listItemSection.json",scrollEnable:true,categoryId:e});this.view.load()},resizeWindow:function(){var e=this.container.getSize();this.viewContainer.setStyles({height:e.y-65+"px"})}});MWF.xApplication.Forum.Setting.SectionSettingView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(e){return new MWF.xApplication.Forum.Setting.SectionSettingDocument(this.viewNode,e,this.explorer,this)},_getCurrentPageData:function(e,t){if(!t)t=20;if(this.options.categoryId=="all"){this.actions.listSectionAll(function(t){if(!t.data)t.data=[];if(e)e(t)}.bind(this))}else{this.actions.listSectionByAdmin(this.options.categoryId,function(t){if(!t.data)t.data=[];if(e)e(t)}.bind(this))}},_removeDocument:function(e,t){this.actions.deleteSection(e.id,function(e){this.reload();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(e){var t=new MWF.xApplication.Forum.Setting.SectionSettingForm(this,e,{title:this.lp.sectionFormTitle+" - "+e.sectionName,onPostOk:function(){this.reload()}.bind(this)});this.app.access.hasSectionAdminAuthority(e,function(e){e?t.edit():t.open()})},_queryCreateViewNode:function(){},_postCreateViewNode:function(e){},_queryCreateViewHead:function(){},_postCreateViewHead:function(e){}});MWF.xApplication.Forum.Setting.SectionSettingDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverSection:function(e,t){var i=e.getElements("[styles='sectionRemoveNode']")[0];if(i)i.setStyle("opacity",1)},mouseoutSection:function(e,t){var i=e.getElements("[styles='sectionRemoveNode']")[0];if(i)i.setStyle("opacity",0)},_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(e,t){}});MWF.xApplication.Forum.Setting.SectionSettingForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"1100",height:"90%",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:true,title:MWF.xApplication.Forum.LP.sectionFormTitle,draggable:true,closeAction:true},createToolbar:function(){var e=this;this.toolbar=new Element("div",{styles:this.css.formToolbar}).inject(this.formNode);var t=new Element("li.categoryNode",{styles:this.css.formCategoryNode,text:this.lp.baseSetting}).inject(this.toolbar);t.addEvents({mouseover:function(){if(e.currentCategoryNode!=this.node)this.node.setStyles(e.css.formCategoryNode_over)}.bind({node:t}),mouseout:function(){if(e.currentCategoryNode!=this.node)this.node.setStyles(e.css.formCategoryNode)}.bind({node:t}),click:function(){if(e.currentCategoryNode)e.currentCategoryNode.setStyles(e.css.formCategoryNode);e.currentCategoryNode=this.node;this.node.setStyles(e.css.formCategoryNode_current);e.baseContainer.setStyle("display","");e.permissionContainer.setStyle("display","none")}.bind({node:t})});t.setStyles(this.css.formCategoryNode_current);e.currentCategoryNode=t;var t=new Element("li.categoryNode",{styles:this.css.formCategoryNode,text:this.lp.permissionSetting}).inject(this.toolbar);t.addEvents({mouseover:function(){if(e.currentCategoryNode!=this.node)this.node.setStyles(e.css.formCategoryNode_over)}.bind({node:t}),mouseout:function(){if(e.currentCategoryNode!=this.node)this.node.setStyles(e.css.formCategoryNode)}.bind({node:t}),click:function(){if(e.currentCategoryNode)e.currentCategoryNode.setStyles(e.css.formCategoryNode);e.currentCategoryNode=this.node;this.node.setStyles(e.css.formCategoryNode_current);e.baseContainer.setStyle("display","none");e.permissionContainer.setStyle("display","")}.bind({node:t})})},createContent:function(){this.createToolbar();this.formContentNode=new Element("div.formContentNode",{styles:this.css.formContentNode}).inject(this.formNode);this.formTableContainer=new Element("div.formTableContainer",{styles:this.css.formTableContainer}).inject(this.formContentNode);this.formTableArea=new Element("div.formTableArea",{styles:this.css.formTableArea}).inject(this.formTableContainer);this._createTableContent()},_createTableContent:function(){_self=this;this.baseContainer=new Element("div").inject(this.formTableArea);var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr>"+"   <td styles='formTableTitle' lable='sectionName' width='10%'></td>"+"   <td styles='formTableValue' item='sectionName' width='40%'></td>"+"   <td styles='formTableTitle' lable='forumId' width='10%'></td>"+"   <td styles='formTableValue' item='forumId' width='40%'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='sectionStatus'></td>"+"   <td styles='formTableValue' item='sectionStatus'></td>"+"   <td styles='formTableTitle' lable='orderNumber'></td>"+"   <td styles='formTableValue' item='orderNumber'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='typeCatagory'></td>"+"   <td styles='formTableValue' item='typeCatagory'></td>"+"   <td styles='formTableTitle' lable='subjectType'></td>"+"   <td styles='formTableValue' item='subjectType'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='creatorName'></td>"+"   <td styles='formTableValue' item='creatorName'></td>"+"   <td styles='formTableTitle' lable='createTime'></td>"+"   <td styles='formTableValue' item='createTime'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='sectionIcon'></td>"+"   <td styles='formTableValue' item='sectionIconArea' colspan='3' valign='bottom'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='sectionDescription'></td>"+"   <td styles='formTableValue' item='sectionDescription' colspan='3'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='sectionNotice'></td>"+"   <td styles='formTableValue' item='sectionNotice' colspan='3'></td>"+"</tr>";"</table>";this.baseContainer.set("html",e);this.permissionContainer=new Element("div",{styles:{display:"none"}}).inject(this.formTableArea);var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr>"+"   <td styles='formTableTitle' lable='moderatorNames'></td>"+"   <td styles='formTableValue' item='moderatorNames' colspan='3'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='sectionVisiable' width='10%'></td>"+"   <td styles='formTableValue' item='sectionVisiable' width='40%'></td>"+"   <td styles='formTableValue' width='50%' colspan='2'>"+"       <span item='sectionVisiableCompanyButton'></span>"+"       <span item='sectionVisiableDepartmentButton'></span>"+"       <span item='sectionVisiablePersonButton'></span>"+"     </td>"+"</tr><tr>"+"   <td></td>"+"   <td styles='formTableValue' colspan='3'>"+"       <div styles='formItemSpan' item='sectionVisiableCompany'></div>"+"       <div styles='formItemSpan' item='sectionVisiableDepartment'></div>"+"       <div styles='formItemSpan' item='sectionVisiablePerson'></div>"+" </td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='subjectPublishAble' width='10%'></td>"+"   <td styles='formTableValue' item='subjectPublishAble' width='40%'></td>"+"   <td styles='formTableValue' width='50%' colspan='2'>"+"       <span item='subjectPublishCompanyButton'></span>"+"       <span item='subjectPublishDepartmentButton'></span>"+"       <span item='subjectPublishPersonButton'></span>"+"     </td>"+"</tr><tr>"+"   <td></td>"+"   <td styles='formTableValue' colspan='3'>"+"       <div styles='formItemSpan' item='subjectPublishCompany'></div>"+"       <div styles='formItemSpan' item='subjectPublishDepartment'></div>"+"       <div styles='formItemSpan' item='subjectPublishPerson'></div>"+" </td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='replyPublishAble'></td>"+"   <td styles='formTableValue' item='replyPublishAble'></td>"+"   <td styles='formTableValue' width='50%' colspan='2'>"+"       <span styles='formItemDiv' item='replyPublishCompanyButton'></span>"+"       <span styles='formItemDiv' item='replyPublishDepartmentButton'></span>"+"       <span styles='formItemDiv' item='replyPublishPersonButton'></span>"+"     </td>"+"</tr><tr>"+"   <td></td>"+"   <td styles='formTableValue' coldiv='3'>"+"       <div item='replyPublishCompany'></div>"+"       <div item='replyPublishDepartment'></div>"+"       <div item='replyPublishPerson'></div>"+" </td>"+"</tr><tr item='indexRecommendTr' style='"+(this.data.sectionVisiable==this.lp.byPermission?"display:none;":"display:;")+"'>"+"   <td styles='formTableTitle' lable='indexRecommendable'></td>"+"   <td styles='formTableValue' item='indexRecommendable'></td>"+"   <td styles='formTableTitle' lable='indexRecommenPerson' style='"+(this.data.indexRecommendable==false?"display:none;":"display:;")+"'></td>"+"   <td styles='formTableValue' item='indexRecommenPerson' style='"+(this.data.indexRecommendable==false?"display:none;":"display:;")+"'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='subjectNeedAudit' width='10%'></td>"+"   <td styles='formTableValue' item='subjectNeedAudit' width='40%'></td>"+"   <td styles='formTableTitle' lable='subjectAuditPerson' width='10%' style='"+(this.data.subjectNeedAudit==true?"display:;":"display:none;")+"'></td>"+"   <td styles='formTableValue' item='subjectAuditPerson' width='40%' style='"+(this.data.subjectNeedAudit==true?"display:;":"display:none;")+"'></td>"+"</tr><tr>"+"   <td styles='formTableTitle' lable='replyNeedAudit'></td>"+"   <td styles='formTableValue' item='replyNeedAudit'></td>"+"   <td styles='formTableTitle' lable='replyAuditPerson' style='"+(this.data.replyNeedAudit==true?"display:;":"display:none;")+"'></td>"+"   <td styles='formTableValue' item='replyAuditPerson' style='"+(this.data.replyNeedAudit==true?"display:;":"display:none;")+"'></td>"+"</tr>";"</table>";this.permissionContainer.set("html",e);var t=[""];var i=[""];this.app.restActions.listCategoryAllByAdmin(function(e){e.data.each(function(e){if(this.isNew){if(this.app.access.hasForumAdminAuthority(e)){t.push(e.forumName);i.push(e.id)}}else{t.push(e.forumName);i.push(e.id)}}.bind(this))}.bind(this),null,false);if(!this.data.typeCatagory){this.data.typeCatagory=this.lp.typeCategorySelectValue.split("|")}else{this.data.typeCatagory=typeof this.data.typeCatagory=="string"?this.data.typeCatagory.split("|"):this.data.typeCatagory}MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{sectionName:{text:this.lp.sectionName,notEmpty:true},forumId:{text:this.lp.owneForum,type:"select",selectText:t,selectValue:i,notEmpty:true,isEdited:function(){return this.isNew}.bind(this)},sectionVisiable:{text:this.lp.sectionVisiable,type:"select",selectValue:this.lp.sectionVisiableValue.split(","),event:{change:function(e,t){this.setItemStyle(e,"sectionVisiable");if(e.getValue()==this.lp.allPerson){this.formTableArea.getElements("[item='indexRecommendTr']")[0].setStyle("display","")}else{this.formTableArea.getElements("[item='indexRecommendTr']")[0].setStyle("display","none")}}.bind(this)}},sectionVisiableCompanyButton:{value:this.lp.selectCompany,type:"button",style:this.getButtonStyle("sectionVisiable"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("sectionVisiableCompany").getElements()[0],"company",0)}.bind(this)}},sectionVisiableDepartmentButton:{value:this.lp.selectDepartment,type:"button",style:this.getButtonStyle("sectionVisiable"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("sectionVisiableDepartment").getElements()[0],"department",0)}.bind(this)}},sectionVisiablePersonButton:{value:this.lp.selectPerson,type:"button",style:this.getButtonStyle("sectionVisiable"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("sectionVisiablePerson").getElements()[0],"person",0)}.bind(this)}},sectionVisiableCompany:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_GUEST_")["company"].join(",")}.bind(this),style:this.getContainerStyle("sectionVisiable")},sectionVisiableDepartment:{
type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_GUEST_")["department"].join(",")}.bind(this),style:this.getContainerStyle("sectionVisiable")},sectionVisiablePerson:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_GUEST_")["person"].join(",")}.bind(this),style:this.getContainerStyle("sectionVisiable")},subjectPublishAble:{text:this.lp.subjectPublishAble,type:"select",selectValue:this.lp.subjectPublishAbleValue.split(","),event:{change:function(e,t){this.setItemStyle(e,"subjectPublish")}.bind(this)}},subjectPublishCompanyButton:{value:this.lp.selectCompany,type:"button",style:this.getButtonStyle("subjectPublishAble"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("subjectPublishCompany").getElements()[0],"company",0)}.bind(this)}},subjectPublishDepartmentButton:{value:this.lp.selectDepartment,type:"button",style:this.getButtonStyle("subjectPublishAble"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("subjectPublishDepartment").getElements()[0],"department",0)}.bind(this)}},subjectPublishPersonButton:{value:this.lp.selectPerson,type:"button",style:this.getButtonStyle("subjectPublishAble"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("subjectPublishPerson").getElements()[0],"person",0)}.bind(this)}},subjectPublishCompany:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_SUBJECT_PUBLISHER_")["company"].join(",")}.bind(this),style:this.getContainerStyle("subjectPublishAble")},subjectPublishDepartment:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_SUBJECT_PUBLISHER_")["department"].join(",")}.bind(this),style:this.getContainerStyle("subjectPublishAble")},subjectPublishPerson:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_SUBJECT_PUBLISHER_")["person"].join(",")}.bind(this),style:this.getContainerStyle("subjectPublishAble")},replyPublishAble:{text:this.lp.replyPublishAble,type:"select",selectValue:this.lp.replyPublishAbleValue.split(","),event:{change:function(e,t){this.setItemStyle(e,"replyPublish")}.bind(this)}},replyPublishCompanyButton:{value:this.lp.selectCompany,type:"button",style:this.getButtonStyle("replyPublishAble"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("replyPublishCompany").getElements()[0],"company",0)}.bind(this)}},replyPublishDepartmentButton:{value:this.lp.selectDepartment,type:"button",style:this.getButtonStyle("replyPublishAble"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("replyPublishDepartment").getElements()[0],"department",0)}.bind(this)}},replyPublishPersonButton:{value:this.lp.selectPerson,type:"button",style:this.getButtonStyle("replyPublishAble"),event:{click:function(e,t){this.explorer.explorer.parent.selectPerson(e.form.getItem("replyPublishPerson").getElements()[0],"person",0)}.bind(this)}},replyPublishCompany:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_REPLY_PUBLISHER_")["company"].join(",")}.bind(this),style:this.getContainerStyle("replyPublishAble")},replyPublishDepartment:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_REPLY_PUBLISHER_")["department"].join(",")}.bind(this),style:this.getContainerStyle("replyPublishAble")},replyPublishPerson:{type:"innerText",value:function(){return this.getRoleMemberByCode("SECTION_REPLY_PUBLISHER_")["person"].join(",")}.bind(this),style:this.getContainerStyle("replyPublishAble")},indexRecommendable:{text:this.lp.indexRecommendable,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"true",event:{change:function(e,t){var i=e.getValue()=="true"?{display:""}:{display:"none"};this.permissionContainer.getElements("[item='indexRecommenPerson']")[0].setStyles(i);this.permissionContainer.getElements("[lable='indexRecommenPerson']")[0].setStyles(i)}.bind(this)}},indexRecommenPerson:{text:this.lp.indexRecommenPerson,tType:"person",count:0,value:function(){var e=this.getRoleMemberByCode("SECTION_RECOMMENDER_")["person"].join(",");return e==""?this.app.userName:e}.bind(this)},subjectNeedAudit:{text:this.lp.subjectNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false",event:{change:function(e,t){var i=e.getValue()=="true"?{display:""}:{display:"none"};this.permissionContainer.getElements("[item='subjectAuditPerson']")[0].setStyles(i);this.permissionContainer.getElements("[lable='subjectAuditPerson']")[0].setStyles(i)}.bind(this)}},subjectAuditPerson:{text:this.lp.auditPerson,tType:"person",count:0,value:function(){return this.getRoleMemberByCode("SECTION_SUBJECT_AUDITOR_")["person"].join(",")}.bind(this)},replyNeedAudit:{text:this.lp.replyNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false",event:{change:function(e,t){var i=e.getValue()=="true"?{display:""}:{display:"none"};this.permissionContainer.getElements("[item='replyAuditPerson']")[0].setStyles(i);this.permissionContainer.getElements("[lable='replyAuditPerson']")[0].setStyles(i)}.bind(this)}},replyAuditPerson:{text:this.lp.auditPerson,tType:"person",count:0,value:function(){return this.getRoleMemberByCode("SECTION_REPLY_AUDITOR_")["person"].join(",")}.bind(this)},moderatorNames:{text:this.lp.moderatorNames,tType:"person",count:0,defaultValue:this.app.userName},sectionType:{text:this.lp.sectionType,type:"select",selectValue:this.lp.sectionTypeValue.split(",")},creatorName:{text:this.lp.creatorName,type:"innerText",defaultValue:this.app.userName},createTime:{text:this.lp.createTime,type:"innerText"},sectionStatus:{text:this.lp.sectionStatus,type:"select",selectValue:this.lp.sectionStatusValue.split(",")},orderNumber:{text:this.lp.orderNumber,tType:"number"},subjectType:{text:this.lp.subjectType,defaultValue:this.lp.subjectTypeDefaultValue},typeCatagory:{text:this.lp.typeCatagory,selectValue:this.lp.typeCategorySelectValue.split("|"),type:"checkbox",notEmpty:true},sectionDescription:{text:this.lp.sectionDescription,type:"textarea",style:{height:"45px"}},sectionNotice:{text:this.lp.sectionNotice,type:"rtf",RTFConfig:{skin:"bootstrapck"}},sectionIcon:{text:this.lp.sectionIcon}}},this.app);this.form.load();this.createIconNode()}.bind(this),true)},saveRole:function(e,t){var i=this.form.getResult(true,",",true,false,true);if(this.isNew)i.id=e;this.saveRoleMember(true,"moderatorNames","SECTION_MANAGER_",i,true);var s=i.sectionVisiable!=this.lp.allPerson;this.saveRoleMember(s,"sectionVisiable","SECTION_GUEST_",i);s=i.subjectPublishAble!=this.lp.allPerson;this.saveRoleMember(s,"subjectPublish","SECTION_SUBJECT_PUBLISHER_",i);s=i.replyPublishAble!=this.lp.allPerson;this.saveRoleMember(s,"replyPublish","SECTION_REPLY_PUBLISHER_",i);s=i.indexRecommendable=="true";this.saveRoleMember(s,"indexRecommenPerson","SECTION_RECOMMENDER_",i,true);s=i.subjectNeedAudit=="true";this.saveRoleMember(s,"subjectAuditPerson","SECTION_SUBJECT_AUDITOR_",i,true);s=i.replyNeedAudit=="true";this.saveRoleMember(s,"replyAuditPerson","SECTION_REPLY_AUDITOR_",i,true);if(t)t()},saveRoleMember:function(e,t,i,s,o,n){var l=[];if(e){if(o){if(s[t]){s[t].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"人员"})})}}else{if(s[t+"Person"]){s[t+"Person"].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"人员"})})}if(s[t+"Department"]){s[t+"Department"].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"部门"})})}if(s[t+"Company"]){s[t+"Company"].split(",").each(function(e){if(e!="")l.push({objectName:e,objectType:"公司"})})}}}var r={bindObjectArray:l,bindRoleCode:i+this.data.id};this.app.restActions.bindRole(r,function(e){if(n)n(json)}.bind(this))},getRoleMemberByCode:function(e){if(!this.RoleMember)this.RoleMember={};if(this.RoleMember[e]){return this.RoleMember[e]}var t={company:[],department:[],person:[]};if(!this.data.id){return t}this.RoleMember[e]=t;this.actions.listRoleMemberByCode({bindRoleCode:e+this.data.id},function(e){e.data=e.data||[];e.data.each(function(e){if(e.objectType=="公司"){t.company.push(e.objectName)}else if(e.objectType=="部门"){t.department.push(e.objectName)}else{t.person.push(e.objectName)}}.bind(this))},null,false);return t},getButtonStyle:function(e){if(this.isEdited||this.isNew){return this.getContainerStyle(e)}else{return{display:"none"}}},getContainerStyle:function(e){return!this.data[e]||this.data[e]==this.lp.allPerson?{display:"none"}:{display:""}},setItemStyle:function(e,t){var i=e.getValue()==this.lp.allPerson?{display:"none"}:{display:""};e.form.getItem(t+"PersonButton").setStyles(i);e.form.getItem(t+"DepartmentButton").setStyles(i);e.form.getItem(t+"CompanyButton").setStyles(i);e.form.getItem(t+"Person").setStyles(i);e.form.getItem(t+"Department").setStyles(i);e.form.getItem(t+"Company").setStyles(i)},createIconNode:function(){var e="/x_component_Forum/$Setting/"+this.options.style+"/sectionIcon/";var t=e+"forum_icon.png";var i=this.formTableArea.getElements("[item='sectionIconArea']")[0];this.iconNode=new Element("img",{styles:this.css.iconNode}).inject(i);if(this.data.icon){this.iconNode.set("src","data:image/png;base64,"+this.data.icon+"")}else{this.iconNode.set("src",t)}if(this.isEdited||this.isNew){var s=new Element("div",{styles:this.css.changeIconActionNode,text:this.lp.uploadIcon}).inject(i);s.addEvent("click",function(){this.changeIcon()}.bind(this))}},selectIcon:function(){var e=new MWF.xApplication.Forum.Setting.SectionIconForm(this,{},{onPostOk:function(e){if(this.formData)this.formData=null;this.iconNode.set("src",e.path)}.bind(this)});e.edit()},changeIcon:function(){if(!this.uploadFileAreaNode){this.uploadFileAreaNode=new Element("div");var e='<input name="file" type="file"/>';this.uploadFileAreaNode.set("html",e);this.fileUploadNode=this.uploadFileAreaNode.getFirst();this.fileUploadNode.addEvent("change",function(){var e=t.files;if(e.length){for(var i=0;i<e.length;i++){var s=e.item(i);if(!s.type.match("image.*"))continue;this.file=s;this.formData=new FormData;this.formData.append("file",this.file);if(!window.FileReader)continue;var o=new FileReader;o.onload=function(e){return function(e){this.iconNode.set("src",e.target.result)}.bind(this)}.bind(this)(s);o.readAsDataURL(s)}}}.bind(this))}var t=this.uploadFileAreaNode.getFirst();t.click()},saveIcon:function(e,t){this.app.restActions.uploadSectionIcon(e,function(){if(t)t()}.bind(this),null,this.formData,this.file)},_ok:function(e,t){e.sectionLevel="主版块";e.typeCatagory=e.typeCatagory.split(",").join("|");this.app.restActions.saveSection(e,function(e){if(this.formData){this.saveIcon(e.data.id,function(){this.saveRole(e.data.id,function(i){if(t)t(e)}.bind(this))}.bind(this))}else{this.saveRole(e.data.id,function(i){if(t)t(e)}.bind(this))}this.fireEvent("postOk")}.bind(this))},setFormNodeSize:function(e,t,i,s){if(!e)e=this.options.width?this.options.width:"50%";if(!t)t=this.options.height?this.options.height:"50%";if(!i)i=this.options.top?this.options.top:0;if(!s)s=this.options.left?this.options.left:0;var o=this.app.content.getSize();var n=o.x;var l=o.y;"string"==typeof e&&(1<e.length&&"%"==e.substr(e.length-1,1))&&(e=parseInt(n*parseInt(e,10)/100,10));"string"==typeof t&&(1<t.length&&"%"==t.substr(t.length-1,1))&&(t=parseInt(l*parseInt(t,10)/100,10));300>e&&(e=300);220>t&&(t=220);i=i||parseInt((l-t)/2,10);s=s||parseInt((n-e)/2,10);this.formAreaNode.setStyles({width:""+e+"px",height:""+t+"px",top:""+i+"px",left:""+s+"px"});this.formNode.setStyles({width:""+e+"px",height:""+t+"px"});var r=this.formIconNode?this.formIconNode.getSize():{x:0,y:0};var a=this.formTopNode?this.formTopNode.getSize():{x:0,y:0};var p=this.formBottomNode?this.formBottomNode.getSize():{x:0,y:0};var c=this.toolbar?this.toolbar.getSize():{x:0,y:0};var d=t-r.y-a.y-p.y-c.y;this.formContentNode.setStyles({height:""+d+"px"});this.formTableContainer.setStyles({height:""+d+"px"})}});MWF.xApplication.Forum.Setting.SectionIconForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"650",height:"400",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:false,title:MWF.xApplication.Forum.LP.sectionIconFormTitle,draggable:true,closeAction:true},_createTableContent:function(){var e="/x_component_Forum/$Setting/"+this.options.style+"/sectionIcon/";var t="/x_component_Forum/$Setting/sectionIcon.json";var i=new Element("div",{styles:this.css.sectionFormContent}).inject(this.formTableArea);MWF.getJSON(t,function(t){t.icons.each(function(t,s){var o=new Element("div",{styles:this.css.iconAreaNode}).inject(i);var n=new Element("img",{styles:this.css.iconSelectNode,src:e+t}).inject(o);o.store("iconName",t);o.store("iconPath",e+t);o.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.iconAreaNodeOver)}.bind({obj:this,node:o}),mouseout:function(){this.node.setStyles(this.obj.css.iconAreaNode)}.bind({obj:this,node:o}),click:function(){var e={path:this.node.retrieve("iconPath"),name:this.node.retrieve("iconName")};this.obj.fireEvent("postOk",e);this.obj.close()}.bind({obj:this,node:o})})}.bind(this))}.bind(this))}});MWF.xApplication.Forum.Setting.SystemSettingExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(e,t,i,s){this.container=e;this.parent=i;this.app=t;this.css=this.parent.css;this.lp=this.app.lp},load:function(){this.container.empty();this.loadView()},destroy:function(){if(this.resizeWindowFun)this.app.removeEvent("resize",this.resizeWindowFun);this.view.destroy()},loadView:function(){this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.container);this.resizeWindow();this.resizeWindowFun=this.resizeWindow.bind(this);this.app.addEvent("resize",this.resizeWindowFun);this.view=new MWF.xApplication.Forum.Setting.SystemSettingView(this.viewContainer,this.app,this,{templateUrl:this.parent.path+"listItemSystem.json",scrollEnable:true});this.view.load()},resizeWindow:function(){var e=this.container.getSize();this.viewContainer.setStyles({height:e.y+"px"})}});MWF.xApplication.Forum.Setting.SystemSettingView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(e){return new MWF.xApplication.Forum.Setting.SystemSettingDocument(this.viewNode,e,this.explorer,this)},_getCurrentPageData:function(e,t){if(!t)t=20;this.actions.listSystemSettingAll(function(t){if(e)e(t)}.bind(this))},_removeDocument:function(e,t){},_openDocument:function(e){var t=new MWF.xApplication.Forum.Setting.SystemSettingForm(this,e,{onPostOk:function(){this.reload()}.bind(this)});if(MWF.AC.isAdministrator()){t.edit()}else{t.open()}}});MWF.xApplication.Forum.Setting.SystemSettingDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(e,t){}});MWF.xApplication.Forum.Setting.SystemSettingForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"600",height:"320",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:true,title:MWF.xApplication.Forum.LP.systemSettingFormTitle,draggable:true,closeAction:true},_createTableContent:function(){var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr><td styles='formTableTitle' lable='configName' width='20%'></td>"+"    <td styles='formTableValue' item='configName' width='80%'></td></tr>"+"<tr><td styles='formTableTitle' lable='configValue'></td>"+"    <td styles='formTableValue' item='configValue'></td></tr>"+"<tr><td styles='formTableTitle' lable='orderNumber'></td>"+"    <td styles='formTableValue' item='orderNumber'></td></tr>"+"<tr><td styles='formTableTitle' lable='description'></td>"+"    <td styles='formTableValue' item='description'></td></tr>"+"</table>";this.formTableArea.set("html",e);var t={text:this.lp.configValue};t.tType="text";MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"execution",isEdited:this.isEdited||this.isNew,itemTemplate:{configName:{text:this.lp.configName,type:"innerText"},configValue:t,orderNumber:{text:this.lp.orderNumber,type:"innerText"},description:{text:this.lp.description,type:"innerText"}}},this.app);this.form.load()}.bind(this),true)},_ok:function(e,t){this.app.restActions.saveSystemSetting(e,function(e){if(t)t(e);this.fireEvent("postOk")}.bind(this))}});MWF.xApplication.Forum.Setting.SelectOrgForm=new Class({Extends:MWF.xApplication.Template.Explorer.PopupForm,Implements:[Options,Events],options:{style:"default",width:"900",height:"230",hasTop:true,hasIcon:false,hasTopIcon:true,hasTopContent:true,hasBottom:true,title:MWF.xApplication.Forum.LP.SelectOrgForm,draggable:true,closeAction:true},_createTableContent:function(){var e="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'>"+"<tr><td styles='formTableTitle' lable='person' width='15%'></td>"+"    <td styles='formTableValue' item='person' colspan='3' width='85%'></td></tr>"+"<tr><td styles='formTableTitle' lable='department'></td>"+"    <td styles='formTableValue' item='department' colspan='3'></td></tr>"+"<tr><td styles='formTableTitle' lable='company'></td>"+"    <td styles='formTableValue' item='company' colspan='3'></td></tr>"+"</table>";this.formTableArea.set("html",e);MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{person:{text:this.lp.selectPerson,tType:"person",count:0},department:{text:this.lp.selectDepartment,tType:"department",count:0},company:{text:this.lp.selectCompany,tType:"company",count:0}}},this.app);this.form.load()}.bind(this),false)},_ok:function(e,t){var i=[];e.person.split(",").each(function(e){i.push(e+"#人员")});e.department.split(",").each(function(e){i.push(e+"#组织")});e.company.split(",").each(function(e){i.push(e+"#组织")});this.app.restActions.saveRole(e,function(s){this.app.restActions.getRole(e.id,function(e){var o={bindObjectArray:i,bindRoleCode:e.roleCode};this.app.restActions.bindRole(o,function(e){if(t)t(s);this.fireEvent("postOk")}.bind(this))})}.bind(this))}});