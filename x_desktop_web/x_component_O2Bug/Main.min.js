MWF.require("MWF.widget.MaskNode",null,false);MWF.xApplication.O2Bug.options.multitask=false;MWF.xApplication.O2Bug.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"O2Bug",icon:"icon.png",width:"1200",height:"700",isResize:true,isMax:true,title:MWF.xApplication.O2Bug.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.O2Bug.LP},loadApplication:function(t){this.loadTitle();this.loadFilter()},loadTitle:function(){this.loadTitleBar();this.loadTitleUserNode();this.loadCreateActionNode();this.loadTitleTextNode();this.loadSearchNode()},loadTitleBar:function(){this.titleBar=new Element("div",{styles:this.css.titleBar}).inject(this.content)},loadTitleUserNode:function(){this.titleUserNode=new Element("div",{styles:this.css.titleUserNode}).inject(this.titleBar);this.titleUserIconNode=new Element("div",{styles:this.css.titleUserIconNode}).inject(this.titleUserNode);this.titleUserTextNode=new Element("div",{styles:this.css.titleUserTextNode,text:this.desktop.session.user.name}).inject(this.titleUserNode)},loadCreateActionNode:function(){this.createAction=new Element("div",{styles:this.css.createAction}).inject(this.titleBar);this.createAction.addEvents({click:function(t){this.createBug()}.bind(this)})},loadTitleTextNode:function(){this.titleTextNode=new Element("div",{styles:this.css.titleTextNode,text:this.lp.title}).inject(this.titleBar)},loadSearchNode:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.titleBar);this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode);this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode);this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode);this.searchBarInputNode=new Element("input",{type:"text",value:this.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);var t=this;this.searchBarActionNode.addEvent("click",function(){this.searchTask()}.bind(this));this.searchBarInputNode.addEvents({focus:function(){if(this.value==t.lp.searchKey)this.set("value","")},blur:function(){if(!this.value)this.set("value",t.lp.searchKey)},keydown:function(t){if(t.code==13){this.searchTask();t.preventDefault()}}.bind(this),selectstart:function(t){t.preventDefault()}})},loadFilter:function(){this.filterBar=new Element("div",{styles:this.css.filterBar}).inject(this.content);this.filterTitleNode=new Element("div",{styles:this.css.filterTitleNode}).inject(this.filterBar);this.filterTitleNode.set("text",this.lp.filter);this.filterContentNode=new Element("div",{styles:this.css.filterContentNode}).inject(this.filterBar);var t=this.lp.bugType+": <select id='sel_bugType'></select><span>&nbsp;&nbsp;&nbsp;&nbsp;</span>"+this.lp.creator+": <select id='sel_creator'></select><span>&nbsp;&nbsp;&nbsp;&nbsp;</span>"+this.lp.targetUser+": <select id='sel_targetUser'></select><span>&nbsp;&nbsp;&nbsp;&nbsp;</span>"+this.lp.status+": <select id='sel_status'></select><span>&nbsp;&nbsp;&nbsp;&nbsp;</span>";this.filterContentNode.set("html",t);this.filterBugTypeNode=this.filterContentNode.getElementById("sel_bugType");this.filterCreatorNode=this.filterContentNode.getElementById("sel_targetUser");this.filterTargetUserNode=this.filterContentNode.getElementById("sel_targetUser");this.filterStatusNode=this.filterContentNode.getElementById("sel_status");Object.each(this.lp.bugTypeList,function(t,e){new Element("option",{value:e,text:t}).inject(this.filterBugTypeNode)}.bind(this));Object.each(this.lp.statusList,function(t,e){new Element("option",{value:e,text:t}).inject(this.filterStatusNode)}.bind(this))},createBug:function(){this.note=new MWF.xApplication.O2Bug.Note(null,this.createAction,this)}});MWF.xApplication.O2Bug.Note=new Class({initialize:function(t,e,i){this.data=t;this.startNode=e;this.app=i;this.css=this.app.css;this.container=this.app.content;this.isNew=this.data&&this.data.id?true:false;this.load()},load:function(){if(!this.data)this.createNewData();this.mask=new MWF.widget.MaskNode(this.container,{loading:false});this.mask.load();this.createNode();this.show()},createNewData:function(){this.data={}},createNode:function(){var t=this.startNode.getSize();this.node=new Element("div",{styles:this.css.bugNoteNode}).inject(this.container);this.node.setStyles({width:""+t.x+"px",height:""+t.y+"px"});this.node.position({relativeTo:this.startNode,position:"topLeft",edge:"topLeft"})},show:function(){var t=this.getNodeCoordinates();var e=new Fx.Morph(this.node,{duration:"500",transition:Fx.Transitions.Expo.easeOut});e.start({opacity:1,width:""+t.width+"px",height:""+t.height+"px",left:""+t.left+"px",top:""+t.top+"px"}).chain(function(){this.setNodeSizeFun=this.setNodeSize.bind(this);this.app.addEvent("resize",this.setNodeSizeFun)}.bind(this))},setNodeSize:function(){var t=this.getNodeCoordinates();this.node.setStyles({width:""+t.width+"px",height:""+t.height+"px",left:""+t.left+"px",top:""+t.top+"px"})},getNodeCoordinates:function(){var t=this.container.getSize();var e=t.x*.8;if(e<800)e=800;var i=t.y*.8;if(i<300)i=300;var s=this.container.getPosition(this.container.getOffsetParent());var n=t.x/2-e/2;if(n<0)n=0;n=s.x+n;var o=t.y/2-i/2;if(o<0)o=0;o=s.y+o;return{width:e,height:i,left:n,top:o}}});