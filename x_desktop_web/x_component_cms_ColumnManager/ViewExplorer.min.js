MWF.xDesktop.requireApp("cms.ColumnManager","Explorer",null,false);MWF.xApplication.cms.ColumnManager.ViewExplorer=new Class({Extends:MWF.xApplication.cms.ColumnManager.Explorer,Implements:[Options,Events],options:{style:"default",create:MWF.CMSCM.LP.view.create,search:MWF.CMSCM.LP.view.search,searchText:MWF.CMSCM.LP.view.searchText,noElement:MWF.CMSCM.LP.view.noViewNoticeText},_createElement:function(e){var t=this;var i=function(e,i){layout.desktop.getFormDesignerStyle(function(){var s={style:layout.desktop.formDesignerStyle,onQueryLoad:function(){this.actions=t.app.restActions;this.column=t.app.options.column;this.application=t.app.options.column;this.relativeForm=i},onPostSave:function(){t.reload()}};layout.desktop.openApplication(e,"cms.ViewDesigner",s)}.bind(this))};var s=new Element("div",{styles:this.css.selectFormMaskNode}).inject(this.app.content);var o=new Element("div",{styles:this.css.selectFormTemplateAreaNode}).inject(this.app.content);o.fade("in");var n=new Element("div",{styles:this.css.selectFormTitleNode,text:this.app.lp.view.selectRelativeForm}).inject(o);var r=new Element("div",{styles:this.css.selectFormScrollNode}).inject(o);var a=new Element("div",{styles:this.css.selectFormContentNode}).inject(r);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(r,{indent:false})}.bind(this));var t=this;this.app.restActions.listForm(this.app.options.column.id,function(e){e.data.each(function(e){var n=new Element("div",{styles:this.css.formNode}).inject(a);var r="process_icon_"+(Math.random()*33).toInt()+".png";var l=this.path+this.options.style+"/processIcon/"+r;var c=new Element("div",{styles:this.css.formIconNode}).inject(n);c.setStyle("background","url("+l+") center center no-repeat");new Element("div",{styles:this.css.formTitleNode,text:e.name}).inject(n);new Element("div",{styles:this.css.formDescriptionNode,text:e.description||"",title:e.description||""}).inject(n);new Element("div",{styles:this.css.formDateNode,text:e.updateTime||""}).inject(n);n.store("form",{name:e.name,id:e.id});n.addEvents({mouseover:function(){this.setStyles(t.css.formNode_over)},mouseout:function(){this.setStyles(t.css.formNode)},mousedown:function(){this.setStyles(t.css.formNode_down)},mouseup:function(){this.setStyles(t.css.formNode_over)},click:function(e){i(e,this.retrieve("form"));o.destroy();s.destroy()}})}.bind(this));var n=this.app.content.getSize();var r=o.getSize();var l=(n.y-r.y)/2;var c=(n.x-r.x)/2;if(l<0)l=0;if(c<0)c=0;o.setStyles({top:""+l+"px",left:""+c+"px"})}.bind(this));s.addEvent("click",function(){o.destroy();s.destroy()})},_loadItemDataList:function(e){this.actions.listView(this.app.options.column.id,e)},_getItemObject:function(e,t){return new MWF.xApplication.cms.ColumnManager.ViewExplorer.View(this,e,{index:t})},setTooltip:function(){this.options.tooltip={create:MWF.CMSCM.LP.view.create,search:MWF.CMSCM.LP.view.search,searchText:MWF.CMSCM.LP.view.searchText,noElement:MWF.CMSCM.LP.view.noViewNoticeText}},loadElementList:function(){this._loadItemDataList(function(e){if(e.data.length){e.data.each(function(e){var t=this._getItemObject(e,this.itemArray.length+1);t.load();this.itemObject[e.id]=t;this.itemArray.push(t)}.bind(this))}else{var t=new Element("div",{styles:this.css.noElementNode,text:this.options.noCreate?MWF.CMSCM.LP.view.noViewNoCreateNoticeText:this.options.tooltip.noElement}).inject(this.elementContentListNode);if(!this.options.noCreate){t.addEvent("click",function(e){this._createElement(e)}.bind(this))}}}.bind(this))},deleteItems:function(){while(this.deleteMarkItems.length){var e=this.deleteMarkItems.shift();if(this.deleteMarkItems.length){e.deleteView()}else{e.deleteView(function(){this.hideDeleteAction();this.reload()}.bind(this))}}}});MWF.xApplication.cms.ColumnManager.ViewExplorer.View=new Class({Extends:MWF.xApplication.cms.ColumnManager.Explorer.Item,load_bak:function(){if(this.options.index%2==0){this.itemNodeCss=this.explorer.css.itemNode_even}else{this.itemNodeCss=this.explorer.css.itemNode}this.node=new Element("div",{styles:this.itemNodeCss,events:{click:function(e){this._open(e);e.stopPropagation()}.bind(this),mouseover:function(){this.node.setStyles(this.explorer.css.itemNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.itemNodeCss)}.bind(this)}}).inject(this.container,this.options.where);if(this.data.name.icon)this.icon=this.data.name.icon;var e=this.explorer.path+""+this.explorer.options.style+"/processIcon/"+this.icon;var t=new Element("div",{styles:this.explorer.css.itemIconNode}).inject(this.node);t.setStyle("background","url("+e+") center center no-repeat");t.makeLnk({par:this._getLnkPar()});this.actionsArea=new Element("div.actionsArea",{styles:this.explorer.css.actionsArea}).inject(this.node);if(!this.explorer.options.noDelete){this.deleteActionNode=new Element("div.deleteAction",{styles:this.explorer.css.deleteAction}).inject(this.actionsArea);this.deleteActionNode.addEvent("click",function(e){this.deleteItem(e);e.stopPropagation()}.bind(this));this.deleteActionNode.addEvents({mouseover:function(e){this.deleteActionNode.setStyles(this.explorer.css.deleteAction_over)}.bind(this),mouseout:function(e){this.deleteActionNode.setStyles(this.explorer.css.deleteAction)}.bind(this)})}var i=new Element("div.itemInforNode",{styles:this.explorer.css.itemInforNode}).inject(this.node);var s=new Element("div.itemInforBaseNode",{styles:this.explorer.css.itemInforBaseNode}).inject(i);new Element("div.itemTextTitleNode",{styles:this.explorer.css.itemTextTitleNode,text:this.data.name,title:this.data.name}).inject(s);new Element("div.itemTextAliasNode",{styles:this.explorer.css.itemTextAliasNode,text:this.data.alias,title:this.data.alias}).inject(s);new Element("div.itemTextDateNode",{styles:this.explorer.css.itemTextDateNode,text:this.data.updateTime||""}).inject(s);new Element("div.itemTextDescriptionNode",{styles:this.explorer.css.itemTextDescriptionNode,text:this.data.description||"",title:this.data.description||""}).inject(s);this._customNodes()},_customNodes:function(){},_open:function(e){var t=this;var i={onQueryLoad:function(){this.actions=t.explorer.actions;this.category=t;this.options.id=t.data.id;this.column=t.explorer.app.options.column;this.application=t.explorer.app.options.column;this.options.noModifyName=t.explorer.options.noModifyName;this.options.readMode=t.explorer.options.readMode,this.options.formId=t.data.formId}};this.explorer.app.desktop.openApplication(e,"cms.ViewDesigner",i)},_getIcon:function(){var e=(Math.random()*33).toInt();return"process_icon_"+e+".png"},_getLnkPar:function(){return{icon:this.explorer.path+this.explorer.options.style+"/viewIcon/lnk.png",title:this.data.name,par:'cms.ViewDesigner#{"id": "'+this.data.id+'", "application": '+JSON.stringify(this.explorer.app.options.application)+"}"}},deleteView:function(e){this.explorer.app.restActions.deleteView(this.data.id,function(){this.node.destroy();if(e)e()}.bind(this))}});