MWF.xDesktop.requireApp("process.ProcessManager","Explorer",null,false);MWF.xApplication.process.ProcessManager.DictionaryExplorer=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer,Implements:[Options,Events],options:{create:MWF.APPPM.LP.dictionary.create,search:MWF.APPPM.LP.dictionary.search,searchText:MWF.APPPM.LP.dictionary.searchText,noElement:MWF.APPPM.LP.dictionary.noDictionaryNoticeText},initialize:function(e,t,i){this.setOptions(i);this.setTooltip();this.path="/x_component_process_ProcessManager/$DictionaryExplorer/";this.cssPath="/x_component_process_ProcessManager/$DictionaryExplorer/"+this.options.style+"/css.wcss";this._loadCss();this.actions=t;this.node=$(e);this.initData()},setContentSize:function(){var e=this.toolbarNode.getSize();var t=this.node.getSize();var i=this.elementContentNode.getStyle("padding-top").toFloat();var o=this.elementContentNode.getStyle("padding-bottom").toFloat();var n=t.y-e.y-i-o;this.elementContentNode.setStyle("height",""+n+"px");if(this.options.noCreate)this.createElementNode.destroy()},showDeleteAction:function(){if(!this.deleteItemsAction){this.deleteItemsAction=new Element("div",{styles:this.css.deleteItemsAction,text:this.app.lp.deleteItems}).inject(this.node);this.deleteItemsAction.fade("in");this.deleteItemsAction.position({relativeTo:this.elementContentListNode,position:"centerTop",edge:"centerTop"});this.deleteItemsAction.addEvent("click",function(){var e=this;this.app.confirm("warn",this.deleteItemsAction,MWF.APPPM.LP.deleteElementTitle,MWF.APPPM.LP.deleteElement,300,120,function(){e.deleteItems();this.close()},function(){this.close()})}.bind(this))}},_createElement:function(e){var t=this;var i={onQueryLoad:function(){this.actions=t.app.restActions;this.application=t.app.options.application;this.explorer=t}};this.app.desktop.openApplication(e,"process.DictionaryDesigner",i)},_loadItemDataList:function(e){this.actions.listDictionary(this.app.options.application.id,e)},_getItemObject:function(e){return new MWF.xApplication.process.ProcessManager.DictionaryExplorer.Dictionary(this,e)},setTooltip:function(){this.options.tooltip={create:MWF.APPPM.LP.dictionary.create,search:MWF.APPPM.LP.dictionary.search,searchText:MWF.APPPM.LP.dictionary.searchText,noElement:MWF.APPPM.LP.dictionary.noDictionaryNoticeText}},loadElementList:function(){this._loadItemDataList(function(e){if(e.data.length){e.data.each(function(e){var t=this._getItemObject(e);t.load()}.bind(this))}else{var t=new Element("div",{styles:this.css.noElementNode,text:this.options.noCreate?MWF.APPPM.LP.dictionary.noDictionaryNoCreateNoticeText:this.options.tooltip.noElement}).inject(this.elementContentListNode);if(!this.options.noCreate){t.addEvent("click",function(e){this._createElement(e)}.bind(this))}}}.bind(this))},deleteItems:function(){this.hideDeleteAction();while(this.deleteMarkItems.length){var e=this.deleteMarkItems.shift();if(this.deleteMarkItems.length){e.deleteDictionary()}else{e.deleteDictionary(function(){}.bind(this))}}}});MWF.xApplication.process.ProcessManager.DictionaryExplorer.Dictionary=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer.Item,load:function(){this.node=new Element("div",{styles:this.explorer.css.itemNode,events:{mouseover:function(){if(this.deleteActionNode)this.deleteActionNode.fade("in")}.bind(this),mouseout:function(){if(this.deleteActionNode)this.deleteActionNode.fade("out")}.bind(this)}}).inject(this.container);if(this.data.name.icon)this.icon=this.data.name.icon;var e=this.explorer.path+""+this.explorer.options.style+"/processIcon/"+this.icon;var t=new Element("div",{styles:this.explorer.css.itemIconNode}).inject(this.node);t.setStyle("background","url("+e+") center center no-repeat");t.makeLnk({par:this._getLnkPar()});if(!this.explorer.options.noDelete){this.deleteActionNode=new Element("div",{styles:this.explorer.css.deleteActionNode}).inject(this.node);this.deleteActionNode.addEvent("click",function(e){this.deleteItem(e)}.bind(this))}var i=new Element("div",{styles:this.explorer.css.itemInforNode}).inject(this.node);var o=new Element("div",{styles:this.explorer.css.itemInforBaseNode}).inject(i);new Element("div",{styles:this.explorer.css.itemTextTitleNode,text:this.data.name,title:this.data.name,events:{click:function(e){this._open(e);e.stopPropagation()}.bind(this)}}).inject(o);new Element("div",{styles:this.explorer.css.itemTextAliasNode,text:this.data.alias,title:this.data.alias}).inject(o);new Element("div",{styles:this.explorer.css.itemTextDateNode,text:this.data.updateTime||""}).inject(o);new Element("div",{styles:this.explorer.css.itemTextDescriptionNode,text:this.data.description||"",title:this.data.description||""}).inject(i);this._customNodes();this._isNew()},_customNodes:function(){},_open:function(e){debugger;var t=this;var i={onQueryLoad:function(){this.actions=t.explorer.actions;this.category=t;this.options.id=t.data.id;this.application=t.explorer.app.options.application;this.options.noModifyName=t.explorer.options.noModifyName;this.options.readMode=t.explorer.options.readMode;this.explorer=t.explorer}};this.explorer.app.desktop.openApplication(e,"process.DictionaryDesigner",i)},_getIcon:function(){return"dictionary.png"},_getLnkPar:function(){return{icon:this.explorer.path+this.explorer.options.style+"/dictionaryIcon/lnk.png",title:this.data.name,par:'process.DictionaryDesigner#{"id": "'+this.data.id+'", "applicationId": "'+this.explorer.app.options.application.id+'"}'}},deleteDictionary:function(e){this.explorer.app.restActions.deleteDictionary(this.data.id,function(){this.node.destroy();if(e)e()}.bind(this))}});