MWF.xApplication.Meeting.MeetingView=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i){this.setOptions(i);this.path="/x_component_Meeting/$MeetingView/";this.cssPath="/x_component_Meeting/$MeetingView/"+this.options.style+"/css.wcss";this._loadCss();this.app=e;this.container=$(t);this.days=[];this.load()},load:function(){this.date=new Date;this.node=new Element("div#meetingNode",{styles:this.css.node}).inject(this.container);this.topNode=new Element("div",{styles:this.css.topNode}).inject(this.node);this.todayNode=new Element("div",{styles:this.css.todayNode}).inject(this.topNode);this.currentNode=new Element("div",{styles:this.css.currentNode}).inject(this.topNode);this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node);this.bottomNode=new Element("div",{styles:this.css.bottomNode}).inject(this.node);this.dayContentNode=new Element("div",{styles:this.css.dayContentNode}).inject(this.bottomNode);this.setContentNodeHeight();this.app.addEvent("resize",this.setContentNodeHeight.bind(this));this.loadContent();this.node.addEvent("mousewheel",this.scrollBottomNode.bind(this))},scrollBottomNode:function(t){var e=1-t.event.wheelDelta;var i=this.bottomNode.getScrollSize();var s=this.bottomNode.getScroll();var n=this.bottomNode.getSize();var o=.6*n.x.toFloat();e=e/120*o;var c=s.x+e;if(c>i.x)c=i.x;if(c<0)c=0;if(!this.bottomScroll)this.bottomScroll=new Fx.Scroll(this.bottomNode);this.bottomScroll.start(c,0)},setContentNodeHeight:function(){var t=this.container.getSize();if(this.app.meetingConfig.hideMenu=="static"){var e=t.y-110;this.node.setStyle("height",""+e+"px");this.node.setStyle("margin-top","60px")}var t=this.node.getSize();var i=this.topNode.getSize();var s=this.bottomNode.getSize();var e=t.y-i.y-s.y-10;this.contentNode.setStyle("height",""+e+"px")},loadContent:function(){var t=this.date.format(this.app.lp.dateFormatMonthDay);var e=this.app.lp.weeks.arr[this.date.getDay()];this.todayNode.set("text",t+","+e);this.app.actions.listMeetingDays(7,function(t){this.currentNode.set("text",this.app.lp.noMeetingWeek);for(i=0;i<t.data.length;i++){var e=t.data[i];if(e.status=="wait"&&!e.myWaitConfirm&&!e.myWaitAccept&&!e.myReject){var s="";var n=new Date;var o=Date.parse(e.startTime);var c=n.diff(o);if(c==0){s=Date.parse(e.startTime).format("%H:%M")}else if(c==1){s=this.app.lp.tomorrow+Date.parse(e.startTime).format("%H:%M")}else if(c==2){s=this.app.lp.afterTomorrow+Date.parse(e.startTime).format("%H:%M")}else{var d=n.diff(o,"month");if(d==0){var a=this.app.lp.weeks.arr[Date.parse(e.startTime).getDay()];s=Date.parse(e.startTime).format(this.app.lp.dateFormatDayOnly)+"("+a+")"+Date.parse(e.startTime).format("%H:%M")}else if(d==1){s=this.app.lp.nextMonth+Date.parse(e.startTime).format(this.app.lp.dateFormatDayOnly)}else{s=Date.parse(e.startTime).format(this.app.lp.dateFormatMonthOnly)}}var h=this.app.lp.newlyMeeting.replace(/{time}/g,s);h=h.replace(/{name}/g,e.subject);this.app.actions.getRoom(e.room,function(t){this.app.actions.getBuilding(t.data.building,function(e){var i="";if(t.data.roomNumber){i=t.data.name+" ("+e.data.name+" #"+t.data.roomNumber+") "}else{i=t.data.name+" ("+e.data.name+") "}h=h.replace(/{room}/g,i);this.currentNode.set("text",h)}.bind(this))}.bind(this));break}}}.bind(this));this.loadDays()},loadDays:function(){var t=this.date.clone();for(var e=1;e<=30;e++){this.days.push(new MWF.xApplication.Meeting.MeetingView.Day(this,t));t.increment()}},hide:function(){var t=new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut});if(this.currentDocument)this.currentDocument.closeDocument();t.start({opacity:0}).chain(function(){this.node.setStyle("display","none")}.bind(this))},show:function(){this.node.setStyles(this.css.node);var t=new Fx.Morph(this.node,{duration:"800",transition:Fx.Transitions.Expo.easeOut});t.start({opacity:1,left:"0px"}).chain(function(){this.node.setStyles({position:"static",width:"auto"})}.bind(this))},reload:function(){debugger;this.days.each(function(t){t.destroy()}.bind(this));this.days=[];this.loadContent()}});MWF.xApplication.Meeting.MeetingView.Day=new Class({Implements:[Events],initialize:function(t,e){this.view=t;this.css=this.view.css;this.container=this.view.dayContentNode;this.app=this.view.app;this.date=e.clone();this.meetings=[];this.load()},load:function(){var t="";if(this.date.diff(new Date)==0){t=this.app.lp.today}else{var e=this.date.format(this.app.lp.dateFormatDay);var i=this.app.lp.weeks.arr[this.date.getDay()];t=e+", "+i}this.node=new Element("div",{styles:this.css.dayNode}).inject(this.container);this.dateNode=new Element("div",{styles:this.css.dayDateNode,text:t}).inject(this.node);this.dayBodyNode=new Element("div",{styles:this.css.dayBodyNode}).inject(this.node);this.dateNode.addEvent("click",function(){this.app.toDay(this.date)}.bind(this));this.loadMeetings()},loadMeetings:function(){var t=this.date.getFullYear();var e=this.date.getMonth()+1;var i=this.date.getDate();var s=0;var n=0;var o=[];this.app.actions.listMeetingDay(t,e,i,function(t){t.data.each(function(t){if(!t.myReject){if(t.myWaitConfirm||t.myWaitAccept){n++;this.meetings.push(new MWF.xApplication.Meeting.MeetingView.Day.Task(this,t))}else{s++;o.unshift(t)}}}.bind(this));o.each(function(t){this.meetings.push(new MWF.xApplication.Meeting.MeetingView.Day.Meeting(this,t))}.bind(this));if(s>0){var e=this.container.getSize();var i=s*350;var c=e.x+i;this.container.setStyle("width",""+c+"px")}if(n==0){var d=new Element("div",{styles:{"line-height":"60px","font-size":"18px",color:"#DDD",padding:"0px 20px"}}).inject(this.dayBodyNode);if(s==0){d.set("text",this.app.lp.noMeeting)}else{d.set("text",this.app.lp.noTask)}}}.bind(this))},destroy:function(){this.meetings.each(function(t){t.destroy()}.bind(this));this.node.destroy();MWF.release(this)}});MWF.xApplication.Meeting.MeetingView.Day.Meeting=new Class({initialize:function(t,e){this.day=t;this.data=e;this.view=this.day.view;this.css=this.view.css;this.app=this.view.app;this.load()},load:function(){this.node=new Element("div",{styles:this.css.dayMeetingNode}).inject(this.day.node,"after");this.titleNode=new Element("div",{styles:this.css.dayMeetingTitleNode}).inject(this.node);this.timeNode=new Element("div",{styles:this.css.dayMeetingTimeNode}).inject(this.node);this.descriptionNode=new Element("div",{styles:this.css.dayMeetingDescriptionNode}).inject(this.node);var t=Date.parse(this.data.startTime).format("%H:%M")+" - "+Date.parse(this.data.completedTime).format("%H:%M");this.timeNode.set("text",t);this.titleNode.set("text",this.data.subject);this.descriptionNode.set("text",this.data.description);this.node.addEvent("click",this.openDocument.bind(this));switch(this.data.status){case"wait":break;case"processing":this.node.setStyles({"border-left":"10px solid #18da14","background-color":"#deffdd"});break;case"completed":this.node.setStyles({"border-left":"10px solid #333","background-color":"#ccc"});break}},openDocument:function(){if(!this.document){debugger;if(this.view.currentDocument)this.view.currentDocument.closeDocument();this.document=new MWF.xApplication.Meeting.MeetingView.Document(this);this.view.currentDocument=this.document}},destroy:function(){if(this.document)this.document.closeDocument();this.node.destroy();MWF.release(this)}});MWF.xApplication.Meeting.MeetingView.Day.Task=new Class({initialize:function(t,e){this.day=t;this.data=e;this.view=this.day.view;this.css=this.view.css;this.container=this.day.dayBodyNode;this.app=this.view.app;this.load()},load:function(){this.node=new Element("div",{styles:this.css.dayTaskNode}).inject(this.container);this.iconNode=new Element("div",{styles:this.css.dayTaskIconNode}).inject(this.node);this.timeNode=new Element("div",{styles:this.css.dayTaskTimeNode}).inject(this.node);this.titleNode=new Element("div",{styles:this.css.dayTaskTitleNode}).inject(this.node);var t=Date.parse(this.data.startTime).format("%H:%M")+" - "+Date.parse(this.data.completedTime).format("%H:%M");this.timeNode.set("text",t);var e;if(this.data.myWaitConfirm)e=this.app.lp.myWaitConfirm;if(this.data.myWaitAccept)e=this.app.lp.myWaitAccept;this.titleNode.set("text","["+e+"]"+this.data.subject);this.node.addEvent("click",this.openDocument.bind(this))},openDocument:function(){if(!this.document){debugger;if(this.view.currentDocument)this.view.currentDocument.closeDocument();this.document=new MWF.xApplication.Meeting.MeetingView.Document(this);this.view.currentDocument=this.document}},destroy:function(){if(this.document)this.document.closeDocument();this.node.destroy();MWF.release(this)}});MWF.xApplication.Meeting.MeetingView.Document=new Class({initialize:function(t){this.item=t;this.data=this.item.data;this.view=this.item.view;this.css=this.item.css;this.container=this.view.contentNode;this.app=this.view.app;this.isEdit=this.data.applicant==this.app.desktop.session.user.name;this.load()},load:function(){this.createNode();this.show();this.loadContent()},show:function(){var t=this.getNodeCoordinates();var e=new Fx.Morph(this.node,{duration:"500",transition:Fx.Transitions.Expo.easeOut});e.start({opacity:1,width:""+t.width+"px",height:""+t.height+"px",left:""+t.left+"px",top:""+t.top+"px"}).chain(function(){this.setNodeSizeFun=this.setNodeSize.bind(this);this.view.app.addEvent("resize",this.setNodeSizeFun)}.bind(this))},setNodeSize:function(){var t=this.getNodeCoordinates();this.node.setStyles({width:""+t.width+"px",height:""+t.height+"px",left:""+t.left+"px",top:""+t.top+"px"})},getNodeCoordinates:function(){var t=this.container.getSize();var e=t.x*.7;if(e<800)e=800;var i=t.y*.8;if(i<300)i=300;var s=this.container.getPosition(this.container.getOffsetParent());var n=t.x/2-e/2;if(n<0)n=0;n=s.x+n;var o=t.y/2-i/2;if(o<0)o=0;o=s.y+o;return{width:e,height:i,left:n,top:o}},createNode:function(){var t=this.item.node.getSize();this.node=new Element("div",{styles:{width:""+t.x+"px",height:""+t.y+"px","background-color":"#FFF",opacity:0,"z-index":100,border:"1px solid #999",position:"absolute"}}).inject(this.container);this.node.position({relativeTo:this.item.node,position:"topLeft",edge:"topLeft"})},loadContent:function(){this.infoNode=new Element("div",{styles:this.css.documentContentInfoNode}).inject(this.node);this.contentNode=new Element("div",{styles:this.css.documentContentNode}).inject(this.node);this.loadInfos();this.loadBody()},loadBody:function(){this.loadActions();this.loadSubject();this.loadDescription();this.loadAttachment();this.setDescriptionNodeSize();this.setDescriptionNodeSizeFun=this.setDescriptionNodeSize.bind(this);this.app.addEvent("resize",this.setDescriptionNodeSizeFun);if(this.isEdit){this.editDocument()}},editDocument:function(){switch(this.data.status){case"wait":this.addSaveAction();this.subjectNode.empty();this.subjectInput=new Element("input",{styles:this.css.documentContentSubjectInputNode,type:"text",value:this.data.subject}).inject(this.subjectNode);this.descriptionNode.empty();this.descriptionInput=new Element("textarea",{styles:this.css.documentContentDescriptionInputNode,value:this.data.description}).inject(this.descriptionNode);if(this.attachmentController){this.attachmentController.setOptions({readonly:false});this.attachmentController.checkActions()}else{this.isEditAttachment=true}this.loadAddInvite();break;case"processing":break;case"completed":if(this.attachmentController){this.attachmentController.attachments.each(function(t){t.isDelete=false}.bind(this));this.attachmentController.setOptions({readonly:false});this.attachmentController.checkActions()}else{this.isEditCompletedAttachment=true}break}},addSaveAction:function(){this.saveNode=new Element("div",{styles:this.css.documentTopSaveNode}).inject(this.closeNode,"after");this.saveNode.addEvents({mouseover:function(){this.saveNode.setStyles(this.css.documentTopSaveNode_over)}.bind(this),mouseout:function(){this.saveNode.setStyles(this.css.documentTopSaveNode)}.bind(this),mousedown:function(){this.saveNode.setStyles(this.css.documentTopSaveNode_down)}.bind(this),mouseup:function(){this.saveNode.setStyles(this.css.documentTopSaveNode_over)}.bind(this),click:function(t){this.saveDocument()}.bind(this)})},saveDocument:function(t,e){if(this.subjectInput&&this.descriptionInput){var i=this.subjectInput.get("value");var s=this.descriptionInput.get("value");if(!i){if(!t)this.app.notice(this.app.lp.meeting_input_subject_error,"error",this.node,{x:"right",y:"top"});return false}this.data.subject=i;this.data.description=s;this.app.actions.saveMeeting(this.data,function(){if(!t)this.app.notice(this.app.lp.meeting_saveSuccess,"success",this.node,{x:"right",y:"top"});if(!e){var i=this.view;this.closeDocument(function(){i.reload()}.bind(this))}else{this.view.reload()}}.bind(this))}},setDescriptionNodeSize:function(){var t=this.getNodeCoordinates();var e=this.topNode.getSize();var i=this.subjectNode.getSize();var s=this.attachmentNode.getSize();var n=t.height-e.y-i.y-s.y-4;this.descriptionNode.setStyle("height",""+n+"px")},loadActions:function(){this.topNode=new Element("div",{styles:this.css.documentTopNode}).inject(this.contentNode);this.closeNode=new Element("div",{styles:this.css.documentTopCloseNode}).inject(this.topNode);this.closeNode.addEvents({mouseover:function(){this.closeNode.setStyles(this.css.documentTopCloseNode_over)}.bind(this),mouseout:function(){this.closeNode.setStyles(this.css.documentTopCloseNode)}.bind(this),mousedown:function(){this.closeNode.setStyles(this.css.documentTopCloseNode_down)}.bind(this),mouseup:function(){this.closeNode.setStyles(this.css.documentTopCloseNode_over)}.bind(this),click:function(t){this.closeDocument()}.bind(this)})},closeDocument:function(t){if(this.setDescriptionNodeSizeFun)this.app.removeEvent("resize",this.setDescriptionNodeSizeFun);if(this.setNodeSizeFun)this.app.removeEvent("resize",this.setNodeSizeFun);var e=this.item.node.getSize();var i=this.item.node.getPosition(this.item.node.getOffsetParent());var s=new Fx.Morph(this.node,{duration:"500",transition:Fx.Transitions.Expo.easeOut});this.node.empty();this.view.currentDocument=null;s.start({opacity:0,width:""+e.x+"px",height:""+e.y+"px",left:""+i.x+"px",top:""+i.y+"px"}).chain(function(){this.destroy();if(t)t()}.bind(this))},destroy:function(){if(this.setDescriptionNodeSizeFun)this.app.removeEvent("resize",this.setDescriptionNodeSizeFun);if(this.setNodeSizeFun)this.app.removeEvent("resize",this.setNodeSizeFun);this.node.destroy();this.item.document=null;MWF.release(this);delete this},loadSubject:function(){this.subjectNode=new Element("div",{styles:this.css.documentContentSubjectNode}).inject(this.topNode);this.subjectNode.set("text",this.data.subject)},loadDescription:function(){this.descriptionNode=new Element("div",{styles:this.css.documentContentDescriptionNode}).inject(this.contentNode);this.descriptionNode.set("text",this.data.description)},loadAttachment:function(){this.attachmentNode=new Element("div",{styles:this.css.documentContentAttachmentnNode}).inject(this.contentNode);MWF.require("MWF.widget.AttachmentController",function(){var t={size:"min",isSizeChange:false,isReplace:false,readonly:true};if(this.isEditAttachment||this.isEditCompletedAttachment){t={size:"min",isSizeChange:false,isReplace:false,readonly:false}}this.attachmentController=new MWF.widget.AttachmentController(this.attachmentNode,this,t);this.attachmentController.load();this.data.attachmentList.each(function(t){var t=this.attachmentController.addAttachment(t);if(this.isEditCompletedAttachment){t.isDelete=false}}.bind(this))}.bind(this))},uploadAttachment:function(t,e){if(!this.uploadFileAreaNode){this.createUploadFileNode()}this.fileUploadNode.click()},createUploadFileNode:function(){this.uploadFileAreaNode=new Element("div");var t='<input name="file" type="file" multiple/>';this.uploadFileAreaNode.set("html",t);this.fileUploadNode=this.uploadFileAreaNode.getFirst();this.fileUploadNode.addEvent("change",function(){var t=this.fileUploadNode.files;if(t.length){for(var e=0;e<t.length;e++){var i=t.item(e);var s=new FormData;s.append("file",i);this.app.actions.addAttachment(function(t,e){debugger;if(t.id){this.app.actions.getAttachment(t.id,function(t){if(t.data)this.attachmentController.addAttachment(t.data);this.attachmentController.checkActions()}.bind(this))}this.attachmentController.checkActions()}.bind(this),null,s,this.data.id,i)}}}.bind(this))},deleteAttachments:function(t,e,i){var s=[];i.each(function(t){s.push(t.data.name)}.bind(this));var n=this;this.app.confirm("warn",t,this.lp.deleteAttachmentTitle,this.lp.deleteAttachment+"( "+s.join(", ")+" )",300,120,function(){while(i.length){attachment=i.shift();n.deleteAttachment(attachment)}this.close()},function(){this.close()},null)},deleteAttachment:function(t){this.app.actions.deleteFile(t.data.id,function(e){this.attachmentController.removeAttachment(t);this.attachmentController.checkActions()}.bind(this))},downloadAttachment:function(t,e,i){i.each(function(t){this.app.actions.getFileDownload(t.data.id)}.bind(this))},openAttachment:function(t,e,i){i.each(function(t){this.app.actions.getFile(t.data.id)}.bind(this))},getAttachmentUrl:function(t,e){this.app.actions.getFileUrl(t.data.id,e)},loadInfos:function(){var t=this.app.lp.meetingApply.replace(/{person}/g,"<div></div>");if(this.data.applicant==this.app.desktop.session.user.name){t=this.app.lp.myMeetingApply}if(this.data.status!="completed"&&!this.data.myReject){if(this.data.myWaitConfirm){t=t+"<br/>"+this.app.lp.waitConfirm}else if(this.data.myWaitAccept){t=t+"<br/>"+this.app.lp.waitAccept}else if(this.data.applicant==this.app.desktop.session.user.name){t=this.app.lp.myMeetingApply+"<br/>"+this.app.lp.attend}else if(this.data.acceptPersonList.indexOf(this.app.desktop.session.user.name)!=-1){t=t+"<br/>"+this.app.lp.isAccept}}this.infoTitleNode=new Element("div",{styles:this.css.documentInfoTitleNode}).inject(this.infoNode);var e=new Element("div",{styles:this.css.documentInfoTitleTextNode,html:t}).inject(this.infoTitleNode);var i=e.getElement("div");if(i){var s={actions:this.app.personActions,app:{lp:this.app.lp}};MWF.require("MWF.widget.Identity",function(){var t=new MWF.widget.Person({name:this.data.applicant},i,s,false,null,{style:"meetingApply"})}.bind(this))}if(this.data.myWaitConfirm)this.createConfirmActions();if(this.data.myWaitAccept)this.createAcceptActions();if(this.data.status=="wait"&&this.isEdit)this.createCancelActions();this.loadDate();this.loadTime();this.loadRoom();this.loadInvite()},createConfirmActions:function(){var t=new Element("div",{styles:this.css.documentInfoTitleActionNode}).inject(this.infoTitleNode);this.disagreeAction=new Element("div",{styles:this.css.documentInfoActionNode}).inject(t);this.disagreeActionIcon=new Element("div",{styles:this.css.documentInfoActionIconRejectNode}).inject(this.disagreeAction);this.disagreeActionText=new Element("div",{styles:this.css.documentInfoActionTextNode,text:this.app.lp.reject}).inject(this.disagreeAction);this.agreeAction=new Element("div",{styles:this.css.documentInfoActionNode}).inject(t);this.agreeActionIcon=new Element("div",{styles:this.css.documentInfoActionIconAcceptNode}).inject(this.agreeAction);this.agreeActionText=new Element("div",{styles:this.css.documentInfoActionTextNode,text:this.app.lp.accept}).inject(this.agreeAction);this.disagreeAction.addEvents({mouseover:function(){this.disagreeAction.setStyles(this.css.documentInfoActionNode_over);this.disagreeActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),mouseout:function(){this.disagreeAction.setStyles(this.css.documentInfoActionNode);this.disagreeActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),mousedown:function(){this.disagreeAction.setStyles(this.css.documentInfoActionNode_down);this.disagreeActionIcon.setStyles(this.css.documentInfoActionIconRejectNode_down)}.bind(this),mouseup:function(){this.disagreeAction.setStyles(this.css.documentInfoActionNode_over);this.disagreeActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),click:function(t){this.disagree(t)}.bind(this)});this.agreeAction.addEvents({mouseover:function(){this.agreeAction.setStyles(this.css.documentInfoActionNode_over);this.agreeActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode)}.bind(this),mouseout:function(){this.agreeAction.setStyles(this.css.documentInfoActionNode);this.agreeActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode)}.bind(this),mousedown:function(){this.agreeAction.setStyles(this.css.documentInfoActionNode_down);this.agreeActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode_down)}.bind(this),mouseup:function(){this.agreeAction.setStyles(this.css.documentInfoActionNode_over);this.agreeActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode)}.bind(this),click:function(t){this.agree(t)}.bind(this)})},createAcceptActions:function(){var t=new Element("div",{styles:this.css.documentInfoTitleActionNode}).inject(this.infoTitleNode);this.rejectAction=new Element("div",{styles:this.css.documentInfoActionNode}).inject(t);this.rejectActionIcon=new Element("div",{styles:this.css.documentInfoActionIconRejectNode}).inject(this.rejectAction);this.rejectActionText=new Element("div",{styles:this.css.documentInfoActionTextNode,text:this.app.lp.reject}).inject(this.rejectAction);this.acceptAction=new Element("div",{styles:this.css.documentInfoActionNode}).inject(t);this.acceptActionIcon=new Element("div",{styles:this.css.documentInfoActionIconAcceptNode}).inject(this.acceptAction);this.acceptActionText=new Element("div",{styles:this.css.documentInfoActionTextNode,text:this.app.lp.accept}).inject(this.acceptAction);this.rejectAction.addEvents({mouseover:function(){this.rejectAction.setStyles(this.css.documentInfoActionNode_over);this.rejectActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),mouseout:function(){this.rejectAction.setStyles(this.css.documentInfoActionNode);this.rejectActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),mousedown:function(){this.rejectAction.setStyles(this.css.documentInfoActionNode_down);this.rejectActionIcon.setStyles(this.css.documentInfoActionIconRejectNode_down)}.bind(this),mouseup:function(){this.rejectAction.setStyles(this.css.documentInfoActionNode_over);this.rejectActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),click:function(t){this.reject(t)}.bind(this)});this.acceptAction.addEvents({mouseover:function(){this.acceptAction.setStyles(this.css.documentInfoActionNode_over);this.acceptActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode)}.bind(this),mouseout:function(){this.acceptAction.setStyles(this.css.documentInfoActionNode);this.acceptActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode)}.bind(this),mousedown:function(){this.acceptAction.setStyles(this.css.documentInfoActionNode_down);this.acceptActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode_down)}.bind(this),mouseup:function(){this.acceptAction.setStyles(this.css.documentInfoActionNode_over);this.acceptActionIcon.setStyles(this.css.documentInfoActionIconAcceptNode)}.bind(this),click:function(t){this.accept(t)}.bind(this)})},createCancelActions:function(){var t=new Element("div",{styles:this.css.documentInfoTitleActionNode}).inject(this.infoTitleNode);this.cancelAction=new Element("div",{styles:this.css.documentInfoActionNode}).inject(t);this.cancelActionIcon=new Element("div",{styles:this.css.documentInfoActionIconAcceptNode}).inject(this.cancelAction);this.cancelActionText=new Element("div",{styles:this.css.documentInfoActionTextNode,text:this.app.lp.cancelMeeting}).inject(this.cancelAction);this.cancelAction.setStyle("width","80px");this.cancelAction.addEvents({mouseover:function(){this.cancelAction.setStyles(this.css.documentInfoActionNode_over);this.cancelActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),mouseout:function(){this.cancelAction.setStyles(this.css.documentInfoActionNode);this.cancelAction.setStyle("width","80px");this.cancelActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),mousedown:function(){this.cancelAction.setStyles(this.css.documentInfoActionNode_down);this.cancelActionIcon.setStyles(this.css.documentInfoActionIconRejectNode_down)}.bind(this),mouseup:function(){this.cancelAction.setStyles(this.css.documentInfoActionNode_over);this.cancelActionIcon.setStyles(this.css.documentInfoActionIconRejectNode)}.bind(this),click:function(t){this.cancel(t)}.bind(this)})},cancel:function(t){var e=this;var i=this.app.lp.cancel_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.cancel_confirm_title,i,380,150,function(){e.cancelMeeting();this.close()},function(){this.close()})},cancelMeeting:function(){this.app.actions.deleteMeeting(this.data.id,function(){var t=this.view;this.closeDocument(function(){t.reload()}.bind(this))}.bind(this))},reject:function(t){var e=this;var i=this.app.lp.reject_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.reject_confirm_title,i,300,120,function(){e.rejectMeeting();this.close()},function(){this.close()})},rejectMeeting:function(){this.app.actions.rejectMeeting(this.data.id,function(){var t=this.view;this.closeDocument(function(){t.reload()}.bind(this))}.bind(this))},accept:function(t){var e=this;var i=this.app.lp.accept_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.accept_confirm_title,i,300,120,function(){e.acceptMeeting();this.close()},function(){this.close()})},acceptMeeting:function(){this.app.actions.acceptMeeting(this.data.id,function(){var t=this.view;this.closeDocument(function(){t.reload()}.bind(this))}.bind(this))},disagree:function(t){var e=this;var i=this.app.lp.disagree_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.disagree_confirm_title,i,300,120,function(){e.disagreeMeeting();this.close()},function(){this.close()})},disagreeMeeting:function(){this.app.actions.denyMeeting(this.data.id,function(){var t=this.view;this.closeDocument(function(){t.reload()}.bind(this))}.bind(this))},agree:function(t){var e=this;var i=this.app.lp.agree_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.agree_confirm_title,i,300,120,function(){e.agreeMeeting();this.close()},function(){this.close()})},agreeMeeting:function(){this.app.actions.allowMeeting(this.data.id,function(){var t=this.view;this.closeDocument(function(){t.reload()}.bind(this))}.bind(this))},loadDate:function(){var t=new Element("div",{styles:this.css.documentInfoLineNode}).inject(this.infoNode);var e=new Element("div",{styles:this.css.documentInfoTextNode,text:this.app.lp.beginDate}).inject(t);var i=new Element("div",{styles:this.css.documentInfoBodyNode}).inject(t);var s=Date.parse(this.data.startTime).format(this.app.lp.dateFormatDay);i.set("text",s)},loadTime:function(){var t=new Element("div",{styles:this.css.documentInfoLineNode}).inject(this.infoNode);var e=new Element("div",{styles:this.css.documentInfoTextNode,text:this.app.lp.time}).inject(t);var i=new Element("div",{styles:this.css.documentInfoBody1Node}).inject(t);var s=Date.parse(this.data.startTime).format("%H:%M");i.set("text",s);tmpNode=new Element("div",{styles:this.css.documentInfoBody2Node,text:"-"}).inject(t);i=new Element("div",{styles:this.css.documentInfoBody1Node}).inject(t);s=Date.parse(this.data.completedTime).format("%H:%M");i.set("text",s);var n=Date.parse(this.data.startTime).diff(Date.parse(this.data.completedTime),"minute");var o=(n/60).toInt();var n=n%60;var c="";if(n==0){c=this.app.lp.timeRangeHour.replace(/{n}/g,o)}else{c=this.app.lp.timeRangeMinute.replace(/{h}/g,o).replace(/{m}/g,n)}i=new Element("div",{styles:this.css.documentInfoBody3Node,text:c}).inject(t)},loadRoom:function(){var t=new Element("div",{styles:this.css.documentInfoLineNode}).inject(this.infoNode);var e=new Element("div",{styles:this.css.documentInfoTextNode,text:this.app.lp.selectRoom}).inject(t);var i=new Element("div",{styles:this.css.documentInfoBodyNode}).inject(t);this.app.actions.getRoom(this.data.room,function(t){this.app.actions.getBuilding(t.data.building,function(e){var s="";if(t.data.roomNumber){s=t.data.name+" ("+e.data.name+" "+t.data.floor+this.app.lp.floor+" #"+t.data.roomNumber+") "}else{s=t.data.name+" ("+e.data.name+" "+t.data.floor+this.app.lp.floor+") "}i.set("text",s)}.bind(this))}.bind(this))},loadInvite:function(){this.inviteLineNode=new Element("div",{styles:this.css.documentInfoLineNode}).inject(this.infoNode);var t=new Element("div",{styles:this.css.documentInfoTextNode,text:this.app.lp.invitePerson1}).inject(this.inviteLineNode);this.inviteBodyNode=new Element("div",{styles:this.css.documentInfoBodyNode}).inject(this.inviteLineNode);var e={actions:this.app.personActions,app:{lp:this.app.lp}};MWF.require("MWF.widget.Identity",function(){this.data.invitePersonList.each(function(t){debugger;var i=new MWF.widget.Person({name:t},this.inviteBodyNode,e,false,null,{style:"room",onLoadedInfor:function(){if(this.data.acceptPersonList.indexOf(t)!=-1){var e=new Element("div",{styles:this.css.documentInfoAcceptIconNode}).inject(i.node,"top");new Element("div",{styles:this.css.documentInfoAcceptTextNode,text:this.app.lp.accepted}).inject(i.inforNode)}if(this.data.rejectPersonList.indexOf(t)!=-1){var s=new Element("div",{styles:this.css.documentInfoRejectIconNode}).inject(i.node,"top");new Element("div",{styles:this.css.documentInfoRejectTextNode,text:this.app.lp.rejected}).inject(i.inforNode)}}.bind(this)})}.bind(this))}.bind(this))},loadAddInvite:function(){this.addInviteNode=new Element("div",{styles:this.css.documentAddInviteActionNode}).inject(this.inviteLineNode);this.addInviteIconNode=new Element("div",{styles:this.css.documentAddInviteActionIconNode}).inject(this.addInviteNode);this.addInviteTextNode=new Element("div",{styles:this.css.documentAddInviteActionTextNode,text:this.app.lp.addInvitePerson1}).inject(this.addInviteNode);this.addInviteNode.addEvents({mouseover:function(){this.addInviteNode.setStyles(this.css.documentAddInviteActionNode_over);this.addInviteIconNode.setStyles(this.css.documentAddInviteActionIconNode)}.bind(this),mouseout:function(){this.addInviteNode.setStyles(this.css.documentAddInviteActionNode);this.addInviteIconNode.setStyles(this.css.documentAddInviteActionIconNode)}.bind(this),mousedown:function(){this.addInviteNode.setStyles(this.css.documentAddInviteActionNode_down);this.addInviteIconNode.setStyles(this.css.documentAddInviteActionIconNode_down)}.bind(this),mouseup:function(){this.addInviteNode.setStyles(this.css.documentAddInviteActionNode_over);this.addInviteIconNode.setStyles(this.css.documentAddInviteActionIconNode)}.bind(this)});var t={actions:this.app.personActions,app:{lp:this.app.lp}};MWF.xDesktop.requireApp("Organization","Selector.package",function(){this.addInviteNode.addEvents({click:function(){var e={type:"person",names:[],count:0,onComplete:function(e){MWF.require("MWF.widget.Identity",function(){var i=[];e.each(function(e){var s=this;var n=new MWF.widget.Person(e.data,this.inviteBodyNode,t,false,null,{style:"room"});i.push(e.data.name)}.bind(this));this.app.actions.addMeetingInvite({invitePersonList:i,id:this.data.id},function(t){this.app.actions.getMeeting(t.data.id,function(t){this.data.invitePersonList=t.data.invitePersonList;this.app.notice(this.app.lp.addedInvitePerson1,"success",this.node,{x:"left",y:"top"})}.bind(this))}.bind(this))}.bind(this))}.bind(this)};var i=new MWF.OrgSelector(this.app.content,e)}.bind(this)})}.bind(this))}});