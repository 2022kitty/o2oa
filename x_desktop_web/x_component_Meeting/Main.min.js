MWF.require("MWF.xDesktop.UserData",null,false);MWF.require("MWF.xAction.org.express.RestActions",null,false);MWF.xDesktop.requireApp("Meeting","Actions.RestActions",null,false);MWF.xDesktop.requireApp("Meeting","MeetingView",null,false);MWF.xApplication.Meeting.options.multitask=false;MWF.xApplication.Meeting.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"Meeting",icon:"icon.png",width:"1000",height:"600",isResize:true,isMax:true,title:MWF.xApplication.Meeting.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Meeting.LP;this.menuMode="show";this.isManager=MWF.AC.isMeetingAdministrator();if(!this.actions)this.actions=new MWF.xApplication.Meeting.Actions.RestActions;if(!this.personActions)this.personActions=new MWF.xAction.org.express.RestActions},loadApplication:function(e){MWF.UD.getDataJson("meetingConfig",function(t){this.meetingConfig=t||{};this.createNode();if(!this.options.isRefresh){this.maxSize(function(){this.loadLayout()}.bind(this))}else{this.loadLayout()}if(e)e()}.bind(this))},createNode:function(){this.content.setStyle("overflow","hidden");this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden"}}).inject(this.content)},loadLayout:function(){this.topMenu=new Element("div",{styles:this.css.topMenu}).inject(this.node);this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node);this.bottomMenu=new Element("div",{styles:this.css.bottomMenu}).inject(this.node);this.loadTopMenus();this.loadBottomMenus();this.hideMenu();this.node.addEvent("contextmenu",function(e){if(this.menuMode=="show"){this.hideMenu()}else{this.showMenu()}e.preventDefault()}.bind(this));this.setEvent();if(this.meetingConfig.defaultView){this[this.meetingConfig.defaultView]()}else{this.toMyMeeting()}},setEvent:function(){this.contentNode.addEvent("click",function(){this.hideMenu()}.bind(this))},loadTopMenus:function(){this.createTopMenu(this.lp.myMeeting,"myMeeting","toMyMeeting");this.createTopMenu(this.lp.month,"month","toMonth");this.createTopMenu(this.lp.day,"day","toDay");this.createTopMenu(this.lp.list,"list","toList");this.createTopMenu(this.lp.room,"room","toRoom")},createTopMenu:function(e,t,i){var o=new Element("div",{styles:this.css.topMenuNode}).inject(this.topMenu);var n=new Element("div",{styles:this.css.topMenuIconNode}).inject(o);n.setStyle("background","url(/x_component_Meeting/$Main/default/icon/"+t+".png) no-repeat center center");var s=new Element("div",{styles:this.css.topMenuTextNode,text:e}).inject(o);var c=this;o.addEvents({mouseover:function(){this.setStyles(c.css.topMenuNode_over)},mouseout:function(){this.setStyles(c.css.topMenuNode)},mousedown:function(){this.setStyles(c.css.topMenuNode_down)},mouseup:function(){this.setStyles(c.css.topMenuNode_over)},click:function(){if(c[i])c[i].apply(c)}});return o},loadBottomMenus:function(){this.createBottomMenu(this.lp.addMeeting,"add","addMeeting");if(this.isManager)this.createBottomMenu(this.lp.addRoom,"addRoom","addRoom");var e=this.createBottomMenu(this.lp.refresh,"refresh","refresh");e.setStyle("float","right");var t=this.createBottomMenu(this.lp.config,"setup","config");t.setStyle("float","right")},createBottomMenu:function(e,t,i){var o=new Element("div",{styles:this.css.bottomMenuNode,title:e}).inject(this.bottomMenu);o.setStyle("background","url(/x_component_Meeting/$Main/default/icon/"+t+".png) no-repeat center center");var n=this;o.addEvents({mouseover:function(){this.setStyle("background","url(/x_component_Meeting/$Main/default/icon/"+t+"_over.png) no-repeat center center")},mouseout:function(){this.setStyle("background","url(/x_component_Meeting/$Main/default/icon/"+t+".png) no-repeat center center")},mousedown:function(){this.setStyle("background","url(/x_component_Meeting/$Main/default/icon/"+t+"_down.png) no-repeat center center")},mouseup:function(){this.setStyle("background","url(/x_component_Meeting/$Main/default/icon/"+t+"_over.png) no-repeat center center")},click:function(){if(n[i])n[i].apply(n)}});return o},hideMenu:function(){if(!this.meetingConfig.hideMenu)this.meetingConfig.hideMenu="static";if(this.meetingConfig.hideMenu!="static"){if(this.menuMode=="show"){this.topMenu.set("tween",{duration:100,transition:"bounce:out"});this.bottomMenu.set("tween",{duration:100,transition:"bounce:out"});this.topMenu.tween("top","0px","-50px");this.bottomMenu.tween("bottom","0px","-50px");this.menuMode="hide";if(!this.topMenuPoint){this.topMenuPoint=new Element("div",{styles:this.css.topMenuPoint}).inject(this.topMenu);this.topMenuPointAction=new Element("div",{styles:this.css.menuPointAction}).inject(this.topMenuPoint);this.topMenuPointAction.addEvent("mouseover",function(){this.showMenu()}.bind(this))}if(!this.bottomMenuPoint){this.bottomMenuPoint=new Element("div",{styles:this.css.bottomMenuPoint}).inject(this.bottomMenu);this.bottomMenuPointAction=new Element("div",{styles:this.css.menuPointAction}).inject(this.bottomMenuPoint);this.bottomMenuPointAction.addEvent("mouseover",function(){this.showMenu()}.bind(this))}this.topMenuPoint.setStyle("display","block");this.bottomMenuPoint.setStyle("display","block")}}},showMenu:function(){if(this.menuMode!="show"){this.topMenu.set("tween",{duration:100,transition:"bounce:out"});this.bottomMenu.set("tween",{duration:100,transition:"bounce:out"});this.topMenu.tween("top","-50px","0px");this.bottomMenu.tween("bottom","-50px","0px");this.menuMode="show";if(this.topMenuPoint)this.topMenuPoint.setStyle("display","none");if(this.bottomMenuPoint)this.bottomMenuPoint.setStyle("display","none")}},hideCurrentView:function(){if(this.currentView){this.currentView.hide();this.currentView=null}},toMyMeeting:function(){this.contentNode.setStyles(this.css.contentNode);if(!this.myMeetingView||this.currentView!=this.myMeetingView){this.hideCurrentView();this.getMyMeetingView(function(){this.myMeetingView.show();this.currentView=this.myMeetingView}.bind(this));this.hideMenu()}},getMyMeetingView:function(e){if(!this.myMeetingView){MWF.xDesktop.requireApp("Meeting","MeetingView",function(){this.myMeetingView=new MWF.xApplication.Meeting.MeetingView(this.contentNode,this);if(e)e()}.bind(this))}else{if(e)e()}},toList:function(){this.contentNode.setStyle("background","#EEE");if(!this.listView||this.currentView!=this.listView){this.hideCurrentView();this.getListView(function(){this.listView.show();this.currentView=this.listView}.bind(this));this.hideMenu()}},getListView:function(e){if(!this.listView){MWF.xDesktop.requireApp("Meeting","ListView",function(){this.listView=new MWF.xApplication.Meeting.ListView(this.contentNode,this);if(e)e()}.bind(this))}else{if(e)e()}},toMonth:function(){this.contentNode.setStyle("background","#EEE");if(!this.monthView||this.currentView!=this.monthView){this.hideCurrentView();this.getMonthView(function(){this.monthView.show();this.currentView=this.monthView}.bind(this));this.hideMenu()}},getMonthView:function(e){if(!this.monthView){MWF.xDesktop.requireApp("Meeting","MonthView",function(){this.monthView=new MWF.xApplication.Meeting.MonthView(this.contentNode,this);if(e)e()}.bind(this))}else{if(e)e()}},toDay:function(e){this.contentNode.setStyle("background","#EEE");if(!this.dayView||this.currentView!=this.dayView){this.hideCurrentView();this.getDayView(function(){this.dayView.show();this.currentView=this.dayView}.bind(this),e);this.hideMenu()}},getDayView:function(e,t){if(!this.dayView){MWF.xDesktop.requireApp("Meeting","DayView",function(){this.dayView=new MWF.xApplication.Meeting.DayView(this.contentNode,this,{date:t});if(e)e()}.bind(this))}else{this.dayView.toDay(t);if(e)e()}},toRoom:function(){this.contentNode.setStyle("background","#EEE");if(!this.roomView||this.currentView!=this.roomView){this.hideCurrentView();this.getRoomView(function(){this.roomView.show();this.currentView=this.roomView}.bind(this));this.hideMenu()}},getRoomView:function(e){if(!this.roomView){MWF.xDesktop.requireApp("Meeting","RoomView",function(){this.roomView=new MWF.xApplication.Meeting.RoomView(this.contentNode,this);if(e)e()}.bind(this))}else{if(e)e()}},refresh:function(){this.hideMenu();if(this.currentView)this.currentView.reload()},addMeeting:function(e,t,i){MWF.UD.getPublicData("meetingConfig",function(o){var n=o?o.process:null;if(n){}else{new MWF.xApplication.Meeting.Creator(this,e,t,i);this.hideMenu()}}.bind(this))},config:function(){new MWF.xApplication.Meeting.Config(this,this.meetingConfig);this.hideMenu()},addRoom:function(){this.createAddRoomNodes();var e=new Fx.Morph(this.createRoomNode,{duration:"300",transition:Fx.Transitions.Sine.easeOut});e.start({opacity:1})},createAddRoomNodes:function(){this.createRoomNode=new Element("div",{styles:this.css.createRoomNode}).inject(this.node);var e=new Element("div",{styles:this.css.createRoomAreaNode}).inject(this.createRoomNode);var t=new Element("div",{styles:this.css.createRoomTitleNode,text:this.lp.addRoom}).inject(e);var i=new Element("div",{styles:this.css.createRoomContentNode}).inject(e);var o=new Element("div",{styles:this.css.createRoomBottomNode}).inject(e);var n=new Element("div",{styles:this.css.createRoomFormNode,html:"<div>"+this.lp.roomForm.name+'</div><div><input type="text"/></div>'}).inject(i);n.getFirst("div").setStyles(this.css.createRoomFormTitleNode);n.getLast("div").setStyles(this.css.createRoomFormContentNode);this.createRoomNameInput=n.getElement("input").setStyles(this.css.createRoomFormInput);var s=new Element("div",{styles:this.css.createRoomFormNode,html:"<div>"+this.lp.roomForm.building+'</div><div><input type="text"/></div>'}).inject(i);s.getFirst("div").setStyles(this.css.createRoomFormTitleNode);s.getLast("div").setStyles(this.css.createRoomFormContentNode);this.createRoomBuildingInput=s.getElement("input").setStyles(this.css.createRoomFormInput);var c=new Element("div",{styles:this.css.createRoomFormNode2,html:"<div>"+this.lp.roomForm.floor+"</div><div></div>"}).inject(i);c.getFirst("div").setStyles(this.css.createRoomFormTitleNode);var a=c.getLast("div").setStyles(this.css.createRoomFormContentNode);this.createRoomFloorSelect=new Element("select",{styles:this.css.createRoomFormSelect}).inject(a);for(var d=-2;d<=50;d++){var l=new Element("option",{value:d,text:d+this.lp.floor,selected:d==1}).inject(this.createRoomFloorSelect)}var r=new Element("div",{styles:this.css.createRoomFormNode3,html:"<div>"+this.lp.roomForm.capacity+'</div><div><input type="number"/></div>'}).inject(i);r.getFirst("div").setStyles(this.css.createRoomFormTitleNode);r.getLast("div").setStyles(this.css.createRoomFormContentNode);this.createRoomCapacityInput=r.getElement("input").setStyles(this.css.createRoomFormInput);var h=new Element("div",{styles:this.css.createRoomFormNode2,html:"<div>"+this.lp.roomForm.roomNumber+'</div><div><input type="text"/></div>'}).inject(i);h.getFirst("div").setStyles(this.css.createRoomFormTitleNode);h.getLast("div").setStyles(this.css.createRoomFormContentNode);this.createRoomRoomNumberInput=h.getElement("input").setStyles(this.css.createRoomFormInput);var u=new Element("div",{styles:this.css.createRoomFormNode3,html:"<div>"+this.lp.roomForm.phone+'</div><div><input type="text"/></div>'}).inject(i);u.getFirst("div").setStyles(this.css.createRoomFormTitleNode);u.getLast("div").setStyles(this.css.createRoomFormContentNode);this.createRoomRoomPhoneNode=u.getElement("input").setStyles(this.css.createRoomFormInput);var m=new Element("div",{styles:this.css.createRoomFormNode,html:"<div>"+this.lp.roomForm.auditor+"</div><div></div>"}).inject(i);m.getFirst("div").setStyles(this.css.createRoomFormTitleNode);this.createRoomRoomAuditorNode=m.getLast("div").setStyles(this.css.createRoomFormAuditorNode);m.setStyle("display","none");var p=new Element("div",{styles:this.css.createRoomFormNode2,html:"<div>"+this.lp.roomForm.device+"</div><div></div>"}).inject(i);p.getFirst("div").setStyles(this.css.createRoomFormTitleNode);this.createRoomDeviceChecks=p.getLast("div").setStyles(this.css.createRoomFormContentNode2);Object.each(this.lp.device,function(e,t){new Element("div",{styles:{float:"left",width:"80px"},html:'<input type="checkbox" name="createRoomDeviceCheckbox" value="'+t+'">'+e}).inject(this.createRoomDeviceChecks)}.bind(this));var v=new Element("div",{styles:this.css.createRoomFormNode3,html:"<div>"+this.lp.roomForm.available+"</div><div></div>"}).inject(i);v.getFirst("div").setStyles(this.css.createRoomFormTitleNode);this.createRoomAvailableChecks=v.getLast("div").setStyles(this.css.createRoomFormContentNode2);new Element("div",{styles:{float:"left"},html:'<input type="radio" name="createRoomAvailableRadio" checked value="y">'+this.lp.enable}).inject(this.createRoomAvailableChecks);new Element("div",{styles:{float:"left"},html:'<input type="radio" name="createRoomAvailableRadio" value="n">'+this.lp.disable}).inject(this.createRoomAvailableChecks);this.createRoomCancelActionNode=new Element("div",{styles:this.css.createRoomCancelActionNode,text:this.lp.cancel}).inject(o);this.createRoomOkActionNode=new Element("div",{styles:this.css.createRoomOkActionNode,text:this.lp.save}).inject(o);this.createRoomCancelActionNode.addEvent("click",function(e){this.createRoomCancel(e)}.bind(this));this.createRoomOkActionNode.addEvent("click",function(e){this.createRoomSave(e)}.bind(this));this.setCreateRoomEvent()},setCreateRoomEvent:function(){this.createRoomNameInput.addEvents({focus:function(){var e=this.createRoomNameInput.retrieve("errorNode",null);if(e){e.destroy();this.createRoomNameInput.eliminate("errorNode");this.createRoomNameInput.setStyle("border","1px solid #999")}}.bind(this),blur:function(){if(!this.createRoomNameInput.get("value"))this.createRoomVerification(this.createRoomNameInput,this.lp.roomForm.verification.inputName)}.bind(this)});this.createRoomBuildingInput.addEvents({focus:function(){var e=this.createRoomBuildingInput.retrieve("errorNode",null);if(e){e.destroy();this.createRoomBuildingInput.eliminate("errorNode");this.createRoomBuildingInput.setStyle("border","1px solid #999")}}.bind(this),blur:function(){var e=false;var t=this.createRoomBuildingInput.retrieve("buildingId");if(!t){var i=this.createRoomBuildingInput.get("value");if(i)e=true}if(!t&&!e)this.createRoomVerification(this.createRoomBuildingInput,this.lp.roomForm.verification.inputBuilding)}.bind(this)});this.createRoomCapacityInput.addEvents({focus:function(){var e=this.createRoomCapacityInput.retrieve("errorNode",null);if(e){e.destroy();this.createRoomCapacityInput.eliminate("errorNode");this.createRoomCapacityInput.setStyle("border","1px solid #999")}}.bind(this),blur:function(){if(!this.createRoomCapacityInput.get("value"))this.createRoomVerification(this.createRoomCapacityInput,this.lp.roomForm.verification.inputCapacity)}.bind(this)});this.createRoomBuildingInput.addEvents({focus:function(){this.createRoomListBuilding()}.bind(this),change:function(){this.createRoomBuildingInput.eliminate("buildingId")}.bind(this),keydown:function(e){if(e.code==13){this.createRoomListBuildingHide();this.createRoomListBuilding()}if(e.code==40)this.createRoomSelectBuildingNext();if(e.code==38)this.createRoomSelectBuildingPrev();if(e.code==32)this.createRoomSelectBuildingConfirm(e)}.bind(this)});MWF.xDesktop.requireApp("Organization","Selector.package",function(){var e=this.createRoomRoomAuditorNode.retrieve("names",null);this.createRoomRoomAuditorNode.addEvents({click:function(){var t={type:"person",names:e?[e]:[],count:1,onComplete:function(e){var t=this.createRoomRoomAuditorNode.retrieve("person");if(t){t.node.destroy();MWF.release(t);this.createRoomRoomAuditorNode.eliminate("person")}this.createRoomRoomAuditorNode.store("names",e[0].data.name);MWF.require("MWF.widget.Identity",function(){var t={actions:this.personActions,app:{lp:this.lp}};var i=this;var o=new MWF.widget.Person(e[0].data,this.createRoomRoomAuditorNode,t,true,function(e){this.node.destroy();MWF.release(this);i.createRoomRoomAuditorNode.eliminate("names");i.createRoomRoomAuditorNode.eliminate("person");e.stopPropagation()},{style:"meeting"});this.createRoomRoomAuditorNode.store("person",o)}.bind(this))}.bind(this)};var i=new MWF.OrgSelector(this.content,t)}.bind(this)})}.bind(this))},createRoomSelectBuildingNext:function(){if(this.createRoomSelectBuildingNode){var e=nu;if(this.createRoomSelectBuildingNode.selectedNode){var e=this.createRoomSelectBuildingNode.selectedNode.getNext();if(!e)e=this.createRoomSelectBuildingNode.getFirst();this.createRoomSelectBuildingNode.selectedNode.setStyle("background-color",this.createRoomSelectBuildingNode.selectedNode.retrieve("bg"))}else{e=this.createRoomSelectBuildingNode.getFirst()}if(e){var t=e.getStyle("background-color");e.store("bg",t);e.setStyles(this.css.createRoomBuildingSelectItem_over);this.createRoomSelectBuildingNode.selectedNode=e}}},createRoomSelectBuildingPrev:function(){if(this.createRoomSelectBuildingNode){var e=null;if(this.createRoomSelectBuildingNode.selectedNode){var e=this.createRoomSelectBuildingNode.selectedNode.getPrevious();if(!e)e=this.createRoomSelectBuildingNode.getLast();this.createRoomSelectBuildingNode.selectedNode.setStyle("background-color",this.createRoomSelectBuildingNode.selectedNode.retrieve("bg"))}else{e=this.createRoomSelectBuildingNode.getLast()}if(e){var t=e.getStyle("background-color");e.store("bg",t);e.setStyles(this.css.createRoomBuildingSelectItem_over);this.createRoomSelectBuildingNode.selectedNode=e}}},createRoomSelectBuildingConfirm:function(e){if(this.createRoomSelectBuildingNode.selectedNode){this.selectBuilding(this.createRoomSelectBuildingNode.selectedNode);e.preventDefault()}},createRoomListBuilding:function(){var e=this.createRoomBuildingInput.get("value");this.actions.listBuildingByKey(e,function(e){if(e.data&&e.data.length){this.createRoomSelectBuildingNode=new Element("div",{styles:this.css.createRoomSelectBuildingNode}).inject(this.createRoomNode);this.setCreateRoomSelectBuildingNodeSize();this.createRoomListBuildingHideFun=this.createRoomListBuildingHide.bind(this);this.node.addEvent("mousedown",this.createRoomListBuildingHideFun);var t=this;e.data.each(function(e,i){var o=new Element("div",{styles:this.css.createRoomBuildingSelectItem}).inject(this.createRoomSelectBuildingNode);var n=new Element("div",{styles:this.css.createRoomBuildingSelectItemName,text:e.name}).inject(o);var s=new Element("div",{styles:this.css.createRoomBuildingSelectItemAddr,text:e.address}).inject(o);if(i%2==1)o.setStyle("background-color","#f1f6ff");o.store("building",e.id);o.addEvents({mouseover:function(e){var i=this.getStyle("background-color");this.store("bg",i);this.setStyles(t.css.createRoomBuildingSelectItem_over)},mouseout:function(e){this.setStyle("background-color",this.retrieve("bg"))},mousedown:function(e){e.stopPropagation()},click:function(e){t.selectBuilding(this)}})}.bind(this))}}.bind(this))},selectBuilding:function(e){var t=e.retrieve("building");var i=e.getFirst().get("text");this.createRoomBuildingInput.set("value",i);this.createRoomBuildingInput.store("buildingId",t);this.createRoomListBuildingHide();var o=this.createRoomBuildingInput.retrieve("errorNode",null);if(o){o.destroy();this.createRoomBuildingInput.eliminate("errorNode");this.createRoomBuildingInput.setStyle("border","1px solid #999")}},setCreateRoomSelectBuildingNodeSize:function(){var e=this.createRoomBuildingInput.getPosition(this.createRoomBuildingInput.getOffsetParent());this.createRoomSelectBuildingNode.position({relativeTo:this.createRoomBuildingInput,position:"bottomCenter",edge:"upperCenter",offset:{x:0-e.x,y:0}});this.createRoomSelectBuildingNode.setStyle("left",e.x);var t=this.createRoomBuildingInput.getSize();var i=t.x-2;this.createRoomSelectBuildingNode.setStyle("width",""+i+"px")},createRoomListBuildingHide:function(){if(this.createRoomSelectBuildingNode){this.createRoomSelectBuildingNode.destroy();this.createRoomSelectBuildingNode=null;this.node.removeEvent("mousedown",this.createRoomListBuildingHideFun)}},createRoomCancel:function(){var e=new Fx.Morph(this.createRoomNode,{duration:"300",transition:Fx.Transitions.Sine.easeOut});e.start({opacity:0}).chain(function(){this.createRoomNode.destroy();this.createRoomNode=null;this.createRoomNameInput=null;this.createRoomBuildingInput=null;this.createRoomFloorSelect=null;this.createRoomCapacityInput=null;this.createRoomRoomNumberInput=null;this.createRoomRoomAuditorNode=null;this.createRoomDeviceChecks=null;this.createRoomAvailableChecks=null;this.createRoomCancelActionNode=null;this.createRoomOkActionNode=null;this.createRoomSelectBuildingNode=null;delete this.createRoomNameInput;delete this.createRoomBuildingInput;delete this.createRoomFloorSelect;delete this.createRoomCapacityInput;delete this.createRoomRoomNumberInput;delete this.createRoomRoomAuditorNode;delete this.createRoomDeviceChecks;delete this.createRoomAvailableChecks;delete this.createRoomCancelActionNode;delete this.createRoomOkActionNode;delete this.createRoomSelectBuildingNode}.bind(this))},createRoomSave:function(){this.getCreateRoomData(function(e){this.actions.saveRoom(e,function(e){this.notice(this.lp.roomForm.save_success,"success",this.node,{x:"left",y:"bottom"});this.createRoomCancel()}.bind(this))}.bind(this))},getCreateRoomData:function(e){var t=true;var i=this.createRoomNameInput.get("value");if(!i)t=this.createRoomVerification(this.createRoomNameInput,this.lp.roomForm.verification.inputName);var o=false;var n=this.createRoomBuildingInput.retrieve("buildingId");if(!n){var s=this.createRoomBuildingInput.get("value");if(s)o=true}if(!n&&!o)t=this.createRoomVerification(this.createRoomBuildingInput,this.lp.roomForm.verification.inputBuilding);var c=this.createRoomFloorSelect.options[this.createRoomFloorSelect.selectedIndex].value;var a=this.createRoomCapacityInput.get("value");if(!a)t=this.createRoomVerification(this.createRoomCapacityInput,this.lp.roomForm.verification.inputCapacity);var d=this.createRoomRoomNumberInput.get("value");var l=this.createRoomRoomPhoneNode.get("value");var r=this.createRoomRoomAuditorNode.retrieve("names","");var h=[];var u=this.createRoomDeviceChecks.getElements("input");u.each(function(e){if(e.checked)h.push(e.get("value"))}.bind(this));var m=h.join("#");var p=true;var v=this.createRoomAvailableChecks.getElements("input");for(var f=0;f<v.length;f++){if(v[f].checked){p=v[f].get("value")=="y"?true:false;break}}if(!t)return false;if(o){this.actions.saveBuilding({name:s,address:""},function(t){n=t.data.id;var o={name:i,building:n,floor:c,device:m,capacity:a,auditor:r,available:p,roomNumber:d,phoneNumber:l};if(e)e(o)}.bind(this))}else{var g={name:i,building:n,floor:c,device:m,capacity:a,auditor:r,available:p,roomNumber:d,phoneNumber:l};if(e)e(g)}},createRoomVerification:function(e,t){var i=new Element("div",{styles:this.css.createRoomErrorInfoNode,text:t}).inject(e,"after");e.setStyle("border","1px solid #F00");e.store("errorNode",i);return false}});MWF.xApplication.Meeting.Creator=new Class({Implements:[Events],initialize:function(e,t,i,o){this.app=e;this.css=this.app.css;this.lp=this.app.lp;this.data={};this.date=t||new Date;this.hour=i;this.room=o;this.load()},load:function(){this.node=new Element("div",{styles:this.css.createMeetingNode}).inject(this.app.node);this.infoAreaNode=new Element("div",{styles:this.css.createMeetingInfoAreaNode}).inject(this.node);this.contentAreaNode=new Element("div",{styles:this.css.createMeetingContentAreaNode}).inject(this.node);this.loadInfo();this.loadContent();this.cancelNode.addEvents({mouseover:function(){this.cancelNode.setStyles(this.css.createMeetingCancelNode_over)}.bind(this),mouseout:function(){this.cancelNode.setStyles(this.css.createMeetingCancelNode)}.bind(this),mousedown:function(){this.cancelNode.setStyles(this.css.createMeetingCancelNode_down)}.bind(this),mouseup:function(){this.cancelNode.setStyles(this.css.createMeetingCancelNode_over)}.bind(this),click:function(e){this.cancelCreateMeeting(e)}.bind(this)});this.saveNode.addEvents({mouseover:function(){this.saveNode.setStyles(this.css.createMeetingSaveNode_over)}.bind(this),mouseout:function(){this.saveNode.setStyles(this.css.createMeetingSaveNode)}.bind(this),mousedown:function(){this.saveNode.setStyles(this.css.createMeetingSaveNode_down)}.bind(this),mouseup:function(){this.saveNode.setStyles(this.css.createMeetingSaveNode_over)}.bind(this),click:function(e){this.saveCreateMeeting(e)}.bind(this)});this.show()},cancelCreateMeeting:function(e){debugger;if(this.data.id){this.save(function(){if(this.setDescriptionHeightFun)this.app.removeEvent("resize",this.setDescriptionHeightFun);this.app.currentView.reload();this.hide()}.bind(this))}else{var t=this;this.app.confirm("warn",e,this.lp.cancel_createMeeting_title,this.lp.cancel_createMeeting,300,120,function(){if(t.setDescriptionHeightFun)t.app.removeEvent("resize",t.setDescriptionHeightFun);t.hide();this.close()},function(){this.close()})}},getSaveData:function(){var e=this.subjectInputNode.get("value");if(e==this.lp.meetingSubject)e="";var t=this.descriptionInput.get("value");if(t==this.lp.meetingDescription)t="";var i=this.roomId;var o=this.dateInput.get("value");var n=this.beginHourSelect.options[this.beginHourSelect.selectedIndex].value;var s=this.beginMinuteSelect.options[this.beginMinuteSelect.selectedIndex].value;var c=this.endHourSelect.options[this.endHourSelect.selectedIndex].value;var a=this.endMinuteSelect.options[this.endMinuteSelect.selectedIndex].value;var d=o+" "+n+":"+s+":0";var l=o+" "+c+":"+a+":0";var r=this.invitePersonNames;var h=Date.parse(d);var u=Date.parse(l);this.data.subject=e;this.data.description=t;this.data.room=i;this.data.startTime=d;this.data.completedTime=l;this.data.startTimeDate=h;this.data.completedTimeDate=u;this.data.invitePersonList=r},save:function(e){this.getSaveData();var t=new Date;var i="";if(!this.data.subject)i+=this.lp.meeting_input_subject_error;if(!this.data.room)i+=this.lp.meeting_input_room_error;if(!this.data.invitePersonList.length)i+=this.lp.meeting_input_person_error;if(this.data.startTimeDate.diff(this.data.completedTimeDate,"minute")<1)i+=this.lp.meeting_input_time_error;if(t.diff(this.data.startTimeDate,"minute")<0)i+=this.lp.meeting_input_date_error;if(i){this.app.notice(this.lp.meeting_input_error+i,"error",this.app.content,{x:"left",y:"top"});return false}this.app.actions.saveMeeting(this.data,function(t){this.data.id=t.data.id;if(e)e()}.bind(this))},saveCreateMeeting:function(){this.save(function(){this.app.notice(this.lp.meeting_saveSuccess,"success",this.app.content,{x:"right",y:"top"});if(!this.attachmentNode){this.loadAttachment()}}.bind(this))},loadInfo:function(){var e=new Element("div",{styles:this.css.createMeetingInfoHeadNode}).inject(this.infoAreaNode);this.cancelNode=new Element("div",{styles:this.css.createMeetingCancelNode}).inject(e);titleNode=new Element("div",{styles:this.css.createMeetingInfoTitleNode}).inject(e);var t=this.lp.meetingApply.replace(/{person}/g,this.app.desktop.session.user.name);titleNode.set("text",t);this.infoContentNode=new Element("div",{styles:this.css.createMeetingInfoContentNode}).inject(this.infoAreaNode);this.loadBeginDate();this.loadBeginTime();this.loadEndTime();this.loadSelectRoom();this.loadInvite()},loadContent:function(){this.contentHeadNode=new Element("div",{styles:this.css.createMeetingContentHeadNode}).inject(this.contentAreaNode);this.saveNode=new Element("div",{styles:this.css.createMeetingSaveNode}).inject(this.contentHeadNode);this.subjectNode=new Element("div",{styles:this.css.createMeetingSubjectNode}).inject(this.contentHeadNode);this.subjectInputNode=new Element("input",{styles:this.css.createMeetingSubjectInputNode,type:"text",value:this.lp.meetingSubject}).inject(this.subjectNode);var e=new Element("div",{styles:this.css.createMeetingDescriptionNode}).inject(this.contentAreaNode);var t=new Element("div",{styles:this.css.createMeetingDescriptionAreaNode}).inject(e);this.descriptionInput=new Element("textarea",{styles:this.css.createMeetingDescriptionInputNode}).inject(t);this.descriptionInput.set("value",this.lp.meetingDescription);this.setDescriptionHeight();this.setDescriptionHeightFun=this.setDescriptionHeight.bind(this);this.app.addEvent("resize",this.setDescriptionHeightFun);this.subjectInputNode.addEvents({focus:function(){if(this.subjectInputNode.get("value")==this.lp.meetingSubject)this.subjectInputNode.set("value","")}.bind(this),blur:function(){if(!this.subjectInputNode.get("value"))this.subjectInputNode.set("value",this.lp.meetingSubject)}.bind(this)});this.descriptionInput.addEvents({focus:function(){if(this.descriptionInput.get("value")==this.lp.meetingDescription)this.descriptionInput.set("value","")}.bind(this),blur:function(){if(!this.descriptionInput.get("value"))this.descriptionInput.set("value",this.lp.meetingDescription)}.bind(this)})},loadAttachment:function(){this.attachmentNode=new Element("div",{styles:this.css.createMeetingAttachmentNode}).inject(this.contentHeadNode,"after");var e=new Element("div",{styles:this.css.createMeetingAttachmentTitleNode}).inject(this.attachmentNode);e.set("text",this.lp.meetingAttachment);var t=new Element("div",{styles:this.css.createMeetingAttachmentContentNode}).inject(this.attachmentNode);MWF.require("MWF.widget.AttachmentController",function(){this.attachmentController=new MWF.widget.AttachmentController(t,this,{size:"min",isSizeChange:false,isReplace:false});this.attachmentController.load()}.bind(this))},uploadAttachment:function(e,t){if(!this.uploadFileAreaNode){this.createUploadFileNode()}this.fileUploadNode.click()},createUploadFileNode:function(){this.uploadFileAreaNode=new Element("div");var e='<input name="file" type="file" multiple/>';this.uploadFileAreaNode.set("html",e);this.fileUploadNode=this.uploadFileAreaNode.getFirst();this.fileUploadNode.addEvent("change",function(){var e=this.fileUploadNode.files;if(e.length){for(var t=0;t<e.length;t++){var i=e.item(t);var o=new FormData;o.append("file",i);this.app.actions.addAttachment(function(e,t){debugger;if(e.id){this.app.actions.getAttachment(e.id,function(e){if(e.data)this.attachmentController.addAttachment(e.data);this.attachmentController.checkActions()}.bind(this))}this.attachmentController.checkActions()}.bind(this),null,o,this.data.id,i)}}}.bind(this))},deleteAttachments:function(e,t,i){var o=[];i.each(function(e){o.push(e.data.name)}.bind(this));var n=this;this.app.confirm("warn",e,this.lp.deleteAttachmentTitle,this.lp.deleteAttachment+"( "+o.join(", ")+" )",300,120,function(){while(i.length){attachment=i.shift();n.deleteAttachment(attachment)}this.close()},function(){this.close()},null)},deleteAttachment:function(e){this.app.actions.deleteFile(e.data.id,function(t){this.attachmentController.removeAttachment(e);this.attachmentController.checkActions()}.bind(this))},downloadAttachment:function(e,t,i){i.each(function(e){this.app.actions.getFileDownload(e.data.id)}.bind(this))},openAttachment:function(e,t,i){i.each(function(e){this.app.actions.getFile(e.data.id)}.bind(this))},getAttachmentUrl:function(e,t){this.app.actions.getFileUrl(e.data.id,t)},setDescriptionHeight:function(){var e=this.node.getSize();var t=e.y-190;this.descriptionInput.setStyle("height",""+t+"px")},loadBeginDate:function(){var e=new Element("div",{styles:this.css.createMeetingInfoLineNode}).inject(this.infoContentNode);var t=new Element("div",{styles:this.css.createMeetingInfoItemTitleNode,text:this.lp.beginDate}).inject(e);var i=new Element("div",{styles:this.css.createMeetingInfoItemEditNode,html:'<input type="rext" readonly />'}).inject(e);this.dateInput=i.getFirst();this.dateInput.setStyles(this.css.createMeetingInfoItemInputNode);this.dateInput.set("value",this.date.format("%Y-%m-%d"));var o=new Element("div",{styles:this.css.createMeetingInfoItemDownNode}).inject(i);MWF.require("MWF.widget.Calendar",function(){new MWF.widget.Calendar(this.dateInput,{style:"meeting",target:this.node})}.bind(this));o.addEvent("click",function(){this.dateInput.focus()}.bind(this))},loadBeginTime:function(){var e=new Element("div",{
styles:this.css.createMeetingInfoLineNode}).inject(this.infoContentNode);var t=new Element("div",{styles:this.css.createMeetingInfoItemTitleNode,text:this.lp.beginTime}).inject(e);var o=new Element("div",{styles:this.css.createMeetingInfoItemEditNode}).inject(e);this.beginHourSelect=new Element("select",{styles:this.css.createMeetingInfoItemSelectNode}).inject(o);this.beginMinuteSelect=new Element("select",{styles:this.css.createMeetingInfoItemSelectNode}).inject(o);var n=this.hour;if(!n){var s=(new Date).increment("hour",1);var n=s.getHours()}for(i=0;i<24;i++){var c=new Element("option",{value:i,text:i}).inject(this.beginHourSelect);if(i==n)c.set("selected",true)}for(i=0;i<60;i=i+5){var c=new Element("option",{value:i,text:i}).inject(this.beginMinuteSelect);if(i==0)c.set("selected",true)}},loadEndTime:function(){var e=new Element("div",{styles:this.css.createMeetingInfoLineNode}).inject(this.infoContentNode);var t=new Element("div",{styles:this.css.createMeetingInfoItemTitleNode,text:this.lp.endTime}).inject(e);var o=new Element("div",{styles:this.css.createMeetingInfoItemEditNode}).inject(e);this.endHourSelect=new Element("select",{styles:this.css.createMeetingInfoItemSelectNode}).inject(o);this.endMinuteSelect=new Element("select",{styles:this.css.createMeetingInfoItemSelectNode}).inject(o);var n=this.hour;if(!n){var s=(new Date).increment("hour",1);var n=s.getHours()}n++;for(i=0;i<24;i++){var c=new Element("option",{value:i,text:i}).inject(this.endHourSelect);if(i==n)c.set("selected",true)}for(i=0;i<60;i=i+5){var c=new Element("option",{value:i,text:i}).inject(this.endMinuteSelect);if(i==0)c.set("selected",true)}},loadSelectRoom:function(){var e=new Element("div",{styles:this.css.createMeetingInfoLineNode}).inject(this.infoContentNode);var t=new Element("div",{styles:this.css.createMeetingInfoItemTitleNode,text:this.lp.selectRoom}).inject(e);var i=new Element("div",{styles:this.css.createMeetingInfoItemEditNode,html:"<div></div>"}).inject(e);this.roomInput=i.getFirst();this.roomInput.setStyles(this.css.createMeetingInfoItemDivNode);var o=new Element("div",{styles:this.css.createMeetingInfoItemDownNode}).inject(i);this.roomInput.addEvents({click:function(e){this.selectRooms()}.bind(this)});o.addEvent("click",function(){this.selectRooms()}.bind(this));if(this.room){this.app.actions.getRoom(this.room,function(e){this.app.actions.getBuilding(e.data.building,function(t){this.roomId=this.room;this.roomInput.set("text",e.data.name+" ("+t.data.name+")")}.bind(this))}.bind(this))}},selectRooms:function(){this.createRoomNode(function(){this.loadSelectRooms();this.selectRoomNode.setStyle("display","block");this.hideRoomNodeFun=this.hideRoomNode.bind(this);document.body.addEvent("mousedown",this.hideRoomNodeFun);this.selectRoomNode.position({relativeTo:this.roomInput,position:"bottomLeft",edge:"upperLeft",offset:{x:0,y:0}});var e=this.roomInput.getSize();var t=e.x-2;this.selectRoomNode.setStyle("width",""+t+"px")}.bind(this))},createRoomNode:function(e){if(!this.selectRoomNode){this.selectRoomNode=new Element("div",{styles:this.css.createMeetingInfoSelectRoomNode}).inject(this.node);this.selectRoomNode.addEvent("mousedown",function(e){e.stopPropagation()});if(e)e()}else{if(e)e()}},loadSelectRooms:function(){var e=this.dateInput.get("value");var t=this.beginHourSelect.options[this.beginHourSelect.selectedIndex].value;var i=this.beginMinuteSelect.options[this.beginMinuteSelect.selectedIndex].value;var o=this.endHourSelect.options[this.endHourSelect.selectedIndex].value;var n=this.endMinuteSelect.options[this.endMinuteSelect.selectedIndex].value;var s=e+" "+t+":"+i;var c=e+" "+o+":"+n;this.app.actions.listBuildingByRange(s,c,function(e){e.data.each(function(e){var t=new Element("div",{styles:this.css.createMeetingInfoSelectRoomItem1Node}).inject(this.selectRoomNode);var i=new Element("div",{styles:this.css.createMeetingInfoSelectRoomItem1NameNode,text:e.name}).inject(t);var o=new Element("div",{styles:this.css.createMeetingInfoSelectRoomItem1AddrNode,text:e.address}).inject(t);e.roomList.each(function(t,i){if(t.available)this.createRoomSelectNode(t,i,e)}.bind(this))}.bind(this))}.bind(this))},createRoomSelectNode:function(e,t,i){var o=new Element("div",{styles:this.css.roomTitleNode}).inject(this.selectRoomNode);var n=new Element("div",{styles:this.css.roomTitleCapacityNode,text:e.capacity+this.lp.person}).inject(o);var s=new Element("div",{styles:this.css.roomTitleInforNode}).inject(o);var c=new Element("div",{styles:{height:"20px"}}).inject(s);var a=new Element("div",{styles:this.css.roomTitleNumberNode,text:e.roomNumber?"#"+e.roomNumber:""}).inject(c);var d=new Element("div",{styles:this.css.roomTitleNameNode,text:e.name}).inject(c);var l=new Element("div",{styles:this.css.roomTitleIconsNode}).inject(s);var r=e.device.split("#");r.each(function(e){var t=new Element("div",{styles:this.css.roomTitleIconNode,title:this.lp.device[e]}).inject(l);t.setStyle("background-image","url(/x_component_Meeting/$RoomView/default/icon/"+e+".png)")}.bind(this));if(t%2!=0)o.setStyle("background-color","#f4f8ff");o.store("room",e);var h=this;if(e.idle){o.addEvents({mouseover:function(){var e=o.getStyle("background-color");this.store("bgcolor",e);this.setStyle("background-color","#e4edfc")},mouseout:function(){var e=this.retrieve("bgcolor","#FFF");this.setStyle("background-color",e)},click:function(){var e=this.retrieve("room");h.roomId=e.id;h.roomInput.set("text",e.name+" ("+i.name+")");h.hideRoomNode()}})}else{o.setStyle("background-color","#fff6f6");var u=new Element("div",{styles:this.css.roomTitleDisabledIconNode}).inject(o)}},hideRoomNode:function(){this.selectRoomNode.empty();this.selectRoomNode.setStyle("display","none");document.body.removeEvent("mousedown",this.hideRoomNodeFun)},setCreateRoomSelectBuildingNodeSize:function(){var e=this.createRoomBuildingInput.getPosition(this.createRoomBuildingInput.getOffsetParent());this.createRoomSelectBuildingNode.position({relativeTo:this.createRoomBuildingInput,position:"bottomCenter",edge:"upperCenter",offset:{x:0,y:0}});this.createRoomSelectBuildingNode.setStyle("left",e.x);var t=this.createRoomBuildingInput.getSize();var i=t.x-2;this.createRoomSelectBuildingNode.setStyle("width",""+i+"px")},loadInvite:function(){var e=new Element("div",{styles:this.css.createMeetingInfoLineNode}).inject(this.infoContentNode);var t=new Element("div",{styles:this.css.createMeetingInfoItemTitleNode,text:this.lp.invitePerson}).inject(e);var i=new Element("div",{styles:this.css.createMeetingInfoItemEditNode,html:"<div></div>"}).inject(e);this.inviteInput=i.getFirst();this.inviteInput.setStyles(this.css.createMeetingInfoItemDivNode);this.invitePersons=[];this.invitePersonNames=[];MWF.xDesktop.requireApp("Organization","Selector.package",function(){this.inviteInput.addEvents({click:function(){var e={type:"person",names:this.invitePersonNames,count:0,onComplete:function(e){this.invitePersons.each(function(e){e.node.destroy();MWF.release(e)}.bind(this));this.invitePersons=[];this.invitePersonNames=[];var t={actions:this.app.personActions,app:{lp:this.lp}};MWF.require("MWF.widget.Identity",function(){e.each(function(e){var i=this;var o=new MWF.widget.Person(e.data,this.inviteInput,t,false,null,{style:"room"});this.invitePersonNames.push(e.data.name);this.invitePersons.push(o)}.bind(this))}.bind(this))}.bind(this)};var t=new MWF.OrgSelector(this.app.content,e)}.bind(this)})}.bind(this))},show:function(){var e=new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Sine.easeOut});e.start({opacity:1})},hide:function(){var e=new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Sine.easeOut});e.start({opacity:0}).chain(function(){this.node.destroy();MWF.release(this)}.bind(this))}});MWF.xApplication.Meeting.Config=new Class({Implements:[Events],initialize:function(e){this.app=e;this.css=this.app.css;this.lp=this.app.lp;this.configData=this.app.meetingConfig||{};MWF.UD.getPublicData("meetingConfig",function(e){var t=e||{};if(t.process){this.configData.process=t.process}else{this.configData.process=""}this.load()}.bind(this))},load:function(){this.node=new Element("div",{styles:this.css.configNode}).inject(this.app.node);this.contentNode=new Element("div",{styles:this.css.configContentNode}).inject(this.node);var e="<div class='line'><div class='configTitle'>"+this.lp.config.navi+"</div><div><input type='checkbox' "+(this.configData.hideMenu!="static"?"checked":"")+" value='auto' />"+this.lp.config.autoHide+"</div></div>"+"<div class='line'><div class='configTitle'>"+this.lp.config["default"]+"</div><div>"+"<input type='radio' name='configSelectDefaultView' "+(!this.configData.defaultView||this.configData.defaultView=="toMyMeeting"?"checked":"")+" value='toMyMeeting'>"+this.lp.myMeeting+"<input type='radio' name='configSelectDefaultView' "+(this.configData.defaultView=="toMonth"?"checked":"")+" value='toMonth'>"+this.lp.month+"<input type='radio' name='configSelectDefaultView' "+(this.configData.defaultView=="toDay"?"checked":"")+" value='toDay'>"+this.lp.day+"<input type='radio' name='configSelectDefaultView' "+(this.configData.defaultView=="toList"?"checked":"")+" value='toList'>"+this.lp.list+"<input type='radio' name='configSelectDefaultView' "+(this.configData.defaultView=="toRoom"?"checked":"")+" value='toRoom'>"+this.lp.room+"</div></div>"+"<div class='line'><div class='configTitle'>"+this.lp.config.legend+"</div><div style='overflow: hidden; height: 50px'>"+"<div style='float: left; width: 80px; height: 20px;margin-right:10px'>"+"<div style='float: left; width: 10px; height: 20px; background-color:#2968cf'></div>"+"<div style='margin-left:15px; line-height:20px; height:20px'>"+this.lp.config.wait+"</div></div>"+"<div style='float: left; width: 80px; height: 20px;margin-right:10px'>"+"<div style='float: left; width: 10px; height: 20px; background-color:#18da14'></div>"+"<div style='margin-left:15px; line-height:20px; height:20px'>"+this.lp.config.progress+"</div></div>"+"<div style='float: left; width: 80px; height: 20px;margin-right:10px'>"+"<div style='float: left; width: 10px; height: 20px; background-color:#ecd034'></div>"+"<div style='margin-left:15px; line-height:20px; height:20px'>"+this.lp.config.invite+"</div></div>"+"<div style='float: left; width: 80px; height: 20px;margin-right:10px'>"+"<div style='float: left; width: 10px; height: 20px; background-color:#555555'></div>"+"<div style='margin-left:15px; line-height:20px; height:20px'>"+this.lp.config.completed+"</div></div>"+"</div></div>"+"<div class='line'><div class='configTitle'>"+this.lp.config.applyProcess+"</div><div></div></div>";this.contentNode.set("html",e);this.contentNode.getElements("div.line").setStyles(this.css.configContentLine);this.contentNode.getElements("div.configTitle").setStyles(this.css.configTitleDiv);this.processNode=this.contentNode.getLast("div").getLast("div");if(this.app.isManager&&false){this.createApplicationSelect()}else{this.contentNode.getLast("div").setStyle("display","none")}this.actionNode=new Element("div",{styles:this.css.configActionNode}).inject(this.node);this.cancelNode=new Element("div",{styles:this.css.configActionCancelNode,text:this.app.lp.cancel}).inject(this.actionNode);this.saveNode=new Element("div",{styles:this.css.configActionSaveNode,text:this.app.lp.save}).inject(this.actionNode);this.cancelNode.addEvent("click",this.hide.bind(this));this.saveNode.addEvent("click",this.save.bind(this));this.node.addEvent("mousedown",function(e){e.stopPropagation()}.bind(this));this.show()},createApplicationSelect:function(){MWF.xDesktop.requireApp("process.ApplicationExplorer","Actions.RestActions",function(){this.appActions=new MWF.xApplication.process.ApplicationExplorer.Actions.RestActions;this.getCurrentProcess(function(){this.applicationSelect=new Element("select").inject(this.processNode);var e=new Element("option",{text:"",value:"",selected:true}).inject(this.applicationSelect);this.appActions.listApplication("",function(e){e.data.each(function(e){var t=new Element("option",{text:e.name,value:e.id,selected:this.currentProcess?this.currentProcess.application==e.id:false}).inject(this.applicationSelect)}.bind(this));if(this.applicationSelect.selectedIndex&&this.applicationSelect.selectedIndex!=0){var t=this.applicationSelect.options[this.applicationSelect.selectedIndex].get("value");if(t)this.createProcessSelect(t)}this.applicationSelect.addEvent("change",function(){var e=this.applicationSelect.options[this.applicationSelect.selectedIndex].get("value");this.createProcessSelect(e)}.bind(this))}.bind(this))}.bind(this))}.bind(this))},createProcessSelect:function(e){if(e){if(!this.processSelect){this.processSelect=new Element("select").inject(this.processNode)}else{this.processSelect.empty()}var t=new Element("option",{text:"",value:"",selected:true}).inject(this.processSelect);this.appActions.listProcess(e,function(e){e.data.each(function(e){var t=new Element("option",{text:e.name,value:e.id,selected:this.currentProcess?this.currentProcess.id==e.id:false}).inject(this.processSelect)}.bind(this))}.bind(this))}else{if(this.processSelect){this.processSelect.destroy();this.processSelect=null}}},getCurrentProcess:function(e){if(this.configData.process){this.appActions.getProcess(this.configData.process,function(t){this.currentProcess=t.data;if(e)e()}.bind(this))}else{this.currentProcess=null;if(e)e()}},save:function(){var e="auto";var t="toMyMeeting";var i="";var o=this.contentNode.getFirst("div");var n=o.getElement("input");if(n)if(!n.checked)e="static";o=o.getNext();var s=o.getElements("input");for(var c=0;c<s.length;c++){if(s[c].checked){t=s[c].get("value");break}}if(this.processSelect){i=this.processSelect.options[this.processSelect.selectedIndex].get("value");MWF.UD.putPublicData("meetingConfig",{process:i})}MWF.UD.putData("meetingConfig",{hideMenu:e,defaultView:t});this.hide()},show:function(){this.node.setStyles(this.css.configNode);var e=new Fx.Morph(this.node,{duration:"500",transition:Fx.Transitions.Expo.easeOut});e.start({opacity:1}).chain(function(){this.hideFun=this.hide.bind(this);this.app.content.addEvent("mousedown",this.hideFun)}.bind(this))},hide:function(){this.node.destroy();this.app.content.removeEvent("mousedown",this.hideFun);MWF.release(this)}});