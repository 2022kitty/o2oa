<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="main" default="default">
	<basename property="project" file="${basedir}" />
	<dirname property="root.dir" file="${basedir}../" />
	<property file="${root.dir}/building/build.properties" />
	<include file="${root.dir}/building/build_common.xml" as="common" />


	<tstamp>
		<format property="TODAY" pattern="yyyyMMdd" locale="zh-cn" />
	</tstamp>

	<target name="default" depends="windowsLinux,macos,aix" />

	<target name="windowsLinux">
		<mkdir dir="dist/o2server" />
		<mkdir dir="versions" />
		<delete includeemptydirs="true">
			<fileset dir="dist/o2server" includes="**/*" />
		</delete>
		<copy todir="dist/o2server/commons/">
			<fileset dir="D:/o2server/commons/" />
		</copy>
		<copy todir="dist/o2server/config/sample">
			<fileset dir="D:/o2server/config/sample" />
		</copy>
		<mkdir dir="dist/o2server/jvm" />
		<copy todir="dist/o2server/jvm/windows">
			<fileset dir="D:/o2server/jvm/windows" />
		</copy>
		<copy todir="dist/o2server/jvm/linux">
			<fileset dir="D:/o2server/jvm/linux" />
		</copy>
		<copy todir="dist/o2server/local/sample">
			<fileset dir="D:/o2server/local/sample" />
		</copy>
		<mkdir dir="dist/o2server/logs" />
		<mkdir dir="dist/o2server/servers/centerServer/webapps" />
		<mkdir dir="dist/o2server/servers/centerServer/work" />
		<mkdir dir="dist/o2server/servers/applicationServer/webapps" />
		<mkdir dir="dist/o2server/servers/applicationServer/work" />
		<copy todir="dist/o2server/servers/webServer/">
			<fileset dir="D:/o2server/servers/webServer/">
				<exclude name="**/.svn/" />
				<exclude name="**/Thumbs.db" />
				<exclude name="**/*.bak" />
				<exclude name="**/*.temp" />
				<exclude name="**/*.tmp" />
				<exclude name="**/~*" />
			</fileset>
		</copy>
		<copy todir="dist/o2server/store/">
			<fileset dir="D:/o2server/store/" />
		</copy>
		<copy todir="dist/o2server">
			<fileset dir="D:/o2server/">
				<include name="console.jar" />
				<include name="start_windows.bat" />
				<include name="start_linux.sh" />
				<include name="stop_windows.bat" />
				<include name="stop_linux.sh" />
			</fileset>
		</copy>
		<echo file="dist/o2server/version.o2" append="false">4${TODAY}</echo>
		<mkdir dir="${root.dir}/versions" />
		<zip encoding="utf-8" destfile="${root.dir}/versions/o2server${TODAY}.zip" update="false">
			<zipfileset dir="dist/o2server/" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server" />
		</zip>
	</target>


	<target name="aix">
		<mkdir dir="dist/o2server" />
		<mkdir dir="versions" />
		<delete includeemptydirs="true">
			<fileset dir="dist/o2server" includes="**/*" />
		</delete>
		<copy todir="dist/o2server/commons/">
			<fileset dir="D:/o2server/commons/" />
		</copy>
		<copy todir="dist/o2server/config/sample">
			<fileset dir="D:/o2server/config/sample" />
		</copy>
		<mkdir dir="dist/o2server/jvm" />
		<copy todir="dist/o2server/jvm/aix">
			<fileset dir="D:/o2server/jvm/aix" />
		</copy>
		<copy todir="dist/o2server/local/sample">
			<fileset dir="D:/o2server/local/sample" />
		</copy>
		<mkdir dir="dist/o2server/logs" />
		<mkdir dir="dist/o2server/servers/centerServer/webapps" />
		<mkdir dir="dist/o2server/servers/centerServer/work" />
		<mkdir dir="dist/o2server/servers/applicationServer/webapps" />
		<mkdir dir="dist/o2server/servers/applicationServer/work" />
		<copy todir="dist/o2server/servers/webServer/">
			<fileset dir="D:/o2server/servers/webServer/">
				<exclude name="**/.svn/" />
				<exclude name="**/Thumbs.db" />
				<exclude name="**/*.bak" />
				<exclude name="**/*.temp" />
				<exclude name="**/*.tmp" />
				<exclude name="**/~*" />
			</fileset>
		</copy>
		<copy todir="dist/o2server/store/">
			<fileset dir="D:/o2server/store/" />
		</copy>
		<copy todir="dist/o2server">
			<fileset dir="D:/o2server/">
				<include name="console.jar" />
				<include name="start_aix.sh" />
				<include name="stop_aix.sh" />
			</fileset>
		</copy>
		<echo file="dist/o2server/version.o2" append="false">4${TODAY}</echo>
		<mkdir dir="${root.dir}/versions" />
		<zip encoding="utf-8" destfile="${root.dir}/versions/o2server${TODAY}_aix.zip" update="false">
			<zipfileset dir="dist/o2server/" filemode="777" dirmode="777" encoding="utf-8" />
		</zip>
	</target>

	<target name="macos">
		<mkdir dir="dist/o2server" />
		<mkdir dir="versions" />
		<delete includeemptydirs="true">
			<fileset dir="dist/o2server" includes="**/*" />
		</delete>
		<copy todir="dist/o2server/commons/">
			<fileset dir="D:/o2server/commons/" />
		</copy>
		<copy todir="dist/o2server/config/sample">
			<fileset dir="D:/o2server/config/sample" />
		</copy>
		<mkdir dir="dist/o2server/jvm" />
		<copy todir="dist/o2server/jvm/macos">
			<fileset dir="D:/o2server/jvm/macos" />
		</copy>
		<copy todir="dist/o2server/local/sample">
			<fileset dir="D:/o2server/local/sample" />
		</copy>
		<mkdir dir="dist/o2server/logs" />
		<mkdir dir="dist/o2server/servers/centerServer/webapps" />
		<mkdir dir="dist/o2server/servers/centerServer/work" />
		<mkdir dir="dist/o2server/servers/applicationServer/webapps" />
		<mkdir dir="dist/o2server/servers/applicationServer/work" />
		<copy todir="dist/o2server/servers/webServer/">
			<fileset dir="D:/o2server/servers/webServer/">
				<exclude name="**/.svn/" />
				<exclude name="**/Thumbs.db" />
				<exclude name="**/*.bak" />
				<exclude name="**/*.temp" />
				<exclude name="**/*.tmp" />
				<exclude name="**/~*" />
			</fileset>
		</copy>
		<copy todir="dist/o2server/store/">
			<fileset dir="D:/o2server/store/" />
		</copy>
		<copy todir="dist/o2server">
			<fileset dir="D:/o2server/">
				<include name="console.jar" />
				<include name="start_macos.sh" />
				<include name="stop_macos.sh" />
			</fileset>
		</copy>
		<echo file="dist/o2server/version.o2" append="false">4${TODAY}</echo>
		<mkdir dir="${root.dir}/versions" />
		<zip encoding="utf-8" destfile="${root.dir}/versions/o2server${TODAY}_macos.zip" update="false">
			<zipfileset dir="dist/o2server/" filemode="777" dirmode="777" encoding="utf-8" />
		</zip>
	</target>
</project>